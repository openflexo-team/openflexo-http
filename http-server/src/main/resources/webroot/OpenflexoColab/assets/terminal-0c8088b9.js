import{c0 as Ee,B as a,bj as k,_ as b,a as d,cx as mt,vx as yt,v6 as ce,bO as ue,Y as he,e as O,rG as il,vy as E,vz as Er,vA as ct,vB as Lt,rH as nl,av as L,sa as es,U as M,aQ as Z,N as Xe,D as q,vC as sl,g as gt,nq as Ye,ek as re,vD as St,S as G,el as vs,dr as rl,vE as ol,cd as Ri,b3 as U,ic as ot,dq as Fn,aF as g,vF as u,vG as Te,fY as Ar,aO as Yt,gq as to,L as ee,ao as si,vH as Ke,bz as me,bB as Mt,vI as Ne,bA as ge,dK as wt,f1 as al,dz as On,fO as ll,bM as Wi,b_ as Kt,fm as Nn,v5 as ne,bT as ie,aj as Bo,ak as Vo,uu as Lr,I as Ho,bC as cl,q0 as Bn,da as hl,bH as dl,bI as ul,cp as ri,sg as Go,qZ as ml,jM as Vn,z as xt,vJ as Qe,vK as pt,n as oi,aP as Hn,aT as ai,bD as Rt,aU as Je,vL as li,k6 as $o,tq as Q,a1 as se,O as ft,vM as gl,u1 as Mr,Q as Wt,a0 as Ie,sX as Be,bx as zo,aK as Fi,f as Rr,nd as Wr,b as Gn,vN as pl,eR as fl,aL as $n,vO as Oi,io as Ft,vP as an,vQ as ln,vR as cn,vS as Vi,aW as _l,vT as wl,rn as vl,rm as bl,y as Sl,vU as tt,bS as Qt,mU as io,vV as Cl,bZ as Ko,vW as Fr,iv as N,or as It,vX as hn,a2 as Y,vY as Me,vZ as qo,hZ as Uo,dF as jo,jh as yl,b5 as Ct,v_ as xl,v$ as Il,w0 as kl,w1 as no,nV as pi,iE as Tl,qr as zn,w2 as Or,mN as Dl,w3 as Pl,w4 as El,E as v,w5 as Al,w6 as Hi,w7 as Gi,w8 as Ll,w9 as Xo,aS as Kn,aH as I,b4 as Yo,mV as qn,sW as Ml,wa as so,wb as Rl,wc as Wl,ci as $i,wd as Fl,we as Qo,wf as Jo,oK as Jt,eZ as Re,on as Zo,wg as bs,wh as Ss,oQ as Un,wi as ea,i8 as Ve,cy as jn,f_ as Nr,dx as ta,dw as kt,wj as z,bg as De,wk as be,d as J,wl as Ol,wm as Nl,dI as ia,t as we,wn as ke,i2 as na,c2 as sa,wo as Bl,wp as Vl,wq as Hl,dG as Br,eQ as Gl,V as Xn,Z as Ni,w as Bi,c_ as ra,cZ as dn,nr as Ue,rR as Cs,e0 as oa,wr as aa,oZ as $l,aD as zl,ws as ro,hP as Kl,rh as Xi,wt as ql,wu as Ul,wv as jl,jc as Xl,ww as Yl,wx as Ql,aw as Jl,wy as la,aR as Yn,dE as Zl,aa as V,ac as ye,pO as ca,pP as ha,wz as ec,wA as tc,wB as ic,wC as ys,wD as nc,wE as sc,wF as rc,wG as oc,H as Se,$ as _e,hb as ac,dj as lc,x as it,o as cc,wH as hc,wI as dc,m as at,hB as uc,wJ as mc,ki as gc,G as _t,ot as pc,qi as fc,eM as ts,u9 as _c,wK as wc,a_ as vc,ea as bc,wL as da,cS as ua,wM as Sc,wN as Cc,wO as yc,wP as xc,wQ as Ic,pk as vt,wR as kc,wS as Tc,wT as Dc,wU as Pc,wV as Ec,wW as Ac,sn as le,a3 as xe,X as bi,bN as Lc,iI as Mc,u as Rc,wX as xs,dc as oo,qo as Is,ec as Wc,ag as Fc,b1 as ao,wY as Oc,k4 as Nc,ep as Bc,dW as Vc,wZ as Hc,w_ as ma,d1 as Gc,w$ as ks,x0 as $c,fw as fi,fx as un,dX as qt,x1 as zc,x2 as Kc,fk as qc,x3 as Ts,x4 as Uc,cA as Vr,x5 as ga,x6 as pa,d0 as Ds,ie as lo,x7 as hi,x8 as jc,x9 as Xc,xa as Yc,xb as Qc,iA as Jc,iD as Zc,bu as eh,xc as th,cl as fa,of as ih,dm as nh,dn as sh,b9 as rh,bY as mn,rB as _a,is as oh,it as ah,d2 as co,xd as lh,sE as ho,t_ as ch,iw as hh,ab as dh,bW as wa,aN as pe,xe as uo,hT as uh,rk as mh,r3 as gh,ri as ph,xf as mo,jd as fh,bv as va,xg as go,xh as zi,xi as _h,dS as wh,xj as gn,iH as vh,xk as bh,i_ as Sh,kz as Ch,iB as yh,eV as xh,kw as Ih,k as Ce,fv as kh,as as ba,aB as Th,xl as Dh,jO as $e,xm as Ph,xn as Eh,xo as Ah}from"./index-e8d740ba.js";import{I as Ot}from"./workbenchThemeService-428461e4.js";import{m as Lh,s as Mh,a as Rh,e as Ut,w as fe,i as Fe,p as Sa,t as di,b as Wh}from"./quickPickPin-de09e26a.js";import{g as Fh}from"./viewsService-21694f24.js";import{g as Ca}from"./quickaccess-214cf2a6.js";import{D as ya}from"./dropdownWithPrimaryActionViewItem-ccac546f.js";function jt(r,e={}){let t="";return e.excludeLeadingNewLine||(t+=`\r
`),t+="\x1B[0m\x1B[7m * ",e.loudFormatting?t+="\x1B[0;104m":t+="\x1B[0m",t+=` ${r} \x1B[0m
\r`,t}const xa=Ee("terminal-view-icon",k.terminal,a("terminalViewIcon","View icon of the terminal view.")),Oh=Ee("terminal-rename",k.gear,a("renameTerminalIcon","Icon for rename in the terminal quick menu.")),Ia=Ee("terminal-kill",k.trash,a("killTerminalIcon","Icon for killing a terminal instance.")),Nh=Ee("terminal-new",k.add,a("newTerminalIcon","Icon for creating a new terminal instance.")),Bh=Ee("terminal-configure-profile",k.gear,a("configureTerminalProfileIcon","Icon for creating a new terminal profile.")),Vh=Ee("terminal-decoration-mark",k.circleSmallFilled,a("terminalDecorationMark","Icon for a terminal decoration mark.")),Hh=Ee("terminal-decoration-incomplete",k.circle,a("terminalDecorationIncomplete","Icon for a terminal decoration of a command that was incomplete.")),Gh=Ee("terminal-decoration-error",k.errorSmall,a("terminalDecorationError","Icon for a terminal decoration of a command that errored.")),$h=Ee("terminal-decoration-success",k.circleFilled,a("terminalDecorationSuccess","Icon for a terminal decoration of a command that was successful.")),zh=Ee("terminal-command-history-remove",k.close,a("terminalCommandHistoryRemove","Icon for removing a terminal command from command history.")),Kh=Ee("terminal-command-history-output",k.output,a("terminalCommandHistoryOutput","Icon for viewing output of a terminal command.")),qh=Ee("terminal-command-history-fuzzy-search",k.searchFuzzy,a("terminalCommandHistoryFuzzySearch","Icon for toggling fuzzy search of command history.")),x={terminal:a("terminal","Terminal"),new:a("terminal.new","New Terminal"),doNotShowAgain:a("doNotShowAgain","Do Not Show Again"),currentSessionCategory:a("currentSessionCategory","current session"),previousSessionCategory:a("previousSessionCategory","previous session"),actionCategory:{value:a("terminalCategory","Terminal"),original:"Terminal"},focus:{value:a("workbench.action.terminal.focus","Focus Terminal"),original:"Focus Terminal"},kill:{value:a("killTerminal","Kill Terminal"),original:"Kill Terminal",short:a("killTerminal.short","Kill")},moveToEditor:{value:a("moveToEditor","Move Terminal into Editor Area"),original:"Move Terminal into Editor Area"},moveToTerminalPanel:{value:a("workbench.action.terminal.moveToTerminalPanel","Move Terminal into Panel"),original:"Move Terminal into Panel"},changeIcon:{value:a("workbench.action.terminal.changeIcon","Change Icon..."),original:"Change Icon..."},changeColor:{value:a("workbench.action.terminal.changeColor","Change Color..."),original:"Change Color..."},split:{value:a("splitTerminal","Split Terminal"),original:"Split Terminal",short:a("splitTerminal.short","Split")},unsplit:{value:a("unsplitTerminal","Unsplit Terminal"),original:"Unsplit Terminal"},rename:{value:a("workbench.action.terminal.rename","Rename..."),original:"Rename..."},toggleSizeToContentWidth:{value:a("workbench.action.terminal.sizeToContentWidthInstance","Toggle Size to Content Width"),original:"Toggle Size to Content Width"},focusHover:{value:a("workbench.action.terminal.focusHover","Focus Hover"),original:"Focus Hover"},sendSequence:{value:a("workbench.action.terminal.sendSequence","Send Custom Sequence To Terminal"),original:"Send Custom Sequence To Terminal"},newWithCwd:{value:a("workbench.action.terminal.newWithCwd","Create New Terminal Starting in a Custom Working Directory"),original:"Create New Terminal Starting in a Custom Working Directory"},renameWithArgs:{value:a("workbench.action.terminal.renameWithArg","Rename the Currently Active Terminal"),original:"Rename the Currently Active Terminal"}};let Le=[],Zt=class ka extends il{constructor(e,t,i,n,s,o,l){super(ka.PREFIX,{canAcceptInBackground:!0}),this._editorService=e,this._terminalService=t,this._terminalEditorService=i,this._terminalGroupService=n,this._commandService=s,this._themeService=o,this._instantiationService=l}_getPicks(e){Le=[],Le.push({type:"separator",label:"panel"});const t=this._terminalGroupService.groups;for(let o=0;o<t.length;o++){const l=t[o];for(let c=0;c<l.terminalInstances.length;c++){const h=l.terminalInstances[c],m=this._createPick(h,c,e,{groupIndex:o,groupSize:l.terminalInstances.length});m&&Le.push(m)}}Le.length>0&&Le.push({type:"separator",label:"editor"});const i=this._terminalEditorService.instances;for(let o=0;o<i.length;o++){const l=i[o];l.target=E.Editor;const c=this._createPick(l,o,e);c&&Le.push(c)}Le.length>0&&Le.push({type:"separator"});const n=a("workbench.action.terminal.newplus","Create New Terminal");Le.push({label:`$(plus) ${n}`,ariaLabel:n,accept:()=>this._commandService.executeCommand("workbench.action.terminal.new")});const s=a("workbench.action.terminal.newWithProfilePlus","Create New Terminal With Profile");return Le.push({label:`$(plus) ${s}`,ariaLabel:s,accept:()=>this._commandService.executeCommand("workbench.action.terminal.newWithProfile")}),Le}_createPick(e,t,i,n){const s=this._instantiationService.invokeFunction(Er,e),o=n?n.groupSize>1?`${n.groupIndex+1}.${t+1}`:`${n.groupIndex+1}`:`${t+1}`,l=`$(${s}) ${o}: ${e.title}`,c=[],h=ct(e);h&&c.push(h);const m=Lt(e,this._themeService.getColorTheme().type);m&&c.push(...m);const p=nl(i,l,!0);if(p)return{label:l,description:e.description,highlights:{label:p},buttons:[{iconClass:L.asClassName(Oh),tooltip:a("renameTerminal","Rename Terminal")},{iconClass:L.asClassName(Ia),tooltip:x.kill.value}],iconClasses:c,trigger:w=>{switch(w){case 0:return this._commandService.executeCommand("workbench.action.terminal.rename",e),es.NO_ACTION;case 1:return this._terminalService.safeDisposeTerminal(e),es.REMOVE_ITEM}return es.NO_ACTION},accept:(w,f)=>{if(e.target===E.Editor){const _=this._editorService.findEditors(e.resource);this._terminalEditorService.openEditor(e,{viewColumn:_==null?void 0:_[0].groupId}),this._terminalEditorService.setActiveInstance(e)}else this._terminalGroupService.showPanel(!f.inBackground),this._terminalGroupService.setActiveInstance(e)}}}};Zt.PREFIX="term ";Zt=b([d(0,mt),d(1,yt),d(2,yt),d(3,ce),d(4,ue),d(5,he),d(6,O)],Zt);function Ta(r,e){const t=[{name:null,description:a("terminalAutomaticProfile","Automatically detect the default")}];return t.push(...r.map(i=>({name:i.profileName,description:Uh(i)}))),e&&t.push(...e.map(i=>({name:i.title,description:jh(i)}))),{values:t.map(i=>i.name),markdownDescriptions:t.map(i=>i.description)}}function Uh(r){let e=`$(${L.isThemeIcon(r.icon)?r.icon.id:r.icon?r.icon:k.terminal.id}) ${r.profileName}
- path: ${r.path}`;return r.args&&(typeof r.args=="string"?e+=`
- args: "${r.args}"`:e+=`
- args: [${r.args.length===0?"":`'${r.args.join("','")}'`}]`),r.overrideName!==void 0&&(e+=`
- overrideName: ${r.overrideName}`),r.color&&(e+=`
- color: ${r.color}`),r.env&&(e+=`
- env: ${JSON.stringify(r.env)}`),e}function jh(r){return`$(${L.isThemeIcon(r.icon)?r.icon.id:r.icon?r.icon:k.terminal.id}) ${r.title}
- extensionIdentifier: ${r.extensionIdentifier}`}function Da(r,e){if(!r&&!e)return!0;if(typeof r=="string"&&typeof e=="string")return r===e;if(Array.isArray(r)&&Array.isArray(e)){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}return!1}function Xh(r,e){if(!r&&!e)return!0;if(!r||!e)return!1;if(L.isThemeIcon(r)&&L.isThemeIcon(e))return r.id===e.id&&r.color===e.color;if(typeof r=="object"&&"light"in r&&"dark"in r&&typeof e=="object"&&"light"in e&&"dark"in e){const t=r,i=e;if((M.isUri(t.light)||ze(t.light))&&(M.isUri(t.dark)||ze(t.dark))&&(M.isUri(i.light)||ze(i.light))&&(M.isUri(i.dark)||ze(i.dark)))return t.light.path===i.light.path&&t.dark.path===i.dark.path}if(M.isUri(r)&&M.isUri(e)||ze(r)||ze(e)){const t=r,i=e;return t.path===i.path&&t.scheme===i.scheme}return!1}function ze(r){return r?typeof r.path=="string"&&typeof r.scheme=="string":!1}let is;function pn(r){return is||(is=r.get(O).createInstance(fn,"commands")),is}let ns;function Ps(r){return ns||(ns=r.get(O).createInstance(fn,"dirs")),ns}const Yi=new Map;async function Yh(r,e){const t=Yi.get(e);if(t===null)return[];if(t!==void 0)return t;let i;switch(e){case"bash":i=await Jh(r);break;case"pwsh":i=await ed(r);break;case"zsh":i=await Zh(r);break;case"fish":i=await td(r);break;default:return[]}if(i===void 0)return Yi.set(e,null),[];const n=Array.from(i);return Yi.set(e,n),n}function Qh(){Yi.clear()}let fn=class extends q{get entries(){return this._ensureUpToDate(),this._entries.entries()}constructor(e,t,i){super(),this._storageDataKey=e,this._configurationService=t,this._storageService=i,this._timestamp=0,this._isReady=!1,this._isStale=!0,this._entries=new sl(this._getHistoryLimit()),this._configurationService.onDidChangeConfiguration(n=>{n.affectsConfiguration("terminal.integrated.shellIntegration.history")&&(this._entries.limit=this._getHistoryLimit())}),this._storageService.onDidChangeValue(n=>{n.key===this._getTimestampStorageKey()&&!this._isStale&&(this._isStale=this._storageService.getNumber(this._getTimestampStorageKey(),-1,0)!==this._timestamp)})}add(e,t){this._ensureUpToDate(),this._entries.set(e,t),this._saveState()}remove(e){this._ensureUpToDate(),this._entries.delete(e),this._saveState()}clear(){this._ensureUpToDate(),this._entries.clear(),this._saveState()}_ensureUpToDate(){this._isReady||(this._loadState(),this._isReady=!0),this._isStale&&(this._entries.clear(),this._loadState(),this._isStale=!1)}_loadState(){this._timestamp=this._storageService.getNumber(this._getTimestampStorageKey(),-1,0);const e=this._loadPersistedState();if(e)for(const t of e.entries)this._entries.set(t.key,t.value)}_loadPersistedState(){const e=this._storageService.get(this._getEntriesStorageKey(),-1);if(e===void 0||e.length===0)return;let t;try{t=JSON.parse(e)}catch{return}return t}_saveState(){const e={entries:[]};this._entries.forEach((t,i)=>e.entries.push({key:i,value:t})),this._storageService.store(this._getEntriesStorageKey(),JSON.stringify(e),-1,1),this._timestamp=Date.now(),this._storageService.store(this._getTimestampStorageKey(),this._timestamp,-1,1)}_getHistoryLimit(){const e=this._configurationService.getValue("terminal.integrated.shellIntegration.history");return typeof e=="number"?e:100}_getTimestampStorageKey(){return`terminal.history.timestamp.${this._storageDataKey}`}_getEntriesStorageKey(){return`terminal.history.entries.${this._storageDataKey}`}};fn=b([d(1,Z),d(2,Xe)],fn);async function Jh(r){const e=r.get(gt),t=r.get(Ye),i=await t.getEnvironment();if((i==null?void 0:i.os)===1||!i&&re)return;const n=await Si(St.HOME,".bash_history",!1,e,t);if(n===void 0)return;const s=n.split(`
`),o=new Set;let l,c,h;for(let m=0;m<s.length;m++){l=s[m],c===void 0?c=l:c+=`
${l}`;for(let p=0;p<l.length;p++)h?l[p]===h&&(h=void 0):l[p].match(/['"]/)&&(h=l[p]);h===void 0&&(c.length>0&&o.add(c.trim()),c=void 0)}return o.values()}async function Zh(r){const e=r.get(gt),t=r.get(Ye),i=await t.getEnvironment();if((i==null?void 0:i.os)===1||!i&&re)return;const n=await Si(St.HOME,".zsh_history",!1,e,t);if(n===void 0)return;const s=n.split(/\:\s\d+\:\d+;/),o=new Set;for(let l=0;l<s.length;l++){const c=s[l].replace(/\\\n/g,`
`).trim();c.length>0&&o.add(c)}return o.values()}async function ed(r){const e=r.get(gt),t=r.get(Ye);let i,n;const s=await t.getEnvironment(),o=(s==null?void 0:s.os)===1||!s&&re;o?(i=St.APPDATA,n="\\Microsoft\\Windows\\PowerShell\\PSReadLine\\ConsoleHost_history.txt"):(i=St.HOME,n=".local/share/powershell/PSReadline/ConsoleHost_history.txt");const l=await Si(i,n,o,e,t);if(l===void 0)return;const c=l.split(`
`),h=new Set;let m,p,w;for(let f=0;f<c.length;f++){if(m=c[f],p===void 0?p=m:p+=`
${m}`,!m.endsWith("`")){const _=p.trim();_.length>0&&h.add(_),p=void 0;continue}for(let _=0;_<m.length;_++)w?m[_]===w&&(w=void 0):m[_].match(/`/)&&(w=m[_]);if(w)p=p.replace(/`$/,""),w=void 0;else{const _=p.trim();_.length>0&&h.add(_),p=void 0}}return h.values()}async function td(r){const e=r.get(gt),t=r.get(Ye),i=await t.getEnvironment();if((i==null?void 0:i.os)===1||!i&&re)return;const s=await(St.XDG_DATA_HOME?Si(St.XDG_DATA_HOME,"fish/fish_history",!1,e,t):Si(St.HOME,".local/share/fish/fish_history",!1,e,t));if(s===void 0)return;const o=new Set,l=s.split(`
`).filter(c=>c.startsWith("- cmd:")).map(c=>c.substring(6).trimStart());for(let c=0;c<l.length;c++){const h=id(l[c]).trim();h.length>0&&o.add(h)}return o.values()}function id(r){return nd(/(^|[^\\])((?:\\\\)*)(\\n)/g,r,`$1$2
`)}function nd(r,e,t){let i,n=e;for(;;)if(i=n,n=n.replace(r,t),n===i)return n}async function Si(r,e,t,i,n){var c;if(!r)return;const s=!!((c=n.getConnection())!=null&&c.remoteAuthority),o=M.from({scheme:s?G.vscodeRemote:G.file,path:(t?vs.join:rl.join)(r,e)});let l;try{l=await i.readFile(o)}catch(h){if(h instanceof ol&&h.fileOperationResult===1)return;throw h}if(l!==void 0)return l.value.toString()}const Pa="─────────",Ea=a("showTerminalTabs","Show Tabs"),_n=x.actionCategory;async function Aa(r,e,t,i){switch(r.config.splitCwd){case"workspaceRoot":if(t!==void 0&&i!==void 0){if(t.length===1)return t[0].uri;if(t.length>1){const n={placeHolder:a("workbench.action.terminal.newWorkspacePlaceholder","Select current working directory for new terminal")},s=await i.executeCommand(Lr,[n]);return s?Promise.resolve(s.uri):void 0}}return"";case"initial":return e.getInitialCwd();case"inherited":return e.getCwd()}}const La=async(r,e)=>{const t=r.get(ne).activeInstance;if(t){const i=ot(e)&&"text"in e?Qi(e.text):void 0;if(!i)return;const n=r.get(Bn),s=r.get(ge),l=r.get(Vn).getLastActiveWorkspaceRoot(t.isRemote?G.vscodeRemote:G.file),c=l?xt(s.getWorkspaceFolder(l)):void 0,h=await n.resolveAsync(c,i);t.sendText(h,!1)}};let Es=class extends U{constructor(e){super("workbench.action.terminal.launchHelp",a("terminalLaunchHelp","Open Help")),this._openerService=e}async run(){this._openerService.open("https://aka.ms/vscode-troubleshoot-terminal-launch")}};Es=b([d(0,Ri)],Es);function P(r){r.f1=r.f1??!0,r.category=r.category??_n,r.precondition=r.precondition??u.processSupported;const e=r.run,t=r;return delete t.run,Bo(class extends Vo{constructor(){super(t)}run(i,n){return e(Ma(i),i,n)}})}function F(r){const e=r.run;return P({...r,run:(t,i,n)=>{const s=t.service.activeInstance;if(s)return e(s,t,i,n)}})}function Ma(r){return{service:r.get(ne),groupService:r.get(ce),instanceService:r.get(Ne),editorService:r.get(yt),profileService:r.get(Qe),profileResolverService:r.get(pt)}}function sd(){P({id:"workbench.action.terminal.newInActiveWorkspace",title:{value:a("workbench.action.terminal.newInActiveWorkspace","Create New Terminal (In Active Workspace)"),original:"Create New Terminal (In Active Workspace)"},run:async r=>{if(r.service.isProcessSupportRegistered){const e=await r.service.createTerminal({location:r.service.defaultLocation});if(!e)return;r.service.setActiveInstance(e)}await r.groupService.showPanel(!0)}}),Wa([]),P({id:"workbench.action.createTerminalEditor",title:{value:a("workbench.action.terminal.createTerminalEditor","Create New Terminal in Editor Area"),original:"Create New Terminal in Editor Area"},run:async(r,e,t)=>{const i=ot(t)&&"location"in t?t:{location:E.Editor};(await r.service.createTerminal(i)).focusWhenReady()}}),P({id:"workbench.action.createTerminalEditorSide",title:{value:a("workbench.action.terminal.createTerminalEditorSide","Create New Terminal in Editor Area to the Side"),original:"Create New Terminal in Editor Area to the Side"},run:async r=>{(await r.service.createTerminal({location:{viewColumn:Fn}})).focusWhenReady()}}),F({id:"workbench.action.terminal.moveToEditor",title:x.moveToEditor,precondition:g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.terminalEditorActive.toNegated(),u.viewShowing),run:(r,e)=>e.service.moveToEditor(r)}),P({id:"workbench.action.terminal.moveToEditorInstance",title:x.moveToEditor,f1:!1,precondition:g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.isOpen),run:async(r,e)=>{const t=Ge(e);if(!(!t||t.length===0)){for(const i of t)r.service.moveToEditor(i);t[t.length-1].focus()}}}),P({id:"workbench.action.terminal.moveToTerminalPanel",title:x.moveToTerminalPanel,precondition:g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.terminalEditorActive),run:(r,e,t)=>{const i=Fa(t)??r.editorService.activeInstance;i&&r.service.moveToTerminalView(i)}}),P({id:"workbench.action.terminal.showTabs",title:{value:a("workbench.action.terminal.showTabs","Show Tabs"),original:"Show Tabs"},f1:!1,precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>r.groupService.showTabs()}),P({id:"workbench.action.terminal.focusPreviousPane",title:{value:a("workbench.action.terminal.focusPreviousPane","Focus Previous Terminal in Terminal Group"),original:"Focus Previous Terminal in Terminal Group"},keybinding:{primary:527,secondary:[528],mac:{primary:2575,secondary:[2576]},when:u.focus,weight:200},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:async r=>{var e;(e=r.groupService.activeGroup)==null||e.focusPreviousPane(),await r.groupService.showPanel(!0)}}),P({id:"workbench.action.terminal.focusNextPane",title:{value:a("workbench.action.terminal.focusNextPane","Focus Next Terminal in Terminal Group"),original:"Focus Next Terminal in Terminal Group"},keybinding:{primary:529,secondary:[530],mac:{primary:2577,secondary:[2578]},when:u.focus,weight:200},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:async r=>{var e;(e=r.groupService.activeGroup)==null||e.focusNextPane(),await r.groupService.showPanel(!0)}}),F({id:"workbench.action.terminal.runRecentCommand",title:{value:a("workbench.action.terminal.runRecentCommand","Run Recent Command..."),original:"Run Recent Command..."},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),keybinding:[{primary:2096,mac:{primary:304},when:g.and(u.focus,Te),weight:200},{primary:2608,mac:{primary:816},when:g.and(u.focus,Te.negate()),weight:200}],run:async(r,e)=>{await r.runRecent("command"),(r==null?void 0:r.target)===E.Editor?await e.editorService.revealActiveEditor():await e.groupService.showPanel(!1)}}),F({id:"workbench.action.terminal.copyLastCommandOutput",title:{value:a("workbench.action.terminal.copyLastCommand","Copy Last Command Output"),original:"Copy Last Command Output"},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:async(r,e,t)=>{var l;const i=t.get(Ar),n=(l=r.capabilities.get(2))==null?void 0:l.commands;if(!n||n.length===0)return;const s=n[n.length-1];if(!(s!=null&&s.hasOutput()))return;const o=s.getOutput();Yt(o)&&await i.writeText(o)}}),F({id:"workbench.action.terminal.goToRecentDirectory",title:{value:a("workbench.action.terminal.goToRecentDirectory","Go to Recent Directory..."),original:"Go to Recent Directory..."},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),keybinding:{primary:2085,when:u.focus,weight:200},run:async(r,e)=>{await r.runRecent("cwd"),(r==null?void 0:r.target)===E.Editor?await e.editorService.revealActiveEditor():await e.groupService.showPanel(!1)}}),P({id:"workbench.action.terminal.resizePaneLeft",title:{value:a("workbench.action.terminal.resizePaneLeft","Resize Terminal Left"),original:"Resize Terminal Left"},keybinding:{linux:{primary:3087},mac:{primary:2319},when:u.focus,weight:200},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>{var e;return(e=r.groupService.activeGroup)==null?void 0:e.resizePane(0)}}),P({id:"workbench.action.terminal.resizePaneRight",title:{value:a("workbench.action.terminal.resizePaneRight","Resize Terminal Right"),original:"Resize Terminal Right"},keybinding:{linux:{primary:3089},mac:{primary:2321},when:u.focus,weight:200},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>{var e;return(e=r.groupService.activeGroup)==null?void 0:e.resizePane(1)}}),P({id:"workbench.action.terminal.resizePaneUp",title:{value:a("workbench.action.terminal.resizePaneUp","Resize Terminal Up"),original:"Resize Terminal Up"},keybinding:{mac:{primary:2320},when:u.focus,weight:200},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>{var e;return(e=r.groupService.activeGroup)==null?void 0:e.resizePane(2)}}),P({id:"workbench.action.terminal.resizePaneDown",title:{value:a("workbench.action.terminal.resizePaneDown","Resize Terminal Down"),original:"Resize Terminal Down"},keybinding:{mac:{primary:2322},when:u.focus,weight:200},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>{var e;return(e=r.groupService.activeGroup)==null?void 0:e.resizePane(3)}}),P({id:"workbench.action.terminal.focus",title:x.focus,precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:async r=>{const e=r.service.activeInstance||await r.service.createTerminal({location:E.Panel});if(e)return r.service.setActiveInstance(e),r.groupService.showPanel(!0)}}),P({id:"workbench.action.terminal.focusTabs",title:{value:a("workbench.action.terminal.focus.tabsView","Focus Terminal Tabs View"),original:"Focus Terminal Tabs View"},keybinding:{primary:3165,weight:200,when:g.or(u.tabsFocus,u.focus)},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>r.groupService.focusTabs()}),P({id:"workbench.action.terminal.focusNext",title:{value:a("workbench.action.terminal.focusNext","Focus Next Terminal Group"),original:"Focus Next Terminal Group"},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),keybinding:{primary:2060,mac:{primary:3166},when:g.and(u.focus,u.editorFocus.negate()),weight:200},run:async r=>{r.groupService.setActiveGroupToNext(),await r.groupService.showPanel(!0)}}),P({id:"workbench.action.terminal.focusPrevious",title:{value:a("workbench.action.terminal.focusPrevious","Focus Previous Terminal Group"),original:"Focus Previous Terminal Group"},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),keybinding:{primary:2059,mac:{primary:3164},when:g.and(u.focus,u.editorFocus.negate()),weight:200},run:async r=>{r.groupService.setActiveGroupToPrevious(),await r.groupService.showPanel(!0)}}),P({id:"workbench.action.terminal.runSelectedText",title:{value:a("workbench.action.terminal.runSelectedText","Run Selected Text In Active Terminal"),original:"Run Selected Text In Active Terminal"},run:async(r,e)=>{const i=e.get(to).getActiveCodeEditor();if(!i||!i.hasModel())return;const n=await r.service.getActiveOrCreateInstance({acceptsInput:!0}),s=i.getSelection();let o;if(s.isEmpty())o=i.getModel().getLineContent(s.selectionStartLineNumber).trim();else{const l=re?1:2;o=i.getModel().getValueInRange(s,l)}n.sendText(o,!0,!0),await r.service.revealActiveTerminal()}}),P({id:"workbench.action.terminal.runActiveFile",title:{value:a("workbench.action.terminal.runActiveFile","Run Active File In Active Terminal"),original:"Run Active File In Active Terminal"},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:async(r,e)=>{const t=e.get(to),i=e.get(ee),n=e.get(si),s=t.getActiveCodeEditor();if(!s||!s.hasModel())return;const o=await r.service.getActiveOrCreateInstance({acceptsInput:!0}),l=o?o.isRemote:!!n.remoteAuthority,c=s.getModel().uri;if(!l&&c.scheme!==G.file&&c.scheme!==G.vscodeUserData||l&&c.scheme!==G.vscodeRemote){i.warn(a("workbench.action.terminal.runActiveFile.noFile","Only files on disk can be run in the terminal"));return}return await o.sendPath(c,!0),r.groupService.showPanel()}}),F({id:"workbench.action.terminal.scrollDown",title:{value:a("workbench.action.terminal.scrollDown","Scroll Down (Line)"),original:"Scroll Down (Line)"},keybinding:{primary:2572,linux:{primary:3090},when:g.and(u.focus,u.altBufferActive.negate()),weight:200},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>r.scrollDownLine()}),F({id:"workbench.action.terminal.scrollDownPage",title:{value:a("workbench.action.terminal.scrollDownPage","Scroll Down (Page)"),original:"Scroll Down (Page)"},keybinding:{primary:1036,mac:{primary:12},when:g.and(u.focus,u.altBufferActive.negate()),weight:200},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>r.scrollDownPage()}),F({id:"workbench.action.terminal.scrollToBottom",title:{value:a("workbench.action.terminal.scrollToBottom","Scroll to Bottom"),original:"Scroll to Bottom"},keybinding:{primary:2061,linux:{primary:1037},when:g.and(u.focus,u.altBufferActive.negate()),weight:200},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>r.scrollToBottom()}),F({id:"workbench.action.terminal.scrollUp",title:{value:a("workbench.action.terminal.scrollUp","Scroll Up (Line)"),original:"Scroll Up (Line)"},keybinding:{primary:2571,linux:{primary:3088},when:g.and(u.focus,u.altBufferActive.negate()),weight:200},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>r.scrollUpLine()}),F({id:"workbench.action.terminal.scrollUpPage",title:{value:a("workbench.action.terminal.scrollUpPage","Scroll Up (Page)"),original:"Scroll Up (Page)"},f1:!0,category:_n,keybinding:{primary:1035,mac:{primary:11},when:g.and(u.focus,u.altBufferActive.negate()),weight:200},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>r.scrollUpPage()}),F({id:"workbench.action.terminal.scrollToTop",title:{value:a("workbench.action.terminal.scrollToTop","Scroll to Top"),original:"Scroll to Top"},keybinding:{primary:2062,linux:{primary:1038},when:g.and(u.focus,u.altBufferActive.negate()),weight:200},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>r.scrollToTop()}),F({id:"workbench.action.terminal.clearSelection",title:{value:a("workbench.action.terminal.clearSelection","Clear Selection"),original:"Clear Selection"},keybinding:{primary:9,when:g.and(u.focus,u.textSelected,u.notFindVisible),weight:200},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>{r.hasSelection()&&r.clearSelection()}}),P({id:"workbench.action.terminal.changeIcon",title:x.changeIcon,precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:(r,e,t)=>{var i;return(i=As(r,t))==null?void 0:i.changeIcon()}}),P({id:"workbench.action.terminal.changeIconPanel",title:x.changeIcon,f1:!1,precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>{var e;return(e=r.groupService.activeInstance)==null?void 0:e.changeIcon()}}),P({id:"workbench.action.terminal.changeIconInstance",title:x.changeIcon,f1:!1,precondition:g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.tabsSingularSelection),run:(r,e)=>{var t;return(t=Ge(e))==null?void 0:t[0].changeIcon()}}),P({id:"workbench.action.terminal.changeColor",title:x.changeColor,precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:(r,e,t)=>{var i;return(i=As(r,t))==null?void 0:i.changeColor()}}),P({id:"workbench.action.terminal.changeColorPanel",title:x.changeColor,f1:!1,precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>{var e;return(e=r.groupService.activeInstance)==null?void 0:e.changeColor()}}),P({id:"workbench.action.terminal.changeColorInstance",title:x.changeColor,f1:!1,precondition:g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.tabsSingularSelection),run:(r,e)=>{var t;return(t=Ge(e))==null?void 0:t[0].changeColor()}}),P({id:"workbench.action.terminal.rename",title:x.rename,precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:(r,e,t)=>po(r,e,t)}),P({id:"workbench.action.terminal.renamePanel",title:x.rename,f1:!1,precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:(r,e)=>po(r,e)}),P({id:"workbench.action.terminal.renameInstance",title:x.rename,f1:!1,keybinding:{primary:60,mac:{primary:3},when:g.and(u.tabsFocus),weight:200},precondition:g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.tabsSingularSelection),run:async(r,e)=>{var n;const t=e.get(ee),i=(n=Ge(e))==null?void 0:n[0];i&&(r.service.setEditingTerminal(i),r.service.setEditable(i,{validationMessage:s=>rd(s),onFinish:async(s,o)=>{if(r.service.setEditable(i,null),r.service.setEditingTerminal(void 0),o)try{await i.rename(s)}catch(l){t.error(l)}}}))}}),F({id:"workbench.action.terminal.detachSession",title:{value:a("workbench.action.terminal.detachSession","Detach Session"),original:"Detach Session"},run:r=>r.detachProcessAndDispose(Ke.User)}),P({id:"workbench.action.terminal.attachToSession",title:{value:a("workbench.action.terminal.attachToSession","Attach to Session"),original:"Attach to Session"},run:async(r,e)=>{var w;const t=e.get(me),i=e.get(Mt),n=e.get(Ye),s=e.get(ee),o=((w=n.getConnection())==null?void 0:w.remoteAuthority)??void 0,l=await e.get(Ne).getBackend(o);if(!l)throw new Error(`No backend registered for remote authority '${o}'`);const c=await l.listProcesses();l.reduceConnectionGraceTime();const m=c.filter(f=>!r.service.isAttachedToTerminal(f)).map(f=>{const _=i.getUriLabel(M.file(f.cwd));return{label:f.title,detail:f.workspaceName?`${f.workspaceName} ⸱ ${_}`:_,description:f.pid?String(f.pid):"",term:f}});if(m.length===0){s.info(a("noUnattachedTerminals","There are no unattached terminals to attach to"));return}const p=await t.pick(m,{canPickMany:!1});if(p){const f=await r.service.createTerminal({config:{attachPersistentProcess:p.term}});r.service.setActiveInstance(f),await mi(f,r)}}}),P({id:"workbench.action.quickOpenTerm",title:{value:a("quickAccessTerminal","Switch Active Terminal"),original:"Switch Active Terminal"},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:(r,e)=>e.get(me).quickAccess.show(Zt.PREFIX)}),F({id:"workbench.action.terminal.scrollToPreviousCommand",title:{value:a("workbench.action.terminal.scrollToPreviousCommand","Scroll To Previous Command"),original:"Scroll To Previous Command"},keybinding:{primary:2064,when:g.and(u.focus,Te.negate()),weight:200},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>{var e;return(e=r.xterm)==null?void 0:e.markTracker.scrollToPreviousMark(void 0,void 0,r.capabilities.has(2))}}),F({id:"workbench.action.terminal.scrollToNextCommand",title:{value:a("workbench.action.terminal.scrollToNextCommand","Scroll To Next Command"),original:"Scroll To Next Command"},keybinding:{primary:2066,when:g.and(u.focus,Te.negate()),weight:200},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>{var e;(e=r.xterm)==null||e.markTracker.scrollToNextMark(),r.focus()}}),F({id:"workbench.action.terminal.selectToPreviousCommand",title:{value:a("workbench.action.terminal.selectToPreviousCommand","Select To Previous Command"),original:"Select To Previous Command"},keybinding:{primary:3088,when:u.focus,weight:200},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>{var e;(e=r.xterm)==null||e.markTracker.selectToPreviousMark(),r.focus()}}),F({id:"workbench.action.terminal.selectToNextCommand",title:{value:a("workbench.action.terminal.selectToNextCommand","Select To Next Command"),original:"Select To Next Command"},keybinding:{primary:3090,when:u.focus,weight:200},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>{var e;(e=r.xterm)==null||e.markTracker.selectToNextMark(),r.focus()}}),F({id:"workbench.action.terminal.selectToPreviousLine",title:{value:a("workbench.action.terminal.selectToPreviousLine","Select To Previous Line"),original:"Select To Previous Line"},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:async r=>{var e;(e=r.xterm)==null||e.markTracker.selectToPreviousLine(),r.focus()}}),F({id:"workbench.action.terminal.selectToNextLine",title:{value:a("workbench.action.terminal.selectToNextLine","Select To Next Line"),original:"Select To Next Line"},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:async r=>{var e;(e=r.xterm)==null||e.markTracker.selectToNextLine(),r.focus()}}),P({id:"toggleEscapeSequenceLogging",title:{value:a("workbench.action.terminal.toggleEscapeSequenceLogging","Toggle Escape Sequence Logging"),original:"Toggle Escape Sequence Logging"},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>r.service.toggleEscapeSequenceLogging()}),P({id:"workbench.action.terminal.sendSequence",title:x.sendSequence,f1:!1,description:{description:x.sendSequence.value,args:[{name:"args",schema:{type:"object",required:["text"],properties:{text:{description:a("sendSequence","The sequence of text to send to the terminal"),type:"string"}}}}]},run:(r,e,t)=>La(e,t)}),P({id:"workbench.action.terminal.newWithCwd",title:x.newWithCwd,description:{description:x.newWithCwd.value,args:[{name:"args",schema:{type:"object",required:["cwd"],properties:{cwd:{description:a("workbench.action.terminal.newWithCwd.cwd","The directory to start the terminal at"),type:"string"}}}}]},run:async(r,e,t)=>{const i=ot(t)&&"cwd"in t?Qi(t.cwd):void 0,n=await r.service.createTerminal({cwd:i});n&&(r.service.setActiveInstance(n),await mi(n,r))}}),F({id:"workbench.action.terminal.renameWithArg",title:x.renameWithArgs,description:{description:x.renameWithArgs.value,args:[{name:"args",schema:{type:"object",required:["name"],properties:{name:{description:a("workbench.action.terminal.renameWithArg.name","The new name for the terminal"),type:"string",minLength:1}}}}]},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:async(r,e,t,i)=>{const n=t.get(ee),s=ot(i)&&"name"in i?Qi(i.name):void 0;if(!s){n.warn(a("workbench.action.terminal.renameWithArg.noName","No name argument provided"));return}r.rename(s)}}),F({id:"workbench.action.terminal.relaunch",title:{value:a("workbench.action.terminal.relaunch","Relaunch Active Terminal"),original:"Relaunch Active Terminal"},run:r=>r.relaunch()}),P({id:"workbench.action.terminal.split",title:x.split,precondition:g.or(u.processSupported,u.webExtensionContributedProfile),keybinding:{primary:3098,weight:200,mac:{primary:2141,secondary:[1306]},when:u.focus},icon:k.splitHorizontal,run:async(r,e,t)=>{const i=ot(t)?t:void 0,n=e.get(ue),s=e.get(ge),o=Ra(i),l=r.service.getInstanceHost(o==null?void 0:o.location).activeInstance;if(!l)return;const c=await Aa(r.service.configHelper,l,s.getWorkspace().folders,n);if(c===void 0)return;const h=await r.service.createTerminal({location:{parentTerminal:l},config:o==null?void 0:o.config,cwd:c});await mi(h,r)}}),P({id:"workbench.action.terminal.splitInstance",title:x.split,f1:!1,keybinding:{primary:3098,mac:{primary:2141,secondary:[1306]},weight:200,when:u.tabsFocus},run:async(r,e)=>{const t=Ge(e);if(t){const i=[];for(const n of t)i.push((async()=>{await r.service.createTerminal({location:{parentTerminal:n}}),await r.groupService.showPanel(!0)})());await Promise.all(i)}}}),F({id:"workbench.action.terminal.unsplit",title:x.unsplit,precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:(r,e)=>e.groupService.unsplitInstance(r)}),P({id:"workbench.action.terminal.unsplitInstance",title:x.unsplit,f1:!1,precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:async(r,e)=>{const t=Ge(e);if((t==null?void 0:t.length)===1){const i=r.groupService.getGroupForInstance(t[0]);i&&(i==null?void 0:i.terminalInstances.length)>1&&r.groupService.unsplitInstance(t[0])}}}),P({id:"workbench.action.terminal.joinInstance",title:{value:a("workbench.action.terminal.joinInstance","Join Terminals"),original:"Join Terminals"},precondition:g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.tabsSingularSelection.toNegated()),run:async(r,e)=>{const t=Ge(e);t&&t.length>1&&r.groupService.joinInstances(t)}}),P({id:"workbench.action.terminal.join",title:{value:a("workbench.action.terminal.join","Join Terminals"),original:"Join Terminals"},precondition:g.and(g.or(u.processSupported,u.terminalHasBeenCreated)),run:async(r,e)=>{const t=e.get(he),i=e.get(ee),n=e.get(me),s=[];if(r.groupService.instances.length<=1){i.warn(a("workbench.action.terminal.join.insufficientTerminals","Insufficient terminals for the join action"));return}const o=r.groupService.instances.filter(c=>{var h;return c.instanceId!==((h=r.groupService.activeInstance)==null?void 0:h.instanceId)});for(const c of o){const h=r.groupService.getGroupForInstance(c);if((h==null?void 0:h.terminalInstances.length)===1){const p=`$(${Er(e,c)}): ${c.title}`,w=[],f=ct(c);f&&w.push(f);const _=Lt(c,t.getColorTheme().type);_&&w.push(..._),s.push({terminal:c,label:p,iconClasses:w})}}if(s.length===0){i.warn(a("workbench.action.terminal.join.onlySplits","All terminals are joined already"));return}const l=await n.pick(s,{});l&&r.groupService.joinInstances([l.terminal,r.groupService.activeInstance])}}),F({id:"workbench.action.terminal.splitInActiveWorkspace",title:{value:a("workbench.action.terminal.splitInActiveWorkspace","Split Terminal (In Active Workspace)"),original:"Split Terminal (In Active Workspace)"},run:async(r,e)=>{const t=await e.service.createTerminal({location:{parentTerminal:r}});(t==null?void 0:t.target)!==E.Editor&&await e.groupService.showPanel(!0)}}),F({id:"workbench.action.terminal.selectAll",title:{value:a("workbench.action.terminal.selectAll","Select All"),original:"Select All"},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),keybinding:[{primary:0,mac:{primary:2079},weight:200,when:u.focus}],run:r=>r.selectAll()}),P({id:"workbench.action.terminal.new",title:{value:a("workbench.action.terminal.new","Create New Terminal"),original:"Create New Terminal"},precondition:g.or(u.processSupported,u.webExtensionContributedProfile),icon:Nh,keybinding:{primary:3163,mac:{primary:1371},weight:200},run:async(r,e,t)=>{var l;let i=ot(t)?t:void 0;const n=e.get(ge),s=e.get(ue),o=n.getWorkspace().folders;if(i&&i instanceof MouseEvent&&(i.altKey||i.ctrlKey)){await r.service.createTerminal({location:{splitActiveTerminal:!0}});return}if(r.service.isProcessSupportRegistered){i=!i||i instanceof MouseEvent?{}:i;let c;if(o.length<=1)c=await r.service.createTerminal(i);else{const h=(l=await od(e))==null?void 0:l.cwd;if(!h)return;i.cwd=h,c=await r.service.createTerminal(i)}r.service.setActiveInstance(c),await mi(c,r)}else r.profileService.contributedProfiles.length>0?s.executeCommand("workbench.action.terminal.newWithProfile"):s.executeCommand("workbench.action.terminal.toggleTerminal")}}),P({id:"workbench.action.terminal.kill",title:{value:a("workbench.action.terminal.kill","Kill the Active Terminal Instance"),original:"Kill the Active Terminal Instance"},precondition:g.or(g.or(u.processSupported,u.terminalHasBeenCreated),u.isOpen),icon:Ia,run:async r=>{const e=r.groupService.activeInstance;e&&(await r.service.safeDisposeTerminal(e),r.groupService.instances.length>0&&await r.groupService.showPanel(!0))}}),P({id:"workbench.action.terminal.killAll",title:{value:a("workbench.action.terminal.killAll","Kill All Terminals"),original:"Kill All Terminals"},precondition:g.or(g.or(u.processSupported,u.terminalHasBeenCreated),u.isOpen),icon:k.trash,run:async r=>{const e=[];for(const t of r.service.instances)e.push(r.service.safeDisposeTerminal(t));await Promise.all(e)}}),P({id:"workbench.action.terminal.killEditor",title:{value:a("workbench.action.terminal.killEditor","Kill the Active Terminal in Editor Area"),original:"Kill the Active Terminal in Editor Area"},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),keybinding:{primary:2101,win:{primary:2110,secondary:[2101]},weight:200,when:g.and(u.focus,wt.Scheme.isEqualTo(G.vscodeTerminal),u.editorFocus)},run:(r,e)=>e.get(ue).executeCommand(al)}),P({id:"workbench.action.terminal.killInstance",title:x.kill,f1:!1,precondition:g.or(g.or(u.processSupported,u.terminalHasBeenCreated),u.isOpen),keybinding:{primary:20,mac:{primary:2049,secondary:[20]},weight:200,when:u.tabsFocus},run:async(r,e)=>{var s;const t=Ge(e);if(!t)return;const i=e.get(On),n=[];for(const o of t)n.push(r.service.safeDisposeTerminal(o));await Promise.all(n),r.service.instances.length>0&&(r.groupService.focusTabs(),(s=i.lastFocusedList)==null||s.focusNext())}}),P({id:"workbench.action.terminal.focusHover",title:x.focusHover,precondition:g.or(g.or(u.processSupported,u.terminalHasBeenCreated),u.isOpen),keybinding:{primary:ll(2089,2087),weight:200,when:g.or(u.tabsFocus,u.focus)},run:r=>r.groupService.focusHover()}),F({id:"workbench.action.terminal.clear",title:{value:a("workbench.action.terminal.clear","Clear"),original:"Clear"},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),keybinding:[{primary:0,mac:{primary:2089},weight:200+1,when:g.and(u.focus,Te.negate())}],run:r=>r.clearBuffer()}),P({id:"workbench.action.terminal.selectDefaultShell",title:{value:a("workbench.action.terminal.selectDefaultShell","Select Default Profile"),original:"Select Default Profile"},run:r=>r.service.showProfileQuickPick("setDefault")}),P({id:"workbench.action.terminal.openSettings",title:{value:a("workbench.action.terminal.openSettings","Configure Terminal Settings"),original:"Configure Terminal Settings"},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:(r,e)=>e.get(Wi).openSettings({jsonEditor:!1,query:"@feature:terminal"})}),F({id:"workbench.action.terminal.setDimensions",title:{value:a("workbench.action.terminal.setFixedDimensions","Set Fixed Dimensions"),original:"Set Fixed Dimensions"},precondition:g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.isOpen),run:r=>r.setFixedDimensions()}),F({id:"workbench.action.terminal.sizeToContentWidth",title:{value:a("workbench.action.terminal.sizeToContentWidth","Toggle Size to Content Width"),original:"Toggle Size to Content Width"},precondition:g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.isOpen),keybinding:{primary:568,weight:200,when:u.focus},run:r=>r.toggleSizeToContentWidth()}),P({id:"workbench.action.terminal.sizeToContentWidthInstance",title:x.toggleSizeToContentWidth,f1:!1,precondition:g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.focus),run:(r,e)=>{var t;return(t=Ge(e))==null?void 0:t[0].toggleSizeToContentWidth()}}),P({id:"workbench.action.terminal.clearPreviousSessionHistory",title:{value:a("workbench.action.terminal.clearPreviousSessionHistory","Clear Previous Session History"),original:"Clear Previous Session History"},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:async(r,e)=>{pn(e).clear(),Qh()}}),F({id:"workbench.action.terminal.selectPrevSuggestion",title:{value:a("workbench.action.terminal.selectPrevSuggestion","Select the Previous Suggestion"),original:"Select the Previous Suggestion"},f1:!1,precondition:g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.focus,u.isOpen,u.suggestWidgetVisible),keybinding:{primary:16,weight:200+1},run:r=>r.selectPreviousSuggestion()}),F({id:"workbench.action.terminal.selectPrevPageSuggestion",title:{value:a("workbench.action.terminal.selectPrevPageSuggestion","Select the Previous Page Suggestion"),original:"Select the Previous Page Suggestion"},f1:!1,precondition:g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.focus,u.isOpen,u.suggestWidgetVisible),keybinding:{primary:11,weight:200+1},run:r=>r.selectPreviousPageSuggestion()}),F({id:"workbench.action.terminal.selectNextSuggestion",title:{value:a("workbench.action.terminal.selectNextSuggestion","Select the Next Suggestion"),original:"Select the Next Suggestion"},f1:!1,precondition:g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.focus,u.isOpen,u.suggestWidgetVisible),keybinding:{primary:18,weight:200+1},run:r=>r.selectNextSuggestion()}),F({id:"workbench.action.terminal.selectNextPageSuggestion",title:{value:a("workbench.action.terminal.selectNextPageSuggestion","Select the Next Page Suggestion"),original:"Select the Next Page Suggestion"},f1:!1,precondition:g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.focus,u.isOpen,u.suggestWidgetVisible),keybinding:{primary:12,weight:200+1},run:r=>r.selectNextPageSuggestion()}),F({id:"workbench.action.terminal.acceptSelectedSuggestion",title:{value:a("workbench.action.terminal.acceptSelectedSuggestion","Accept Selected Suggestion"),original:"Accept Selected Suggestion"},f1:!1,precondition:g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.focus,u.isOpen,u.suggestWidgetVisible),keybinding:{primary:3,secondary:[2],weight:200+1},run:r=>r.acceptSelectedSuggestion()}),F({id:"workbench.action.terminal.hideSuggestWidget",title:{value:a("workbench.action.terminal.hideSuggestWidget","Hide Suggest Widget"),original:"Hide Suggest Widget"},f1:!1,precondition:g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.focus,u.isOpen,u.suggestWidgetVisible),keybinding:{primary:9,weight:200+1},run:r=>r.hideSuggestWidget()}),Kt.clipboard.writeText&&(F({id:"workbench.action.terminal.copySelection",title:{value:a("workbench.action.terminal.copySelection","Copy Selection"),original:"Copy Selection"},precondition:g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.textSelected),keybinding:[{primary:3105,mac:{primary:2081},weight:200,when:g.and(u.textSelected,u.focus)}],run:r=>r.copySelection()}),F({id:"workbench.action.terminal.copyAndClearSelection",title:{value:a("workbench.action.terminal.copyAndClearSelection","Copy and Clear Selection"),original:"Copy and Clear Selection"},precondition:g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.textSelected),keybinding:[{win:{primary:2081},weight:200,when:g.and(u.textSelected,u.focus)}],run:async r=>{await r.copySelection(),r.clearSelection()}}),F({id:"workbench.action.terminal.copySelectionAsHtml",title:{value:a("workbench.action.terminal.copySelectionAsHtml","Copy Selection as HTML"),original:"Copy Selection as HTML"},f1:!0,category:_n,precondition:g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.textSelected),run:r=>r.copySelection(!0)})),Kt.clipboard.readText&&F({id:"workbench.action.terminal.paste",title:{value:a("workbench.action.terminal.paste","Paste into Active Terminal"),original:"Paste into Active Terminal"},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),keybinding:[{primary:2100,win:{primary:2100,secondary:[3124]},linux:{primary:3124},weight:200,when:u.focus}],run:r=>r.paste()}),Kt.clipboard.readText&&Nn&&F({id:"workbench.action.terminal.pasteSelection",title:{value:a("workbench.action.terminal.pasteSelection","Paste Selection into Active Terminal"),original:"Paste Selection into Active Terminal"},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),keybinding:[{linux:{primary:1043},weight:200,when:u.focus}],run:r=>r.pasteSelection()}),P({id:"workbench.action.terminal.switchTerminal",title:{value:a("workbench.action.terminal.switchTerminal","Switch Terminal"),original:"Switch Terminal"},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:async(r,e,t)=>{const i=Qi(t);if(!i)return;if(i===Pa){r.service.refreshActiveGroup();return}if(i===Ea){e.get(Z).updateValue("terminal.integrated.tabs.enabled",!0);return}const s=/^([0-9]+): /.exec(i);if(s)return r.groupService.setActiveGroupByIndex(Number(s[1])-1),r.groupService.showPanel(!0);const o=r.profileService.availableProfiles,l=i.substring(4);if(o){const c=o.find(h=>h.profileName===l);if(c){const h=await r.service.createTerminal({config:c});r.service.setActiveInstance(h)}else console.warn(`No profile with name "${l}"`)}else console.warn(`Unmatched terminal item: "${i}"`)}})}function Ge(r){var o;const e=r.get(On),t=r.get(ne);if(!((o=e.lastFocusedList)!=null&&o.getSelection()))return;const i=e.lastFocusedList.getSelection(),n=e.lastFocusedList.getFocus(),s=[];if(n.length===1&&!i.includes(n[0]))return s.push(t.getInstanceFromIndex(n[0])),s;for(const l of i)s.push(t.getInstanceFromIndex(l));return s}function rd(r){return!r||r.trim().length===0?{content:a("emptyTerminalNameInfo","Providing no name will reset it to the default value"),severity:ie.Info}:null}function Ra(r){return ot(r)&&"profileName"in r?{config:r,location:r.location}:r}let Ki;function Wa(r){const e=Ta(r);Ki==null||Ki.dispose(),Ki=Bo(class extends Vo{constructor(){super({id:"workbench.action.terminal.newWithProfile",title:{value:a("workbench.action.terminal.newWithProfile","Create New Terminal (With Profile)"),original:"Create New Terminal (With Profile)"},f1:!0,category:_n,precondition:g.or(u.processSupported,u.webExtensionContributedProfile),description:{description:"workbench.action.terminal.newWithProfile",args:[{name:"args",schema:{type:"object",required:["profileName"],properties:{profileName:{description:a("workbench.action.terminal.newWithProfile.profileName","The name of the profile to create"),type:"string",enum:e.values,markdownEnumDescriptions:e.markdownDescriptions}}}}]}})}async run(t,i,n){const s=Ma(t),o=t.get(ge),l=t.get(ue);let c,h,m,p;if(ot(i)&&i&&"profileName"in i){const f=s.profileService.availableProfiles.find(_=>_.profileName===i.profileName);if(!f)throw new Error(`Could not find terminal profile "${i.profileName}"`);h={config:f}}else i instanceof MouseEvent||i instanceof PointerEvent||i instanceof KeyboardEvent?(c=i,h=n?{config:n}:void 0):h=Ra(i);if(c&&(c.altKey||c.ctrlKey)){const f=s.service.activeInstance;if(f){await s.service.createTerminal({location:{parentTerminal:f},config:h==null?void 0:h.config});return}}if(o.getWorkspace().folders.length>1){const f={placeHolder:a("workbench.action.terminal.newWorkspacePlaceholder","Select current working directory for new terminal")},_=await l.executeCommand(Lr,[f]);if(!_)return;p=_.uri}h?(h.cwd=p,m=await s.service.createTerminal(h)):m=await s.service.showProfileQuickPick("createInstance",p),m&&(s.service.setActiveInstance(m),await mi(m,s))}})}function As(r,e){return r.service.getInstanceFromResource(Fa(e))||r.service.activeInstance}async function od(r,e){const t=r.get(me),i=r.get(Mt),n=r.get(ge),s=r.get(Ho),o=r.get(cl),l=r.get(Z),c=r.get(Bn),h=n.getWorkspace().folders;if(!h.length)return;const m=await Promise.all(h.map(y=>ad(y,l,c))),p=ld(m);if(p.length===1)return p[0];const w=p.map(y=>{const R=y.folder.name,C=y.isOverridden?a("workbench.action.terminal.overriddenCwdDescription","(Overriden) {0}",i.getUriLabel(y.cwd,{relative:!y.isAbsolute})):i.getUriLabel(hl(y.cwd),{relative:!0});return{label:R,description:C!==R?C:void 0,pair:y,iconClasses:dl(s,o,y.cwd,ul.ROOT_FOLDER)}}),f={placeHolder:a("workbench.action.terminal.newWorkspacePlaceholder","Select current working directory for new terminal"),matchOnDescription:!0,canPickMany:!1},_=e||ri.None,S=await t.pick(w,f,_);return S==null?void 0:S.pair}async function ad(r,e,t){const i=e.getValue("terminal.integrated.cwd",{resource:r.uri});if(!Yt(i)||i.length===0)return{folder:r,cwd:r.uri,isAbsolute:!1,isOverridden:!1};const n=await t.resolveAsync(r,i);return Go(n)||n.startsWith(ml.VARIABLE_LHS)?{folder:r,isAbsolute:!0,isOverridden:!0,cwd:M.from({scheme:r.uri.scheme,path:n})}:{folder:r,isAbsolute:!1,isOverridden:!0,cwd:M.joinPath(r.uri,n)}}function ld(r){const e=new Map;for(const n of r){const s=n.cwd.toString();(!e.get(s)||s===n.folder.uri.toString())&&e.set(s,n)}const t=new Set(e.values());return r.filter(n=>t.has(n))}async function mi(r,e){r.target===E.Editor?(await e.editorService.revealActiveEditor(),await r.focusWhenReady(!0)):await e.groupService.showPanel(!0)}async function po(r,e,t){const i=As(r,t);if(i){const n=await e.get(me).input({value:i.title,prompt:a("workbench.action.terminal.rename.prompt","Enter terminal name")});i.rename(n)}}function Fa(r){return M.isUri(r)?r:void 0}function Qi(r){return Yt(r)?r:void 0}var cd='.monaco-action-bar .action-item .action-label.extension-action{line-height:normal;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.monaco-action-bar .action-dropdown-item>.action-label.extension-action.label,.monaco-action-bar .action-item>.action-label.extension-action.label{padding:0 5px}.monaco-action-bar .action-dropdown-item>.monaco-dropdown .action-label{padding:0}.monaco-action-bar .action-item .action-label.extension-action.label{outline-offset:1px}.monaco-action-bar .action-dropdown-item .action-label.extension-action.label,.monaco-action-bar .action-item .action-label.extension-action.label,.monaco-action-bar .action-item .action-label.extension-action.text{height:auto;line-height:14px;width:auto}.monaco-action-bar .action-item .action-label.extension-action.built-in-status{border-color:var(--vscode-foreground)}.monaco-action-bar .action-item .action-label.extension-action.label,.monaco-action-bar .action-item.action-dropdown-item>.action-dropdown-item-separator{background-color:var(--vscode-extensionButton-background)!important}.monaco-action-bar .action-item .action-label.extension-action.label{color:var(--vscode-extensionButton-foreground)!important}.monaco-action-bar .action-item .action-label.extension-action.label:hover{background-color:var(--vscode-extensionButton-hoverBackground)!important}.monaco-action-bar .action-item.action-dropdown-item>.action-dropdown-item-separator>div{background-color:var(--vscode-extensionButton-separator)}.monaco-action-bar .action-item .action-label.extension-action.label.prominent,.monaco-action-bar .action-item.action-dropdown-item>.action-dropdown-item-separator.prominent{background-color:var(--vscode-extensionButton-prominentBackground)}.monaco-action-bar .action-item .action-label.extension-action.label.prominent{color:var(--vscode-extensionButton-prominentForeground)!important}.monaco-action-bar .action-item .action-label.extension-action.label.prominent:hover{background-color:var(--vscode-extensionButton-prominentHoverBackground)}.monaco-action-bar .action-item .action-label.extension-action:not(.disabled){border:1px solid var(--vscode-contrastBorder)}.monaco-action-bar .action-item.action-dropdown-item>.action-dropdown-item-separator{border-bottom:1px solid var(--vscode-contrastBorder);border-top:1px solid var(--vscode-contrastBorder)}.monaco-action-bar .action-item .action-label.extension-action.extension-status-error{color:var(--vscode-editorError-foreground)}.monaco-action-bar .action-item .action-label.extension-action.extension-status-warning{color:var(--vscode-editorWarning-foreground)}.monaco-action-bar .action-item .action-label.extension-action.extension-status-info{color:var(--vscode-editorInfo-foreground)}.monaco-action-bar .action-dropdown-item .action-label.extension-action.label,.monaco-action-bar .action-item .action-label.extension-action.icon,.monaco-action-bar .action-item:not(.disabled) .action-label.extension-action.label,.monaco-action-bar .action-item:not(.disabled) .action-label.extension-action.text{margin-top:2px}.monaco-action-bar .action-item .action-label.extension-action.manage.hide,.monaco-action-bar .action-item.action-dropdown-item .action-label.extension-action.hide,.monaco-action-bar .action-item.action-dropdown-item.disabled,.monaco-action-bar .action-item.disabled .action-label.disable-status.hide,.monaco-action-bar .action-item.disabled .action-label.extension-action.extension-sync,.monaco-action-bar .action-item.disabled .action-label.extension-action.hide,.monaco-action-bar .action-item.disabled .action-label.extension-action.hide-when-disabled,.monaco-action-bar .action-item.disabled .action-label.extension-action.ignore,.monaco-action-bar .action-item.disabled .action-label.extension-action.install:not(.installing),.monaco-action-bar .action-item.disabled .action-label.extension-action.language,.monaco-action-bar .action-item.disabled .action-label.extension-action.migrate,.monaco-action-bar .action-item.disabled .action-label.extension-action.reload,.monaco-action-bar .action-item.disabled .action-label.extension-action.theme,.monaco-action-bar .action-item.disabled .action-label.extension-action.undo-ignore,.monaco-action-bar .action-item.disabled .action-label.extension-action.uninstall:not(.uninstalling),.monaco-action-bar .action-item.disabled .action-label.extension-action.update,.monaco-action-bar .action-item.disabled .action-label.extension-status-label.hide,.monaco-action-bar .action-item.disabled .action-label.extension-status.hide{display:none}.monaco-action-bar .extension-action.label{display:inherit}.monaco-action-bar .action-item.disabled .action-label.extension-status:before{opacity:1}.monaco-action-bar .action-item.disabled .action-label.extension-status-label:before{content:"\\2713";padding-right:4px}.monaco-action-bar .action-item.disabled .action-label.extension-action{opacity:1}.monaco-action-bar .action-item.disabled .action-label.extension-action.text{font-style:italic;opacity:.9}';oi(cd,{});const fo=["{","	// See https://go.microsoft.com/fwlink/?LinkId=827846 to learn about workspace recommendations.","	// Extension identifier format: ${publisher}.${name}. Example: vscode.csharp","","	// List of extensions which should be recommended for users of this workspace.",'	"recommendations": [',"		","	],","	// List of extensions recommended by VS Code that should not be recommended for users of this workspace.",'	"unwantedRecommendations": [',"		","	]","}"].join(`
`),hd=Hn("extensionRecommendationsService"),Hr=Hn("IExtensionIgnoredRecommendationsService"),Oa=".vscode/extensions.json",Gr=Hn("extensionManifestPropertiesService"),dd=Hn("localizationService"),ud="workbench.action.showWindowLog";let ei=class extends U{constructor(e,t,i,n,s,o,l,c,h,m,p,w,f,_,S){super("extension.promptExtensionInstallFailure"),this.extension=e,this.version=t,this.installOperation=i,this.installOptions=n,this.error=s,this.productService=o,this.openerService=l,this.notificationService=c,this.dialogService=h,this.commandService=m,this.logService=p,this.extensionManagementServerService=w,this.instantiationService=f,this.galleryService=_,this.extensionManifestPropertiesService=S}async run(){if(Sl(this.error))return;if(this.logService.error(this.error),this.error.name===tt.Unsupported){const s=Qt?a("VS Code for Web","{0} for the Web",this.productService.nameLong):this.productService.nameLong,o=a("cannot be installed","The '{0}' extension is not available in {1}. Click 'More Information' to learn more.",this.extension.displayName||this.extension.identifier.id,s),{confirmed:l}=await this.dialogService.confirm({type:ie.Info,message:o,primaryButton:a({key:"more information",comment:["&& denotes a mnemonic"]},"&&More Information"),cancelButton:a("close","Close")});l&&this.openerService.open(Qt?M.parse("https://aka.ms/vscode-web-extensions-guide"):M.parse("https://aka.ms/vscode-remote"));return}if([tt.Incompatible,tt.IncompatibleTargetPlatform,tt.Malicious,tt.ReleaseVersionNotFound,tt.Deprecated].includes(this.error.name)){await this.dialogService.info(io(this.error));return}if(tt.Signature===this.error.name){await this.dialogService.prompt({type:"error",message:a("signature verification failed","{0} cannot verify the '{1}' extension. Are you sure you want to install it?",this.productService.nameLong,this.extension.displayName||this.extension.identifier.id),buttons:[{label:a("install anyway","Install Anyway"),run:()=>{var o;const s=(o=this.installOptions)!=null&&o.isMachineScoped?this.instantiationService.createInstance(wn,{donotVerifySignature:!0}):this.instantiationService.createInstance(vn,{donotVerifySignature:!0});return s.extension=this.extension,s.run()}}],cancelButton:a("cancel","Cancel")});return}let e=this.installOperation===3?a("update operation","Error while updating '{0}' extension.",this.extension.displayName||this.extension.identifier.id):a("install operation","Error while installing '{0}' extension.",this.extension.displayName||this.extension.identifier.id),t;const i=[];if(tt.IncompatiblePreRelease===this.error.name)e=io(this.error),t=a("install release version message","Would you like to install the release version?"),i.push({label:a("install release version","Install Release Version"),run:()=>{var o,l;const s=(o=this.installOptions)!=null&&o.isMachineScoped?this.instantiationService.createInstance(wn,{installPreReleaseVersion:!!this.installOptions.installPreReleaseVersion}):this.instantiationService.createInstance(vn,{installPreReleaseVersion:!!((l=this.installOptions)!=null&&l.installPreReleaseVersion)});return s.extension=this.extension,s.run()}});else{const s=await this.getDownloadUrl();s&&(t=a("check logs","Please check the [log]({0}) for more details.",`command:${ud}`),i.push({label:a("download","Try Downloading Manually..."),run:()=>this.openerService.open(s).then(()=>{this.notificationService.prompt(ie.Info,a("install vsix","Once downloaded, please manually install the downloaded VSIX of '{0}'.",this.extension.identifier.id),[{label:a("installVSIX","Install from VSIX..."),run:()=>this.commandService.executeCommand(Cl)}])})}))}const n=`${e}${t?` ${t}`:""}`;this.notificationService.prompt(ie.Error,n,i)}async getDownloadUrl(){if(Ko||!this.extension.gallery||!this.productService.extensionsGallery||!this.extensionManagementServerService.localExtensionManagementServer&&!this.extensionManagementServerService.remoteExtensionManagementServer)return;let e=this.extension.gallery.properties.targetPlatform;if(e!=="universal"&&e!=="undefined"&&this.extensionManagementServerService.remoteExtensionManagementServer)try{const t=await this.galleryService.getManifest(this.extension.gallery,ri.None);t&&this.extensionManifestPropertiesService.prefersExecuteOnWorkspace(t)&&(e=await this.extensionManagementServerService.remoteExtensionManagementServer.extensionManagementService.getTargetPlatform())}catch(t){this.logService.error(t);return}if(e!=="unknown")return M.parse(`${this.productService.extensionsGallery.serviceUrl}/publishers/${this.extension.publisher}/vsextensions/${this.extension.name}/${this.version}/vspackage${e!=="undefined"?`?targetPlatform=${e}`:""}`)}};ei=b([d(5,ai),d(6,Ri),d(7,ee),d(8,Rt),d(9,ue),d(10,Je),d(11,li),d(12,O),d(13,$o),d(14,Gr)],ei);class T extends U{constructor(){super(...arguments),this._extension=null}get extension(){return this._extension}set extension(e){this._extension=e,this.update()}}T.EXTENSION_ACTION_CLASS="extension-action";T.TEXT_ACTION_CLASS=`${T.EXTENSION_ACTION_CLASS} text`;T.LABEL_ACTION_CLASS=`${T.EXTENSION_ACTION_CLASS} label`;T.ICON_ACTION_CLASS=`${T.EXTENSION_ACTION_CLASS} icon`;let ti=class extends T{set manifest(e){this._manifest=e,this.updateLabel()}constructor(e,t,i,n,s,o,l,c,h,m,p){super(e,a("install","Install"),i,!1),this.options=t,this.extensionsWorkbenchService=n,this.instantiationService=s,this.runtimeExtensionService=o,this.workbenchThemeService=l,this.labelService=c,this.dialogService=h,this.preferencesService=m,this.telemetryService=p,this._manifest=null,this.updateThrottler=new Fr,this.update(),this._register(this.labelService.onDidChangeFormatters(()=>this.updateLabel(),this))}update(){this.updateThrottler.queue(()=>this.computeAndUpdateEnablement())}async computeAndUpdateEnablement(){this.enabled=!1,this.extension&&(this.extension.isBuiltin||this.extensionsWorkbenchService.canSetLanguage(this.extension)||this.extension.state===3&&await this.extensionsWorkbenchService.canInstall(this.extension)&&(this.enabled=this.options.installPreReleaseVersion?this.extension.hasPreReleaseVersion:this.extension.hasReleaseVersion,this.updateLabel()))}async run(){if(!this.extension)return;if(this.extension.deprecationInfo){let t=a("deprecated message","This extension is deprecated as it is no longer being maintained."),i;(function(o){o[o.InstallAnyway=0]="InstallAnyway",o[o.ShowAlternateExtension=1]="ShowAlternateExtension",o[o.ConfigureSettings=2]="ConfigureSettings",o[o.Cancel=3]="Cancel"})(i||(i={}));const n=[{label:a("install anyway","Install Anyway"),run:()=>i.InstallAnyway}];if(this.extension.deprecationInfo.extension){t=a("deprecated with alternate extension message","This extension is deprecated. Use the {0} extension instead.",this.extension.deprecationInfo.extension.displayName);const o=this.extension.deprecationInfo.extension;n.push({label:a({key:"Show alternate extension",comment:["&& denotes a mnemonic"]},"&&Open {0}",this.extension.deprecationInfo.extension.displayName),run:async()=>{const[l]=await this.extensionsWorkbenchService.getExtensions([{id:o.id,preRelease:o.preRelease}],ri.None);return await this.extensionsWorkbenchService.open(l),i.ShowAlternateExtension}})}else if(this.extension.deprecationInfo.settings){t=a("deprecated with alternate settings message","This extension is deprecated as this functionality is now built-in to VS Code.");const o=this.extension.deprecationInfo.settings;n.push({label:a({key:"configure in settings",comment:["&& denotes a mnemonic"]},"&&Configure Settings"),run:async()=>(await this.preferencesService.openSettings({query:o.map(l=>`@id:${l}`).join(" ")}),i.ConfigureSettings)})}else this.extension.deprecationInfo.additionalInfo&&(t=new N(`${t} ${this.extension.deprecationInfo.additionalInfo}`));const{result:s}=await this.dialogService.prompt({type:ie.Warning,message:a("install confirmation","Are you sure you want to install '{0}'?",this.extension.displayName),detail:Yt(t)?t:void 0,custom:Yt(t)?void 0:{markdownDetails:[{markdown:t}]},buttons:n,cancelButton:{run:()=>i.Cancel}});if(s!==i.InstallAnyway)return}this.extensionsWorkbenchService.open(this.extension,{showPreReleaseVersion:this.options.installPreReleaseVersion}),It(a("installExtensionStart","Installing extension {0} started. An editor is now open with more details on this extension",this.extension.displayName)),this.telemetryService.publicLog("extensions:action:install",{...this.extension.telemetryData,actionId:this.id});const e=await this.install(this.extension);if(e!=null&&e.local){It(a("installExtensionComplete","Installing extension {0} is completed.",this.extension.displayName));const t=await this.getRunningExtension(e.local);if(t&&!(t.activationEvents&&t.activationEvents.some(i=>i.startsWith("onLanguage")))){const i=await this.getThemeAction(e);if(i){i.extension=e;try{return i.run({showCurrentTheme:!0,ignoreFocusLost:!0})}finally{i.dispose()}}}}}async getThemeAction(e){if((await this.workbenchThemeService.getColorThemes()).some(s=>Oe(s,e)))return this.instantiationService.createInstance(ht);if((await this.workbenchThemeService.getFileIconThemes()).some(s=>Oe(s,e)))return this.instantiationService.createInstance(dt);if((await this.workbenchThemeService.getProductIconThemes()).some(s=>Oe(s,e)))return this.instantiationService.createInstance(ut)}async install(e){const t=this.getInstallOptions();try{return await this.extensionsWorkbenchService.install(e,t)}catch(i){await this.instantiationService.createInstance(ei,e,e.latestVersion,2,t,i).run();return}}async getRunningExtension(e){const t=await this.runtimeExtensionService.getExtension(e.identifier.id);return t||(this.runtimeExtensionService.canAddExtension(hn(e))?new Promise((i,n)=>{const s=this.runtimeExtensionService.onDidChangeExtensions(async()=>{const o=await this.runtimeExtensionService.getExtension(e.identifier.id);o&&(s.dispose(),i(o))})}):null)}updateLabel(){this.label=this.getLabel()}getLabel(e){var t,i;return this.options.installPreReleaseVersion&&((t=this.extension)!=null&&t.hasPreReleaseVersion)?e?a("install pre-release","Install Pre-Release"):a("install pre-release version","Install Pre-Release Version"):(i=this.extension)!=null&&i.hasPreReleaseVersion?e?a("install","Install"):a("install release version","Install Release Version"):a("install","Install")}getInstallOptions(){return this.options}};ti.Class=`${T.LABEL_ACTION_CLASS} prominent install`;ti=b([d(3,Q),d(4,O),d(5,se),d(6,Ot),d(7,Mt),d(8,Rt),d(9,Wi),d(10,ft)],ti);let wn=class Na extends ti{constructor(e,t,i,n,s,o,l,c,h,m,p,w){super("extensions.install",e,Na.Class,t,i,n,s,o,l,c,w),this.extensionManagementServerService=h,this.workbenchExtensionManagementService=m,this.userDataSyncEnablementService=p,this.updateLabel(),this._register(o.onDidChangeFormatters(()=>this.updateLabel(),this)),this._register(Y.any(p.onDidChangeEnablement,Y.filter(p.onDidChangeResourceEnablement,f=>f[0]==="extensions"))(()=>this.update()))}getLabel(e){const t=super.getLabel(e),i=a("do no sync","Do not sync"),n=this.getInstallOptions().isMachineScoped;if(this._manifest&&this.extensionManagementServerService.remoteExtensionManagementServer){if(this.workbenchExtensionManagementService.getExtensionManagementServerToInstall(this._manifest)===this.extensionManagementServerService.remoteExtensionManagementServer){const o=this.extensionManagementServerService.remoteExtensionManagementServer.label;return n?a({key:"install extension in remote and do not sync",comment:["First placeholder is install action label.","Second placeholder is the name of the action to install an extension in remote server and do not sync it. Placeholder is for the name of remote server.","Third placeholder is do not sync label."]},"{0} in {1} ({2})",t,o,i):a({key:"install extension in remote",comment:["First placeholder is install action label.","Second placeholder is the name of the action to install an extension in remote server and do not sync it. Placeholder is for the name of remote server."]},"{0} in {1}",t,o)}return n?a("install extension locally and do not sync","{0} Locally ({1})",t,i):a("install extension locally","{0} Locally",t)}return n?`${t} (${i})`:t}getInstallOptions(){return{...super.getInstallOptions(),isMachineScoped:this.userDataSyncEnablementService.isEnabled()&&this.userDataSyncEnablementService.isResourceEnabled("extensions")}}};wn=b([d(1,Q),d(2,O),d(3,se),d(4,Ot),d(5,Mt),d(6,Rt),d(7,Wi),d(8,li),d(9,gl),d(10,Mr),d(11,ft)],wn);let vn=class extends ti{constructor(e,t,i,n,s,o,l,c,h,m,p){super("extensions.installAndSync",e,ti.Class,t,i,n,s,o,l,c,p),this.userDataSyncEnablementService=m,this.tooltip=a({key:"install everywhere tooltip",comment:["Placeholder is the name of the product. Eg: Visual Studio Code or Visual Studio Code - Insiders"]},"Install this extension in all your synced {0} instances",h.nameLong),this._register(Y.any(m.onDidChangeEnablement,Y.filter(m.onDidChangeResourceEnablement,w=>w[0]==="extensions"))(()=>this.update()))}async computeAndUpdateEnablement(){await super.computeAndUpdateEnablement(),this.enabled&&(this.enabled=this.userDataSyncEnablementService.isEnabled()&&this.userDataSyncEnablementService.isResourceEnabled("extensions"))}getInstallOptions(){return{...super.getInstallOptions(),isMachineScoped:!1}}};vn=b([d(1,Q),d(2,O),d(3,se),d(4,Ot),d(5,Mt),d(6,Rt),d(7,Wi),d(8,ai),d(9,Mr),d(10,ft)],vn);class Xt extends T{constructor(){super("extension.installing",Xt.LABEL,Xt.CLASS,!1)}update(){this.class=`${Xt.CLASS}${this.extension&&this.extension.state===0?"":" hide"}`}}Xt.LABEL=a("installing","Installing");Xt.CLASS=`${T.LABEL_ACTION_CLASS} install installing`;let ii=class Nt extends T{constructor(e,t,i,n,s,o){super(e,Nt.INSTALL_LABEL,Nt.Class,!1),this.server=t,this.canInstallAnyWhere=i,this.extensionsWorkbenchService=n,this.extensionManagementServerService=s,this.extensionManifestPropertiesService=o,this.updateWhenCounterExtensionChanges=!0,this.update()}update(){if(this.enabled=!1,this.class=Nt.Class,this.canInstall()){const e=this.extensionsWorkbenchService.installed.filter(t=>Me(t.identifier,this.extension.identifier)&&t.server===this.server)[0];e?e.state===0&&!e.local&&(this.enabled=!0,this.label=Nt.INSTALLING_LABEL,this.class=Nt.InstallingClass):(this.enabled=!0,this.label=this.getInstallLabel())}}canInstall(){return!this.extension||!this.server||!this.extension.local||this.extension.state!==1||this.extension.type!==1||this.extension.enablementState===2||this.extension.enablementState===0||this.extension.enablementState===4?!1:!!(qo(this.extension.local.manifest)||this.server===this.extensionManagementServerService.localExtensionManagementServer&&this.extensionManifestPropertiesService.prefersExecuteOnUI(this.extension.local.manifest)||this.server===this.extensionManagementServerService.remoteExtensionManagementServer&&this.extensionManifestPropertiesService.prefersExecuteOnWorkspace(this.extension.local.manifest)||this.server===this.extensionManagementServerService.webExtensionManagementServer&&this.extensionManifestPropertiesService.prefersExecuteOnWeb(this.extension.local.manifest)||this.canInstallAnyWhere&&(this.server===this.extensionManagementServerService.localExtensionManagementServer&&this.extensionManifestPropertiesService.canExecuteOnUI(this.extension.local.manifest)||this.server===this.extensionManagementServerService.remoteExtensionManagementServer&&this.extensionManifestPropertiesService.canExecuteOnWorkspace(this.extension.local.manifest)))}async run(){var e,t;if((e=this.extension)!=null&&e.local&&(t=this.extension)!=null&&t.server&&this.server)return this.extensionsWorkbenchService.open(this.extension),It(a("installExtensionStart","Installing extension {0} started. An editor is now open with more details on this extension",this.extension.displayName)),this.extensionsWorkbenchService.installInServer(this.extension,this.server)}};ii.INSTALL_LABEL=a("install","Install");ii.INSTALLING_LABEL=a("installing","Installing");ii.Class=`${T.LABEL_ACTION_CLASS} prominent install`;ii.InstallingClass=`${T.LABEL_ACTION_CLASS} install installing`;ii=b([d(3,Q),d(4,li),d(5,Gr)],ii);let Tt=class nt extends T{constructor(e){super("extensions.uninstall",nt.UninstallLabel,nt.UninstallClass,!1),this.extensionsWorkbenchService=e,this.update()}update(){if(!this.extension){this.enabled=!1;return}const e=this.extension.state;if(e===2){this.label=nt.UninstallingLabel,this.class=nt.UnInstallingClass,this.enabled=!1;return}if(this.label=nt.UninstallLabel,this.class=nt.UninstallClass,this.tooltip=nt.UninstallLabel,e!==1){this.enabled=!1;return}if(this.extension.isBuiltin){this.enabled=!1;return}this.enabled=!0}async run(){if(this.extension)return It(a("uninstallExtensionStart","Uninstalling extension {0} started.",this.extension.displayName)),this.extensionsWorkbenchService.uninstall(this.extension).then(()=>{It(a("uninstallExtensionComplete","Please reload Visual Studio Code to complete the uninstallation of the extension {0}.",this.extension.displayName))})}};Tt.UninstallLabel=a("uninstallAction","Uninstall");Tt.UninstallingLabel=a("Uninstalling","Uninstalling");Tt.UninstallClass=`${T.LABEL_ACTION_CLASS} uninstall`;Tt.UnInstallingClass=`${T.LABEL_ACTION_CLASS} uninstall uninstalling`;Tt=b([d(0,Q)],Tt);class lt extends T{constructor(e,t,i){super(e,t,lt.DisabledClass,!1),this.extensionsWorkbenchService=i,this.updateThrottler=new Fr,this.update()}update(){this.updateThrottler.queue(()=>this.computeAndUpdateEnablement())}async computeAndUpdateEnablement(){if(this.enabled=!1,this.class=Ls.DisabledClass,!this.extension||this.extension.deprecationInfo)return;const e=await this.extensionsWorkbenchService.canInstall(this.extension),t=this.extension.state===1;this.enabled=e&&t&&this.extension.outdated,this.class=this.enabled?lt.EnabledClass:lt.DisabledClass}}lt.EnabledClass=`${T.LABEL_ACTION_CLASS} prominent update`;lt.DisabledClass=`${lt.EnabledClass} disabled`;let Ls=class extends lt{constructor(e,t,i){super("extensions.update",a("update","Update"),t),this.verbose=e,this.instantiationService=i}update(){super.update(),this.extension&&(this.label=this.verbose?a("update to","Update to v{0}",this.extension.latestVersion):a("update","Update"))}async run(){if(this.extension)return It(a("updateExtensionStart","Updating extension {0} to version {1} started.",this.extension.displayName,this.extension.latestVersion)),this.install(this.extension)}async install(e){var t;try{await this.extensionsWorkbenchService.install(e,(t=e.local)!=null&&t.preRelease?{installPreReleaseVersion:!0}:void 0),It(a("updateExtensionComplete","Updating extension {0} to version {1} completed.",e.displayName,e.latestVersion))}catch(i){this.instantiationService.createInstance(ei,e,e.latestVersion,3,void 0,i).run()}}};Ls=b([d(1,Q),d(2,O)],Ls);let Ci=class Ji extends T{constructor(e,t){super("extensionsAction.migrateDeprecatedExtension",a("migrateExtension","Migrate"),Ji.DisabledClass,!1),this.small=e,this.extensionsWorkbenchService=t,this.update()}update(){var t,i;if(this.enabled=!1,this.class=Ji.DisabledClass,!((t=this.extension)!=null&&t.local)||this.extension.state!==1||!((i=this.extension.deprecationInfo)!=null&&i.extension))return;const e=this.extension.deprecationInfo.extension.id;this.extensionsWorkbenchService.local.some(n=>Me(n.identifier,{id:e}))||(this.enabled=!0,this.class=Ji.EnabledClass,this.tooltip=a("migrate to","Migrate to {0}",this.extension.deprecationInfo.extension.displayName),this.label=this.small?a("migrate","Migrate"):this.tooltip)}async run(){var i,n,s,o;if(!((n=(i=this.extension)==null?void 0:i.deprecationInfo)!=null&&n.extension))return;const e=this.extension.local;await this.extensionsWorkbenchService.uninstall(this.extension);const[t]=await this.extensionsWorkbenchService.getExtensions([{id:this.extension.deprecationInfo.extension.id,preRelease:(o=(s=this.extension.deprecationInfo)==null?void 0:s.extension)==null?void 0:o.preRelease}],ri.None);await this.extensionsWorkbenchService.install(t,{isMachineScoped:e==null?void 0:e.isMachineScoped})}};Ci.EnabledClass=`${T.LABEL_ACTION_CLASS} migrate`;Ci.DisabledClass=`${Ci.EnabledClass} disabled`;Ci=b([d(1,Q)],Ci);let bn=class extends T{constructor(e,t,i,n,s){super(e,t,i,n),this.instantiationService=s,this._actionViewItem=null}createActionViewItem(){return this._actionViewItem=this.instantiationService.createInstance(Ms,this),this._actionViewItem}run({actionGroups:e,disposeActionsOnHide:t}){var i;return(i=this._actionViewItem)==null||i.showMenu(e,t),Promise.resolve()}};bn=b([d(4,O)],bn);let Ms=class extends Uo{constructor(e,t){super(null,e,{icon:!0,label:!0}),this.contextMenuService=t}showMenu(e,t){if(this.element){const i=this.getActions(e),n=jo(this.element),s={x:n.left,y:n.top+n.height+10};this.contextMenuService.showContextMenu({getAnchor:()=>s,getActions:()=>i,actionRunner:this.actionRunner,onHide:()=>{t&&yl(i)}})}}getActions(e){let t=[];for(const i of e)t=[...t,...i,new Ct];return t.length?t.slice(0,t.length-1):t}};Ms=b([d(1,Wt)],Ms);async function md(r,e,t){return t.invokeFunction(async i=>{var w,f,_,S;const n=i.get(Q),s=i.get(Kn),o=i.get(hd),l=i.get(Hr),c=i.get(Ot),h=[];if(r){h.push(["extension",r.identifier.id]),h.push(["isBuiltinExtension",r.isBuiltin]),h.push(["extensionHasConfiguration",r.local&&!!r.local.manifest.contributes&&!!r.local.manifest.contributes.configuration]),h.push(["extensionHasKeybindings",r.local&&!!r.local.manifest.contributes&&!!r.local.manifest.contributes.keybindings]),h.push(["extensionHasCommands",r.local&&!!r.local.manifest.contributes&&!!((w=r.local.manifest.contributes)!=null&&w.commands)]),h.push(["isExtensionRecommended",!!o.getAllRecommendationsWithReason()[r.identifier.id.toLowerCase()]]),h.push(["isExtensionWorkspaceRecommended",((f=o.getAllRecommendationsWithReason()[r.identifier.id.toLowerCase()])==null?void 0:f.reasonId)===0]),h.push(["isUserIgnoredRecommendation",l.globalIgnoredRecommendations.some(D=>D===r.identifier.id.toLowerCase())]),r.state===1&&h.push(["extensionStatus","installed"]),h.push(["installedExtensionIsPreReleaseVersion",!!((_=r.local)!=null&&_.isPreReleaseVersion)]),h.push(["galleryExtensionIsPreReleaseVersion",!!((S=r.gallery)!=null&&S.properties.isPreReleaseVersion)]),h.push(["extensionHasPreReleaseVersion",r.hasPreReleaseVersion]),h.push(["extensionHasReleaseVersion",r.hasReleaseVersion]);const[y,R,C]=await Promise.all([c.getColorThemes(),c.getFileIconThemes(),c.getProductIconThemes()]);h.push(["extensionHasColorThemes",y.some(D=>Oe(D,r))]),h.push(["extensionHasFileIconThemes",R.some(D=>Oe(D,r))]),h.push(["extensionHasProductIconThemes",C.some(D=>Oe(D,r))]),h.push(["canSetLanguage",n.canSetLanguage(r)]),h.push(["isActiveLanguagePackExtension",r.gallery&&zn===Or(r.gallery)])}const m=s.createMenu(I.ExtensionContext,e.createOverlay(h)),p=m.getActions({shouldForwardArgs:!0});return m.dispose(),p})}function ss(r,e){const t=[];for(const[,i]of r)t.push(i.map(n=>n instanceof Yo?n:e.createInstance(Rs,n)));return t}let ni=class gi extends bn{constructor(e,t,i){super(gi.ID,"","",!0,e),this.extensionService=t,this.contextKeyService=i,this.tooltip=a("manage","Manage"),this.update()}async getActionGroups(){const e=[],t=await md(this.extension,this.contextKeyService,this.instantiationService),i=[],n=[],s=[];for(const[o,l]of t)o===xl?n.push(...ss([[o,l]],this.instantiationService)[0]):o===Il?i.push(...ss([[o,l]],this.instantiationService)[0]):s.push(...ss([[o,l]],this.instantiationService));return i.length&&e.push(i),e.push([this.instantiationService.createInstance(xi),this.instantiationService.createInstance(yi)]),e.push([this.instantiationService.createInstance(ki),this.instantiationService.createInstance(Ii)]),e.push([...n.length?n:[],this.instantiationService.createInstance(Dt),this.instantiationService.createInstance(Tt)]),s.forEach(o=>e.push(o)),e.forEach(o=>o.forEach(l=>{l instanceof T&&(l.extension=this.extension)})),e}async run(){return await this.extensionService.whenInstalledExtensionsRegistered(),super.run({actionGroups:await this.getActionGroups(),disposeActionsOnHide:!0})}update(){if(this.class=gi.HideManageExtensionClass,this.enabled=!1,this.extension){const e=this.extension.state;this.enabled=e===1,this.class=this.enabled||e===2?gi.Class:gi.HideManageExtensionClass,this.tooltip=e===2?a("ManageExtensionAction.uninstallingTooltip","Uninstalling"):""}}};ni.ID="extensions.manage";ni.Class=`${T.ICON_ACTION_CLASS} manage `+L.asClassName(Lh);ni.HideManageExtensionClass=`${ni.Class} hide`;ni=b([d(0,O),d(1,se),d(2,Ie)],ni);let Rs=class extends T{constructor(e,t){super(e.id,e.label),this.action=e,this.extensionsWorkbenchService=t}update(){this.extension&&this.action.id===kl&&(this.checked=!this.extensionsWorkbenchService.isExtensionIgnoredToSync(this.extension))}async run(){this.extension&&await this.action.run(this.extension.local?no(this.extension.local.manifest.publisher,this.extension.local.manifest.name):this.extension.gallery?no(this.extension.gallery.publisher,this.extension.gallery.name):this.extension.identifier.id)}};Rs=b([d(1,Q)],Rs);let Sn=class Zi extends T{constructor(e,t){super(Zi.ID,e?"":Zi.TITLE.value,`${e?T.ICON_ACTION_CLASS+" "+L.asClassName(Sa):T.LABEL_ACTION_CLASS} hide-when-disabled switch-to-prerelease`,!0),this.commandService=t,this.tooltip=a("switch to pre-release version tooltip","Switch to Pre-Release version of this extension"),this.update()}update(){var e;this.enabled=!!this.extension&&!this.extension.isBuiltin&&!((e=this.extension.local)!=null&&e.isPreReleaseVersion)&&this.extension.hasPreReleaseVersion&&this.extension.state===1}async run(){var e;if(this.enabled)return this.commandService.executeCommand(Zi.ID,(e=this.extension)==null?void 0:e.identifier.id)}};Sn.ID="workbench.extensions.action.switchToPreReleaseVersion";Sn.TITLE={value:a("switch to pre-release version","Switch to Pre-Release Version"),original:"Switch to  Pre-Release Version"};Sn=b([d(1,ue)],Sn);let Cn=class en extends T{constructor(e,t){super(en.ID,e?"":en.TITLE.value,`${e?T.ICON_ACTION_CLASS+" "+L.asClassName(Sa):T.LABEL_ACTION_CLASS} hide-when-disabled switch-to-released`),this.commandService=t,this.tooltip=a("switch to release version tooltip","Switch to Release version of this extension"),this.update()}update(){var e;this.enabled=!!this.extension&&!this.extension.isBuiltin&&this.extension.state===1&&!!((e=this.extension.local)!=null&&e.isPreReleaseVersion)&&!!this.extension.hasReleaseVersion}async run(){var e;if(this.enabled)return this.commandService.executeCommand(en.ID,(e=this.extension)==null?void 0:e.identifier.id)}};Cn.ID="workbench.extensions.action.switchToReleaseVersion";Cn.TITLE={value:a("switch to release version","Switch to Release Version"),original:"Switch to Release Version"};Cn=b([d(1,ue)],Cn);let Dt=class Ws extends T{constructor(e,t,i,n,s){super(Ws.ID,Ws.LABEL,T.LABEL_ACTION_CLASS),this.extensionsWorkbenchService=e,this.extensionGalleryService=t,this.quickInputService=i,this.instantiationService=n,this.dialogService=s,this.update()}update(){this.enabled=!!this.extension&&!this.extension.isBuiltin&&!!this.extension.gallery&&!!this.extension.local&&!!this.extension.server&&this.extension.state===1&&!this.extension.deprecationInfo}async run(){if(!this.enabled)return;const e=await this.extension.server.extensionManagementService.getTargetPlatform(),t=await this.extensionGalleryService.getAllCompatibleVersions(this.extension.gallery,this.extension.local.preRelease,e);if(!t.length){await this.dialogService.info(a("no versions","This extension has no other versions."));return}const i=t.map((s,o)=>({id:s.version,label:s.version,description:`${pi(new Date(Date.parse(s.date)),!0)}${s.isPreReleaseVersion?` (${a("pre-release","pre-release")})`:""}${s.version===this.extension.version?` (${a("current","current")})`:""}`,latest:o===0,ariaLabel:`${s.isPreReleaseVersion?"Pre-Release version":"Release version"} ${s.version}`,isPreReleaseVersion:s.isPreReleaseVersion})),n=await this.quickInputService.pick(i,{placeHolder:a("selectVersion","Select Version to Install"),matchOnDetail:!0});if(n){if(this.extension.version===n.id)return;try{n.latest?await this.extensionsWorkbenchService.install(this.extension,{installPreReleaseVersion:n.isPreReleaseVersion}):await this.extensionsWorkbenchService.installVersion(this.extension,n.id,{installPreReleaseVersion:n.isPreReleaseVersion})}catch(s){this.instantiationService.createInstance(ei,this.extension,n.latest?this.extension.latestVersion:n.id,2,void 0,s).run()}}return null}};Dt.ID="workbench.extensions.action.install.anotherVersion";Dt.LABEL=a("install another version","Install Another Version...");Dt=b([d(0,Q),d(1,$o),d(2,me),d(3,O),d(4,Rt)],Dt);let yi=class Fs extends T{constructor(e,t){super(Fs.ID,Fs.LABEL,T.LABEL_ACTION_CLASS),this.extensionsWorkbenchService=e,this.extensionEnablementService=t,this.tooltip=a("enableForWorkspaceActionToolTip","Enable this extension only in this workspace"),this.update()}update(){this.enabled=!1,this.extension&&this.extension.local&&(this.enabled=this.extension.state===1&&!this.extensionEnablementService.isEnabled(this.extension.local)&&this.extensionEnablementService.canChangeWorkspaceEnablement(this.extension.local))}async run(){if(this.extension)return this.extensionsWorkbenchService.setEnablement(this.extension,9)}};yi.ID="extensions.enableForWorkspace";yi.LABEL=a("enableForWorkspaceAction","Enable (Workspace)");yi=b([d(0,Q),d(1,Be)],yi);let xi=class Os extends T{constructor(e,t){super(Os.ID,Os.LABEL,T.LABEL_ACTION_CLASS),this.extensionsWorkbenchService=e,this.extensionEnablementService=t,this.tooltip=a("enableGloballyActionToolTip","Enable this extension"),this.update()}update(){this.enabled=!1,this.extension&&this.extension.local&&(this.enabled=this.extension.state===1&&this.extensionEnablementService.isDisabledGlobally(this.extension.local)&&this.extensionEnablementService.canChangeEnablement(this.extension.local))}async run(){if(this.extension)return this.extensionsWorkbenchService.setEnablement(this.extension,8)}};xi.ID="extensions.enableGlobally";xi.LABEL=a("enableGloballyAction","Enable");xi=b([d(0,Q),d(1,Be)],xi);let Ii=class Ns extends T{constructor(e,t,i,n){super(Ns.ID,Ns.LABEL,T.LABEL_ACTION_CLASS),this.workspaceContextService=e,this.extensionsWorkbenchService=t,this.extensionEnablementService=i,this.extensionService=n,this.tooltip=a("disableForWorkspaceActionToolTip","Disable this extension only in this workspace"),this.update(),this._register(this.extensionService.onDidChangeExtensions(()=>this.update()))}update(){this.enabled=!1,this.extension&&this.extension.local&&this.extensionService.extensions.some(e=>Me({id:e.identifier.value,uuid:e.uuid},this.extension.identifier)&&this.workspaceContextService.getWorkbenchState()!==1)&&(this.enabled=this.extension.state===1&&(this.extension.enablementState===8||this.extension.enablementState===9)&&this.extensionEnablementService.canChangeWorkspaceEnablement(this.extension.local))}async run(){if(this.extension)return this.extensionsWorkbenchService.setEnablement(this.extension,7)}};Ii.ID="extensions.disableForWorkspace";Ii.LABEL=a("disableForWorkspaceAction","Disable (Workspace)");Ii=b([d(0,ge),d(1,Q),d(2,Be),d(3,se)],Ii);let ki=class Bs extends T{constructor(e,t,i){super(Bs.ID,Bs.LABEL,T.LABEL_ACTION_CLASS),this.extensionsWorkbenchService=e,this.extensionEnablementService=t,this.extensionService=i,this.tooltip=a("disableGloballyActionToolTip","Disable this extension"),this.update(),this._register(this.extensionService.onDidChangeExtensions(()=>this.update()))}update(){this.enabled=!1,this.extension&&this.extension.local&&this.extensionService.extensions.some(e=>Me({id:e.identifier.value,uuid:e.uuid},this.extension.identifier))&&(this.enabled=this.extension.state===1&&(this.extension.enablementState===8||this.extension.enablementState===9)&&this.extensionEnablementService.canChangeEnablement(this.extension.local))}async run(){if(this.extension)return this.extensionsWorkbenchService.setEnablement(this.extension,6)}};ki.ID="extensions.disableGlobally";ki.LABEL=a("disableGloballyAction","Disable");ki=b([d(0,Q),d(1,Be),d(2,se)],ki);let Ti=class tn extends T{constructor(e,t){super("extensions.reload",a("reloadAction","Reload"),tn.DisabledClass,!1),this.hostService=e,this.extensionService=t,this.updateWhenCounterExtensionChanges=!0,this._register(this.extensionService.onDidChangeExtensions(()=>this.update())),this.update()}update(){if(this.enabled=!1,this.tooltip="",!this.extension)return;const e=this.extension.state;if(e===0||e===2||this.extension.local&&this.extension.local.manifest&&this.extension.local.manifest.contributes&&this.extension.local.manifest.contributes.localizations&&this.extension.local.manifest.contributes.localizations.length>0)return;const t=this.extension.reloadRequiredStatus;this.enabled=t!==void 0,this.label=t!==void 0?a("reload required","Reload Required"):"",this.tooltip=t!==void 0?t:"",this.class=this.enabled?tn.EnabledClass:tn.DisabledClass}run(){return Promise.resolve(this.hostService.reload())}};Ti.EnabledClass=`${T.LABEL_ACTION_CLASS} reload`;Ti.DisabledClass=`${Ti.EnabledClass} disabled`;Ti=b([d(0,zo),d(1,se)],Ti);function Oe(r,e){return!!(e&&r.extensionData&&Tl.equals(r.extensionData.extensionId,e.identifier.id))}function $r(r,e,t,i){const n=[];for(const s of r)Oe(s,t)&&!(i&&s===e)&&n.push({label:s.label,id:s.id});return i&&(n.push({type:"separator",label:a("current","current")}),n.push({label:e.label,id:e.id})),n}let ht=class Bt extends T{constructor(e,t,i,n){super(Bt.ID,Bt.TITLE.value,Bt.DisabledClass,!1),this.workbenchThemeService=t,this.quickInputService=i,this.extensionEnablementService=n,this._register(Y.any(e.onDidChangeExtensions,t.onDidColorThemeChange)(()=>this.update(),this)),this.update()}update(){this.workbenchThemeService.getColorThemes().then(e=>{this.enabled=this.computeEnablement(e),this.class=this.enabled?Bt.EnabledClass:Bt.DisabledClass})}computeEnablement(e){return!!this.extension&&this.extension.state===1&&this.extensionEnablementService.isEnabledEnablementState(this.extension.enablementState)&&e.some(t=>Oe(t,this.extension))}async run({showCurrentTheme:e,ignoreFocusLost:t}={showCurrentTheme:!1,ignoreFocusLost:!1}){const i=await this.workbenchThemeService.getColorThemes();if(!this.computeEnablement(i))return;const n=this.workbenchThemeService.getColorTheme(),s=new qn(100),o=$r(i,n,this.extension,e),l=await this.quickInputService.pick(o,{placeHolder:a("select color theme","Select Color Theme"),onDidFocus:c=>s.trigger(()=>this.workbenchThemeService.setColorTheme(c.id,void 0)),ignoreFocusLost:t});return this.workbenchThemeService.setColorTheme(l?l.id:n.id,"auto")}};ht.ID="workbench.extensions.action.setColorTheme";ht.TITLE={value:a("workbench.extensions.action.setColorTheme","Set Color Theme"),original:"Set Color Theme"};ht.EnabledClass=`${T.LABEL_ACTION_CLASS} theme`;ht.DisabledClass=`${ht.EnabledClass} disabled`;ht=b([d(0,se),d(1,Ot),d(2,me),d(3,Be)],ht);let dt=class Vt extends T{constructor(e,t,i,n){super(Vt.ID,Vt.TITLE.value,Vt.DisabledClass,!1),this.workbenchThemeService=t,this.quickInputService=i,this.extensionEnablementService=n,this._register(Y.any(e.onDidChangeExtensions,t.onDidFileIconThemeChange)(()=>this.update(),this)),this.update()}update(){this.workbenchThemeService.getFileIconThemes().then(e=>{this.enabled=this.computeEnablement(e),this.class=this.enabled?Vt.EnabledClass:Vt.DisabledClass})}computeEnablement(e){return!!this.extension&&this.extension.state===1&&this.extensionEnablementService.isEnabledEnablementState(this.extension.enablementState)&&e.some(t=>Oe(t,this.extension))}async run({showCurrentTheme:e,ignoreFocusLost:t}={showCurrentTheme:!1,ignoreFocusLost:!1}){const i=await this.workbenchThemeService.getFileIconThemes();if(!this.computeEnablement(i))return;const n=this.workbenchThemeService.getFileIconTheme(),s=new qn(100),o=$r(i,n,this.extension,e),l=await this.quickInputService.pick(o,{placeHolder:a("select file icon theme","Select File Icon Theme"),onDidFocus:c=>s.trigger(()=>this.workbenchThemeService.setFileIconTheme(c.id,void 0)),ignoreFocusLost:t});return this.workbenchThemeService.setFileIconTheme(l?l.id:n.id,"auto")}};dt.ID="workbench.extensions.action.setFileIconTheme";dt.TITLE={value:a("workbench.extensions.action.setFileIconTheme","Set File Icon Theme"),original:"Set File Icon Theme"};dt.EnabledClass=`${T.LABEL_ACTION_CLASS} theme`;dt.DisabledClass=`${dt.EnabledClass} disabled`;dt=b([d(0,se),d(1,Ot),d(2,me),d(3,Be)],dt);let ut=class Ht extends T{constructor(e,t,i,n){super(Ht.ID,Ht.TITLE.value,Ht.DisabledClass,!1),this.workbenchThemeService=t,this.quickInputService=i,this.extensionEnablementService=n,this._register(Y.any(e.onDidChangeExtensions,t.onDidProductIconThemeChange)(()=>this.update(),this)),this.update()}update(){this.workbenchThemeService.getProductIconThemes().then(e=>{this.enabled=this.computeEnablement(e),this.class=this.enabled?Ht.EnabledClass:Ht.DisabledClass})}computeEnablement(e){return!!this.extension&&this.extension.state===1&&this.extensionEnablementService.isEnabledEnablementState(this.extension.enablementState)&&e.some(t=>Oe(t,this.extension))}async run({showCurrentTheme:e,ignoreFocusLost:t}={showCurrentTheme:!1,ignoreFocusLost:!1}){const i=await this.workbenchThemeService.getProductIconThemes();if(!this.computeEnablement(i))return;const n=this.workbenchThemeService.getProductIconTheme(),s=new qn(100),o=$r(i,n,this.extension,e),l=await this.quickInputService.pick(o,{placeHolder:a("select product icon theme","Select Product Icon Theme"),onDidFocus:c=>s.trigger(()=>this.workbenchThemeService.setProductIconTheme(c.id,void 0)),ignoreFocusLost:t});return this.workbenchThemeService.setProductIconTheme(l?l.id:n.id,"auto")}};ut.ID="workbench.extensions.action.setProductIconTheme";ut.TITLE={value:a("workbench.extensions.action.setProductIconTheme","Set Product Icon Theme"),original:"Set Product Icon Theme"};ut.EnabledClass=`${T.LABEL_ACTION_CLASS} theme`;ut.DisabledClass=`${ut.EnabledClass} disabled`;ut=b([d(0,se),d(1,Ot),d(2,me),d(3,Be)],ut);let Pt=class Gt extends T{constructor(e){super(Gt.ID,Gt.TITLE.value,Gt.DisabledClass,!1),this.extensionsWorkbenchService=e,this.update()}update(){this.enabled=!1,this.class=Gt.DisabledClass,this.extension&&this.extensionsWorkbenchService.canSetLanguage(this.extension)&&(this.extension.gallery&&zn===Or(this.extension.gallery)||(this.enabled=!0,this.class=Gt.EnabledClass))}async run(){return this.extension&&this.extensionsWorkbenchService.setLanguage(this.extension)}};Pt.ID="workbench.extensions.action.setDisplayLanguage";Pt.TITLE={value:a("workbench.extensions.action.setDisplayLanguage","Set Display Language"),original:"Set Display Language"};Pt.EnabledClass=`${T.LABEL_ACTION_CLASS} language`;Pt.DisabledClass=`${Pt.EnabledClass} disabled`;Pt=b([d(0,Q)],Pt);let Et=class $t extends T{constructor(e,t){super($t.ID,$t.TITLE.value,$t.DisabledClass,!1),this.extensionsWorkbenchService=e,this.localeService=t,this.update()}update(){this.enabled=!1,this.class=$t.DisabledClass,this.extension&&this.extensionsWorkbenchService.canSetLanguage(this.extension)&&(this.extension.gallery&&zn!==Or(this.extension.gallery)||(this.enabled=!0,this.class=$t.EnabledClass))}async run(){return this.extension&&this.localeService.clearLocalePreference()}};Et.ID="workbench.extensions.action.clearLanguage";Et.TITLE={value:a("workbench.extensions.action.clearLanguage","Clear Display Language"),original:"Clear Display Language"};Et.EnabledClass=`${T.LABEL_ACTION_CLASS} language`;Et.DisabledClass=`${Et.EnabledClass} disabled`;Et=b([d(0,Q),d(1,dd)],Et);let yn=class Vs extends U{constructor(e,t,i){super(Vs.ID,Vs.LABEL,void 0,!1),this.paneCompositeService=t,this.extensionWorkbenchService=i,this.extensionId=e}async run(){const e=await this.paneCompositeService.openPaneComposite(Oi,0,!0),t=e==null?void 0:e.getViewPaneContainer();t.search(`@id:${this.extensionId}`),t.focus();const[i]=await this.extensionWorkbenchService.getExtensions([{id:this.extensionId}],{source:"install-recommendation"},ri.None);return i?this.extensionWorkbenchService.open(i):null}};yn.ID="workbench.extensions.action.showRecommendedExtension";yn.LABEL=a("showRecommendedExtension","Show Recommended Extension");yn=b([d(1,Fi),d(2,Q)],yn);let Di=class Hs extends U{constructor(e,t,i,n){super(Hs.ID,Hs.LABEL,void 0,!1),this.paneCompositeService=t,this.instantiationService=i,this.extensionWorkbenchService=n,this.extensionId=e}async run(){const e=await this.paneCompositeService.openPaneComposite(Oi,0,!0),t=e==null?void 0:e.getViewPaneContainer();t.search(`@id:${this.extensionId}`),t.focus();const[i]=await this.extensionWorkbenchService.getExtensions([{id:this.extensionId}],{source:"install-recommendation"},ri.None);if(i){await this.extensionWorkbenchService.open(i);try{await this.extensionWorkbenchService.install(i)}catch(n){this.instantiationService.createInstance(ei,i,i.latestVersion,2,void 0,n).run()}}}};Di.ID="workbench.extensions.action.installRecommendedExtension";Di.LABEL=a("installRecommendedExtension","Install Recommended Extension");Di=b([d(1,Fi),d(2,O),d(3,Q)],Di);let xn=class Gs extends U{constructor(e,t){super(Gs.ID,"Ignore Recommendation"),this.extension=e,this.extensionRecommendationsManagementService=t,this.class=Gs.Class,this.tooltip=a("ignoreExtensionRecommendation","Do not recommend this extension again"),this.enabled=!0}run(){return this.extensionRecommendationsManagementService.toggleGlobalIgnoredRecommendation(this.extension.identifier.id,!0),Promise.resolve()}};xn.ID="extensions.ignore";xn.Class=`${T.LABEL_ACTION_CLASS} ignore`;xn=b([d(1,Hr)],xn);let In=class $s extends U{constructor(e,t){super($s.ID,"Undo"),this.extension=e,this.extensionRecommendationsManagementService=t,this.class=$s.Class,this.tooltip=a("undo","Undo"),this.enabled=!0}run(){return this.extensionRecommendationsManagementService.toggleGlobalIgnoredRecommendation(this.extension.identifier.id,!1),Promise.resolve()}};In.ID="extensions.ignore";In.Class=`${T.LABEL_ACTION_CLASS} undo-ignore`;In=b([d(1,Hr)],In);let kn=class extends U{constructor(e,t){super("extensions.searchExtensions",a("search recommendations","Search Extensions"),void 0,!0),this.searchValue=e,this.paneCompositeService=t}async run(){var t;const e=(t=await this.paneCompositeService.openPaneComposite(Oi,0,!0))==null?void 0:t.getViewPaneContainer();e.search(this.searchValue),e.focus()}};kn=b([d(1,Fi)],kn);let Tn=class extends U{constructor(e,t,i,n,s,o,l,c){super(e,t),this.contextService=i,this.fileService=n,this.textFileService=s,this.editorService=o,this.jsonEditingService=l,this.textModelResolverService=c}openExtensionsFile(e){return this.getOrCreateExtensionsFile(e).then(({created:t,content:i})=>this.getSelectionPosition(i,e,["recommendations"]).then(n=>this.editorService.openEditor({resource:e,options:{pinned:t,selection:n}})),t=>Promise.reject(new Error(a("OpenExtensionsFile.failed","Unable to create 'extensions.json' file inside the '.vscode' folder ({0}).",t))))}openWorkspaceConfigurationFile(e){return this.getOrUpdateWorkspaceConfigurationFile(e).then(t=>this.getSelectionPosition(t.value.toString(),t.resource,["extensions","recommendations"])).then(t=>this.editorService.openEditor({resource:e,options:{selection:t,forceReload:!0}}))}getOrUpdateWorkspaceConfigurationFile(e){return Promise.resolve(this.fileService.readFile(e)).then(t=>{const i=Dl(t.value.toString()).extensions;return!i||!i.recommendations?this.jsonEditingService.write(e,[{path:["extensions"],value:{recommendations:[]}}],!0).then(()=>this.fileService.readFile(e)):t})}getSelectionPosition(e,t,i){const n=Pl(e),s=El(n,i);if(s&&s.parent&&s.parent.children){const o=s.parent.children[1],l=o.children&&o.children.length?o.children[o.children.length-1]:null,c=l?l.offset+l.length:o.offset+1;return Promise.resolve(this.textModelResolverService.createModelReference(t)).then(h=>{const m=h.object.textEditorModel.getPositionAt(c);return h.dispose(),{startLineNumber:m.lineNumber,startColumn:m.column,endLineNumber:m.lineNumber,endColumn:m.column}})}return Promise.resolve(void 0)}getOrCreateExtensionsFile(e){return Promise.resolve(this.fileService.readFile(e)).then(t=>({created:!1,extensionsFileResource:e,content:t.value.toString()}),t=>this.textFileService.write(e,fo).then(()=>({created:!0,extensionsFileResource:e,content:fo})))}};Tn=b([d(2,ge),d(3,gt),d(4,Rr),d(5,mt),d(6,Wr),d(7,Gn)],Tn);let Dn=class extends Tn{constructor(e,t,i,n,s,o,l,c){super(e,t,s,i,n,o,l,c),this._register(this.contextService.onDidChangeWorkbenchState(()=>this.update(),this)),this.update()}update(){this.enabled=this.contextService.getWorkbenchState()!==1}run(){switch(this.contextService.getWorkbenchState()){case 2:return this.openExtensionsFile(this.contextService.getWorkspace().folders[0].toResource(Oa));case 3:return this.openWorkspaceConfigurationFile(this.contextService.getWorkspace().configuration)}return Promise.resolve()}};Dn.ID="workbench.extensions.action.configureWorkspaceRecommendedExtensions";Dn.LABEL=a("configureWorkspaceRecommendedExtensions","Configure Recommended Extensions (Workspace)");Dn=b([d(2,gt),d(3,Rr),d(4,ge),d(5,mt),d(6,Wr),d(7,Gn)],Dn);let Pn=class extends Tn{constructor(e,t,i,n,s,o,l,c,h){super(e,t,s,i,n,o,l,c),this.commandService=h}run(){const t=this.contextService.getWorkspace().folders.length===1?Promise.resolve(this.contextService.getWorkspace().folders[0]):this.commandService.executeCommand(Lr);return Promise.resolve(t).then(i=>i?this.openExtensionsFile(i.toResource(Oa)):null)}};Pn.ID="workbench.extensions.action.configureWorkspaceFolderRecommendedExtensions";Pn.LABEL=a("configureWorkspaceFolderRecommendedExtensions","Configure Recommended Extensions (Workspace Folder)");Pn=b([d(2,gt),d(3,Rr),d(4,ge),d(5,mt),d(6,Wr),d(7,Gn),d(8,ue)],Pn);let Pi=class nn extends U{get extension(){return this._extension}set extension(e){this._extension&&e&&Me(this._extension.identifier,e.identifier)||(this.initialStatus=null,this.status=null,this.enablementState=null),this._extension=e,this.update()}constructor(e,t,i){super("extensions.action.statusLabel","",nn.DISABLED_CLASS,!1),this.extensionService=e,this.extensionManagementServerService=t,this.extensionEnablementService=i,this.initialStatus=null,this.status=null,this.version=null,this.enablementState=null,this._extension=null}update(){const e=this.computeLabel();this.label=e||"",this.class=e?nn.ENABLED_CLASS:nn.DISABLED_CLASS}computeLabel(){if(!this.extension)return null;const e=this.status,t=this.version,i=this.enablementState;this.status=this.extension.state,this.version=this.extension.version,this.initialStatus===null&&(this.initialStatus=this.status),this.enablementState=this.extension.enablementState;const n=()=>{const o=this.extensionService.extensions.filter(l=>Me({id:l.identifier.value,uuid:l.uuid},this.extension.identifier))[0];return this.extension.local?o&&this.extension.version===o.version?!0:this.extensionService.canAddExtension(hn(this.extension.local)):!1},s=()=>this.extension.local?this.extensionService.extensions.every(o=>!(Me({id:o.identifier.value,uuid:o.uuid},this.extension.identifier)&&this.extension.server===this.extensionManagementServerService.getExtensionManagementServer(Xo(o))))?!0:this.extensionService.canRemoveExtension(hn(this.extension.local)):!1;if(e!==null){if(e===0&&this.status===1)return n()?this.initialStatus===1&&this.version!==t?a("updated","Updated"):a("installed","Installed"):null;if(e===2&&this.status===3)return this.initialStatus=this.status,s()?a("uninstalled","Uninstalled"):null}if(i!==null){const o=this.extensionEnablementService.isEnabledEnablementState(i),l=this.extensionEnablementService.isEnabledEnablementState(this.enablementState);if(!o&&l)return n()?a("enabled","Enabled"):null;if(o&&!l)return s()?a("disabled","Disabled"):null}return null}run(){return Promise.resolve()}};Pi.ENABLED_CLASS=`${T.TEXT_ACTION_CLASS} extension-status-label`;Pi.DISABLED_CLASS=`${Pi.ENABLED_CLASS} hide`;Pi=b([d(0,se),d(1,li),d(2,Be)],Pi);let Ei=class sn extends bn{constructor(e,t,i,n){super("extensions.sync","",sn.SYNC_CLASS,!1,n),this.configurationService=e,this.extensionsWorkbenchService=t,this.userDataSyncEnablementService=i,this._register(Y.filter(this.configurationService.onDidChangeConfiguration,s=>s.affectsConfiguration("settingsSync.ignoredExtensions"))(()=>this.update())),this._register(i.onDidChangeEnablement(()=>this.update())),this.update()}update(){if(this.enabled=!!this.extension&&this.userDataSyncEnablementService.isEnabled()&&this.extension.state===1,this.extension){const e=this.extensionsWorkbenchService.isExtensionIgnoredToSync(this.extension);this.class=e?sn.IGNORED_SYNC_CLASS:sn.SYNC_CLASS,this.tooltip=e?a("ignored","This extension is ignored during sync"):a("synced","This extension is synced")}}async run(){return super.run({actionGroups:[[new U("extensions.syncignore",this.extensionsWorkbenchService.isExtensionIgnoredToSync(this.extension)?a("sync","Sync this extension"):a("do not sync","Do not sync this extension"),void 0,!0,()=>this.extensionsWorkbenchService.toggleExtensionIgnoredToSync(this.extension))]],disposeActionsOnHide:!0})}};Ei.IGNORED_SYNC_CLASS=`${T.ICON_ACTION_CLASS} extension-sync ${L.asClassName(Mh)}`;Ei.SYNC_CLASS=`${Ei.ICON_ACTION_CLASS} extension-sync ${L.asClassName(Rh)}`;Ei=b([d(0,Z),d(1,Q),d(2,Mr),d(3,O)],Ei);let zs=class bt extends T{get status(){return this._status}constructor(e,t,i,n,s,o,l,c,h,m,p){super("extensions.status","",`${bt.CLASS} hide`,!1),this.extensionManagementServerService=e,this.labelService=t,this.commandService=i,this.workspaceTrustEnablementService=n,this.workspaceTrustService=s,this.extensionsWorkbenchService=o,this.extensionService=l,this.extensionManifestPropertiesService=c,this.contextService=h,this.productService=m,this.workbenchExtensionEnablementService=p,this.updateWhenCounterExtensionChanges=!0,this._onDidChangeStatus=this._register(new v),this.onDidChangeStatus=this._onDidChangeStatus.event,this.updateThrottler=new Fr,this._register(this.labelService.onDidChangeFormatters(()=>this.update(),this)),this._register(this.extensionService.onDidChangeExtensions(()=>this.update())),this.update()}update(){this.updateThrottler.queue(()=>this.computeAndUpdateStatus())}async computeAndUpdateStatus(){var i,n,s,o;if(this.updateStatus(void 0,!0),this.enabled=!1,!this.extension)return;if(this.extension.isMalicious){this.updateStatus({icon:fe,message:new N(a("malicious tooltip","This extension was reported to be problematic."))},!0);return}if(this.extension.deprecationInfo){if(this.extension.deprecationInfo.extension){const l=`[${this.extension.deprecationInfo.extension.displayName}](${M.parse(`command:extension.open?${encodeURIComponent(JSON.stringify([this.extension.deprecationInfo.extension.id]))}`)})`;this.updateStatus({icon:fe,message:new N(a("deprecated with alternate extension tooltip","This extension is deprecated. Use the {0} extension instead.",l))},!0)}else if(this.extension.deprecationInfo.settings){const l=`[${a("settings","settings")}](${M.parse(`command:workbench.action.openSettings?${encodeURIComponent(JSON.stringify([this.extension.deprecationInfo.settings.map(c=>`@id:${c}`).join(" ")]))}`)})`;this.updateStatus({icon:fe,message:new N(a("deprecated with alternate settings tooltip","This extension is deprecated as this functionality is now built-in to VS Code. Configure these {0} to use this functionality.",l))},!0)}else{const l=new N(a("deprecated tooltip","This extension is deprecated as it is no longer being maintained."));this.extension.deprecationInfo.additionalInfo&&l.appendMarkdown(` ${this.extension.deprecationInfo.additionalInfo}`),this.updateStatus({icon:fe,message:l},!0)}return}if(this.extensionsWorkbenchService.canSetLanguage(this.extension))return;if(this.extension.gallery&&this.extension.state===3&&!await this.extensionsWorkbenchService.canInstall(this.extension)){if(this.extensionManagementServerService.localExtensionManagementServer||this.extensionManagementServerService.remoteExtensionManagementServer){const l=await(this.extensionManagementServerService.localExtensionManagementServer?this.extensionManagementServerService.localExtensionManagementServer.extensionManagementService.getTargetPlatform():this.extensionManagementServerService.remoteExtensionManagementServer.extensionManagementService.getTargetPlatform()),c=new N(`${a("incompatible platform","The '{0}' extension is not available in {1} for {2}.",this.extension.displayName||this.extension.identifier.id,this.productService.nameLong,Al(l))} [${a("learn more","Learn More")}](https://aka.ms/vscode-platform-specific-extensions)`);this.updateStatus({icon:fe,message:c},!0);return}if(this.extensionManagementServerService.webExtensionManagementServer){const l=a("VS Code for Web","{0} for the Web",this.productService.nameLong),c=new N(`${a("not web tooltip","The '{0}' extension is not available in {1}.",this.extension.displayName||this.extension.identifier.id,l)} [${a("learn why","Learn Why")}](https://aka.ms/vscode-web-extensions-guide)`);this.updateStatus({icon:fe,message:c},!0);return}}if(!this.extension.local||!this.extension.server||this.extension.state!==1)return;if(this.extension.enablementState===2){this.updateStatus({message:new N(a("disabled by environment","This extension is disabled by the environment."))},!0);return}if(this.extension.enablementState===3){this.updateStatus({message:new N(a("enabled by environment","This extension is enabled because it is required in the current environment."))},!0);return}if(this.extension.enablementState===4){const l=Hi((i=this.extension.local.manifest.capabilities)==null?void 0:i.virtualWorkspaces);this.updateStatus({icon:Fe,message:new N(l?Gi(l):a("disabled because of virtual workspace","This extension has been disabled because it does not support virtual workspaces."))},!0);return}if(Ll(this.contextService.getWorkspace())){const l=this.extensionManifestPropertiesService.getExtensionVirtualWorkspaceSupportType(this.extension.local.manifest),c=Hi((n=this.extension.local.manifest.capabilities)==null?void 0:n.virtualWorkspaces);if(l==="limited"||c){this.updateStatus({icon:fe,message:new N(c?Gi(c):a("extension limited because of virtual workspace","This extension has limited features because the current workspace is virtual."))},!0);return}}if(this.extension.enablementState===0||this.extension.enablementState===5&&this.workbenchExtensionEnablementService.getDependenciesEnablementStates(this.extension.local).every(([,l])=>this.workbenchExtensionEnablementService.isEnabledEnablementState(l)||l===0)){this.enabled=!0;const l=Hi((s=this.extension.local.manifest.capabilities)==null?void 0:s.untrustedWorkspaces);this.updateStatus({icon:di,message:new N(l?Gi(l):a("extension disabled because of trust requirement","This extension has been disabled because the current workspace is not trusted."))},!0);return}if(this.workspaceTrustEnablementService.isWorkspaceTrustEnabled()&&!this.workspaceTrustService.isWorkspaceTrusted()){const l=this.extensionManifestPropertiesService.getExtensionUntrustedWorkspaceSupportType(this.extension.local.manifest),c=Hi((o=this.extension.local.manifest.capabilities)==null?void 0:o.untrustedWorkspaces);if(l==="limited"||c){this.enabled=!0,this.updateStatus({icon:di,message:new N(c?Gi(c):a("extension limited because of trust requirement","This extension has limited features because the current workspace is not trusted."))},!0);return}}if(this.extension.enablementState===1&&!this.extensionsWorkbenchService.installed.some(l=>Me(l.identifier,this.extension.identifier)&&l.server!==this.extension.server)){let l;this.extensionManagementServerService.localExtensionManagementServer===this.extension.server?this.extensionManifestPropertiesService.prefersExecuteOnWorkspace(this.extension.local.manifest)&&this.extensionManagementServerService.remoteExtensionManagementServer&&(l=new N(`${a("Install in remote server to enable","This extension is disabled in this workspace because it is defined to run in the Remote Extension Host. Please install the extension in '{0}' to enable.",this.extensionManagementServerService.remoteExtensionManagementServer.label)} [${a("learn more","Learn More")}](https://aka.ms/vscode-remote/developing-extensions/architecture)`)):this.extensionManagementServerService.remoteExtensionManagementServer===this.extension.server?this.extensionManifestPropertiesService.prefersExecuteOnUI(this.extension.local.manifest)&&(this.extensionManagementServerService.localExtensionManagementServer?l=new N(`${a("Install in local server to enable","This extension is disabled in this workspace because it is defined to run in the Local Extension Host. Please install the extension locally to enable.",this.extensionManagementServerService.remoteExtensionManagementServer.label)} [${a("learn more","Learn More")}](https://aka.ms/vscode-remote/developing-extensions/architecture)`):Qt&&(l=new N(`${a("Defined to run in desktop","This extension is disabled because it is defined to run only in {0} for the Desktop.",this.productService.nameLong)} [${a("learn more","Learn More")}](https://aka.ms/vscode-remote/developing-extensions/architecture)`))):this.extensionManagementServerService.webExtensionManagementServer===this.extension.server&&(l=new N(`${a("Cannot be enabled","This extension is disabled because it is not supported in {0} for the Web.",this.productService.nameLong)} [${a("learn more","Learn More")}](https://aka.ms/vscode-remote/developing-extensions/architecture)`)),l&&this.updateStatus({icon:fe,message:l},!0);return}if(this.extensionManagementServerService.remoteExtensionManagementServer){if(qo(this.extension.local.manifest)){if(!this.extensionsWorkbenchService.installed.some(h=>Me(h.identifier,this.extension.identifier)&&h.server!==this.extension.server)){const h=this.extension.server===this.extensionManagementServerService.localExtensionManagementServer?new N(a("Install language pack also in remote server","Install the language pack extension on '{0}' to enable it there also.",this.extensionManagementServerService.remoteExtensionManagementServer.label)):new N(a("Install language pack also locally","Install the language pack extension locally to enable it there also."));this.updateStatus({icon:Fe,message:h},!0)}return}const l=this.extensionService.extensions.filter(h=>Me({id:h.identifier.value,uuid:h.uuid},this.extension.identifier))[0],c=l?this.extensionManagementServerService.getExtensionManagementServer(Xo(l)):null;if(this.extension.server===this.extensionManagementServerService.localExtensionManagementServer&&c===this.extensionManagementServerService.remoteExtensionManagementServer){this.extensionManifestPropertiesService.prefersExecuteOnWorkspace(this.extension.local.manifest)&&this.updateStatus({icon:Fe,message:new N(`${a("enabled remotely","This extension is enabled in the Remote Extension Host because it prefers to run there.")} [${a("learn more","Learn More")}](https://aka.ms/vscode-remote/developing-extensions/architecture)`)},!0);return}if(this.extension.server===this.extensionManagementServerService.remoteExtensionManagementServer&&c===this.extensionManagementServerService.localExtensionManagementServer){this.extensionManifestPropertiesService.prefersExecuteOnUI(this.extension.local.manifest)&&this.updateStatus({icon:Fe,message:new N(`${a("enabled locally","This extension is enabled in the Local Extension Host because it prefers to run there.")} [${a("learn more","Learn More")}](https://aka.ms/vscode-remote/developing-extensions/architecture)`)},!0);return}if(this.extension.server===this.extensionManagementServerService.remoteExtensionManagementServer&&c===this.extensionManagementServerService.webExtensionManagementServer){this.extensionManifestPropertiesService.canExecuteOnWeb(this.extension.local.manifest)&&this.updateStatus({icon:Fe,message:new N(`${a("enabled in web worker","This extension is enabled in the Web Worker Extension Host because it prefers to run there.")} [${a("learn more","Learn More")}](https://aka.ms/vscode-remote/developing-extensions/architecture)`)},!0);return}}if(this.extension.enablementState===5){this.updateStatus({icon:fe,message:new N(a("extension disabled because of dependency","This extension has been disabled because it depends on an extension that is disabled."))},!0);return}const e=this.workbenchExtensionEnablementService.isEnabled(this.extension.local),t=this.extensionService.extensions.some(l=>Me({id:l.identifier.value,uuid:l.uuid},this.extension.identifier));if(e&&t){if(this.extensionManagementServerService.localExtensionManagementServer&&this.extensionManagementServerService.remoteExtensionManagementServer&&this.extension.server===this.extensionManagementServerService.remoteExtensionManagementServer){this.updateStatus({message:new N(a("extension enabled on remote","Extension is enabled on '{0}'",this.extension.server.label))},!0);return}if(this.extension.enablementState===8){this.updateStatus({message:new N(a("globally enabled","This extension is enabled globally."))},!0);return}if(this.extension.enablementState===9){this.updateStatus({message:new N(a("workspace enabled","This extension is enabled for this workspace by the user."))},!0);return}}if(!e&&!t){if(this.extension.enablementState===6){this.updateStatus({message:new N(a("globally disabled","This extension is disabled globally by the user."))},!0);return}if(this.extension.enablementState===7){this.updateStatus({message:new N(a("workspace disabled","This extension is disabled for this workspace by the user."))},!0);return}}if(e&&!t&&!this.extension.local.isValid){const l=this.extension.local.validations.filter(([c])=>c===ie.Error).map(([,c])=>c);this.updateStatus({icon:Ut,message:new N(l.join(" ").trim())},!0)}}updateStatus(e,t){var i,n,s,o,l,c;this._status!==e&&(this._status&&e&&this._status.message===e.message&&((i=this._status.icon)==null?void 0:i.id)===((n=e.icon)==null?void 0:n.id)||(this._status=e,t&&(((s=this._status)==null?void 0:s.icon)===Ut?this.class=`${bt.CLASS} extension-status-error ${L.asClassName(Ut)}`:((o=this._status)==null?void 0:o.icon)===fe?this.class=`${bt.CLASS} extension-status-warning ${L.asClassName(fe)}`:((l=this._status)==null?void 0:l.icon)===Fe?this.class=`${bt.CLASS} extension-status-info ${L.asClassName(Fe)}`:((c=this._status)==null?void 0:c.icon)===di?this.class=`${bt.CLASS} ${L.asClassName(di)}`:this.class=`${bt.CLASS} hide`),this._onDidChangeStatus.fire()))}async run(){var e;if(((e=this._status)==null?void 0:e.icon)===di)return this.commandService.executeCommand("workbench.trust.manage")}};zs.CLASS=`${T.ICON_ACTION_CLASS} extension-status`;zs=b([d(0,li),d(1,Mt),d(2,ue),d(3,pl),d(4,fl),d(5,Q),d(6,se),d(7,Gr),d(8,ge),d(9,ai),d(10,Be)],zs);let En=class Ks extends U{constructor(e=Ks.ID,t=Ks.LABEL,i,n,s,o,l,c,h){super(e,t),this.extensionsWorkbenchService=i,this.extensionManagementServerService=n,this.quickInputService=s,this.notificationService=o,this.hostService=l,this.instantiationService=c,this.extensionService=h}get enabled(){return this.extensionsWorkbenchService.local.filter(e=>!e.isBuiltin&&e.local).length>0}run(){return this.quickInputService.pick(this.getEntries(),{placeHolder:a("selectExtensionToReinstall","Select Extension to Reinstall")}).then(e=>e&&this.reinstallExtension(e.extension))}getEntries(){return this.extensionsWorkbenchService.queryLocal().then(e=>e.filter(i=>!i.isBuiltin&&i.server!==this.extensionManagementServerService.webExtensionManagementServer).map(i=>({id:i.identifier.id,label:i.displayName,description:i.identifier.id,extension:i})))}reinstallExtension(e){return this.instantiationService.createInstance(kn,"@installed ").run().then(()=>this.extensionsWorkbenchService.reinstall(e).then(t=>{const i=!(t.local&&this.extensionService.canAddExtension(hn(t.local))),n=i?a("ReinstallAction.successReload","Please reload Visual Studio Code to complete reinstalling the extension {0}.",t.identifier.id):a("ReinstallAction.success","Reinstalling the extension {0} is completed.",t.identifier.id),s=i?[{label:a("InstallVSIXAction.reloadNow","Reload Now"),run:()=>this.hostService.reload()}]:[];this.notificationService.prompt(ie.Info,n,s,{sticky:!0})},t=>this.notificationService.error(t)))}};En.ID="workbench.extensions.action.reinstall";En.LABEL=a("reinstall","Reinstall Extension...");En=b([d(2,Q),d(3,li),d(4,me),d(5,ee),d(6,zo),d(7,O),d(8,se)],En);let An=class qs extends U{constructor(e=qs.ID,t=qs.LABEL,i,n,s,o){super(e,t),this.extensionsWorkbenchService=i,this.quickInputService=n,this.instantiationService=s,this.extensionEnablementService=o}get enabled(){return this.extensionsWorkbenchService.local.some(e=>this.isEnabled(e))}async run(){const e=await this.quickInputService.pick(this.getExtensionEntries(),{placeHolder:a("selectExtension","Select Extension"),matchOnDetail:!0});if(e&&e.extension){const t=this.instantiationService.createInstance(Dt);t.extension=e.extension,await t.run(),await this.instantiationService.createInstance(kn,e.extension.identifier.id).run()}}isEnabled(e){const t=this.instantiationService.createInstance(Dt);return t.extension=e,t.enabled&&!!e.local&&this.extensionEnablementService.isEnabled(e.local)}async getExtensionEntries(){const e=await this.extensionsWorkbenchService.queryLocal(),t=[];for(const i of e)this.isEnabled(i)&&t.push({id:i.identifier.id,label:i.displayName||i.identifier.id,description:i.identifier.id,extension:i});return t.sort((i,n)=>i.extension.displayName.localeCompare(n.extension.displayName))}};An.ID="workbench.extensions.action.install.specificVersion";An.LABEL=a("install previous version","Install Specific Version of Extension...");An=b([d(2,Q),d(3,me),d(4,O),d(5,Be)],An);$n.registerCommand("workbench.extensions.action.showExtensionsForLanguage",function(r,e){return r.get(Fi).openPaneComposite(Oi,0,!0).then(i=>i==null?void 0:i.getViewPaneContainer()).then(i=>{i.search(`ext:${e.replace(/^\./,"")}`),i.focus()})});$n.registerCommand("workbench.extensions.action.showExtensionsWithIds",function(r,e){return r.get(Fi).openPaneComposite(Oi,0,!0).then(i=>i==null?void 0:i.getViewPaneContainer()).then(i=>{const n=e.map(s=>`@id:${s}`).join(" ");i.search(n),i.focus()})});Ft("extensionButton.background",{dark:an,light:an,hcDark:null,hcLight:null},a("extensionButtonBackground","Button background color for extension actions."));Ft("extensionButton.foreground",{dark:ln,light:ln,hcDark:null,hcLight:null},a("extensionButtonForeground","Button foreground color for extension actions."));Ft("extensionButton.hoverBackground",{dark:cn,light:cn,hcDark:null,hcLight:null},a("extensionButtonHoverBackground","Button background hover color for extension actions."));Ft("extensionButton.separator",{dark:Vi,light:Vi,hcDark:Vi,hcLight:Vi},a("extensionButtonSeparator","Button separator color for extension actions"));Ft("extensionButton.prominentBackground",{dark:an,light:an,hcDark:null,hcLight:null},a("extensionButtonProminentBackground","Button background color for extension actions that stand out (e.g. install button)."));Ft("extensionButton.prominentForeground",{dark:ln,light:ln,hcDark:null,hcLight:null},a("extensionButtonProminentForeground","Button foreground color for extension actions that stand out (e.g. install button)."));Ft("extensionButton.prominentHoverBackground",{dark:cn,light:cn,hcDark:null,hcLight:null},a("extensionButtonProminentHoverBackground","Button background hover color for extension actions that stand out (e.g. install button)."));_l((r,e)=>{const t=r.getColor(wl);t&&(e.addRule(`.extension-editor .header .actions-status-container > .status ${L.asCSSSelector(Ut)} { color: ${t}; }`),e.addRule(`.extension-editor .body .subcontent .runtime-status ${L.asCSSSelector(Ut)} { color: ${t}; }`),e.addRule(`.monaco-hover.extension-hover .markdown-hover .hover-contents ${L.asCSSSelector(Ut)} { color: ${t}; }`));const i=r.getColor(vl);i&&(e.addRule(`.extension-editor .header .actions-status-container > .status ${L.asCSSSelector(fe)} { color: ${i}; }`),e.addRule(`.extension-editor .body .subcontent .runtime-status ${L.asCSSSelector(fe)} { color: ${i}; }`),e.addRule(`.monaco-hover.extension-hover .markdown-hover .hover-contents ${L.asCSSSelector(fe)} { color: ${i}; }`));const n=r.getColor(bl);n&&(e.addRule(`.extension-editor .header .actions-status-container > .status ${L.asCSSSelector(Fe)} { color: ${n}; }`),e.addRule(`.extension-editor .body .subcontent .runtime-status ${L.asCSSSelector(Fe)} { color: ${n}; }`),e.addRule(`.monaco-hover.extension-hover .markdown-hover .hover-contents ${L.asCSSSelector(Fe)} { color: ${n}; }`))});let Ln=class{get onConfigChanged(){return this._onConfigChanged.event}constructor(e,t,i,n,s){this._configurationService=e,this._extensionManagementService=t,this._notificationService=i,this._instantiationService=n,this._productService=s,this._linuxDistro=1,this._onConfigChanged=new v,this._recommendationsShown=!1,this._updateConfig(),this._configurationService.onDidChangeConfiguration(o=>{o.affectsConfiguration(so)&&this._updateConfig()}),Nn&&(navigator.userAgent.includes("Ubuntu")?this._linuxDistro=3:navigator.userAgent.includes("Fedora")&&(this._linuxDistro=2))}_updateConfig(){const e=this._configurationService.getValue(so);e.fontWeight=this._normalizeFontWeight(e.fontWeight,Rl),e.fontWeightBold=this._normalizeFontWeight(e.fontWeightBold,Wl),this.config=e,this._onConfigChanged.fire()}configFontIsMonospace(){const t=this.config.fontFamily||this._configurationService.getValue("editor").fontFamily||$i.fontFamily,i=this._getBoundingRectFor("i",t,15),n=this._getBoundingRectFor("w",t,15);return!i||!n||!i.width||!n.width?!0:i.width===n.width}_createCharMeasureElementIfNecessary(){if(!this.panelContainer)throw new Error("Cannot measure element when terminal is not attached");return(!this._charMeasureElement||!this._charMeasureElement.parentElement)&&(this._charMeasureElement=document.createElement("div"),this.panelContainer.appendChild(this._charMeasureElement)),this._charMeasureElement}_getBoundingRectFor(e,t,i){let n;try{n=this._createCharMeasureElementIfNecessary()}catch{return}const s=n.style;s.display="inline-block",s.fontFamily=t,s.fontSize=i+"px",s.lineHeight="normal",n.innerText=e;const o=n.getBoundingClientRect();return s.display="none",o}_measureFont(e,t,i,n){const s=this._getBoundingRectFor("X",e,t);if(this._lastFontMeasurement&&(!s||!s.width||!s.height))return this._lastFontMeasurement;if(this._lastFontMeasurement={fontFamily:e,fontSize:t,letterSpacing:i,lineHeight:n,charWidth:0,charHeight:0},s&&s.width&&s.height)if(this._lastFontMeasurement.charHeight=Math.ceil(s.height),this.config.gpuAcceleration==="off")this._lastFontMeasurement.charWidth=s.width;else{const c=(Math.floor(s.width*window.devicePixelRatio)+Math.round(i))/window.devicePixelRatio;this._lastFontMeasurement.charWidth=c-Math.round(i)/window.devicePixelRatio}return this._lastFontMeasurement}getFont(e,t){var c,h;const i=this._configurationService.getValue("editor");let n=this.config.fontFamily||i.fontFamily||$i.fontFamily,s=this._clampInt(this.config.fontSize,6,100,$i.fontSize);this.config.fontFamily||(this._linuxDistro===2&&(n="'DejaVu Sans Mono'"),this._linuxDistro===3&&(n="'Ubuntu Mono'",s=this._clampInt(s+2,6,100,$i.fontSize))),n+=", monospace";const o=this.config.letterSpacing?Math.max(Math.floor(this.config.letterSpacing),Fl):Qo,l=this.config.lineHeight?Math.max(this.config.lineHeight,1):Jo;return t?{fontFamily:n,fontSize:s,letterSpacing:o,lineHeight:l}:e&&e._renderService&&(c=e._renderService.dimensions)!=null&&c.css.cell.width&&(h=e._renderService.dimensions)!=null&&h.css.cell.height?{fontFamily:n,fontSize:s,letterSpacing:o,lineHeight:l,charHeight:e._renderService.dimensions.css.cell.height/l,charWidth:e._renderService.dimensions.css.cell.width-Math.round(o)/window.devicePixelRatio}:this._measureFont(n,s,o,l)}_clampInt(e,t,i,n){let s=parseInt(e,10);return isNaN(s)?n:(typeof t=="number"&&(s=Math.max(t,s)),typeof i=="number"&&(s=Math.min(i,s)),s)}async showRecommendations(e){if(!this._recommendationsShown&&(this._recommendationsShown=!0,re&&e.executable&&Jt(e.executable).toLowerCase()==="wsl.exe")){const t=this._productService.exeBasedExtensionTips;if(!t||!t.wsl)return;const i=Object.keys(t.wsl.recommendations).find(n=>t.wsl.recommendations[n].important);i&&!await this._isExtensionInstalled(i)&&this._notificationService.prompt(Re.Info,a("useWslExtension.title","The '{0}' extension is recommended for opening a terminal in WSL.",t.wsl.friendlyName),[{label:a("install","Install"),run:()=>{this._instantiationService.createInstance(Di,i).run()}}],{sticky:!0,neverShowAgain:{id:"terminalConfigHelper/launchRecommendationsIgnore",scope:Zo.APPLICATION},onCancel:()=>{}})}}async _isExtensionInstalled(e){return(await this._extensionManagementService.getInstalled()).some(i=>i.identifier.id===e)}_normalizeFontWeight(e,t){return e==="normal"||e==="bold"?e:this._clampInt(e,bs,Ss,t)}};Ln=b([d(0,Z),d(1,Ml),d(2,ee),d(3,O),d(4,ai)],Ln);let Us=class{constructor(e,t,i,n,s,o){this._terminalProfileService=e,this._terminalProfileResolverService=t,this._configurationService=i,this._quickInputService=n,this._themeService=s,this._notificationService=o}async showAndGetResult(e){const t=await this._terminalProfileService.getPlatformKey(),i="terminal.integrated.profiles."+t,n=await this._createAndShow(e),s=`terminal.integrated.defaultProfile.${t}`;if(n){if(e==="setDefault"){if("command"in n.profile)return;if("id"in n.profile)return await this._configurationService.updateValue(s,n.profile.title,2),{config:{extensionIdentifier:n.profile.extensionIdentifier,id:n.profile.id,title:n.profile.title,options:{color:n.profile.color,icon:n.profile.icon}},keyMods:n.keyMods};if("isAutoDetected"in n.profile){const o=await this._configurationService.getValue(i);if(typeof o=="object"){const l={path:n.profile.path};n.profile.args&&(l.args=n.profile.args),o[n.profile.profileName]=l}await this._configurationService.updateValue(i,o,2)}await this._configurationService.updateValue(s,n.profileName,2)}else if(e==="createInstance")return"id"in n.profile?{config:{extensionIdentifier:n.profile.extensionIdentifier,id:n.profile.id,title:n.profile.title,options:{icon:n.profile.icon,color:n.profile.color}},keyMods:n.keyMods}:{config:n.profile,keyMods:n.keyMods};return"profileName"in n.profile?n.profile.profileName:n.profile.title}}async _createAndShow(e){const t=await this._terminalProfileService.getPlatformKey(),i=this._terminalProfileService.availableProfiles,n="terminal.integrated.profiles."+t,s=this._terminalProfileService.getDefaultProfileName();let o;const l={placeHolder:e==="createInstance"?a("terminal.integrated.selectProfileToCreate","Select the terminal profile to create"):a("terminal.integrated.chooseDefaultProfile","Select your default terminal profile"),onDidTriggerItemButton:async _=>{if(!await this._isProfileSafe(_.item.profile)||"command"in _.item.profile||"id"in _.item.profile)return;const S=this._configurationService.getValue("terminal.integrated.profiles."+t),y=S?Object.keys(S):[],R=await this._quickInputService.input({prompt:a("enterTerminalProfileName","Enter terminal profile name"),value:_.item.profile.profileName,validateInput:async D=>{if(y.includes(D))return a("terminalProfileAlreadyExists","A terminal profile already exists with that name")}});if(!R)return;const C={...S};C[R]={path:_.item.profile.path,args:_.item.profile.args},await this._configurationService.updateValue(n,C,2)},onKeyMods:_=>o=_},c=[],h=i.filter(_=>!_.isAutoDetected),m=i.filter(_=>_.isAutoDetected);h.length>0&&(c.push({type:"separator",label:a("terminalProfiles","profiles")}),c.push(...this._sortProfileQuickPickItems(h.map(_=>this._createProfileQuickPickItem(_)),s))),c.push({type:"separator",label:a("ICreateContributedTerminalProfileOptions","contributed")});const p=[];for(const _ of this._terminalProfileService.contributedProfiles){let S;typeof _.icon=="string"&&(_.icon.startsWith("$(")?S=L.fromString(_.icon):S=L.fromId(_.icon)),(!S||!Un().getIcon(S.id))&&(S=this._terminalProfileResolverService.getDefaultIcon());const y=Lt(_,this._themeService.getColorTheme().type,!0),R=ct(_),C=[];y&&C.push(...y),R&&C.push(R),p.push({label:`$(${S.id}) ${_.title}`,profile:{extensionIdentifier:_.extensionIdentifier,title:_.title,icon:_.icon,id:_.id,color:_.color},profileName:_.title,iconClasses:C})}p.length>0&&c.push(...this._sortProfileQuickPickItems(p,s)),m.length>0&&(c.push({type:"separator",label:a("terminalProfiles.detected","detected")}),c.push(...this._sortProfileQuickPickItems(m.map(_=>this._createProfileQuickPickItem(_)),s)));const w=ea(this._themeService.getColorTheme());document.body.appendChild(w);const f=await this._quickInputService.pick(c,l);if(document.body.removeChild(w),!!f&&await this._isProfileSafe(f.profile))return o&&(f.keyMods=o),f}async _isProfileSafe(e){const t="isUnsafePath"in e&&e.isUnsafePath,i="requiresUnsafePath"in e&&e.requiresUnsafePath;return!t&&!i?!0:await new Promise(n=>{const s=[];t&&s.push(e.path),i&&s.push(i),this._notificationService.prompt(ie.Warning,a("unsafePathWarning","This terminal profile uses a potentially unsafe path that can be modified by another user: {0}. Are you sure you want to use it?",`"${s.join(",")}"`),[{label:a("yes","Yes"),run:()=>n(!0)},{label:a("cancel","Cancel"),run:()=>n(!1)}]).onDidClose(()=>n(!1))})}_createProfileQuickPickItem(e){const t=[{iconClass:L.asClassName(Bh),tooltip:a("createQuickLaunchProfile","Configure Terminal Profile")}],n=`$(${(e.icon&&L.isThemeIcon(e.icon)?e.icon:k.terminal).id}) ${e.profileName}`,s=e.isFromPath?Jt(e.path):e.path,o=ct(e),l=[];if(o&&l.push(o),e.args){if(typeof e.args=="string")return{label:n,description:`${e.path} ${e.args}`,profile:e,profileName:e.profileName,buttons:t,iconClasses:l};const c=e.args.map(h=>h.includes(" ")?`"${h.replace(/"/g,'\\"')}"`:h).join(" ");return{label:n,description:`${s} ${c}`,profile:e,profileName:e.profileName,buttons:t,iconClasses:l}}return{label:n,description:s,profile:e,profileName:e.profileName,buttons:t,iconClasses:l}}_sortProfileQuickPickItems(e,t){return e.sort((i,n)=>n.profileName===t?1:i.profileName===t?-1:i.profileName.localeCompare(n.profileName))}};Us=b([d(0,Qe),d(1,pt),d(2,Z),d(3,me),d(4,he),d(5,ee)],Us);function zr(r){const[,e,t]=r.path.split("/");if(!e||!Number.parseInt(t))throw new Error(`Could not parse terminal uri for resource ${r}`);return{workspaceId:e,instanceId:Number.parseInt(t)}}function Ba(r,e,t){return M.from({scheme:G.vscodeTerminal,path:`/${r}/${e}`,fragment:t||void 0})}function Va(r){var t;const e=(t=r.dataTransfer)==null?void 0:t.getData("Terminals");if(e){const i=JSON.parse(e),n=[];for(const s of i)n.push(M.parse(s));return n.length===0?void 0:n}}function Kr(r,e){if(e){for(const t of r)if(t.resource.path===e.path)return t}}let je=class{get isProcessSupportRegistered(){return!!this._processSupportContextKey.get()}get connectionState(){return this._connectionState}get configHelper(){return this._configHelper}get instances(){return this._terminalGroupService.instances.concat(this._terminalEditorService.instances)}getReconnectedTerminals(e){return this._reconnectedTerminals.get(e)}get defaultLocation(){return this.configHelper.config.defaultLocation==="editor"?E.Editor:E.Panel}get activeInstance(){for(const e of this._hostActiveTerminals.values())if(e!=null&&e.hasFocus)return e;return this._activeInstance}get onDidChangeActiveGroup(){return this._onDidChangeActiveGroup.event}get onDidCreateInstance(){return this._onDidCreateInstance.event}get onDidDisposeInstance(){return this._onDidDisposeInstance.event}get onDidFocusInstance(){return this._onDidFocusInstance.event}get onDidReceiveProcessId(){return this._onDidReceiveProcessId.event}get onDidRequestStartExtensionTerminal(){return this._onDidRequestStartExtensionTerminal.event}get onDidChangeInstanceDimensions(){return this._onDidChangeInstanceDimensions.event}get onDidMaximumDimensionsChange(){return this._onDidMaxiumumDimensionsChange.event}get onDidChangeInstanceCapability(){return this._onDidChangeInstanceCapability.event}get onDidChangeInstances(){return this._onDidChangeInstances.event}get onDidChangeInstanceTitle(){return this._onDidChangeInstanceTitle.event}get onDidChangeInstanceIcon(){return this._onDidChangeInstanceIcon.event}get onDidChangeInstanceColor(){return this._onDidChangeInstanceColor.event}get onDidChangeActiveInstance(){return this._onDidChangeActiveInstance.event}get onDidChangeInstancePrimaryStatus(){return this._onDidChangeInstancePrimaryStatus.event}get onDidInputInstanceData(){return this._onDidInputInstanceData.event}get onDidDisposeGroup(){return this._onDidDisposeGroup.event}get onDidChangeGroups(){return this._onDidChangeGroups.event}get onDidRegisterProcessSupport(){return this._onDidRegisterProcessSupport.event}get onDidChangeConnectionState(){return this._onDidChangeConnectionState.event}constructor(e,t,i,n,s,o,l,c,h,m,p,w,f,_,S,y,R,C){this._contextKeyService=e,this._lifecycleService=t,this._logService=i,this._dialogService=n,this._instantiationService=s,this._remoteAgentService=o,this._viewsService=l,this._configurationService=c,this._environmentService=h,this._terminalEditorService=m,this._terminalGroupService=p,this._terminalInstanceService=w,this._editorGroupsService=f,this._terminalProfileService=_,this._extensionService=S,this._notificationService=y,this._workspaceContextService=R,this._commandService=C,this._hostActiveTerminals=new Map,this._escapeSequenceLoggingEnabled=!1,this._isShuttingDown=!1,this._backgroundedTerminalInstances=[],this._backgroundedTerminalDisposables=new Map,this._connectionState=0,this._reconnectedTerminals=new Map,this._onDidChangeActiveGroup=new v,this._onDidCreateInstance=new v,this._onDidDisposeInstance=new v,this._onDidFocusInstance=new v,this._onDidReceiveProcessId=new v,this._onDidRequestStartExtensionTerminal=new v,this._onDidChangeInstanceDimensions=new v,this._onDidMaxiumumDimensionsChange=new v,this._onDidChangeInstanceCapability=new v,this._onDidChangeInstances=new v,this._onDidChangeInstanceTitle=new v,this._onDidChangeInstanceIcon=new v,this._onDidChangeInstanceColor=new v,this._onDidChangeActiveInstance=new v,this._onDidChangeInstancePrimaryStatus=new v,this._onDidInputInstanceData=new v,this._onDidDisposeGroup=new v,this._onDidChangeGroups=new v,this._onDidRegisterProcessSupport=new v,this._onDidChangeConnectionState=new v,this._configHelper=this._instantiationService.createInstance(Ln),this.onDidCreateInstance(()=>this._terminalProfileService.refreshAvailableProfiles()),this._forwardInstanceHostEvents(this._terminalGroupService),this._forwardInstanceHostEvents(this._terminalEditorService),this._terminalGroupService.onDidChangeActiveGroup(this._onDidChangeActiveGroup.fire,this._onDidChangeActiveGroup),this._terminalInstanceService.onDidCreateInstance(D=>{D.setEscapeSequenceLogging(this._escapeSequenceLoggingEnabled),this._initInstanceListeners(D),this._onDidCreateInstance.fire(D)}),this._terminalGroupService.onDidChangeActiveInstance(D=>{!D&&!this._isShuttingDown&&this._terminalGroupService.hidePanel(),D!=null&&D.shellType?this._terminalShellTypeContextKey.set(D.shellType.toString()):D||this._terminalShellTypeContextKey.reset()}),this._handleInstanceContextKeys(),this._terminalShellTypeContextKey=u.shellType.bindTo(this._contextKeyService),this._processSupportContextKey=u.processSupported.bindTo(this._contextKeyService),this._processSupportContextKey.set(!Qt||this._remoteAgentService.getConnection()!==null),this._terminalHasBeenCreated=u.terminalHasBeenCreated.bindTo(this._contextKeyService),this._terminalCountContextKey=u.count.bindTo(this._contextKeyService),this._terminalEditorActive=u.terminalEditorActive.bindTo(this._contextKeyService),this.onDidChangeActiveInstance(D=>{this._terminalEditorActive.set(!!(D!=null&&D.target)&&D.target===E.Editor)}),t.onBeforeShutdown(async D=>D.veto(this._onBeforeShutdown(D.reason),"veto.terminal")),t.onWillShutdown(D=>this._onWillShutdown(D)),this.initializePrimaryBackend(),kt(0).then(()=>this._instantiationService.createInstance(js,document.head))}async showProfileQuickPick(e,t){var o,l;const n=await this._instantiationService.createInstance(Us).showAndGetResult(e);if(!n||typeof n=="string")return;const s=n.keyMods;if(e==="createInstance"){const c=this.getDefaultInstanceHost().activeInstance;let h;if(n.config&&"id"in(n==null?void 0:n.config)){await this.createContributedTerminalProfile(n.config.extensionIdentifier,n.config.id,{icon:(o=n.config.options)==null?void 0:o.icon,color:(l=n.config.options)==null?void 0:l.color,location:s!=null&&s.alt&&c?{splitActiveTerminal:!0}:this.defaultLocation});return}else n.config&&"profileName"in n.config&&(s!=null&&s.alt&&c?h=await this.createTerminal({location:{parentTerminal:c},config:n.config,cwd:t}):h=await this.createTerminal({location:this.defaultLocation,config:n.config,cwd:t}));if(h&&this.defaultLocation!==E.Editor)return this._terminalGroupService.showPanel(!0),this.setActiveInstance(h),h}}async initializePrimaryBackend(){var i;this._primaryBackend=await this._terminalInstanceService.getBackend(this._environmentService.remoteAuthority);const e=this.configHelper.config.enablePersistentSessions;this._connectionState=0,!!this._environmentService.remoteAuthority&&e?this._reconnectToRemoteTerminals().then(()=>this._setConnected()):e?this._reconnectToLocalTerminals().then(()=>this._setConnected()):Promise.resolve().then(()=>this._setConnected()),(i=this._primaryBackend)==null||i.onDidRequestDetach(async n=>{var o,l,c;const s=this.getInstanceFromResource(Ba(n.workspaceId,n.instanceId));if(s){const h=s==null?void 0:s.persistentProcessId;h&&!s.shellLaunchConfig.isFeatureTerminal&&!s.shellLaunchConfig.customPtyImplementation?(s.target===E.Editor?this._terminalEditorService.detachInstance(s):(o=this._terminalGroupService.getGroupForInstance(s))==null||o.removeInstance(s),await s.detachProcessAndDispose(Ke.User),await((l=this._primaryBackend)==null?void 0:l.acceptDetachInstanceReply(n.requestId,h))):await((c=this._primaryBackend)==null?void 0:c.acceptDetachInstanceReply(n.requestId,void 0))}})}getPrimaryBackend(){return this._primaryBackend}_forwardInstanceHostEvents(e){e.onDidChangeInstances(this._onDidChangeInstances.fire,this._onDidChangeInstances),e.onDidDisposeInstance(this._onDidDisposeInstance.fire,this._onDidDisposeInstance),e.onDidChangeActiveInstance(t=>this._evaluateActiveInstance(e,t)),e.onDidFocusInstance(t=>{this._onDidFocusInstance.fire(t),this._evaluateActiveInstance(e,t)}),e.onDidChangeInstanceCapability(t=>{this._onDidChangeInstanceCapability.fire(t)}),this._hostActiveTerminals.set(e,void 0)}_evaluateActiveInstance(e,t){if(this._hostActiveTerminals.set(e,t),t===void 0)for(const i of this._hostActiveTerminals.values())i&&(t=i);this._activeInstance=t,this._onDidChangeActiveInstance.fire(t)}setActiveInstance(e){e.shellLaunchConfig.hideFromUser&&this._showBackgroundTerminal(e),e.target===E.Editor?this._terminalEditorService.setActiveInstance(e):this._terminalGroupService.setActiveInstance(e)}async focusActiveInstance(){if(this._activeInstance)return this._activeInstance.target===E.Editor?this._terminalEditorService.focusActiveInstance():this._terminalGroupService.focusActiveInstance()}async createContributedTerminalProfile(e,t,i){var s;await this._extensionService.activateByEvent(`onTerminalProfile:${t}`);const n=this._terminalProfileService.getContributedProfileProvider(e,t);if(!n){this._notificationService.error(`No terminal profile provider registered for id "${t}"`);return}try{await n.createContributedTerminalProfile(i),this._terminalGroupService.setActiveInstanceByIndex(this._terminalGroupService.instances.length-1),await((s=this._terminalGroupService.activeInstance)==null?void 0:s.focusWhenReady())}catch(o){this._notificationService.error(o.message)}}async safeDisposeTerminal(e){if(!(e.target!==E.Editor&&e.hasChildProcesses&&(this.configHelper.config.confirmOnKill==="panel"||this.configHelper.config.confirmOnKill==="always")&&await this._showTerminalCloseConfirmation(!0)))return new Promise(t=>{e.onExit(()=>t()),e.dispose(Ke.User)})}_setConnected(){this._connectionState=1,this._onDidChangeConnectionState.fire(),this._logService.trace("Reconnected to terminals")}async _reconnectToRemoteTerminals(){const e=this._environmentService.remoteAuthority;if(!e)return;const t=await this._terminalInstanceService.getBackend(e);if(!t)return;const i=await t.getTerminalLayoutInfo();t.reduceConnectionGraceTime(),await this._recreateTerminalGroups(i),this._attachProcessLayoutListeners()}async _reconnectToLocalTerminals(){const e=await this._terminalInstanceService.getBackend();if(!e)return;const t=await e.getTerminalLayoutInfo();t&&t.tabs.length>0&&await this._recreateTerminalGroups(t),this._attachProcessLayoutListeners()}async _recreateTerminalGroups(e){var n;let t=0,i;if(e){for(const s of e.tabs){const o=s.terminals.filter(l=>l.terminal&&l.terminal.isOrphan);if(o.length){t+=o.length;let l,c;for(const m of o)this._lifecycleService.startupKind!==3&&((n=m.terminal)==null?void 0:n.type)==="Task"||(l?l=await this.createTerminal({config:{attachPersistentProcess:m.terminal},location:{parentTerminal:l}}):(l=await this.createTerminal({config:{attachPersistentProcess:m.terminal},location:E.Panel}),c=this._terminalGroupService.getGroupForInstance(l),s.isActive&&(i=c)));const h=this.instances.find(m=>{var p;return((p=m.shellLaunchConfig.attachPersistentProcess)==null?void 0:p.id)===s.activePersistentProcessId});h&&this.setActiveInstance(h),c==null||c.resizePanes(s.terminals.map(m=>m.relativeSize))}}e.tabs.length&&(this._terminalGroupService.activeGroup=i)}return t}async toggleEscapeSequenceLogging(){if(this.instances.length!==0){this._escapeSequenceLoggingEnabled=await this.instances[0].toggleEscapeSequenceLogging();for(let e=1;e<this.instances.length;e++)this.instances[e].setEscapeSequenceLogging(this._escapeSequenceLoggingEnabled);await this._toggleDevTools(this._escapeSequenceLoggingEnabled)}}_attachProcessLayoutListeners(){this.onDidChangeActiveGroup(()=>this._saveState()),this.onDidChangeActiveInstance(()=>this._saveState()),this.onDidChangeInstances(()=>this._saveState()),this.onDidReceiveProcessId(()=>this._saveState()),this.onDidChangeInstanceTitle(e=>this._updateTitle(e)),this.onDidChangeInstanceIcon(e=>this._updateIcon(e.instance,e.userInitiated))}_handleInstanceContextKeys(){const e=u.isOpen.bindTo(this._contextKeyService),t=()=>{e.set(this.instances.length>0),this._terminalCountContextKey.set(this.instances.length)};this.onDidChangeInstances(()=>t())}async getActiveOrCreateInstance(e){var n;const t=this.activeInstance;if(!t)return this.createTerminal();if(!(e!=null&&e.acceptsInput)||((n=t.xterm)==null?void 0:n.isStdinDisabled)!==!0)return t;const i=await this.createTerminal();return this.setActiveInstance(i),await this.revealActiveTerminal(),i}async revealActiveTerminal(){const e=this.activeInstance;e&&(e.target===E.Editor?await this._terminalEditorService.revealActiveEditor():await this._terminalGroupService.showPanel())}setEditable(e,t){var s;t?this._editable={instance:e,data:t}:this._editable=void 0;const i=this._viewsService.getActiveViewWithId(z),n=this.isEditable(e);(s=i==null?void 0:i.terminalTabbedView)==null||s.setEditable(n)}isEditable(e){return!!this._editable&&(this._editable.instance===e||!e)}getEditableData(e){return this._editable&&this._editable.instance===e?this._editable.data:void 0}requestStartExtensionTerminal(e,t,i){return new Promise(n=>{this._onDidRequestStartExtensionTerminal.fire({proxy:e,cols:t,rows:i,callback:n})})}_onBeforeShutdown(e){return Qt?(this._isShuttingDown=!0,!1):this._onBeforeShutdownAsync(e)}async _onBeforeShutdownAsync(e){var t,i;if(this.instances.length===0)return!1;try{if(this._shutdownWindowCount=await((t=this._nativeDelegate)==null?void 0:t.getWindowCount()),this._shouldReviveProcesses(e)&&await Promise.race([(i=this._primaryBackend)==null?void 0:i.persistTerminalState(),kt(2e3)]),!(this._configHelper.config.enablePersistentSessions&&e===3)&&(this.configHelper.config.confirmOnExit==="always"&&this.instances.length>0||this.configHelper.config.confirmOnExit==="hasChildProcesses"&&this.instances.some(l=>l.hasChildProcesses)))return this._onBeforeShutdownConfirmation(e)}catch(n){this._logService.warn("Exception occurred during terminal shutdown",n)}return this._isShuttingDown=!0,!1}setNativeDelegate(e){this._nativeDelegate=e}async _toggleDevTools(e){var t,i;e?(t=this._nativeDelegate)==null||t.openDevTools():(i=this._nativeDelegate)==null||i.toggleDevTools()}_shouldReviveProcesses(e){if(!this._configHelper.config.enablePersistentSessions)return!1;switch(this.configHelper.config.persistentSessionReviveProcess){case"onExit":return e===1&&this._shutdownWindowCount===1&&!De?!0:e===4||e===2;case"onExitAndWindowClose":return e!==3;default:return!1}}async _onBeforeShutdownConfirmation(e){const t=await this._showTerminalCloseConfirmation();return t||(this._isShuttingDown=!0),t}_onWillShutdown(e){var i;const t=this._configHelper.config.enablePersistentSessions&&e.reason===3;for(const n of[...this._terminalGroupService.instances,...this._backgroundedTerminalInstances])t&&n.shouldPersist?n.detachProcessAndDispose(Ke.Shutdown):n.dispose(Ke.Shutdown);!t&&!this._shouldReviveProcesses(e.reason)&&((i=this._primaryBackend)==null||i.setTerminalLayoutInfo(void 0))}_saveState(){var i;if(this._isShuttingDown||!this.configHelper.config.enablePersistentSessions)return;const t={tabs:this._terminalGroupService.groups.map(n=>n.getLayoutInfo(n===this._terminalGroupService.activeGroup))};(i=this._primaryBackend)==null||i.setTerminalLayoutInfo(t)}_updateTitle(e){var t,i;!this.configHelper.config.enablePersistentSessions||!e||!e.persistentProcessId||!e.title||e.isDisposed||(e.staticTitle?(t=this._primaryBackend)==null||t.updateTitle(e.persistentProcessId,e.staticTitle,be.Api):(i=this._primaryBackend)==null||i.updateTitle(e.persistentProcessId,e.title,e.titleSource))}_updateIcon(e,t){var i;!this.configHelper.config.enablePersistentSessions||!e||!e.persistentProcessId||!e.icon||e.isDisposed||(i=this._primaryBackend)==null||i.updateIcon(e.persistentProcessId,t,e.icon,e.color)}refreshActiveGroup(){this._onDidChangeActiveGroup.fire(this._terminalGroupService.activeGroup)}getInstanceFromId(e){let t=-1;if(this._backgroundedTerminalInstances.forEach((i,n)=>{i.instanceId===e&&(t=n)}),t!==-1)return this._backgroundedTerminalInstances[t];try{return this.instances[this._getIndexFromId(e)]}catch{return}}getInstanceFromIndex(e){return this.instances[e]}getInstanceFromResource(e){return Kr(this.instances,e)}isAttachedToTerminal(e){return this.instances.some(t=>t.processId===e.pid)}moveToEditor(e){if(e.target===E.Editor)return;const t=this._terminalGroupService.getGroupForInstance(e);t&&(t.removeInstance(e),this._terminalEditorService.openEditor(e))}async moveToTerminalView(e,t,i){if(M.isUri(e)&&(e=this.getInstanceFromResource(e)),!e)return;if(this._terminalEditorService.detachInstance(e),e.target!==E.Editor){await this._terminalGroupService.showPanel(!0);return}e.target=E.Panel;let n;if(t&&(n=this._terminalGroupService.getGroupForInstance(t)),n||(n=this._terminalGroupService.createGroup()),n.addInstance(e),this.setActiveInstance(e),await this._terminalGroupService.showPanel(!0),t&&i){const s=n.terminalInstances.indexOf(t)+(i==="after"?1:0);n.moveInstance(e,s)}this._onDidChangeInstances.fire(),this._onDidChangeActiveGroup.fire(this._terminalGroupService.activeGroup)}_initInstanceListeners(e){const t=[e.onTitleChanged(this._onDidChangeInstanceTitle.fire,this._onDidChangeInstanceTitle),e.onIconChanged(this._onDidChangeInstanceIcon.fire,this._onDidChangeInstanceIcon),e.onIconChanged(this._onDidChangeInstanceColor.fire,this._onDidChangeInstanceColor),e.onProcessIdReady(this._onDidReceiveProcessId.fire,this._onDidReceiveProcessId),e.statusList.onDidChangePrimaryStatus(()=>this._onDidChangeInstancePrimaryStatus.fire(e)),e.onDimensionsChanged(()=>{this._onDidChangeInstanceDimensions.fire(e),this.configHelper.config.enablePersistentSessions&&this.isProcessSupportRegistered&&this._saveState()}),e.onMaximumDimensionsChanged(()=>this._onDidMaxiumumDimensionsChange.fire(e)),e.onDidInputData(this._onDidInputInstanceData.fire,this._onDidInputInstanceData),e.onDidFocus(this._onDidChangeActiveInstance.fire,this._onDidChangeActiveInstance),e.onRequestAddInstanceToGroup(async i=>await this._addInstanceToGroup(e,i))];e.onDisposed(()=>J(t))}async _addInstanceToGroup(e,t){var s;const i=zr(t.uri);if(i.instanceId===void 0)return;let n=this.getInstanceFromResource(t.uri);if(!n){const o=await((s=this._primaryBackend)==null?void 0:s.requestDetachInstance(i.workspaceId,i.instanceId));if(o){n=await this.createTerminal({config:{attachPersistentProcess:o},resource:t.uri}),this._terminalGroupService.moveInstance(n,e,t.side);return}}if(n=this._terminalGroupService.getInstanceFromResource(t.uri),n){this._terminalGroupService.moveInstance(n,e,t.side);return}if(n=this._terminalEditorService.getInstanceFromResource(t.uri),n){this.moveToTerminalView(n,e,t.side);return}}registerProcessSupport(e){e&&(this._processSupportContextKey.set(e),this._onDidRegisterProcessSupport.fire())}_getIndexFromId(e){let t=-1;if(this.instances.forEach((i,n)=>{i.instanceId===e&&(t=n)}),t===-1)throw new Error(`Terminal with ID ${e} does not exist (has it already been disposed?)`);return t}async _showTerminalCloseConfirmation(e){let t;this.instances.length===1||e?t=a("terminalService.terminalCloseConfirmationSingular","Do you want to terminate the active terminal session?"):t=a("terminalService.terminalCloseConfirmationPlural","Do you want to terminate the {0} active terminal sessions?",this.instances.length);const{confirmed:i}=await this._dialogService.confirm({type:"warning",message:t,primaryButton:a({key:"terminate",comment:["&& denotes a mnemonic"]},"&&Terminate")});return!i}getDefaultInstanceHost(){return this.defaultLocation===E.Editor?this._terminalEditorService:this._terminalGroupService}getInstanceHost(e){if(e){if(e===E.Editor)return this._terminalEditorService;if(typeof e=="object"){if("viewColumn"in e)return this._terminalEditorService;if("parentTerminal"in e)return e.parentTerminal.target===E.Editor?this._terminalEditorService:this._terminalGroupService}else return this._terminalGroupService}return this}async createTerminal(e){if(this._terminalProfileService.availableProfiles.length===0){const c=(e==null?void 0:e.config)&&"customPtyImplementation"in e.config,h=this._remoteAgentService.getConnection()&&M.isUri(e==null?void 0:e.cwd)&&(e==null?void 0:e.cwd.scheme)===G.vscodeFileResource;!c&&!h&&await this._terminalProfileService.profilesReady}const t=(e==null?void 0:e.config)||this._terminalProfileService.getDefaultProfile(),i=t&&"extensionIdentifier"in t?{}:this._terminalInstanceService.convertProfileToShellLaunchConfig(t||{});let n=t&&"extensionIdentifier"in t?t:void 0;!n&&(!e||!e.config)&&(n=await this._terminalProfileService.getContributedDefaultProfile(i));const s=typeof(e==null?void 0:e.location)=="object"&&"splitActiveTerminal"in e.location?e.location.splitActiveTerminal:typeof(e==null?void 0:e.location)=="object"?"parentTerminal"in e.location:!1;if(await this._resolveCwd(i,s,e),n){const c=this.resolveLocation(e==null?void 0:e.location);let h;s?h=c===E.Editor?{viewColumn:Fn}:{splitActiveTerminal:!0}:h=typeof(e==null?void 0:e.location)=="object"&&"viewColumn"in e.location?e.location:c,await this.createContributedTerminalProfile(n.extensionIdentifier,n.id,{icon:n.icon,color:n.color,location:h});const m=c===E.Editor?this._terminalEditorService:this._terminalGroupService,p=m.instances[m.instances.length-1];return await p.focusWhenReady(),this._terminalHasBeenCreated.set(!0),p}if(!i.customPtyImplementation&&!this.isProcessSupportRegistered)throw new Error("Could not create terminal when process support is not registered");if(i.hideFromUser){const c=this._terminalInstanceService.createInstance(i,E.Panel);return this._backgroundedTerminalInstances.push(c),this._backgroundedTerminalDisposables.set(c.instanceId,[c.onDisposed(this._onDidDisposeInstance.fire,this._onDidDisposeInstance)]),this._terminalHasBeenCreated.set(!0),c}this._evaluateLocalCwd(i);const o=this.resolveLocation(e==null?void 0:e.location)||this.defaultLocation,l=this._getSplitParent(e==null?void 0:e.location);return this._terminalHasBeenCreated.set(!0),l?this._splitTerminal(i,o,l):this._createTerminal(i,o,e)}async _resolveCwd(e,t,i){if(!e.cwd){if(i!=null&&i.cwd)e.cwd=i.cwd;else if(t&&(i!=null&&i.location)){let s=this.activeInstance;if(typeof i.location=="object"&&"parentTerminal"in i.location&&(s=i.location.parentTerminal),!s)throw new Error("Cannot split without an active instance");e.cwd=await Aa(this.configHelper,s,this._workspaceContextService.getWorkspace().folders,this._commandService)}}}_splitTerminal(e,t,i){let n;if(typeof e.cwd!="object"&&typeof i.shellLaunchConfig.cwd=="object"&&(e.cwd=M.from({scheme:i.shellLaunchConfig.cwd.scheme,authority:i.shellLaunchConfig.cwd.authority,path:e.cwd||i.shellLaunchConfig.cwd.path})),t===E.Editor||i.target===E.Editor)n=this._terminalEditorService.splitInstance(i,e);else{const s=this._terminalGroupService.getGroupForInstance(i);if(!s)throw new Error(`Cannot split a terminal without a group ${i}`);e.parentTerminalId=i.instanceId,n=s.split(e)}return this._addToReconnected(n),n}_addToReconnected(e){var i;if(!((i=e.reconnectionProperties)!=null&&i.ownerId))return;const t=this._reconnectedTerminals.get(e.reconnectionProperties.ownerId);t?t.push(e):this._reconnectedTerminals.set(e.reconnectionProperties.ownerId,[e])}_createTerminal(e,t,i){let n;const s=this._getEditorOptions(i==null?void 0:i.location);return t===E.Editor?(n=this._terminalInstanceService.createInstance(e,E.Editor),this._terminalEditorService.openEditor(n,s)):n=this._terminalGroupService.createGroup(e).terminalInstances[0],this._addToReconnected(n),n}resolveLocation(e){var t,i;if(e&&typeof e=="object"){if("parentTerminal"in e)return e.parentTerminal.target?e.parentTerminal.target:E.Panel;if("viewColumn"in e)return E.Editor;if("splitActiveTerminal"in e)return(t=this._activeInstance)!=null&&t.target?(i=this._activeInstance)==null?void 0:i.target:E.Panel}return e}_getSplitParent(e){if(e&&typeof e=="object"&&"parentTerminal"in e)return e.parentTerminal;if(e&&typeof e=="object"&&"splitActiveTerminal"in e)return this.activeInstance}_getEditorOptions(e){if(e&&typeof e=="object"&&"viewColumn"in e)return e.viewColumn=Ol(this._editorGroupsService,this._configurationService,e.viewColumn),e}_evaluateLocalCwd(e){var t;typeof e.cwd!="string"&&((t=e.cwd)==null?void 0:t.scheme)===G.file&&(Nl.getValue(this._contextKeyService)?(e.initialText=jt(a("localTerminalVirtualWorkspace","This shell is open to a {0}local{1} folder, NOT to the virtual folder","\x1B[3m","\x1B[23m"),{excludeLeadingNewLine:!0,loudFormatting:!0}),e.type="Local"):this._remoteAgentService.getConnection()&&(e.initialText=jt(a("localTerminalRemote","This shell is running on your {0}local{1} machine, NOT on the connected remote machine","\x1B[3m","\x1B[23m"),{excludeLeadingNewLine:!0,loudFormatting:!0}),e.type="Local"))}_showBackgroundTerminal(e){this._backgroundedTerminalInstances.splice(this._backgroundedTerminalInstances.indexOf(e),1);const t=this._backgroundedTerminalDisposables.get(e.instanceId);t&&J(t),this._backgroundedTerminalDisposables.delete(e.instanceId),e.shellLaunchConfig.hideFromUser=!1,this._terminalGroupService.createGroup(e),this.instances.length===1&&this._terminalGroupService.setActiveInstanceByIndex(0),this._onDidChangeInstances.fire(),this._onDidChangeGroups.fire()}async setContainers(e,t){this._configHelper.panelContainer=e,this._terminalGroupService.setContainer(t)}getEditingTerminal(){return this._editingTerminal}setEditingTerminal(e){this._editingTerminal=e}};je.__decorator=b([Ve(500)],je.prototype,"_saveState",null);je.__decorator=b([Ve(500)],je.prototype,"_updateTitle",null);je.__decorator=b([Ve(500)],je.prototype,"_updateIcon",null);je=b([d(0,Ie),d(1,jn),d(2,Je),d(3,Rt),d(4,O),d(5,Ye),d(6,Nr),d(7,Z),d(8,si),d(9,yt),d(10,ce),d(11,Ne),d(12,ta),d(13,Qe),d(14,se),d(15,ee),d(16,ge),d(17,ue)],je);let js=class extends ia{constructor(e,t,i,n,s){super(i),this._terminalService=t,this._themeService=i,this._terminalProfileService=n,this._editorService=s,this._registerListeners(),this._styleElement=document.createElement("style"),e.appendChild(this._styleElement),this._register(we(()=>e.removeChild(this._styleElement))),this.updateStyles()}_registerListeners(){this._register(this._terminalService.onDidChangeInstanceIcon(()=>this.updateStyles())),this._register(this._terminalService.onDidChangeInstanceColor(()=>this.updateStyles())),this._register(this._terminalService.onDidCreateInstance(()=>this.updateStyles())),this._register(this._editorService.onDidActiveEditorChange(()=>{this._editorService.activeEditor instanceof ke&&this.updateStyles()})),this._register(this._editorService.onDidCloseEditor(()=>{this._editorService.activeEditor instanceof ke&&this.updateStyles()})),this._register(this._terminalProfileService.onDidChangeAvailableProfiles(()=>this.updateStyles()))}updateStyles(){var s;super.updateStyles();const e=this._themeService.getColorTheme();let t="";const i=this._themeService.getProductIconTheme();for(const o of this._terminalService.instances){const l=o.icon;if(!l)continue;let c;l instanceof M?c=l:l instanceof Object&&"light"in l&&"dark"in l&&(c=e.type===na.LIGHT?l.light:l.dark);const h=Lt(o,e.type);if(c instanceof M&&h&&h.length>1&&(t+=`.monaco-workbench .terminal-tab.${h[0]}::before{background-image: ${sa(c)};}`),L.isThemeIcon(l)){const p=Un().getIcon(l.id);if(p){const w=i.getIcon(p);w&&(t+=`.monaco-workbench .terminal-tab.codicon-${l.id}::before{content: '${w.fontCharacter}' !important; font-family: ${Bl(((s=w.font)==null?void 0:s.id)??"codicon")} !important;}`)}}}const n=e.getColor(Vl);n&&(t+=`.monaco-workbench .show-file-icons .file-icon.terminal-tab::before { color: ${n}; }`),t+=Hl(e,!0),this._styleElement.textContent=t}};js=b([d(1,ne),d(2,he),d(3,Qe),d(4,mt)],js);let Xs=class extends q{constructor(e,t,i,n,s,o){super(),this._editorService=e,this._editorGroupsService=t,this._terminalInstanceService=i,this._instantiationService=n,this.instances=[],this._activeInstanceIndex=-1,this._isShuttingDown=!1,this._editorInputs=new Map,this._instanceDisposables=new Map,this._onDidDisposeInstance=new v,this.onDidDisposeInstance=this._onDidDisposeInstance.event,this._onDidFocusInstance=new v,this.onDidFocusInstance=this._onDidFocusInstance.event,this._onDidChangeInstanceCapability=new v,this.onDidChangeInstanceCapability=this._onDidChangeInstanceCapability.event,this._onDidChangeActiveInstance=new v,this.onDidChangeActiveInstance=this._onDidChangeActiveInstance.event,this._onDidChangeInstances=new v,this.onDidChangeInstances=this._onDidChangeInstances.event,this._terminalEditorActive=u.terminalEditorActive.bindTo(o),this._register(we(()=>{for(const l of this._instanceDisposables.values())J(l)})),this._register(s.onWillShutdown(()=>this._isShuttingDown=!0)),this._register(this._editorService.onDidActiveEditorChange(()=>{var m;const l=this._editorService.activeEditor,c=l instanceof ke?l==null?void 0:l.terminalInstance:void 0,h=!!c&&l instanceof ke;if(this._terminalEditorActive.set(h),h)l==null||l.setGroup((m=this._editorService.activeEditorPane)==null?void 0:m.group),this.setActiveInstance(c);else for(const p of this.instances)p.resetFocusContextKey()})),this._register(this._editorService.onDidVisibleEditorsChange(()=>{const l=this.instances.map(m=>m.instanceId),h=this._getActiveTerminalEditors().find(m=>{var w;const p=m instanceof ke?(w=m.terminalInstance)==null?void 0:w.instanceId:void 0;return p===void 0?!1:!l.includes(p)});h instanceof ke&&h.terminalInstance&&(this._editorInputs.set(h.terminalInstance.resource.path,h),this.instances.push(h.terminalInstance))})),this._register(this._editorService.onDidCloseEditor(l=>{const c=l.editor instanceof ke?l.editor.terminalInstance:void 0;if(c){const h=this.instances.findIndex(m=>m===c);if(h!==-1){const m=this.instances[h]===this.activeInstance;this._removeInstance(c),m&&this.setActiveInstance(void 0)}}}))}_getActiveTerminalEditors(){return this._editorService.visibleEditors.filter(e=>{var t;return e instanceof ke&&((t=e.terminalInstance)==null?void 0:t.instanceId)})}get activeInstance(){if(!(this.instances.length===0||this._activeInstanceIndex===-1))return this.instances[this._activeInstanceIndex]}setActiveInstance(e){this._activeInstanceIndex=e?this.instances.findIndex(t=>t===e):-1,this._onDidChangeActiveInstance.fire(this.activeInstance)}async focusActiveInstance(){var e;return(e=this.activeInstance)==null?void 0:e.focusWhenReady(!0)}async openEditor(e,t){var n,s;const i=this.resolveResource(e);i&&(await((n=this._activeOpenEditorRequest)==null?void 0:n.promise),this._activeOpenEditorRequest={instanceId:e.instanceId,promise:this._editorService.openEditor({resource:i,description:e.description||e.shellLaunchConfig.type,options:{pinned:!0,forceReload:!0,preserveFocus:t==null?void 0:t.preserveFocus}},(t==null?void 0:t.viewColumn)??Br)},await((s=this._activeOpenEditorRequest)==null?void 0:s.promise),this._activeOpenEditorRequest=void 0)}resolveResource(e){const t=e.resource,i=t.path,n=this._editorInputs.get(i);if(n)return n.resource;e.target=E.Editor;const s=this._instantiationService.createInstance(ke,t,e);return this._registerInstance(i,s,e),s.resource}getInputFromResource(e){const t=this._editorInputs.get(e.path);if(!t)throw new Error(`Could not get input from resource: ${e.path}`);return t}_registerInstance(e,t,i){this._editorInputs.set(e,t),this._instanceDisposables.set(e,[i.onDidFocus(this._onDidFocusInstance.fire,this._onDidFocusInstance),i.onDisposed(this._onDidDisposeInstance.fire,this._onDidDisposeInstance),i.capabilities.onDidAddCapability(()=>this._onDidChangeInstanceCapability.fire(i)),i.capabilities.onDidRemoveCapability(()=>this._onDidChangeInstanceCapability.fire(i))]),this.instances.push(i),this._onDidChangeInstances.fire()}_removeInstance(e){const t=e.resource.path;this._editorInputs.delete(t);const i=this.instances.findIndex(s=>s===e);i!==-1&&this.instances.splice(i,1);const n=this._instanceDisposables.get(t);this._instanceDisposables.delete(t),n&&J(n),this._onDidChangeInstances.fire()}getInstanceFromResource(e){return Kr(this.instances,e)}splitInstance(e,t={}){var s;if(e.target===E.Editor){const o=(s=this._editorInputs.get(e.resource.path))==null?void 0:s.group;o&&this._editorGroupsService.activateGroup(o)}const i=this._terminalInstanceService.createInstance(t,E.Editor),n=this.resolveResource(i);return n&&this._editorService.openEditor({resource:M.revive(n),description:i.description,options:{pinned:!0,forceReload:!0}},Fn),i}reviveInput(e){if("pid"in e){const t={...e,findRevivedId:!0},i=this._terminalInstanceService.createInstance({attachPersistentProcess:t},E.Editor),n=this._instantiationService.createInstance(ke,i.resource,i);return this._registerInstance(i.resource.path,n,i),n}else throw new Error(`Could not revive terminal editor input, ${e}`)}detachInstance(e){const t=e.resource.path,i=this._editorInputs.get(t);i==null||i.detachInstance(),this._removeInstance(e),this._isShuttingDown||i==null||i.dispose()}async revealActiveEditor(e){var n;const t=this.activeInstance;if(!t||((n=this._activeOpenEditorRequest)==null?void 0:n.instanceId)===t.instanceId)return;const i=this._editorInputs.get(t.resource.path);this._editorService.openEditor(i,{pinned:!0,forceReload:!0,preserveFocus:e,activation:Gl.PRESERVE})}};Xs=b([d(0,mt),d(1,ta),d(2,Ne),d(3,O),d(4,jn),d(5,Ie)],Xs);let Ys=class extends q{get onDidChange(){return this._onDidChange}constructor(e,t,i){super(),this._container=e,this.orientation=t,this._layoutService=i,this._splitViewDisposables=this._register(new Bi),this._children=[],this._terminalToPane=new Map,this._onDidChange=Y.None,this._width=this._container.offsetWidth,this._height=this._container.offsetHeight,this._createSplitView(),this._splitView.layout(this.orientation===1?this._width:this._height)}_createSplitView(){this._splitView=new ra(this._container,{orientation:this.orientation}),this._splitViewDisposables.clear(),this._splitViewDisposables.add(this._splitView.onDidSashReset(()=>this._splitView.distributeViewSizes()))}split(e,t){this._addChild(e,t)}resizePane(e,t,i,n){const s=t===0||t===1;if(s&&this.orientation!==1||!s&&this.orientation!==0){(this.orientation===1&&t===3||this.orientation===0&&t===1)&&(i*=-1),this._layoutService.resizePart(n,i,i);return}if(this._children.length<=1)return;const o=[];for(let h=0;h<this._splitView.length;h++)o.push(this._splitView.getViewSize(h));const l=e!==this._children.length-1,c=l?e+1:e-1;(l&&t===0||!l&&t===1||l&&t===2||!l&&t===3)&&(i*=-1),o[e]+i<80?i=80-o[e]:o[c]-i<80&&(i=o[c]-80),o[e]+=i,o[c]-=i;for(let h=0;h<this._splitView.length-1;h++)this._splitView.resizeView(h,o[h])}resizePanes(e){if(this._children.length<=1)return;e[e.length-1]+=1-e.reduce((i,n)=>i+n,0);let t=0;for(let i=0;i<this._splitView.length;i++)t+=this._splitView.getViewSize(i);for(let i=0;i<this._splitView.length;i++)this._splitView.resizeView(i,t*e[i])}getPaneSize(e){const t=this._terminalToPane.get(e);if(!t)return 0;const i=this._children.indexOf(t);return this._splitView.getViewSize(i)}_addChild(e,t){const i=new gd(e,this.orientation===1?this._height:this._width);i.orientation=this.orientation,typeof t=="number"?this._children.splice(t,0,i):this._children.push(i),this._terminalToPane.set(e,this._children[this._children.indexOf(i)]),this._withDisabledLayout(()=>this._splitView.addView(i,dn.Distribute,t)),this.layout(this._width,this._height),this._onDidChange=Y.any(...this._children.map(n=>n.onDidChange))}remove(e){let t=null;for(let i=0;i<this._children.length;i++)this._children[i].instance===e&&(t=i);t!==null&&(this._children.splice(t,1),this._terminalToPane.delete(e),this._splitView.removeView(t,dn.Distribute),e.detachFromElement())}layout(e,t){this._width=e,this._height=t,this.orientation===1?(this._children.forEach(i=>i.orthogonalLayout(t)),this._splitView.layout(e)):(this._children.forEach(i=>i.orthogonalLayout(e)),this._splitView.layout(t))}setOrientation(e){if(this.orientation!==e){for(this.orientation=e;this._container.children.length>0;)this._container.removeChild(this._container.children[0]);this._splitViewDisposables.clear(),this._splitView.dispose(),this._createSplitView(),this._withDisabledLayout(()=>{this._children.forEach(t=>{t.orientation=e,this._splitView.addView(t,1)})})}}_withDisabledLayout(e){this._children.forEach(t=>t.instance.disableLayout=!0),e(),this._children.forEach(t=>t.instance.disableLayout=!1)}};Ys=b([d(2,Xn)],Ys);class gd{get onDidChange(){return this._onDidChange}constructor(e,t){this.instance=e,this.orthogonalSize=t,this.minimumSize=80,this.maximumSize=Number.MAX_VALUE,this._onDidChange=Y.None,this.element=document.createElement("div"),this.element.className="terminal-split-pane",this.instance.attachToElement(this.element)}layout(e){!e||!this.orthogonalSize||(this.orientation===0?this.instance.layout({width:this.orthogonalSize,height:e}):this.instance.layout({width:e,height:this.orthogonalSize}))}orthogonalLayout(e){this.orthogonalSize=e}}let Qs=class extends q{get terminalInstances(){return this._terminalInstances}constructor(e,t,i,n,s,o,l){super(),this._container=e,this._terminalService=i,this._terminalInstanceService=n,this._layoutService=s,this._viewDescriptorService=o,this._instantiationService=l,this._terminalInstances=[],this._panelPosition=2,this._terminalLocation=1,this._instanceDisposables=new Map,this._activeInstanceIndex=-1,this._onDidDisposeInstance=this._register(new v),this.onDidDisposeInstance=this._onDidDisposeInstance.event,this._onDidFocusInstance=this._register(new v),this.onDidFocusInstance=this._onDidFocusInstance.event,this._onDidChangeInstanceCapability=this._register(new v),this.onDidChangeInstanceCapability=this._onDidChangeInstanceCapability.event,this._onDisposed=this._register(new v),this.onDisposed=this._onDisposed.event,this._onInstancesChanged=this._register(new v),this.onInstancesChanged=this._onInstancesChanged.event,this._onDidChangeActiveInstance=new v,this.onDidChangeActiveInstance=this._onDidChangeActiveInstance.event,this._onPanelOrientationChanged=new v,this.onPanelOrientationChanged=this._onPanelOrientationChanged.event,t&&this.addInstance(t),this._container&&this.attachToElement(this._container),this._onPanelOrientationChanged.fire(this._terminalLocation===1&&this._panelPosition===2?1:0)}addInstance(e,t){let i;const n=t?this._terminalInstances.findIndex(s=>s.instanceId===t):this._activeInstanceIndex;"instanceId"in e?i=e:i=this._terminalInstanceService.createInstance(e,E.Panel),this._terminalInstances.length===0?(this._terminalInstances.push(i),this._activeInstanceIndex=0):this._terminalInstances.splice(n+1,0,i),this._initInstanceListeners(i),this._splitPaneContainer&&this._splitPaneContainer.split(i,n+1),this._onInstancesChanged.fire()}dispose(){super.dispose(),this._container&&this._groupElement&&(this._container.removeChild(this._groupElement),this._groupElement=void 0),this._terminalInstances=[],this._onInstancesChanged.fire()}get activeInstance(){if(this._terminalInstances.length!==0)return this._terminalInstances[this._activeInstanceIndex]}getLayoutInfo(e){const t=this.terminalInstances.filter(n=>typeof n.persistentProcessId=="number"&&n.shouldPersist),i=t.map(n=>{var s;return((s=this._splitPaneContainer)==null?void 0:s.getPaneSize(n))||0}).reduce((n,s)=>n+=s,0);return{isActive:e,activePersistentProcessId:this.activeInstance?this.activeInstance.persistentProcessId:void 0,terminals:t.map(n=>({relativeSize:i>0?this._splitPaneContainer.getPaneSize(n)/i:0,terminal:n.persistentProcessId||0}))}}_initInstanceListeners(e){this._instanceDisposables.set(e.instanceId,[e.onDisposed(t=>{this._onDidDisposeInstance.fire(t),this._handleOnDidDisposeInstance(t)}),e.onDidFocus(t=>{this._setActiveInstance(t),this._onDidFocusInstance.fire(t)}),e.capabilities.onDidAddCapability(()=>this._onDidChangeInstanceCapability.fire(e)),e.capabilities.onDidRemoveCapability(()=>this._onDidChangeInstanceCapability.fire(e))])}_handleOnDidDisposeInstance(e){this._removeInstance(e)}removeInstance(e){this._removeInstance(e);const t=this._instanceDisposables.get(e.instanceId);t&&(J(t),this._instanceDisposables.delete(e.instanceId))}_removeInstance(e){var n,s;const t=this._terminalInstances.indexOf(e);if(t===-1)return;const i=e===this.activeInstance;if(this._terminalInstances.splice(t,1),i&&this._terminalInstances.length>0){const o=t<this._terminalInstances.length?t:this._terminalInstances.length-1;this.setActiveInstanceByIndex(o),(n=this.activeInstance)==null||n.focus(!0)}else t<this._activeInstanceIndex&&this._activeInstanceIndex--;(s=this._splitPaneContainer)==null||s.remove(e),this._terminalInstances.length===0?(this._onDisposed.fire(this),this.dispose()):this._onInstancesChanged.fire()}moveInstance(e,t){const i=this.terminalInstances.indexOf(e);i!==-1&&(this._terminalInstances.splice(i,1),this._terminalInstances.splice(t,0,e),this._splitPaneContainer&&(this._splitPaneContainer.remove(e),this._splitPaneContainer.split(e,t)),this._onInstancesChanged.fire())}_setActiveInstance(e){this.setActiveInstanceByIndex(this._getIndexFromId(e.instanceId))}_getIndexFromId(e){let t=-1;if(this.terminalInstances.forEach((i,n)=>{i.instanceId===e&&(t=n)}),t===-1)throw new Error(`Terminal with ID ${e} does not exist (has it already been disposed?)`);return t}setActiveInstanceByIndex(e,t){if(e<0||e>=this._terminalInstances.length)return;const i=this.activeInstance;this._activeInstanceIndex=e,(i!==this.activeInstance||t)&&(this._onInstancesChanged.fire(),this._onDidChangeActiveInstance.fire(this.activeInstance))}attachToElement(e){if(this._container=e,this._groupElement||(this._groupElement=document.createElement("div"),this._groupElement.classList.add("terminal-group")),this._container.appendChild(this._groupElement),!this._splitPaneContainer){this._panelPosition=this._layoutService.getPanelPosition(),this._terminalLocation=this._viewDescriptorService.getViewLocationById(z);const t=this._terminalLocation===1&&this._panelPosition===2?1:0;this._splitPaneContainer=this._instantiationService.createInstance(Ys,this._groupElement,t),this.terminalInstances.forEach(i=>this._splitPaneContainer.split(i,this._activeInstanceIndex+1)),this._initialRelativeSizes&&(this.resizePanes(this._initialRelativeSizes),this._initialRelativeSizes=void 0)}}get title(){if(this._terminalInstances.length===0)return"";let e=this.terminalInstances[0].title+this._getBellTitle(this.terminalInstances[0]);this.terminalInstances[0].description&&(e+=` (${this.terminalInstances[0].description})`);for(let t=1;t<this.terminalInstances.length;t++){const i=this.terminalInstances[t];i.title&&(e+=`, ${i.title+this._getBellTitle(i)}`,i.description&&(e+=` (${i.description})`))}return e}_getBellTitle(e){return this._terminalService.configHelper.config.enableBell&&e.statusList.statuses.some(t=>t.id==="bell")?"*":""}setVisible(e){this._groupElement&&(this._groupElement.style.display=e?"":"none"),this.terminalInstances.forEach(t=>t.setVisible(e))}split(e){const t=this._terminalInstanceService.createInstance(e,E.Panel);return this.addInstance(t,e.parentTerminalId),this._setActiveInstance(t),t}addDisposable(e){this._register(e)}layout(e,t){if(this._splitPaneContainer){const i=this._layoutService.getPanelPosition(),n=this._viewDescriptorService.getViewLocationById(z);if(i!==this._panelPosition||n!==this._terminalLocation){const o=n===1&&i===2?1:0;this._splitPaneContainer.setOrientation(o),this._panelPosition=i,this._terminalLocation=n,this._onPanelOrientationChanged.fire(this._splitPaneContainer.orientation)}this._splitPaneContainer.layout(e,t)}}focusPreviousPane(){const e=this._activeInstanceIndex===0?this._terminalInstances.length-1:this._activeInstanceIndex-1;this.setActiveInstanceByIndex(e)}focusNextPane(){const e=this._activeInstanceIndex===this._terminalInstances.length-1?0:this._activeInstanceIndex+1;this.setActiveInstanceByIndex(e)}resizePane(e){if(!this._splitPaneContainer)return;const t=e===0||e===1,i=this._terminalService.configHelper.getFont(),n=t?i.charWidth:i.charHeight;n&&this._splitPaneContainer.resizePane(this._activeInstanceIndex,e,n*4,Fh(this._terminalLocation))}resizePanes(e){if(!this._splitPaneContainer){this._initialRelativeSizes=e;return}this._splitPaneContainer.resizePanes(e)}};Qs=b([d(2,ne),d(3,Ne),d(4,Xn),d(5,Ni),d(6,O)],Qs);let Js=class extends q{get instances(){return this.groups.reduce((e,t)=>e.concat(t.terminalInstances),[])}constructor(e,t,i,n,s){super(),this._contextKeyService=e,this._instantiationService=t,this._viewsService=i,this._viewDescriptorService=n,this._configurationService=s,this.groups=[],this.activeGroupIndex=-1,this._onDidChangeActiveGroup=new v,this.onDidChangeActiveGroup=this._onDidChangeActiveGroup.event,this._onDidDisposeGroup=new v,this.onDidDisposeGroup=this._onDidDisposeGroup.event,this._onDidChangeGroups=new v,this.onDidChangeGroups=this._onDidChangeGroups.event,this._onDidShow=new v,this.onDidShow=this._onDidShow.event,this._onDidDisposeInstance=new v,this.onDidDisposeInstance=this._onDidDisposeInstance.event,this._onDidFocusInstance=new v,this.onDidFocusInstance=this._onDidFocusInstance.event,this._onDidChangeActiveInstance=new v,this.onDidChangeActiveInstance=this._onDidChangeActiveInstance.event,this._onDidChangeInstances=new v,this.onDidChangeInstances=this._onDidChangeInstances.event,this._onDidChangeInstanceCapability=new v,this.onDidChangeInstanceCapability=this._onDidChangeInstanceCapability.event,this._onDidChangePanelOrientation=new v,this.onDidChangePanelOrientation=this._onDidChangePanelOrientation.event,this.onDidDisposeGroup(o=>this._removeGroup(o)),this._terminalGroupCountContextKey=u.groupCount.bindTo(this._contextKeyService),this.onDidChangeGroups(()=>this._terminalGroupCountContextKey.set(this.groups.length)),Y.any(this.onDidChangeActiveGroup,this.onDidChangeInstances)(()=>this.updateVisibility())}hidePanel(){const e=this._viewDescriptorService.getViewContainerByViewId(z);e&&this._viewDescriptorService.getViewContainerModel(e).activeViewDescriptors.length===1&&(this._viewsService.closeView(z),u.tabsMouse.bindTo(this._contextKeyService).set(!1))}showTabs(){this._configurationService.updateValue("terminal.integrated.tabs.enabled",!0)}get activeGroup(){if(!(this.activeGroupIndex<0||this.activeGroupIndex>=this.groups.length))return this.groups[this.activeGroupIndex]}set activeGroup(e){if(e===void 0)return;const t=this.groups.findIndex(i=>i===e);this.setActiveGroupByIndex(t)}get activeInstance(){var e;return(e=this.activeGroup)==null?void 0:e.activeInstance}setActiveInstance(e){this.setActiveInstanceByIndex(this._getIndexFromId(e.instanceId))}_getIndexFromId(e){const t=this.instances.findIndex(i=>i.instanceId===e);if(t===-1)throw new Error(`Terminal with ID ${e} does not exist (has it already been disposed?)`);return t}setContainer(e){this._container=e,this.groups.forEach(t=>t.attachToElement(e))}async focusTabs(){var t;if(this.instances.length===0)return;await this.showPanel(!0);const e=this._viewsService.getActiveViewWithId(z);(t=e==null?void 0:e.terminalTabbedView)==null||t.focusTabs()}async focusHover(){var t;if(this.instances.length===0)return;const e=this._viewsService.getActiveViewWithId(z);(t=e==null?void 0:e.terminalTabbedView)==null||t.focusHover()}async focusActiveInstance(){return this.showPanel(!0)}createGroup(e){const t=this._instantiationService.createInstance(Qs,this._container,e);return t.onPanelOrientationChanged(i=>this._onDidChangePanelOrientation.fire(i)),this.groups.push(t),t.addDisposable(t.onDidDisposeInstance(this._onDidDisposeInstance.fire,this._onDidDisposeInstance)),t.addDisposable(t.onDidFocusInstance(this._onDidFocusInstance.fire,this._onDidFocusInstance)),t.addDisposable(t.onDidChangeActiveInstance(i=>{t===this.activeGroup&&this._onDidChangeActiveInstance.fire(i)})),t.addDisposable(t.onDidChangeInstanceCapability(this._onDidChangeInstanceCapability.fire,this._onDidChangeInstanceCapability)),t.addDisposable(t.onInstancesChanged(this._onDidChangeInstances.fire,this._onDidChangeInstances)),t.addDisposable(t.onDisposed(this._onDidDisposeGroup.fire,this._onDidDisposeGroup)),t.terminalInstances.length>0&&this._onDidChangeInstances.fire(),this.instances.length===1&&this.setActiveInstanceByIndex(0),this._onDidChangeGroups.fire(),t}async showPanel(e){const t=this._viewsService.getActiveViewWithId(z)??await this._viewsService.openView(z,e);if(t==null||t.setExpanded(!0),e){await kt(0);const i=this.activeInstance;i&&(t&&!t.isVisible()&&await this._viewsService.openView(z,e),await i.focusWhenReady(!0))}this._onDidShow.fire()}getInstanceFromResource(e){return Kr(this.instances,e)}_removeGroup(e){var s;const t=this.activeGroup,i=e===t,n=this.groups.indexOf(e);if(n!==-1&&(this.groups.splice(n,1),this._onDidChangeGroups.fire()),i){if(this.groups.length>0){const o=n<this.groups.length?n:this.groups.length-1;this.setActiveGroupByIndex(o,!0),(s=this.activeInstance)==null||s.focus(!0)}}else this.activeGroupIndex>n&&this.setActiveGroupByIndex(this.activeGroupIndex-1);this.activeGroupIndex>=this.groups.length&&this.setActiveGroupByIndex(this.groups.length-1),this._onDidChangeInstances.fire(),this._onDidChangeGroups.fire(),i&&(this._onDidChangeActiveGroup.fire(this.activeGroup),this._onDidChangeActiveInstance.fire(this.activeInstance))}setActiveGroupByIndex(e,t){if(e===-1&&this.groups.length===0){this.activeGroupIndex!==-1&&(this.activeGroupIndex=-1,this._onDidChangeActiveGroup.fire(this.activeGroup),this._onDidChangeActiveInstance.fire(this.activeInstance));return}if(e<0||e>=this.groups.length)return;const i=this.activeGroup;this.activeGroupIndex=e,(t||i!==this.activeGroup)&&(this._onDidChangeActiveGroup.fire(this.activeGroup),this._onDidChangeActiveInstance.fire(this.activeInstance))}_getInstanceLocation(e){let t=0;for(;e>=0&&t<this.groups.length;){const i=this.groups[t],n=i.terminalInstances.length;if(e<n)return{group:i,groupIndex:t,instance:i.terminalInstances[e],instanceIndex:e};e-=n,t++}}setActiveInstanceByIndex(e){const t=this.activeInstance,i=this._getInstanceLocation(e),n=i==null?void 0:i.group.terminalInstances[i.instanceIndex];if(!i||t===n)return;const s=i.instanceIndex;this.activeGroupIndex=i.groupIndex,this._onDidChangeActiveGroup.fire(this.activeGroup),i.group.setActiveInstanceByIndex(s,!0)}setActiveGroupToNext(){if(this.groups.length<=1)return;let e=this.activeGroupIndex+1;e>=this.groups.length&&(e=0),this.setActiveGroupByIndex(e)}setActiveGroupToPrevious(){if(this.groups.length<=1)return;let e=this.activeGroupIndex-1;e<0&&(e=this.groups.length-1),this.setActiveGroupByIndex(e)}moveGroup(e,t){const i=this.getGroupForInstance(e),n=this.getGroupForInstance(t);if(!i||!n)return;if(i===n){const l=i.terminalInstances.indexOf(t);l!==-1&&i.moveInstance(e,l);return}const s=this.groups.indexOf(i),o=this.groups.indexOf(n);this.groups.splice(s,1),this.groups.splice(o,0,i),this._onDidChangeInstances.fire()}moveGroupToEnd(e){const t=this.getGroupForInstance(e);if(!t)return;const i=this.groups.indexOf(t);this.groups.splice(i,1),this.groups.push(t),this._onDidChangeInstances.fire()}moveInstance(e,t,i){const n=this.getGroupForInstance(e),s=this.getGroupForInstance(t);if(!n||!s)return;n!==s&&(n.removeInstance(e),s.addInstance(e));const o=s.terminalInstances.indexOf(t)+(i==="after"?1:0);s.moveInstance(e,o)}unsplitInstance(e){const t=this.getGroupForInstance(e);!t||t.terminalInstances.length<2||(t.removeInstance(e),this.createGroup(e))}joinInstances(e){const t=this.getGroupForInstance(e[0]);if(t){let o=!0;for(let l=1;l<t.terminalInstances.length;l++)if(t.terminalInstances.includes(e[l])){o=!1;break}if(!o)return}let i,n;for(const o of e){const l=this.getGroupForInstance(o);if((l==null?void 0:l.terminalInstances.length)===1){i=o,n=l;break}}n||(n=this.createGroup());const s=this.activeGroup===n;for(const o of e){if(o===i)continue;const l=this.getGroupForInstance(o);l&&(l.removeInstance(o),n.addInstance(o))}this.setActiveInstance(e[0]),this._onDidChangeInstances.fire(),s||this._onDidChangeActiveGroup.fire(this.activeGroup)}instanceIsSplit(e){const t=this.getGroupForInstance(e);return t?t.terminalInstances.length>1:!1}getGroupForInstance(e){return this.groups.find(t=>t.terminalInstances.includes(e))}getGroupLabels(){return this.groups.filter(e=>e.terminalInstances.length>0).map((e,t)=>`${t+1}: ${e.title?e.title:""}`)}updateVisibility(){const e=this._viewsService.isViewVisible(z);this.groups.forEach((t,i)=>t.setVisible(e&&i===this.activeGroupIndex))}};Js=b([d(0,Ie),d(1,O),d(2,Nr),d(3,Ni),d(4,Z)],Js);class Ha extends q{constructor(){super(...arguments),this._map=new Map,this._onDidRemoveCapability=this._register(new v),this.onDidRemoveCapability=this._onDidRemoveCapability.event,this._onDidAddCapability=this._register(new v),this.onDidAddCapability=this._onDidAddCapability.event}get items(){return this._map.keys()}add(e,t){this._map.set(e,t),this._onDidAddCapability.fire(e)}get(e){return this._map.get(e)}remove(e){this._map.has(e)&&(this._map.delete(e),this._onDidRemoveCapability.fire(e))}has(e){return this._map.has(e)}}class pd extends q{constructor(){super(...arguments),this._stores=[],this._onDidRemoveCapability=this._register(new v),this.onDidRemoveCapability=this._onDidRemoveCapability.event,this._onDidAddCapability=this._register(new v),this.onDidAddCapability=this._onDidAddCapability.event}get items(){return this._items()}*_items(){for(const e of this._stores)for(const t of e.items)yield t}has(e){for(const t of this._stores)for(const i of t.items)if(i===e)return!0;return!1}get(e){for(const t of this._stores){const i=t.get(e);if(i)return i}}add(e){this._stores.push(e);for(const t of e.items)this._onDidAddCapability.fire(t);e.onDidAddCapability(t=>this._onDidAddCapability.fire(t)),e.onDidRemoveCapability(t=>this._onDidRemoveCapability.fire(t))}}class fd{constructor(e){this._process=e,this.type=1,this._cwd="",this._onDidChangeCwd=new v,this.onDidChangeCwd=this._onDidChangeCwd.event}async getCwd(){if(!this._process)return Promise.resolve("");const e=await this._process.getCwd();return e!==this._cwd&&this._onDidChangeCwd.fire(e),this._cwd=e,this._cwd}}class _d{constructor(e,t){this._totalDataLength=0,this._entries=[{cols:e,rows:t,data:[]}]}handleResize(e,t){if(this._entries.length>0&&this._entries[this._entries.length-1].data.length===0&&this._entries.pop(),this._entries.length>0){const i=this._entries[this._entries.length-1];if(i.cols===e&&i.rows===t)return;if(i.cols===0&&i.rows===0){i.cols=e,i.rows=t;return}}this._entries.push({cols:e,rows:t,data:[]})}handleData(e){for(this._entries[this._entries.length-1].data.push(e),this._totalDataLength+=e.length;this._totalDataLength>1048576;){const i=this._entries[0],n=this._totalDataLength-1048576;n>=i.data[0].length?(this._totalDataLength-=i.data[0].length,i.data.shift(),i.data.length===0&&this._entries.shift()):(i.data[0]=i.data[0].substr(n),this._totalDataLength-=n)}}generateReplayEventSync(){return this._entries.forEach(e=>{e.data.length>0&&(e.data=[e.data.join("")])}),{events:this._entries.map(e=>({cols:e.cols,rows:e.rows,data:e.data[0]??""})),commands:{isWindowsPty:!1,commands:[]}}}async generateReplayEvent(){return this.generateReplayEventSync()}}let Mn=class{constructor(e,t,i,n,s){this._diff=e,this._terminalId=t,this._collection=i,this._terminalService=n,this._extensionService=s,this.requiresAction=!0}_getInfo(e){const t=new Set;rn(t,this._diff.added.values()),rn(t,this._diff.removed.values()),rn(t,this._diff.changed.values());let i=a("extensionEnvironmentContributionInfoStale","The following extensions want to relaunch the terminal to contribute to its environment:");return i+=Ga(this._collection,e,this._extensionService,t),i}_getActions(){return[{label:a("relaunchTerminalLabel","Relaunch terminal"),run:()=>{var e;return(e=this._terminalService.getInstanceFromId(this._terminalId))==null?void 0:e.relaunch()},commandId:"workbench.action.terminal.relaunch"}]}getStatus(e){return{id:"relaunch-needed",severity:Re.Warning,icon:k.warning,tooltip:this._getInfo(e),hoverActions:this._getActions()}}};Mn=b([d(3,ne),d(4,se)],Mn);let _i=class{constructor(e,t,i){this._collection=e,this._commandService=t,this._extensionService=i,this.requiresAction=!1}_getInfo(e){const t=new Set;rn(t,this._collection.getVariableMap(e).values());let i=a("extensionEnvironmentContributionInfoActive","The following extensions have contributed to this terminal's environment:");return i+=Ga(this._collection,e,this._extensionService,t),i}_getActions(e){return[{label:a("showEnvironmentContributions","Show environment contributions"),run:()=>this._commandService.executeCommand("workbench.action.terminal.showEnvironmentContributions",e),commandId:"workbench.action.terminal.showEnvironmentContributions"}]}getStatus(e){return{id:"env-var-info-changes-active",severity:Re.Info,tooltip:this._getInfo(e),hoverActions:this._getActions(e)}}};_i=b([d(1,ue),d(2,se)],_i);function Ga(r,e,t,i){const n=[`
`],s=r.getDescriptionMap(void 0),o=r.getDescriptionMap(e);for(const l of i){const c=s.get(l);c&&(n.push(`
- \`${rs(l,t)}\``),n.push(`: ${c}`));const h=o.get(l);if(h){const m=c?` (${a("ScopedEnvironmentContributionInfo","workspace")})`:"";n.push(`
- \`${rs(l,t)}${m}\``),n.push(`: ${h}`)}!c&&!h&&n.push(`
- \`${rs(l,t)}\``)}return n.join("")}function rn(r,e){for(const t of e)for(const i of t)r.add(i.extensionIdentifier)}function rs(r,e){var t;return((t=e.extensions.find(i=>i.id===r))==null?void 0:t.displayName)||r}var qe;(function(r){r[r.Replace=1]="Replace",r[r.Append=2]="Append",r[r.Prepend=3]="Prepend"})(qe||(qe={}));const wd=new Map([[qe.Append,"APPEND"],[qe.Prepend,"PREPEND"],[qe.Replace,"REPLACE"]]);class $a{constructor(e){this.collections=e,this.map=new Map,this.descriptionMap=new Map,e.forEach((t,i)=>{this.populateDescriptionMap(t,i);const n=t.map.entries();let s=n.next();for(;!s.done;){const o=s.value[1],l=s.value[0];let c=this.map.get(l);if(c||(c=[],this.map.set(l,c)),c.length>0&&c[0].type===qe.Replace){s=n.next();continue}const h={extensionIdentifier:i,value:o.value,type:o.type,scope:o.scope,variable:o.variable,options:o.options};h.scope||delete h.scope,c.unshift(h),s=n.next()}})}async applyToProcessEnvironment(e,t,i){var s,o;let n;re&&(n={},Object.keys(e).forEach(l=>n[l.toLowerCase()]=l));for(const[l,c]of this.getVariableMap(t)){const h=re&&n[l.toLowerCase()]||l;for(const m of c){const p=i?await i(m.value):m.value;if(((s=m.options)==null?void 0:s.applyAtProcessCreation)??!0)switch(m.type){case qe.Append:e[h]=(e[h]||"")+p;break;case qe.Prepend:e[h]=p+(e[h]||"");break;case qe.Replace:e[h]=p;break}if(((o=m.options)==null?void 0:o.applyAtShellIntegration)??!1){const w=`VSCODE_ENV_${wd.get(m.type)}`;e[w]=(e[w]?e[w]+":":"")+l+"="+this._encodeColons(p)}}}}_encodeColons(e){return e.replaceAll(":","\\x3a")}diff(e,t){const i=new Map,n=new Map,s=new Map;if(e.getVariableMap(t).forEach((o,l)=>{const c=this.getVariableMap(t).get(l),h=wo(o,c);h&&i.set(l,h)}),this.getVariableMap(t).forEach((o,l)=>{const c=e.getVariableMap(t).get(l),h=wo(o,c);h&&s.set(l,h)}),this.getVariableMap(t).forEach((o,l)=>{const c=e.getVariableMap(t).get(l),h=vd(o,c);h&&n.set(l,h)}),!(i.size===0&&n.size===0&&s.size===0))return{added:i,changed:n,removed:s}}getVariableMap(e){const t=new Map;return this.map.forEach((i,n)=>{const s=i.filter(o=>_o(o,e));s.length>0&&t.set(s[0].variable,s)}),t}getDescriptionMap(e){const t=new Map;return this.descriptionMap.forEach((i,n)=>{const s=i.filter(o=>_o(o,e,!0));s.length>0&&t.set(s[0].extensionIdentifier,s[0].description)}),t}populateDescriptionMap(e,t){if(!e.descriptionMap)return;const i=e.descriptionMap.entries();let n=i.next();for(;!n.done;){const s=n.value[1],o=n.value[0];let l=this.descriptionMap.get(o);l||(l=[],this.descriptionMap.set(o,l));const c={extensionIdentifier:t,scope:s.scope,description:s.description};c.scope||delete c.scope,l.push(c),n=i.next()}}}function _o(r,e,t=!1){return r.scope?!!(r.scope.workspaceFolder&&(e!=null&&e.workspaceFolder)&&r.scope.workspaceFolder.index===e.workspaceFolder.index):t?e===r.scope:!0}function wo(r,e){if(!e)return r;const t=new Set;e.forEach(n=>t.add(n.extensionIdentifier));const i=[];return r.forEach(n=>{t.has(n.extensionIdentifier)||i.push(n)}),i.length===0?void 0:i}function vd(r,e){if(!e)return;const t=new Map;e.forEach(n=>t.set(n.extensionIdentifier,n));const i=[];return r.forEach(n=>{var o,l,c,h;const s=t.get(n.extensionIdentifier);s&&(n.type!==s.type||n.value!==s.value||((l=(o=n.scope)==null?void 0:o.workspaceFolder)==null?void 0:l.index)!==((h=(c=s.scope)==null?void 0:c.workspaceFolder)==null?void 0:h.index))&&i.push(s)}),i.length===0?void 0:i}function bd(r,...e){const t=e.reduce((s,o)=>(s[o]=!0,s),{}),i=[/^ELECTRON_.+$/,/^VSCODE_(?!(PORTABLE|SHELL_LOGIN|ENV_REPLACE|ENV_APPEND|ENV_PREPEND)).+$/,/^SNAP(|_.*)$/,/^GDK_PIXBUF_.+$/];Object.keys(r).filter(s=>!t[s]).forEach(s=>{for(let o=0;o<i.length;o++)if(s.search(i[o])!==-1){delete r[s];break}})}function vo(r){let e=r;e.includes("\\")&&(e=e.replace(/\\/g,"\\\\"));const t=/[\`\$\|\&\>\~\#\!\^\*\;\<\"\']/g;return e=e.replace(t,""),`'${e}'`}function Sd(r,e,t){if(!r)return"";if(!e)return r;e.match(/[\/\\]$/)&&(e=e.slice(0,e.length-1));const i=r.replace(/\\/g,"/").toLowerCase(),n=e.replace(/\\/g,"/").toLowerCase();return i.includes(n)?`~${t}${r.slice(e.length+1)}`:r}function Zs(r){return r.match(/^['"].*['"]$/)&&(r=r.substring(1,r.length-1)),Ue===1&&r&&r[1]===":"?r[0].toUpperCase()+r.substring(1):r}function bo(r,e){if(e)if(re)for(const t in e){let i=t;for(const s in r)if(t.toLowerCase()===s.toLowerCase()){i=s;break}const n=e[t];n!==void 0&&So(r,i,n)}else Object.keys(e).forEach(t=>{const i=e[t];i!==void 0&&So(r,t,i)})}function So(r,e,t){typeof t=="string"?r[e]=t:delete r[e]}function Cd(r,e,t,i){r.TERM_PROGRAM="vscode",e&&(r.TERM_PROGRAM_VERSION=e),yd(r,i)&&(r.LANG=xd(t)),r.COLORTERM="truecolor"}function Co(r,e){if(e)for(const t of Object.keys(e)){const i=e[t];i!=null&&(r[t]=i)}}async function yo(r,e){return await Promise.all(Object.entries(e).map(async([t,i])=>{if(typeof i=="string")try{e[t]=await r(i)}catch{e[t]=i}})),e}function yd(r,e){if(e==="on")return!0;if(e==="auto"){const t=r.LANG;return!t||t.search(/\.UTF\-8$/)===-1&&t.search(/\.utf8$/)===-1&&t.search(/\.euc.+/)===-1}return!1}function xd(r){const e=r?r.split("-"):[],t=e.length;if(t===0)return"en_US.UTF-8";if(t===1){const i={af:"ZA",am:"ET",be:"BY",bg:"BG",ca:"ES",cs:"CZ",da:"DK",de:"DE",el:"GR",en:"US",es:"ES",et:"EE",eu:"ES",fi:"FI",fr:"FR",he:"IL",hr:"HR",hu:"HU",hy:"AM",is:"IS",it:"IT",ja:"JP",kk:"KZ",ko:"KR",lt:"LT",nl:"NL",no:"NO",pl:"PL",pt:"BR",ro:"RO",ru:"RU",sk:"SK",sl:"SI",sr:"YU",sv:"SE",tr:"TR",uk:"UA",zh:"CN"};e[0]in i&&e.push(i[e[0]])}else e[1]=e[1].toUpperCase();return e.join("_")+".UTF-8"}async function Id(r,e,t,i,n,s){if(r.cwd){const l=typeof r.cwd=="object"?r.cwd.fsPath:r.cwd,c=await xo(l,t);return Zs(c||l)}let o;return!r.ignoreConfigurationCwd&&n&&(t&&(n=await xo(n,t,s)),n&&(Go(n)?o=n:i&&(o=Cs(i.fsPath,n)))),o||(o=i?i.fsPath:e||""),Zs(o)}async function xo(r,e,t){if(e)try{return await e(r)}catch(i){t==null||t.error("Could not resolve terminal cwd",i);return}return r}function kd(r,e,t){if(t)return i=>t.resolveWithEnvironment(e,r,i)}async function Td(r,e,t,i,n,s){const o={};if(r.strictEnv)Co(o,r.env);else{Co(o,s);const l={...e};t&&(l&&await yo(t,l),r.env&&await yo(t,r.env)),bd(o,"VSCODE_IPC_HOOK_CLI"),bo(o,l),bo(o,r.env),Cd(o,i,zn,n)}return o}async function Dd(r,e,t,i,n,s,o=re){let l;if(Yt(r)?l=r:(l=r.fsPath,o&&s!==1?l=l.replace(/\\/g,"/"):!o&&s===1&&(l=l.replace(/\//g,"\\"))),!e)return l;const c=l.includes(" "),h=l.includes("(")||l.includes(")"),m=Jt(e,".exe"),p=m==="pwsh"||t==="pwsh"||m==="powershell"||t==="powershell";if(p&&(c||l.includes("'")))return`& '${l.replace(/'/g,"''")}'`;if(h&&p)return`& '${l}'`;if(s===1){if(i!==void 0)return i==="gitbash"?vo(l.replace(/\\/g,"/")):i==="wsl"?(n==null?void 0:n.getWslPath(l,"win-to-unix"))||l:c?`"${l}"`:l;const w=e.toLowerCase();return w.includes("wsl")||w.includes("bash.exe")&&!w.toLowerCase().includes("git")?(n==null?void 0:n.getWslPath(l,"win-to-unix"))||l:c?`"${l}"`:l}return vo(l)}function er(r,e,t){const i=typeof r=="string"?M.parse(r):r;let n=i?xt(e.getWorkspaceFolder(i)):void 0;if(!n){const s=t.getLastActiveWorkspaceRoot();n=s?xt(e.getWorkspaceFolder(s)):void 0}return n}let tr=class extends q{get persistentProcessId(){var e;return(e=this._process)==null?void 0:e.id}get shouldPersist(){return!!this.reconnectionProperties||(this._process?this._process.shouldPersist:!1)}get hasWrittenData(){return this._hasWrittenData}get hasChildProcesses(){return this._hasChildProcesses}get reconnectionProperties(){var e,t,i;return((t=(e=this._shellLaunchConfig)==null?void 0:e.attachPersistentProcess)==null?void 0:t.reconnectionProperties)||((i=this._shellLaunchConfig)==null?void 0:i.reconnectionProperties)||void 0}get extEnvironmentVariableCollection(){return this._extEnvironmentVariableCollection}constructor(e,t,i,n,s,o,l,c,h,m,p,w,f,_,S,y,R,C,D,B){super(),this._instanceId=e,this._configHelper=t,this._historyService=o,this._instantiationService=l,this._logService=c,this._workspaceContextService=h,this._configurationResolverService=m,this._workbenchEnvironmentService=p,this._productService=w,this._remoteAgentService=f,this._pathService=_,this._environmentVariableService=S,this._terminalProfileResolverService=y,this._configurationService=R,this._terminalInstanceService=C,this._telemetryService=D,this._notificationService=B,this.processState=1,this.capabilities=new Ha,this._isDisposed=!1,this._process=null,this._processType=0,this._preLaunchInputQueue=[],this._latency=-1,this._latencyLastMeasured=0,this._hasWrittenData=!1,this._hasChildProcesses=!1,this._ptyListenersAttached=!1,this._isDisconnected=!1,this._dimensions={cols:0,rows:0},this._onPtyDisconnect=this._register(new v),this.onPtyDisconnect=this._onPtyDisconnect.event,this._onPtyReconnect=this._register(new v),this.onPtyReconnect=this._onPtyReconnect.event,this._onProcessReady=this._register(new v),this.onProcessReady=this._onProcessReady.event,this._onProcessStateChange=this._register(new v),this.onProcessStateChange=this._onProcessStateChange.event,this._onBeforeProcessData=this._register(new v),this.onBeforeProcessData=this._onBeforeProcessData.event,this._onProcessData=this._register(new v),this.onProcessData=this._onProcessData.event,this._onDidChangeProperty=this._register(new v),this.onDidChangeProperty=this._onDidChangeProperty.event,this._onEnvironmentVariableInfoChange=this._register(new v),this.onEnvironmentVariableInfoChanged=this._onEnvironmentVariableInfoChange.event,this._onProcessExit=this._register(new v),this.onProcessExit=this._onProcessExit.event,this._onRestoreCommands=this._register(new v),this.onRestoreCommands=this._onRestoreCommands.event,this._cwdWorkspaceFolder=er(i,this._workspaceContextService,this._historyService),this.ptyProcessReady=this._createPtyProcessReadyPromise(),this.getLatency(),this._ackDataBufferer=new Pd(A=>{var j;return(j=this._process)==null?void 0:j.acknowledgeDataEvent(A)}),this._dataFilter=this._instantiationService.createInstance(ir),this._dataFilter.onProcessData(A=>{const $={data:typeof A=="string"?A:A.data};this._onBeforeProcessData.fire($),$.data&&$.data.length>0&&(typeof A!="string"&&(A.data=$.data),this._onProcessData.fire(typeof A!="string"?A:{data:$.data,trackCommit:!1}))}),i&&typeof i=="object"?this.remoteAuthority=$l(i):this.remoteAuthority=this._workbenchEnvironmentService.remoteAuthority,n&&(this._extEnvironmentVariableCollection=new $a(n),this._register(this._environmentVariableService.onDidChangeCollections(A=>this._onEnvironmentVariableCollectionChange(A))),this.environmentVariableInfo=this._instantiationService.createInstance(_i,this._extEnvironmentVariableCollection),this._onEnvironmentVariableInfoChange.fire(this.environmentVariableInfo)),this.shellIntegrationNonce=s??zl()}async freePortKillProcess(e){var t,i;try{(t=this._process)!=null&&t.freePortKillProcess&&await((i=this._process)==null?void 0:i.freePortKillProcess(e))}catch(n){this._notificationService.notify({message:a("killportfailure","Could not kill process listening on port {0}, command exited with error {1}",e,n),severity:Re.Warning})}}dispose(e=!1){this._isDisposed=!0,this._process&&(this._setProcessState(5),this._process.shutdown(e),this._process=null),super.dispose()}_createPtyProcessReadyPromise(){return new Promise(e=>{const t=this.onProcessReady(()=>{this._logService.debug(`Terminal process ready (shellProcessId: ${this.shellProcessId})`),t.dispose(),e(void 0)})})}async detachFromProcess(e){var t,i;await((i=(t=this._process)==null?void 0:t.detach)==null?void 0:i.call(t,e)),this._process=null}async createProcess(e,t,i,n=!0){var l,c;this._shellLaunchConfig=e,this._dimensions.cols=t,this._dimensions.rows=i;let s;if(e.customPtyImplementation)this._processType=1,s=e.customPtyImplementation(this._instanceId,t,i);else{const h=await this._terminalInstanceService.getBackend(this.remoteAuthority);if(!h)throw new Error(`No terminal backend registered for remote authority '${this.remoteAuthority}'`);this.backend=h;const m=kd(this._cwdWorkspaceFolder,await this._terminalProfileResolverService.getEnvironment(this.remoteAuthority),this._configurationResolverService);if(this.userHome=(l=this._pathService.resolvedUserHome)==null?void 0:l.fsPath,this.os=Ue,this.remoteAuthority){const p=await this._pathService.userHome();this.userHome=p.path;const w=await this._remoteAgentService.getEnvironment();if(!w)throw new Error(`Failed to get remote environment for remote authority "${this.remoteAuthority}"`);this.userHome=w.userHome.path,this.os=w.os;const f=await this._resolveEnvironment(h,m,e),_=(this._configurationService.getValue("task.reconnection")&&e.reconnectionProperties||!e.isFeatureTerminal)&&this._configHelper.config.enablePersistentSessions&&!e.isTransient;if(e.attachPersistentProcess){const S=await h.attachToProcess(e.attachPersistentProcess.id);S?s=S:(this._logService.warn("Attach to process failed for terminal",e.attachPersistentProcess),e.attachPersistentProcess=void 0)}if(!s){await this._terminalProfileResolverService.resolveShellLaunchConfig(e,{remoteAuthority:this.remoteAuthority,os:this.os});const S={shellIntegration:{enabled:this._configurationService.getValue("terminal.integrated.shellIntegration.enabled"),suggestEnabled:this._configurationService.getValue("terminal.integrated.shellIntegration.suggestEnabled"),nonce:this.shellIntegrationNonce},windowsEnableConpty:this._configHelper.config.windowsEnableConpty,environmentVariableCollections:(c=this._extEnvironmentVariableCollection)!=null&&c.collections?ro(this._extEnvironmentVariableCollection.collections):void 0,workspaceFolder:this._cwdWorkspaceFolder};try{s=await h.createProcess(e,"",t,i,this._configHelper.config.unicodeVersion,f,S,_)}catch(y){if((y==null?void 0:y.message)==="Could not fetch remote environment"){this._logService.trace("Could not fetch remote environment, silently failing");return}throw y}}this._isDisposed||this._setupPtyHostListeners(h)}else{if(e.attachPersistentProcess){const p=e.attachPersistentProcess.findRevivedId?await h.attachToRevivedProcess(e.attachPersistentProcess.id):await h.attachToProcess(e.attachPersistentProcess.id);p?s=p:(this._logService.warn("Attach to process failed for terminal",e.attachPersistentProcess),e.attachPersistentProcess=void 0)}s||(s=await this._launchLocalProcess(h,e,t,i,this.userHome,m)),this._isDisposed||this._setupPtyHostListeners(h)}}if(this._isDisposed){s.shutdown(!1);return}this._process=s,this._setProcessState(2),(this.os===3||this.os===2)&&this.capabilities.add(1,new fd(this._process)),this._dataFilter.newProcess(this._process,n),this._processListeners&&J(this._processListeners),this._processListeners=[s.onProcessReady(h=>{this.shellProcessId=h.pid,this._initialCwd=h.cwd,this._onDidChangeProperty.fire({type:"initialCwd",value:this._initialCwd}),this._onProcessReady.fire(h),this._preLaunchInputQueue.length>0&&this._process&&(s.input(this._preLaunchInputQueue.join("")),this._preLaunchInputQueue.length=0)}),s.onProcessExit(h=>this._onExit(h)),s.onDidChangeProperty(({type:h,value:m})=>{var p;switch(h){case"hasChildProcesses":this._hasChildProcesses=m;break;case"failedShellIntegrationActivation":(p=this._telemetryService)==null||p.publicLog2("terminal/shellIntegrationActivationFailureCustomArgs");break}this._onDidChangeProperty.fire({type:h,value:m})})],s.onRestoreCommands&&this._processListeners.push(s.onRestoreCommands(h=>{this._onRestoreCommands.fire(h)})),setTimeout(()=>{this.processState===2&&this._setProcessState(3)},500);const o=await s.start();if(o)return o}async relaunch(e,t,i,n){return this.ptyProcessReady=this._createPtyProcessReadyPromise(),this._logService.trace(`Relaunching terminal instance ${this._instanceId}`),this._isDisconnected&&(this._isDisconnected=!1,this._onPtyReconnect.fire()),this._hasWrittenData=!1,this.createProcess(e,t,i,n)}async _resolveEnvironment(e,t,i){const n=er(i.cwd,this._workspaceContextService,this._historyService),s=re?"windows":De?"osx":"linux",o=this._configurationService.getValue(`terminal.integrated.env.${s}`);this._configHelper.showRecommendations(i);let l;i.useShellEnvironment?l=await e.getShellEnvironment():l=await this._terminalProfileResolverService.getEnvironment(this.remoteAuthority);const c=await Td(i,o,t,this._productService.version,this._configHelper.config.detectLocale,l);return!this._isDisposed&&!i.strictEnv&&!i.hideFromUser&&(this._extEnvironmentVariableCollection=this._environmentVariableService.mergedCollection,this._register(this._environmentVariableService.onDidChangeCollections(h=>this._onEnvironmentVariableCollectionChange(h))),await this._extEnvironmentVariableCollection.applyToProcessEnvironment(c,{workspaceFolder:n},t),this._extEnvironmentVariableCollection.getVariableMap({workspaceFolder:n}).size&&(this.environmentVariableInfo=this._instantiationService.createInstance(_i,this._extEnvironmentVariableCollection),this._onEnvironmentVariableInfoChange.fire(this.environmentVariableInfo))),c}async _launchLocalProcess(e,t,i,n,s,o){await this._terminalProfileResolverService.resolveShellLaunchConfig(t,{remoteAuthority:void 0,os:Ue});const l=this._historyService.getLastActiveWorkspaceRoot(G.file),c=await Id(t,s,o,l,this._configHelper.config.cwd,this._logService),h=await this._resolveEnvironment(e,o,t),m={shellIntegration:{enabled:this._configurationService.getValue("terminal.integrated.shellIntegration.enabled"),suggestEnabled:this._configurationService.getValue("terminal.integrated.shellIntegration.suggestEnabled"),nonce:this.shellIntegrationNonce},windowsEnableConpty:this._configHelper.config.windowsEnableConpty,environmentVariableCollections:this._extEnvironmentVariableCollection?ro(this._extEnvironmentVariableCollection.collections):void 0,workspaceFolder:this._cwdWorkspaceFolder},p=(this._configurationService.getValue("task.reconnection")&&t.reconnectionProperties||!t.isFeatureTerminal)&&this._configHelper.config.enablePersistentSessions&&!t.isTransient;return await e.createProcess(t,c,i,n,this._configHelper.config.unicodeVersion,h,m,p)}_setupPtyHostListeners(e){this._ptyListenersAttached||(this._ptyListenersAttached=!0,this._register(e.onPtyHostUnresponsive(()=>{this._isDisconnected=!0,this._onPtyDisconnect.fire()})),this._ptyResponsiveListener=e.onPtyHostResponsive(()=>{this._isDisconnected=!1,this._onPtyReconnect.fire()}),this._register(we(()=>{var t;return(t=this._ptyResponsiveListener)==null?void 0:t.dispose()})),this._register(e.onPtyHostRestart(async()=>{var t;if(this._isDisconnected||(this._isDisconnected=!0,this._onPtyDisconnect.fire()),(t=this._ptyResponsiveListener)==null||t.dispose(),this._ptyResponsiveListener=void 0,this._shellLaunchConfig)if(this._shellLaunchConfig.isFeatureTerminal&&!this.reconnectionProperties)this._onExit(-1);else{const i=a("ptyHostRelaunch","Restarting the terminal because the connection to the shell process was lost...");this._onProcessData.fire({data:jt(i,{loudFormatting:!0}),trackCommit:!1}),await this.relaunch(this._shellLaunchConfig,this._dimensions.cols,this._dimensions.rows,!1)}})))}async getBackendOS(){let e=Ue;if(this.remoteAuthority){const t=await this._remoteAgentService.getEnvironment();if(!t)throw new Error(`Failed to get remote environment for remote authority "${this.remoteAuthority}"`);e=t.os}return e}setDimensions(e,t,i){if(i){this._resize(e,t);return}return this.ptyProcessReady.then(()=>this._resize(e,t))}async setUnicodeVersion(e){var t;return(t=this._process)==null?void 0:t.setUnicodeVersion(e)}_resize(e,t){if(this._process){try{this._process.resize(e,t)}catch(i){if(i.code!=="EPIPE"&&i.code!=="ERR_IPC_CHANNEL_CLOSED")throw i}this._dimensions.cols=e,this._dimensions.rows=t}}async write(e){await this.ptyProcessReady,this._dataFilter.disableSeamlessRelaunch(),this._hasWrittenData=!0,this.shellProcessId||this._processType===1?this._process&&this._process.input(e):this._preLaunchInputQueue.push(e)}async processBinary(e){var t;await this.ptyProcessReady,this._dataFilter.disableSeamlessRelaunch(),this._hasWrittenData=!0,(t=this._process)==null||t.processBinary(e)}get initialCwd(){return this._initialCwd??""}async getLatency(){if(await this.ptyProcessReady,!this._process)return Promise.resolve(0);if(this._latencyLastMeasured===0||this._latencyLastMeasured+1e3<Date.now()){const e=this._process.getLatency();this._latency=await e,this._latencyLastMeasured=Date.now()}return Promise.resolve(this._latency)}async refreshProperty(e){if(!this._process)throw new Error("Cannot refresh property when process is not set");return this._process.refreshProperty(e)}async updateProperty(e,t){var i;return(i=this._process)==null?void 0:i.updateProperty(e,t)}acknowledgeDataEvent(e){this._ackDataBufferer.ack(e)}_onExit(e){this._process=null,this.processState===2&&this._setProcessState(4),this.processState===3&&this._setProcessState(6),this._onProcessExit.fire(e)}_setProcessState(e){this.processState=e,this._onProcessStateChange.fire()}_onEnvironmentVariableCollectionChange(e){const t=this._extEnvironmentVariableCollection.diff(e,{workspaceFolder:this._cwdWorkspaceFolder});if(t===void 0){this.environmentVariableInfo instanceof Mn&&(this.environmentVariableInfo=this._instantiationService.createInstance(_i,this._extEnvironmentVariableCollection),this._onEnvironmentVariableInfoChange.fire(this.environmentVariableInfo));return}this.environmentVariableInfo=this._instantiationService.createInstance(Mn,t,this._instanceId,e),this._onEnvironmentVariableInfoChange.fire(this.environmentVariableInfo)}};tr=b([d(5,Vn),d(6,O),d(7,Je),d(8,ge),d(9,Bn),d(10,si),d(11,ai),d(12,Ye),d(13,oa),d(14,aa),d(15,pt),d(16,Z),d(17,Ne),d(18,ft),d(19,ee)],tr);class Pd{constructor(e){this._callback=e,this._unsentCharCount=0}ack(e){for(this._unsentCharCount+=e;this._unsentCharCount>5e3;)this._unsentCharCount-=5e3,this._callback(5e3)}}let ir=class extends q{get onProcessData(){return this._onProcessData.event}constructor(e){super(),this._logService=e,this._disableSeamlessRelaunch=!1,this._onProcessData=this._register(new v)}newProcess(e,t){var n,s,o,l,c;if((n=this._dataListener)==null||n.dispose(),(s=this._activeProcess)==null||s.shutdown(!1),this._activeProcess=e,!this._firstRecorder||!t||this._disableSeamlessRelaunch){(o=this._firstDisposable)==null||o.dispose(),[this._firstRecorder,this._firstDisposable]=this._createRecorder(e),this._disableSeamlessRelaunch&&t&&this._onProcessData.fire("\x1Bc"),this._dataListener=e.onProcessData(h=>this._onProcessData.fire(h)),this._disableSeamlessRelaunch=!1;return}this._secondRecorder&&this.triggerSwap(),this._swapTimeout=window.setTimeout(()=>this.triggerSwap(),3e3),(l=this._dataListener)==null||l.dispose(),(c=this._firstDisposable)==null||c.dispose();const i=this._createRecorder(e);[this._secondRecorder,this._secondDisposable]=i}disableSeamlessRelaunch(){this._disableSeamlessRelaunch=!0,this._stopRecording(),this.triggerSwap()}triggerSwap(){var i,n,s;if(this._swapTimeout&&(window.clearTimeout(this._swapTimeout),this._swapTimeout=void 0),!this._firstRecorder)return;if(!this._secondRecorder){this._firstRecorder=void 0,(i=this._firstDisposable)==null||i.dispose();return}const e=this._getDataFromRecorder(this._firstRecorder),t=this._getDataFromRecorder(this._secondRecorder);e===t?this._logService.trace("Seamless terminal relaunch - identical content"):(this._logService.trace("Seamless terminal relaunch - resetting content"),this._onProcessData.fire({data:`\x1Bc${t}`,trackCommit:!1})),(n=this._dataListener)==null||n.dispose(),this._dataListener=this._activeProcess.onProcessData(o=>this._onProcessData.fire(o)),this._firstRecorder=this._secondRecorder,(s=this._firstDisposable)==null||s.dispose(),this._firstDisposable=this._secondDisposable,this._secondRecorder=void 0}_stopRecording(){var e,t;this._swapTimeout||(this._firstRecorder=void 0,(e=this._firstDisposable)==null||e.dispose(),this._secondRecorder=void 0,(t=this._secondDisposable)==null||t.dispose())}_createRecorder(e){const t=new _d(0,0),i=e.onProcessData(n=>t.handleData(typeof n=="string"?n:n.data));return[t,i]}_getDataFromRecorder(e){return e.generateReplayEventSync().events.filter(t=>!!t.data).map(t=>t.data).join("")}};ir=b([d(0,Je)],ir);async function on(r,e,t,i,n,s){var B;if(!e.xterm)return;const o=r.get(mt),l=r.get(O),c=r.get(me),h=r.get(Xe),m=`terminal.pinnedRecentCommands.${e.shellType}`;let p,w=[];const f=new Set,_={iconClass:L.asClassName(zh),tooltip:a("removeCommand","Remove from Command History")},S={iconClass:L.asClassName(Kh),tooltip:a("viewCommandOutput","View Command Output"),alwaysVisible:!1};if(i==="command"){let H=function(X){return X.replace(/\r?\n/g,"⏎").replace(/\s\s\s+/g,"⋯")};p=De?a("selectRecentCommandMac","Select a command to run (hold Option-key to edit the command)"):a("selectRecentCommand","Select a command to run (hold Alt-key to edit the command)");const A=e.capabilities.get(2),j=A==null?void 0:A.commands,$=A==null?void 0:A.executingCommand;if($&&f.add($),j&&j.length>0){for(const X of j){const We=X.command.trim();if(We.length===0||f.has(We))continue;let et=Sd(X.cwd,e.userHome,e.os===1?"\\":"/");X.exitCode&&(X.exitCode===-1?et+=" failed":et+=` exitCode: ${X.exitCode}`),et=et.trim();const Jn=[S],de=w.length>0?w[w.length-1]:void 0;if((de==null?void 0:de.type)!=="separator"&&(de==null?void 0:de.label)===We){de.id=X.timestamp.toString(),de.description=et;continue}w.push({label:H(We),rawLabel:We,description:et,id:X.timestamp.toString(),command:X,buttons:X.hasOutput()?Jn:void 0}),f.add(We)}w=w.reverse()}$&&w.unshift({label:H($),rawLabel:$,description:A.cwd}),w.length>0&&w.unshift({type:"separator",label:x.currentSessionCategory});const He=l.invokeFunction(pn),Ze=[];for(const[X,We]of He.entries)!f.has(X)&&We.shellType===e.shellType&&(Ze.unshift({label:H(X),rawLabel:X,buttons:[_]}),f.add(X));Ze.length>0&&w.push({type:"separator",label:x.previousSessionCategory},...Ze);const Qn=await l.invokeFunction(Yh,e.shellType),ci=[];for(const X of Qn)f.has(X)||ci.unshift({label:H(X),rawLabel:X});ci.length>0&&w.push({type:"separator",label:a("shellFileHistoryCategory","{0} history",e.shellType)},...ci)}else{p=De?a("selectRecentDirectoryMac","Select a directory to go to (hold Option-key to edit the command)"):a("selectRecentDirectory","Select a directory to go to (hold Alt-key to edit the command)");const A=((B=e.capabilities.get(0))==null?void 0:B.cwds)||[];if(A&&A.length>0){for(const H of A)w.push({label:H,rawLabel:H});w=w.reverse(),w.unshift({type:"separator",label:x.currentSessionCategory})}const j=l.invokeFunction(Ps),$=[];for(const[H,He]of j.entries)(He===null||He.remoteAuthority===e.remoteAuthority)&&!A.includes(H)&&$.unshift({label:H,rawLabel:H,buttons:[_]});$.length>0&&w.push({type:"separator",label:x.previousSessionCategory},...$)}if(w.length===0)return;const y=new Kl({title:"Fuzzy search",icon:qh,isChecked:n==="fuzzy",inputActiveOptionBorder:Xi(ql),inputActiveOptionForeground:Xi(Ul),inputActiveOptionBackground:Xi(jl)});y.onChange(()=>{l.invokeFunction(on,e,t,i,y.checked?"fuzzy":"contiguous",C.value)});const R=l.createInstance(Ai),C=c.createQuickPick(),D=w;return C.items=[...D],C.sortByLabel=!1,C.placeholder=p,C.matchOnLabelMode=n||"contiguous",C.toggles=[y],C.onDidTriggerItemButton(async A=>{var j,$;if(A.button===_)i==="command"?(j=l.invokeFunction(pn))==null||j.remove(A.item.label):($=l.invokeFunction(Ps))==null||$.remove(A.item.label);else if(A.button===S){const H=A.item.command,He=H==null?void 0:H.getOutput();if(He&&(H!=null&&H.command)){const Ze=await R.provideTextContent(M.from({scheme:Ai.scheme,path:`${H.command}... ${pi(H.timestamp,!0)}`,fragment:He,query:`terminal-output-${H.timestamp}-${e.instanceId}`}));Ze&&await o.openEditor({resource:Ze.uri})}}await l.invokeFunction(on,e,t,i,n,s)}),C.onDidChangeValue(async A=>{A||await l.invokeFunction(on,e,t,i,n,A)}),C.onDidAccept(async()=>{const A=C.activeItems[0];let j;i==="cwd"?j=`cd ${await e.preparePathForShell(A.rawLabel)}`:j=A.rawLabel,C.hide(),e.runCommand(j,!C.keyMods.alt),C.keyMods.alt&&e.focus()}),s&&(C.value=s),new Promise(A=>{t.set(!0),Wh(h,m,C,!0),C.onDidHide(()=>{t.set(!1),A()})})}let Ai=class za{constructor(e,t){this._modelService=t,e.registerTextModelContentProvider(za.scheme,this)}async provideTextContent(e){const t=this._modelService.getModel(e);return t&&!t.isDisposed()?t:this._modelService.createModel(e.fragment,null,e,!1)}};Ai.scheme="TERMINAL_OUTPUT";Ai=b([d(0,Gn),d(1,Ho)],Ai);let nr=class extends q{get onDidAddStatus(){return this._onDidAddStatus.event}get onDidRemoveStatus(){return this._onDidRemoveStatus.event}get onDidChangePrimaryStatus(){return this._onDidChangePrimaryStatus.event}constructor(e){super(),this._configurationService=e,this._statuses=new Map,this._statusTimeouts=new Map,this._onDidAddStatus=this._register(new v),this._onDidRemoveStatus=this._register(new v),this._onDidChangePrimaryStatus=this._register(new v)}get primary(){let e;for(const t of this._statuses.values())(!e||t.severity>=e.severity)&&(e=t);return e}get statuses(){return Array.from(this._statuses.values())}add(e,t){e=this._applyAnimationSetting(e);const i=this._statusTimeouts.get(e.id);if(i&&(window.clearTimeout(i),this._statusTimeouts.delete(e.id)),t&&t>0){const s=window.setTimeout(()=>this.remove(e),t);this._statusTimeouts.set(e.id,s)}const n=this._statuses.get(e.id);if(n&&n!==e&&(this._onDidRemoveStatus.fire(n),this._statuses.delete(n.id)),!this._statuses.has(e.id)){const s=this.primary;this._statuses.set(e.id,e),this._onDidAddStatus.fire(e);const o=this.primary;s!==o&&this._onDidChangePrimaryStatus.fire(o)}}remove(e){var i;const t=typeof e=="string"?this._statuses.get(e):e;if(t&&this._statuses.get(t.id)){const n=((i=this.primary)==null?void 0:i.id)===t.id;this._statuses.delete(t.id),this._onDidRemoveStatus.fire(t),n&&this._onDidChangePrimaryStatus.fire(this.primary)}}toggle(e,t){t?this.add(e):this.remove(e)}_applyAnimationSetting(e){if(!e.icon||L.getModifier(e.icon)!=="spin"||this._configurationService.getValue("terminal.integrated.tabs.enableAnimation"))return e;let t;return e.icon.id===Xl.id?t=k.play:t=L.modify(e.icon,void 0),{...e,icon:t}}};nr=b([d(0,Z)],nr);function Ka(r){switch(r){case Re.Error:return Ql;case Re.Warning:return Yl;default:return""}}class Ed{constructor(){this._attached=new Map}attachToElement(e){this._container||(this._container=document.createElement("div"),this._container.classList.add("terminal-widget-container"),e.appendChild(this._container))}dispose(){this._container&&this._container.parentElement&&(this._container.parentElement.removeChild(this._container),this._container=void 0)}attachWidget(e){var t;if(this._container)return(t=this._attached.get(e.id))==null||t.dispose(),e.attach(this._container),this._attached.set(e.id,e),{dispose:()=>{this._attached.get(e.id)===e&&(this._attached.delete(e.id),e.dispose())}}}}class Ad extends q{constructor(e){super(),this._initializationPromise=e,this._isOsSet=!1,this._onLineData=this._register(new v),this.onLineData=this._onLineData.event}async activate(e){this._xterm=e,await this._initializationPromise,this._register(e.onLineFeed(()=>{const t=e.buffer,i=t.active.getLine(t.active.baseY+t.active.cursorY);i&&!i.isWrapped&&this._sendLineData(t.active,t.active.baseY+t.active.cursorY-1)})),this._register(we(()=>{const t=e.buffer;this._sendLineData(t.active,t.active.baseY+t.active.cursorY)}))}setOperatingSystem(e){if(!(this._isOsSet||!this._xterm)&&(this._isOsSet=!0,e===1)){const t=this._xterm;this._register(t.parser.registerCsiHandler({final:"H"},()=>{const i=t.buffer;return this._sendLineData(i.active,i.active.baseY+i.active.cursorY),!1}))}}_sendLineData(e,t){let i=e.getLine(t);if(!i)return;let n=i.translateToString(!0);for(;t>0&&i.isWrapped&&(i=e.getLine(--t),!!i);)n=i.translateToString(!1)+n;this._onLineData.fire(n)}}var K;(function(r){r[r.Top=0]="Top",r[r.Bottom=1]="Bottom"})(K||(K={}));let sr=class extends q{activate(e){this._terminal=e,this._register(this._terminal.onData(()=>{this._currentMarker=K.Bottom}))}constructor(e,t){super(),this._capabilities=e,this._themeService=t,this._currentMarker=K.Bottom,this._selectionStart=null,this._isDisposable=!1}_getMarkers(e){var o,l;const t=this._capabilities.get(2),i=this._capabilities.get(3),n=this._capabilities.get(4);let s=[];if(t?s=Jl(t.commands.map(c=>c.marker)):i&&s.push(...i.commands),n&&!e){let c=(o=n.markers().next())==null?void 0:o.value;const h=[];for(;c;)h.push(c),c=(l=n.markers().next())==null?void 0:l.value;s=h}return s}clearMarker(){this._currentMarker=K.Bottom,this._resetNavigationDecorations(),this._selectionStart=null}_resetNavigationDecorations(){this._navigationDecorations&&J(this._navigationDecorations),this._navigationDecorations=[]}_isEmptyCommand(e){return e===K.Bottom?!0:e===K.Top?!this._getMarkers(!0).map(t=>t.line).includes(0):!this._getMarkers(!0).includes(e)}scrollToPreviousMark(e=1,t=!1,i=!1){if(!this._terminal)return;t||(this._selectionStart=null);let n;const s=typeof this._currentMarker=="object"?this._getTargetScrollLine(this._terminal,this._currentMarker,e):Math.min(wi(this._terminal,this._currentMarker),this._terminal.buffer.active.baseY),o=this._terminal.buffer.active.viewportY;if(typeof this._currentMarker=="object"?!this._isMarkerInViewport(this._terminal,this._currentMarker):s!==o){const l=this._getMarkers(i).filter(c=>c.line>=o).length;n=this._getMarkers(i).length-l-1}else this._currentMarker===K.Bottom?n=this._getMarkers(i).length-1:this._currentMarker===K.Top?n=-1:this._isDisposable?(n=this._findPreviousMarker(this._terminal,i),this._currentMarker.dispose(),this._isDisposable=!1):i&&this._isEmptyCommand(this._currentMarker)?n=this._findPreviousMarker(this._terminal,!0):n=this._getMarkers(i).indexOf(this._currentMarker)-1;if(n<0){this._currentMarker=K.Top,this._terminal.scrollToTop(),this._resetNavigationDecorations();return}this._currentMarker=this._getMarkers(i)[n],this._scrollToMarker(this._currentMarker,e)}scrollToNextMark(e=1,t=!1,i=!0){if(!this._terminal)return;t||(this._selectionStart=null);let n;const s=typeof this._currentMarker=="object"?this._getTargetScrollLine(this._terminal,this._currentMarker,e):Math.min(wi(this._terminal,this._currentMarker),this._terminal.buffer.active.baseY),o=this._terminal.buffer.active.viewportY;if((typeof this._currentMarker=="object"?!this._isMarkerInViewport(this._terminal,this._currentMarker):s!==o)?n=this._getMarkers(i).filter(c=>c.line<=o).length:this._currentMarker===K.Bottom?n=this._getMarkers(i).length:this._currentMarker===K.Top?n=0:this._isDisposable?(n=this._findNextMarker(this._terminal,i),this._currentMarker.dispose(),this._isDisposable=!1):i&&this._isEmptyCommand(this._currentMarker)?n=this._findNextMarker(this._terminal,!0):n=this._getMarkers(i).indexOf(this._currentMarker)+1,n>=this._getMarkers(i).length){this._currentMarker=K.Bottom,this._terminal.scrollToBottom(),this._resetNavigationDecorations();return}this._currentMarker=this._getMarkers(i)[n],this._scrollToMarker(this._currentMarker,e)}_scrollToMarker(e,t,i,n){if(this._terminal){if(!this._isMarkerInViewport(this._terminal,e)){const s=this._getTargetScrollLine(this._terminal,e,t);this._terminal.scrollToLine(s)}n||this._registerTemporaryDecoration(e,i)}}_createMarkerForOffset(e,t){var i;if(t===0)return e;{const n=(i=this._terminal)==null?void 0:i.registerMarker(-this._terminal.buffer.active.cursorY+e.line-this._terminal.buffer.active.baseY+t);if(n)return n;throw new Error(`Could not register marker with offset ${e.line}, ${t}`)}}_registerTemporaryDecoration(e,t){var o;if(!this._terminal)return;this._resetNavigationDecorations();const i=this._themeService.getColorTheme().getColor(la),n=e.line,s=t?t.line-n+1:1;for(let l=0;l<s;l++){const c=this._terminal.registerDecoration({marker:this._createMarkerForOffset(e,l),width:this._terminal.cols,overviewRulerOptions:{color:(i==null?void 0:i.toString())||"#a0a0a0cc"}});if(c){(o=this._navigationDecorations)==null||o.push(c);let h;c.onRender(m=>{var p;h||(h=m,s>1?m.classList.add("terminal-scroll-highlight"):m.classList.add("terminal-scroll-highlight","terminal-scroll-highlight-outline"),(p=this._terminal)!=null&&p.element&&(m.style.marginLeft=`-${getComputedStyle(this._terminal.element).paddingLeft}`))}),c.onDispose(()=>{var m;this._navigationDecorations=(m=this._navigationDecorations)==null?void 0:m.filter(p=>p!==c)}),kt(350).then(()=>{h&&h.classList.remove("terminal-scroll-highlight-outline")})}}}_getTargetScrollLine(e,t,i){return i===1?Math.max(t.line-Math.floor(e.rows/4),0):t.line}_isMarkerInViewport(e,t){const i=e.buffer.active.viewportY;return t.line>=i&&t.line<i+e.rows}scrollToClosestMarker(e,t,i){const n=this._capabilities.get(4);if(!n)return;const s=n.getMark(e);if(!s)return;const o=t?n.getMark(t):s;this._scrollToMarker(s,0,o,!i)}selectToPreviousMark(){this._terminal&&(this._selectionStart===null&&(this._selectionStart=this._currentMarker),this._capabilities.has(2)?this.scrollToPreviousMark(1,!0,!0):this.scrollToPreviousMark(1,!0,!1),qi(this._terminal,this._currentMarker,this._selectionStart))}selectToNextMark(){this._terminal&&(this._selectionStart===null&&(this._selectionStart=this._currentMarker),this._capabilities.has(2)?this.scrollToNextMark(1,!0,!0):this.scrollToNextMark(1,!0,!1),qi(this._terminal,this._currentMarker,this._selectionStart))}selectToPreviousLine(){this._terminal&&(this._selectionStart===null&&(this._selectionStart=this._currentMarker),this.scrollToPreviousLine(this._terminal,1,!0),qi(this._terminal,this._currentMarker,this._selectionStart))}selectToNextLine(){this._terminal&&(this._selectionStart===null&&(this._selectionStart=this._currentMarker),this.scrollToNextLine(this._terminal,1,!0),qi(this._terminal,this._currentMarker,this._selectionStart))}scrollToPreviousLine(e,t=1,i=!1){if(i||(this._selectionStart=null),this._currentMarker===K.Top){e.scrollToTop();return}if(this._currentMarker===K.Bottom)this._currentMarker=this._registerMarkerOrThrow(e,this._getOffset(e)-1);else{const n=this._getOffset(e);this._isDisposable&&this._currentMarker.dispose(),this._currentMarker=this._registerMarkerOrThrow(e,n-1)}this._isDisposable=!0,this._scrollToMarker(this._currentMarker,t)}scrollToNextLine(e,t=1,i=!1){if(i||(this._selectionStart=null),this._currentMarker===K.Bottom){e.scrollToBottom();return}if(this._currentMarker===K.Top)this._currentMarker=this._registerMarkerOrThrow(e,this._getOffset(e)+1);else{const n=this._getOffset(e);this._isDisposable&&this._currentMarker.dispose(),this._currentMarker=this._registerMarkerOrThrow(e,n+1)}this._isDisposable=!0,this._scrollToMarker(this._currentMarker,t)}_registerMarkerOrThrow(e,t){const i=e.registerMarker(t);if(!i)throw new Error(`Could not create marker for ${t}`);return i}_getOffset(e){if(this._currentMarker===K.Bottom)return 0;if(this._currentMarker===K.Top)return 0-(e.buffer.active.baseY+e.buffer.active.cursorY);{let t=wi(e,this._currentMarker);return t-=e.buffer.active.baseY+e.buffer.active.cursorY,t}}_findPreviousMarker(e,t=!1){if(this._currentMarker===K.Top)return 0;if(this._currentMarker===K.Bottom)return this._getMarkers(t).length-1;let i;for(i=this._getMarkers(t).length-1;i>=0;i--)if(this._getMarkers(t)[i].line<this._currentMarker.line)return i;return-1}_findNextMarker(e,t=!1){if(this._currentMarker===K.Top)return 0;if(this._currentMarker===K.Bottom)return this._getMarkers(t).length-1;let i;for(i=0;i<this._getMarkers(t).length;i++)if(this._getMarkers(t)[i].line>this._currentMarker.line)return i;return this._getMarkers(t).length}};sr=b([d(1,he)],sr);function wi(r,e){return e===K.Bottom?r.buffer.active.baseY+r.rows-1:e===K.Top?0:e.line}function qi(r,e,t){t===null&&(t=K.Bottom);let i=wi(r,e),n=wi(r,t);if(i>n){const s=i;i=n,n=s}n-=1,r.selectLines(i,n)}let Li=class{get commands(){return this._commands}get executingCommand(){return this._currentCommand.command}get executingCommandObject(){if(this._currentCommand.commandStartMarker)return{marker:this._currentCommand.commandStartMarker}}get cwd(){return this._cwd}get _isInputting(){return!!(this._currentCommand.commandStartMarker&&!this._currentCommand.commandExecutedMarker)}get hasInput(){var e,t,i;if(!(!this._isInputting||!((e=this._currentCommand)!=null&&e.commandStartMarker))){if(this._terminal.buffer.active.baseY+this._terminal.buffer.active.cursorY===((t=this._currentCommand.commandStartMarker)==null?void 0:t.line)){const n=(i=this._terminal.buffer.active.getLine(this._terminal.buffer.active.cursorY))==null?void 0:i.translateToString(!0,this._currentCommand.commandStartX);return n===void 0?void 0:n.length>0}return!0}}constructor(e,t){this._terminal=e,this._logService=t,this.type=2,this._commands=[],this._currentCommand={},this._isWindowsPty=!1,this._commandMarkers=[],this.__isCommandStorageDisabled=!1,this._onCommandStarted=new v,this.onCommandStarted=this._onCommandStarted.event,this._onBeforeCommandFinished=new v,this.onBeforeCommandFinished=this._onBeforeCommandFinished.event,this._onCommandFinished=new v,this.onCommandFinished=this._onCommandFinished.event,this._onCommandExecuted=new v,this.onCommandExecuted=this._onCommandExecuted.event,this._onCommandInvalidated=new v,this.onCommandInvalidated=this._onCommandInvalidated.event,this._onCurrentCommandInvalidated=new v,this.onCurrentCommandInvalidated=this._onCurrentCommandInvalidated.event,this._dimensions={cols:this._terminal.cols,rows:this._terminal.rows},this._terminal.onResize(i=>this._handleResize(i)),this._terminal.onCursorMove(()=>this._handleCursorMove()),this._setupClearListeners()}_handleResize(e){this._isWindowsPty&&this._preHandleResizeWindows(e),this._dimensions.cols=e.cols,this._dimensions.rows=e.rows}_handleCursorMove(){this._terminal.buffer.active===this._terminal.buffer.normal&&this._currentCommand.commandStartMarker&&this._terminal.buffer.active.baseY+this._terminal.buffer.active.cursorY<this._currentCommand.commandStartMarker.line&&(this._clearCommandsInViewport(),this._currentCommand.isInvalid=!0,this._onCurrentCommandInvalidated.fire({reason:"windows"}))}_setupClearListeners(){this.onBeforeCommandFinished(e=>{this._isWindowsPty&&(e.command.trim().toLowerCase()==="clear"||e.command.trim().toLowerCase()==="cls")&&(this._clearCommandsInViewport(),this._currentCommand.isInvalid=!0,this._onCurrentCommandInvalidated.fire({reason:"windows"}))}),this._terminal.parser.registerCsiHandler({final:"J"},e=>(this._isWindowsPty||e.length>=1&&(e[0]===2||e[0]===3)&&this._clearCommandsInViewport(),!1))}_preHandleResizeWindows(e){const t=this._terminal.buffer.active.baseY,i=e.rows-this._dimensions.rows;i>0&&this._waitForCursorMove().then(()=>{const n=Math.min(i,t);for(let s=this.commands.length-1;s>=0;s--){const o=this.commands[s];if(!o.marker||o.marker.line<t||o.commandStartLineContent===void 0)break;const l=this._terminal.buffer.active.getLine(o.marker.line);if(!l||l.translateToString(!0)===o.commandStartLineContent)continue;const c=o.marker.line-n,h=this._terminal.buffer.active.getLine(c);(h==null?void 0:h.translateToString(!0))===o.commandStartLineContent&&this._terminal._core._bufferService.buffer.lines.onDeleteEmitter.fire({index:this._terminal.buffer.active.baseY,amount:n})}})}_clearCommandsInViewport(){var t;let e=0;for(let i=this._commands.length-1;i>=0;i--){const n=(t=this._commands[i].marker)==null?void 0:t.line;if(n&&n<this._terminal.buffer.active.baseY)break;e++}e>0&&this._onCommandInvalidated.fire(this._commands.splice(this._commands.length-e,e))}_waitForCursorMove(){const e=this._terminal.buffer.active.cursorX,t=this._terminal.buffer.active.cursorY;let i=0;return new Promise((n,s)=>{const o=setInterval(()=>{if(e!==this._terminal.buffer.active.cursorX||t!==this._terminal.buffer.active.cursorY){n(),clearInterval(o);return}i+=10,i>1e3&&(clearInterval(o),n())},10)})}setCwd(e){this._cwd=e}setIsWindowsPty(e){this._isWindowsPty=e}setIsCommandStorageDisabled(){this.__isCommandStorageDisabled=!0}getCwdForLine(e){var i,n;return this._currentCommand.promptStartMarker&&e>=((i=this._currentCommand.promptStartMarker)==null?void 0:i.line)?this._cwd:(n=[...this._commands].reverse().find(s=>s.marker.line<=e-1))==null?void 0:n.cwd}handlePromptStart(e){var t;this._currentCommand.promptStartMarker=(e==null?void 0:e.marker)||this._terminal.registerMarker(0),this._logService.debug("CommandDetectionCapability#handlePromptStart",this._terminal.buffer.active.cursorX,(t=this._currentCommand.promptStartMarker)==null?void 0:t.line)}handleContinuationStart(){this._currentCommand.currentContinuationMarker=this._terminal.registerMarker(0),this._logService.debug("CommandDetectionCapability#handleContinuationStart",this._currentCommand.currentContinuationMarker)}handleContinuationEnd(){if(!this._currentCommand.currentContinuationMarker){this._logService.warn("CommandDetectionCapability#handleContinuationEnd Received continuation end without start");return}this._currentCommand.continuations||(this._currentCommand.continuations=[]),this._currentCommand.continuations.push({marker:this._currentCommand.currentContinuationMarker,end:this._terminal.buffer.active.cursorX}),this._currentCommand.currentContinuationMarker=void 0,this._logService.debug("CommandDetectionCapability#handleContinuationEnd",this._currentCommand.continuations[this._currentCommand.continuations.length-1])}handleRightPromptStart(){this._currentCommand.commandRightPromptStartX=this._terminal.buffer.active.cursorX,this._logService.debug("CommandDetectionCapability#handleRightPromptStart",this._currentCommand.commandRightPromptStartX)}handleRightPromptEnd(){this._currentCommand.commandRightPromptEndX=this._terminal.buffer.active.cursorX,this._logService.debug("CommandDetectionCapability#handleRightPromptEnd",this._currentCommand.commandRightPromptEndX)}handleCommandStart(e){var t,i,n,s;if(this._handleCommandStartOptions=e,this._currentCommand.commandStartMarker=(e==null?void 0:e.marker)||this._currentCommand.commandStartMarker,((t=this._currentCommand.commandStartMarker)==null?void 0:t.line)===this._terminal.buffer.active.cursorY){this._currentCommand.commandStartX=this._terminal.buffer.active.cursorX,this._logService.debug("CommandDetectionCapability#handleCommandStart",this._currentCommand.commandStartX,(i=this._currentCommand.commandStartMarker)==null?void 0:i.line);return}if(this._isWindowsPty){this._handleCommandStartWindows();return}this._currentCommand.commandStartX=this._terminal.buffer.active.cursorX,this._currentCommand.commandStartMarker=(e==null?void 0:e.marker)||this._terminal.registerMarker(0),(n=this._currentCommand.commandExecutedMarker)==null||n.dispose(),this._currentCommand.commandExecutedMarker=void 0,this._currentCommand.commandExecutedX=void 0;for(const o of this._commandMarkers)o.dispose();this._commandMarkers.length=0,this._onCommandStarted.fire({marker:(e==null?void 0:e.marker)||this._currentCommand.commandStartMarker,markProperties:e==null?void 0:e.markProperties}),this._logService.debug("CommandDetectionCapability#handleCommandStart",this._currentCommand.commandStartX,(s=this._currentCommand.commandStartMarker)==null?void 0:s.line)}_handleCommandStartWindows(){this._currentCommand.commandStartX=this._terminal.buffer.active.cursorX,this._commandMarkers.length=0,kt(0).then(()=>{var e;if(this._currentCommand.commandExecutedMarker||(this._onCursorMoveListener=this._terminal.onCursorMove(()=>{if(this._commandMarkers.length===0||this._commandMarkers[this._commandMarkers.length-1].line!==this._terminal.buffer.active.cursorY){const t=this._terminal.registerMarker(0);t&&this._commandMarkers.push(t)}})),this._currentCommand.commandStartMarker=this._terminal.registerMarker(0),this._currentCommand.commandStartMarker){const t=this._terminal.buffer.active.getLine(this._currentCommand.commandStartMarker.line);t&&(this._currentCommand.commandStartLineContent=t.translateToString(!0))}this._onCommandStarted.fire({marker:this._currentCommand.commandStartMarker}),this._logService.debug("CommandDetectionCapability#_handleCommandStartWindows",this._currentCommand.commandStartX,(e=this._currentCommand.commandStartMarker)==null?void 0:e.line)})}handleGenericCommand(e){var t;(t=e==null?void 0:e.markProperties)!=null&&t.disableCommandStorage&&this.setIsCommandStorageDisabled(),this.handlePromptStart(e),this.handleCommandStart(e),this.handleCommandExecuted(e),this.handleCommandFinished(void 0,e)}handleCommandExecuted(e){var n,s,o,l;if(this._isWindowsPty){this._handleCommandExecutedWindows();return}if(this._currentCommand.commandExecutedMarker=(e==null?void 0:e.marker)||this._terminal.registerMarker(0),this._currentCommand.commandExecutedX=this._terminal.buffer.active.cursorX,this._logService.debug("CommandDetectionCapability#handleCommandExecuted",this._currentCommand.commandExecutedX,(n=this._currentCommand.commandExecutedMarker)==null?void 0:n.line),!this._currentCommand.commandStartMarker||!this._currentCommand.commandExecutedMarker||this._currentCommand.commandStartX===void 0)return;this._currentCommand.command=this.__isCommandStorageDisabled?"":(s=this._terminal.buffer.active.getLine(this._currentCommand.commandStartMarker.line))==null?void 0:s.translateToString(!0,this._currentCommand.commandStartX,this._currentCommand.commandRightPromptStartX).trim();let t=this._currentCommand.commandStartMarker.line+1;const i=this._currentCommand.commandExecutedMarker.line;for(;t<i;t++){const c=this._terminal.buffer.active.getLine(t);if(c){const h=(o=this._currentCommand.continuations)==null?void 0:o.find(p=>p.marker.line===t);h&&(this._currentCommand.command+=`
`);const m=(h==null?void 0:h.end)??0;this._currentCommand.command+=c.translateToString(!0,m)}}t===i&&(this._currentCommand.command+=((l=this._terminal.buffer.active.getLine(i))==null?void 0:l.translateToString(!0,void 0,this._currentCommand.commandExecutedX))||""),this._onCommandExecuted.fire()}_handleCommandExecutedWindows(){var e,t;(e=this._onCursorMoveListener)==null||e.dispose(),this._onCursorMoveListener=void 0,this._evaluateCommandMarkersWindows(),this._currentCommand.commandExecutedX=this._terminal.buffer.active.cursorX,this._onCommandExecuted.fire(),this._logService.debug("CommandDetectionCapability#handleCommandExecuted",this._currentCommand.commandExecutedX,(t=this._currentCommand.commandExecutedMarker)==null?void 0:t.line)}invalidateCurrentCommand(e){this._currentCommand.isInvalid=!0,this._onCurrentCommandInvalidated.fire(e)}handleCommandFinished(e,t){var n,s,o;this._isWindowsPty&&this._preHandleCommandFinishedWindows(),this._currentCommand.commandFinishedMarker=(t==null?void 0:t.marker)||this._terminal.registerMarker(0);let i=this._currentCommand.command;if(this._logService.debug("CommandDetectionCapability#handleCommandFinished",this._terminal.buffer.active.cursorX,(n=this._currentCommand.commandFinishedMarker)==null?void 0:n.line,this._currentCommand.command,this._currentCommand),this._exitCode=e,this._exitCode===void 0){const l=this.commands.length>0?this.commands[this.commands.length-1]:void 0;i&&i.length>0&&(l==null?void 0:l.command)===i&&(this._exitCode=l.exitCode)}if(!(this._currentCommand.commandStartMarker===void 0||!this._terminal.buffer.active)){if(this._exitCode===void 0&&i===void 0&&(i=""),i!==void 0&&!i.startsWith("\\")||(s=this._handleCommandStartOptions)!=null&&s.ignoreCommandLine){const l=this._terminal.buffer.active,c=Date.now(),h=this._currentCommand.commandExecutedMarker,m=this._currentCommand.commandFinishedMarker,p={command:(o=this._handleCommandStartOptions)!=null&&o.ignoreCommandLine?"":i||"",isTrusted:!!this._currentCommand.isTrusted,marker:this._currentCommand.commandStartMarker,endMarker:m,executedMarker:h,timestamp:c,cwd:this._cwd,exitCode:this._exitCode,commandStartLineContent:this._currentCommand.commandStartLineContent,hasOutput:()=>!(h!=null&&h.isDisposed)&&!(m!=null&&m.isDisposed)&&!!(h&&m&&(h==null?void 0:h.line)<m.line),getOutput:()=>Io(h,m,l),getOutputMatch:w=>ko(this._isWindowsPty&&(h==null?void 0:h.line)===(m==null?void 0:m.line)?this._currentCommand.commandStartMarker:h,m,l,this._terminal.cols,w),markProperties:t==null?void 0:t.markProperties};this._commands.push(p),this._logService.debug("CommandDetectionCapability#onCommandFinished",p),this._onBeforeCommandFinished.fire(p),this._currentCommand.isInvalid||this._onCommandFinished.fire(p)}this._currentCommand.previousCommandMarker=this._currentCommand.commandStartMarker,this._currentCommand={},this._handleCommandStartOptions=void 0}}_preHandleCommandFinishedWindows(){this._currentCommand.commandExecutedMarker||(this._commandMarkers.length===0&&(this._currentCommand.commandStartMarker||(this._currentCommand.commandStartMarker=this._terminal.registerMarker(0)),this._currentCommand.commandStartMarker&&this._commandMarkers.push(this._currentCommand.commandStartMarker)),this._evaluateCommandMarkersWindows())}_evaluateCommandMarkersWindows(){if(this._commandMarkers.length!==0){if(this._commandMarkers=this._commandMarkers.sort((e,t)=>e.line-t.line),this._currentCommand.commandStartMarker=this._commandMarkers[0],this._currentCommand.commandStartMarker){const e=this._terminal.buffer.active.getLine(this._currentCommand.commandStartMarker.line);e&&(this._currentCommand.commandStartLineContent=e.translateToString(!0))}this._currentCommand.commandExecutedMarker=this._commandMarkers[this._commandMarkers.length-1]}}setCommandLine(e,t){this._logService.debug("CommandDetectionCapability#setCommandLine",e,t),this._currentCommand.command=e,this._currentCommand.isTrusted=t}serialize(){const e=this.commands.map(t=>{var i,n,s;return{startLine:(i=t.marker)==null?void 0:i.line,startX:void 0,endLine:(n=t.endMarker)==null?void 0:n.line,executedLine:(s=t.executedMarker)==null?void 0:s.line,command:this.__isCommandStorageDisabled?"":t.command,isTrusted:t.isTrusted,cwd:t.cwd,exitCode:t.exitCode,commandStartLineContent:t.commandStartLineContent,timestamp:t.timestamp,markProperties:t.markProperties,aliases:t.aliases}});return this._currentCommand.commandStartMarker&&e.push({startLine:this._currentCommand.commandStartMarker.line,startX:this._currentCommand.commandStartX,endLine:void 0,executedLine:void 0,command:"",isTrusted:!0,cwd:this._cwd,exitCode:void 0,commandStartLineContent:void 0,timestamp:0,markProperties:void 0}),{isWindowsPty:this._isWindowsPty,commands:e}}deserialize(e){e.isWindowsPty&&this.setIsWindowsPty(e.isWindowsPty);const t=this._terminal.buffer.normal;for(const i of e.commands){const n=i.startLine!==void 0?this._terminal.registerMarker(i.startLine-(t.baseY+t.cursorY)):void 0;if(!n)continue;if(!i.endLine){this._currentCommand.commandStartMarker=n,this._currentCommand.commandStartX=i.startX,this._cwd=i.cwd,this._onCommandStarted.fire({marker:n});continue}const s=i.endLine!==void 0?this._terminal.registerMarker(i.endLine-(t.baseY+t.cursorY)):void 0,o=i.executedLine!==void 0?this._terminal.registerMarker(i.executedLine-(t.baseY+t.cursorY)):void 0,l={command:this.__isCommandStorageDisabled?"":i.command,isTrusted:i.isTrusted,marker:n,endMarker:s,executedMarker:o,timestamp:i.timestamp,cwd:i.cwd,commandStartLineContent:i.commandStartLineContent,exitCode:i.exitCode,hasOutput:()=>!(o!=null&&o.isDisposed)&&!(s!=null&&s.isDisposed)&&!!(o&&s&&o.line<s.line),getOutput:()=>Io(o,s,t),getOutputMatch:c=>ko(this._isWindowsPty&&(o==null?void 0:o.line)===(s==null?void 0:s.line)?n:o,s,t,this._terminal.cols,c),markProperties:i.markProperties,wasReplayed:!0};this._commands.push(l),this._logService.debug("CommandDetectionCapability#onCommandFinished",l),this._onCommandFinished.fire(l)}}};Li.__decorator=b([Ve(500)],Li.prototype,"_handleCursorMove",null);Li=b([d(1,Je)],Li);function Io(r,e,t){if(!r||!e)return;const i=r.line,n=e.line;if(i===n)return;let s="",o;for(let l=i;l<n;l++)o=t.getLine(l),o&&(s+=o.translateToString(!o.isWrapped)+(o.isWrapped?"":`
`));return s===""?void 0:s}function ko(r,e,t,i,n){var p,w;if(!r||!e)return;const s=e.line;if(s===-1)return;const o=Math.max(r.line,0),l=n.lineMatcher,c=typeof l=="string"?1:n.length||Ld(l),h=[];let m;if(n.anchor==="bottom")for(let f=s-(n.offset||0);f>=o;f--){let _=f;const S=f;for(;_>=o&&((p=t.getLine(_))!=null&&p.isWrapped);)_--;if(f=_,h.unshift(To(t,_,S,i)),m||(m=h[0].match(l)),h.length>=c)break}else for(let f=o+(n.offset||0);f<s;f++){const _=f;let S=f;for(;S+1<s&&((w=t.getLine(S+1))!=null&&w.isWrapped);)S++;if(f=S,h.push(To(t,_,S,i)),m||(m=h[h.length-1].match(l)),h.length>=c)break}return m?{regexMatch:m,outputLines:h}:void 0}function To(r,e,t,i){const n=Math.max(2048/i*2);t=Math.min(t,e+n);let s="";for(let o=e;o<=t;o++){const l=r.getLine(o);l&&(s+=l.translateToString(!0,0,i))}return s}function Ld(r){if(!r.multiline)return 1;const e=r.source;let t=1,i=e.indexOf("\\n");for(;i!==-1;)t++,i=e.indexOf("\\n",i+1);return t}class Md{constructor(){this.type=0,this._cwd="",this._cwds=new Map,this._onDidChangeCwd=new v,this.onDidChangeCwd=this._onDidChangeCwd.event}get cwds(){return Array.from(this._cwds.keys())}getCwd(){return this._cwd}updateCwd(e){const t=this._cwd!==e;this._cwd=e;const i=this._cwds.get(this._cwd)||0;this._cwds.delete(this._cwd),this._cwds.set(this._cwd,i+1),t&&this._onDidChangeCwd.fire(e)}}class Rd{get commands(){return this._commands}constructor(e){this._terminal=e,this.type=3,this._commands=[],this._onCommandFinished=new v,this.onCommandFinished=this._onCommandFinished.event,this._terminal.onData(t=>this._onData(t)),this._terminal.parser.registerCsiHandler({final:"J"},t=>(t.length>=1&&(t[0]===2||t[0]===3)&&this._clearCommandsInViewport(),!1))}_onData(e){e==="\r"&&this._onEnter()}_onEnter(){if(this._terminal&&this._terminal.buffer.active.cursorX>=2){const e=this._terminal.registerMarker(0);e&&(this._commands.push(e),this._onCommandFinished.fire(e))}}_clearCommandsInViewport(){let e=0;for(let t=this._commands.length-1;t>=0&&!(this._commands[t].line<this._terminal.buffer.active.baseY);t--)e++;this._commands.splice(this._commands.length-e,e)}}class Wd{constructor(e){this._terminal=e,this.type=4,this._idToMarkerMap=new Map,this._anonymousMarkers=new Map,this._onMarkAdded=new v,this.onMarkAdded=this._onMarkAdded.event}*markers(){for(const e of this._idToMarkerMap.values())yield e;for(const e of this._anonymousMarkers.values())yield e}addMark(e){const t=(e==null?void 0:e.marker)||this._terminal.registerMarker(),i=e==null?void 0:e.id;t&&(i?(this._idToMarkerMap.set(i,t),t.onDispose(()=>this._idToMarkerMap.delete(i))):(this._anonymousMarkers.set(t.id,t),t.onDispose(()=>this._anonymousMarkers.delete(t.id))),this._onMarkAdded.fire({marker:t,id:i,hidden:e==null?void 0:e.hidden,hoverMessage:e==null?void 0:e.hoverMessage}))}getMark(e){return this._idToMarkerMap.get(e)}}let rr=class extends q{get status(){return this._status}constructor(e,t,i,n){super(),this._nonce=e,this._disableTelemetry=t,this._telemetryService=i,this._logService=n,this.capabilities=new Ha,this._hasUpdatedTelemetry=!1,this._commonProtocolDisposables=[],this._status=0,this._onDidChangeStatus=new v,this.onDidChangeStatus=this._onDidChangeStatus.event,this._register(we(()=>{this._clearActivationTimeout(),this._disposeCommonProtocol()}))}_disposeCommonProtocol(){J(this._commonProtocolDisposables),this._commonProtocolDisposables.length=0}activate(e){this._terminal=e,this.capabilities.add(3,new Rd(this._terminal)),this._register(e.parser.registerOscHandler(633,t=>this._handleVSCodeSequence(t))),this._register(e.parser.registerOscHandler(1337,t=>this._doHandleITermSequence(t))),this._commonProtocolDisposables.push(e.parser.registerOscHandler(133,t=>this._handleFinalTermSequence(t))),this._register(e.parser.registerOscHandler(7,t=>this._doHandleSetCwd(t))),this._register(e.parser.registerOscHandler(9,t=>this._doHandleSetWindowsFriendlyCwd(t))),this._ensureCapabilitiesOrAddFailureTelemetry()}_handleFinalTermSequence(e){const t=this._doHandleFinalTermSequence(e);return this._status===0&&(this._status=1,this._onDidChangeStatus.fire(this._status)),t}_doHandleFinalTermSequence(e){if(!this._terminal)return!1;const[t,...i]=e.split(";");switch(t){case"A":return this._createOrGetCommandDetection(this._terminal).handlePromptStart(),!0;case"B":return this._createOrGetCommandDetection(this._terminal).handleCommandStart({ignoreCommandLine:!0}),!0;case"C":return this._createOrGetCommandDetection(this._terminal).handleCommandExecuted(),!0;case"D":{const n=i.length===1?parseInt(i[0]):void 0;return this._createOrGetCommandDetection(this._terminal).handleCommandFinished(n),!0}}return!1}_handleVSCodeSequence(e){var i;const t=this._doHandleVSCodeSequence(e);return!this._hasUpdatedTelemetry&&t&&((i=this._telemetryService)==null||i.publicLog2("terminal/shellIntegrationActivationSucceeded"),this._hasUpdatedTelemetry=!0,this._clearActivationTimeout()),this._status!==2&&(this._status=2,this._onDidChangeStatus.fire(this._status)),t}async _ensureCapabilitiesOrAddFailureTelemetry(){!this._telemetryService||this._disableTelemetry||(this._activationTimeout=setTimeout(()=>{var e;!this.capabilities.get(2)&&!this.capabilities.get(0)&&((e=this._telemetryService)==null||e.publicLog2("terminal/shellIntegrationActivationTimeout"),this._logService.warn("Shell integration failed to add capabilities within 10 seconds")),this._hasUpdatedTelemetry=!0},1e4))}_clearActivationTimeout(){this._activationTimeout!==void 0&&(clearTimeout(this._activationTimeout),this._activationTimeout=void 0)}_doHandleVSCodeSequence(e){var s;if(!this._terminal)return!1;const t=e.indexOf(";"),i=t===-1?e:e.substring(0,t),n=t===-1?[]:e.substring(t+1).split(";");switch(i){case"A":return this._createOrGetCommandDetection(this._terminal).handlePromptStart(),!0;case"B":return this._createOrGetCommandDetection(this._terminal).handleCommandStart(),!0;case"C":return this._createOrGetCommandDetection(this._terminal).handleCommandExecuted(),!0;case"D":{const o=n[0],l=o!==void 0?parseInt(o):void 0;return this._createOrGetCommandDetection(this._terminal).handleCommandFinished(l),!0}case"E":{const o=n[0],l=n[1];let c;return o!==void 0?c=Do(o):c="",this._createOrGetCommandDetection(this._terminal).setCommandLine(c,l===this._nonce),!0}case"F":return this._createOrGetCommandDetection(this._terminal).handleContinuationStart(),!0;case"G":return this._createOrGetCommandDetection(this._terminal).handleContinuationEnd(),!0;case"H":return this._createOrGetCommandDetection(this._terminal).handleRightPromptStart(),!0;case"I":return this._createOrGetCommandDetection(this._terminal).handleRightPromptEnd(),!0;case"P":{const o=n[0],l=o!==void 0?Do(o):"",{key:c,value:h}=Po(l);if(h===void 0)return!0;switch(c){case"Cwd":return this._updateCwd(h),!0;case"IsWindows":return this._createOrGetCommandDetection(this._terminal).setIsWindowsPty(h==="True"),!0;case"Task":return this._createOrGetBufferMarkDetection(this._terminal),(s=this.capabilities.get(2))==null||s.setIsCommandStorageDisabled(),!0}}case"SetMark":return this._createOrGetBufferMarkDetection(this._terminal).addMark(Fd(n)),!0}return!1}_updateCwd(e){e=Zs(e),this._createOrGetCwdDetection().updateCwd(e);const t=this.capabilities.get(2);t==null||t.setCwd(e)}_doHandleITermSequence(e){if(!this._terminal)return!1;const[t]=e.split(";");switch(t){case"SetMark":this._createOrGetBufferMarkDetection(this._terminal).addMark();default:{const{key:i,value:n}=Po(t);if(n===void 0)return!0;switch(i){case"CurrentDir":return this._updateCwd(n),!0}}}return!1}_doHandleSetWindowsFriendlyCwd(e){if(!this._terminal)return!1;const[t,...i]=e.split(";");switch(t){case"9":return i.length&&this._updateCwd(i[0]),!0}return!1}_doHandleSetCwd(e){if(!this._terminal)return!1;const[t]=e.split(";");if(t.match(/^file:\/\/.*\//)){const i=M.parse(t);if(i.path&&i.path.length>0)return this._updateCwd(i.path),!0}return!1}serialize(){return!this._terminal||!this.capabilities.has(2)?{isWindowsPty:!1,commands:[]}:this._createOrGetCommandDetection(this._terminal).serialize()}deserialize(e){if(!this._terminal)throw new Error("Cannot restore commands before addon is activated");this._createOrGetCommandDetection(this._terminal).deserialize(e)}_createOrGetCwdDetection(){let e=this.capabilities.get(0);return e||(e=new Md,this.capabilities.add(0,e)),e}_createOrGetCommandDetection(e){let t=this.capabilities.get(2);return t||(t=new Li(e,this._logService),this.capabilities.add(2,t)),t}_createOrGetBufferMarkDetection(e){let t=this.capabilities.get(4);return t||(t=new Wd(e),this.capabilities.add(4,t)),t}};rr=b([d(3,Je)],rr);function Do(r){return r.replaceAll(/\\(\\|x([0-9a-f]{2}))/gi,(e,t,i)=>i?String.fromCharCode(parseInt(i,16)):t)}function Po(r){const e=r.indexOf("=");return e===-1?{key:r,value:void 0}:{key:r.substring(0,e),value:r.substring(1+e)}}function Fd(r){let e,t=!1;for(const i of r)i!==void 0&&(i==="Hidden"&&(t=!0),i.startsWith("Id=")&&(e=i.substring(3)));return{id:e,hidden:t}}let or=class extends q{constructor(e,t,i){super(),this._hoverService=e,this._contextMenuVisible=!1,this._register(i.onDidShowContextMenu(()=>this._contextMenuVisible=!0)),this._register(i.onDidHideContextMenu(()=>this._contextMenuVisible=!1)),this._hoverDelayer=this._register(new qn(t.getValue("workbench.hover.delay")))}hideHover(){this._hoverDelayer.cancel(),this._hoverService.hideHover()}createHover(e,t,i){return Zl(V(e,ye.MOUSE_ENTER,()=>{this._contextMenuVisible||this._hoverDelayer.trigger(()=>{var s,o;let n=`${a("terminalPromptContextMenu","Show Command Actions")}`;if(n+=`

---

`,t)if(t.markProperties||i)if((s=t.markProperties)!=null&&s.hoverMessage||i)n=((o=t.markProperties)==null?void 0:o.hoverMessage)||i||"";else return;else t.exitCode?t.exitCode===-1?n+=a("terminalPromptCommandFailed","Command executed {0} and failed",pi(t.timestamp,!0)):n+=a("terminalPromptCommandFailedWithExitCode","Command executed {0} and failed (Exit Code {1})",pi(t.timestamp,!0),t.exitCode):n+=a("terminalPromptCommandSuccess","Command executed {0}",pi(t.timestamp,!0));else if(i)n=i;else return;this._hoverService.showHover({content:new N(n),target:e})})}),V(e,ye.MOUSE_LEAVE,()=>this.hideHover()),V(e,ye.MOUSE_OUT,()=>this.hideHover()))}};or=b([d(0,Yn),d(1,Z),d(2,Wt)],or);function os(r,e){if(!e)return;const t=r.inspect("terminal.integrated.fontSize").value,i=r.inspect("terminal.integrated.fontSize").defaultValue,n=r.inspect("terminal.integrated.lineHeight").value;if(typeof t=="number"&&typeof i=="number"&&typeof n=="number"){const s=t/i<=1?t/i:1;e.style.width=`${s*16}px`,e.style.height=`${s*16*n}px`,e.style.fontSize=`${s*16}px`,e.style.marginLeft=`${s*-17}px`}}let ar=class extends q{constructor(e,t,i,n,s,o,l,c,h,m,p,w){super(),this._capabilities=e,this._clipboardService=t,this._contextMenuService=i,this._configurationService=n,this._themeService=s,this._openerService=o,this._quickInputService=l,this._commandService=h,this._audioCueService=p,this._notificationService=w,this._capabilityDisposables=new Map,this._decorations=new Map,this._onDidRequestRunCommand=this._register(new v),this.onDidRequestRunCommand=this._onDidRequestRunCommand.event,this._register(we(()=>this._dispose())),this._register(this._configurationService.onDidChangeConfiguration(f=>{f.affectsConfiguration("terminal.integrated.fontSize")||f.affectsConfiguration("terminal.integrated.lineHeight")?this.refreshLayouts():f.affectsConfiguration("workbench.colorCustomizations")?this._refreshStyles(!0):f.affectsConfiguration("terminal.integrated.shellIntegration.decorationsEnabled")&&(this._removeCapabilityDisposables(2),this._updateDecorationVisibility())})),this._register(this._themeService.onDidColorThemeChange(()=>this._refreshStyles(!0))),this._updateDecorationVisibility(),this._register(this._capabilities.onDidAddCapability(f=>this._createCapabilityDisposables(f))),this._register(this._capabilities.onDidRemoveCapability(f=>this._removeCapabilityDisposables(f))),this._register(c.onWillShutdown(()=>this._disposeAllDecorations())),this._terminalDecorationHoverService=m.createInstance(or)}_removeCapabilityDisposables(e){const t=this._capabilityDisposables.get(e);t&&J(t),this._capabilityDisposables.delete(e)}_createCapabilityDisposables(e){let t=[];const i=this._capabilities.get(e);if(!(!i||this._capabilityDisposables.has(e))){switch(i.type){case 4:t=[i.onMarkAdded(n=>this.registerMarkDecoration(n))];break;case 2:t=this._getCommandDetectionListeners(i);break}this._capabilityDisposables.set(e,t)}}registerMarkDecoration(e){if(!(!this._terminal||!this._showGutterDecorations&&!this._showOverviewRulerDecorations)&&!e.hidden)return this.registerCommandDecoration(void 0,void 0,e)}_updateDecorationVisibility(){var i;const e=this._configurationService.getValue("terminal.integrated.shellIntegration.decorationsEnabled");this._showGutterDecorations=e==="both"||e==="gutter",this._showOverviewRulerDecorations=e==="both"||e==="overviewRuler",this._disposeAllDecorations(),(this._showGutterDecorations||this._showOverviewRulerDecorations)&&(this._attachToCommandCapability(),this._updateGutterDecorationVisibility());const t=(i=this._capabilities.get(2))==null?void 0:i.executingCommandObject;t&&this.registerCommandDecoration(t,!0)}_disposeAllDecorations(){var e;(e=this._placeholderDecoration)==null||e.dispose();for(const t of this._decorations.values())t.decoration.dispose(),J(t.disposables)}_updateGutterDecorationVisibility(){const e=document.querySelectorAll("terminal-command-decoration");for(const t of e)this._updateCommandDecorationVisibility(t)}_updateCommandDecorationVisibility(e){this._showGutterDecorations?e.classList.remove("hide"):e.classList.add("hide")}refreshLayouts(){var e;os(this._configurationService,(e=this._placeholderDecoration)==null?void 0:e.element);for(const t of this._decorations)os(this._configurationService,t[1].decoration.element)}_refreshStyles(e){var t,i,n;if(e)for(const s of this._decorations.values()){const o=((t=this._getDecorationCssColor(s))==null?void 0:t.toString())??"";(i=s.decoration.options)!=null&&i.overviewRulerOptions?s.decoration.options.overviewRulerOptions.color=o:s.decoration.options&&(s.decoration.options.overviewRulerOptions={color:o})}this._updateClasses((n=this._placeholderDecoration)==null?void 0:n.element);for(const s of this._decorations.values())this._updateClasses(s.decoration.element,s.exitCode,s.markProperties)}_dispose(){this._terminalDecorationHoverService.dispose();for(const e of this._capabilityDisposables.values())J(e);this.clearDecorations()}_clearPlaceholder(){var e;(e=this._placeholderDecoration)==null||e.dispose(),this._placeholderDecoration=void 0}clearDecorations(){var e;(e=this._placeholderDecoration)==null||e.marker.dispose(),this._clearPlaceholder(),this._disposeAllDecorations(),this._decorations.clear()}_attachToCommandCapability(){this._capabilities.has(2)&&this._getCommandDetectionListeners(this._capabilities.get(2))}_getCommandDetectionListeners(e){var i;if(this._capabilityDisposables.has(2)){const n=this._capabilityDisposables.get(2);J(n),this._capabilityDisposables.delete(e.type)}const t=[];(i=e.executingCommandObject)!=null&&i.marker&&this.registerCommandDecoration(e.executingCommandObject,!0),t.push(e.onCommandStarted(n=>this.registerCommandDecoration(n,!0)));for(const n of e.commands)this.registerCommandDecoration(n);return t.push(e.onCommandFinished(n=>{this.registerCommandDecoration(n),n.exitCode&&this._audioCueService.playAudioCue(ha.terminalCommandFailed)})),t.push(e.onCommandInvalidated(n=>{var s;for(const o of n){const l=(s=o.marker)==null?void 0:s.id;if(l){const c=this._decorations.get(l);c&&(c.decoration.dispose(),J(c.disposables))}}})),t.push(e.onCurrentCommandInvalidated(n=>{if(n.reason==="noProblemsReported"){const s=Array.from(this._decorations.entries())[this._decorations.size-1];s==null||s[1].decoration.dispose()}else n.reason==="windows"&&this._clearPlaceholder()})),t}activate(e){this._terminal=e,this._attachToCommandCapability()}registerCommandDecoration(e,t,i){var l;if(!this._terminal||t&&!e||!this._showGutterDecorations&&!this._showOverviewRulerDecorations)return;const n=(e==null?void 0:e.marker)||(i==null?void 0:i.marker);if(!n)throw new Error(`cannot add a decoration for a command ${JSON.stringify(e)} with no marker`);this._clearPlaceholder();const s=((l=this._getDecorationCssColor(e))==null?void 0:l.toString())??"",o=this._terminal.registerDecoration({marker:n,overviewRulerOptions:this._showOverviewRulerDecorations?t?{color:s,position:"left"}:{color:s,position:e!=null&&e.exitCode?"right":"left"}:void 0});if(o)return t&&(this._placeholderDecoration=o),o.onRender(c=>{var h;c.classList.contains(".xterm-decoration-overview-ruler")||(this._decorations.get(o.marker.id)||(o.onDispose(()=>this._decorations.delete(o.marker.id)),this._decorations.set(o.marker.id,{decoration:o,disposables:this._createDisposables(c,e,i),exitCode:e==null?void 0:e.exitCode,markProperties:e==null?void 0:e.markProperties})),(!c.classList.contains("codicon")||((h=e==null?void 0:e.marker)==null?void 0:h.line)===0)&&(os(this._configurationService,c),this._updateClasses(c,e==null?void 0:e.exitCode,(e==null?void 0:e.markProperties)||i)))}),o}_createDisposables(e,t,i){return(t==null?void 0:t.exitCode)===void 0&&!(t!=null&&t.markProperties)?[]:t!=null&&t.markProperties||i?[this._terminalDecorationHoverService.createHover(e,t||i,i==null?void 0:i.hoverMessage)]:[this._createContextMenu(e,t),this._terminalDecorationHoverService.createHover(e,t)]}_updateClasses(e,t,i){if(e){for(const n of e.classList)e.classList.remove(n);e.classList.add("terminal-command-decoration","codicon","xterm-decoration"),i?(e.classList.add("default-color",...L.asClassNameArray(Vh)),i.hoverMessage||e.classList.add("default")):(this._updateCommandDecorationVisibility(e),t===void 0?(e.classList.add("default-color","default"),e.classList.add(...L.asClassNameArray(Hh))):t?(e.classList.add("error"),e.classList.add(...L.asClassNameArray(Gh))):e.classList.add(...L.asClassNameArray($h)))}}_createContextMenu(e,t){return V(e,ye.CLICK,async()=>{this._terminalDecorationHoverService.hideHover();const i=await this._getCommandActions(t);this._contextMenuService.showContextMenu({getAnchor:()=>e,getActions:()=>i})})}async _getCommandActions(e){const t=[];if(e.command!==""){const l=a("terminal.rerunCommand","Rerun Command");t.push({class:void 0,tooltip:l,id:"terminal.rerunCommand",label:l,enabled:!0,run:async()=>{e.command!==""&&(!e.isTrusted&&!await new Promise(m=>{this._notificationService.prompt(ie.Info,a("rerun","Do you want to run the command: {0}",e.command),[{label:a("yes","Yes"),run:()=>m(!0)},{label:a("no","No"),run:()=>m(!1)}])})||this._onDidRequestRunCommand.fire({command:e}))}});const c=a("terminal.copyCommand","Copy Command");t.push({class:void 0,tooltip:c,id:"terminal.copyCommand",label:c,enabled:!0,run:()=>this._clipboardService.writeText(e.command)})}if(e.hasOutput()){t.length>0&&t.push(new Ct);const l=a("terminal.copyOutput","Copy Output");t.push({class:void 0,tooltip:l,id:"terminal.copyOutput",label:l,enabled:!0,run:()=>{const h=e.getOutput();typeof h=="string"&&this._clipboardService.writeText(h)}});const c=a("terminal.copyOutputAsHtml","Copy Output as HTML");t.push({class:void 0,tooltip:c,id:"terminal.copyOutputAsHtml",label:c,enabled:!0,run:()=>this._onDidRequestRunCommand.fire({command:e,copyAsHtml:!0})})}t.length>0&&t.push(new Ct);const i=a("workbench.action.terminal.runRecentCommand","Run Recent Command");t.push({class:void 0,tooltip:i,id:"workbench.action.terminal.runRecentCommand",label:i,enabled:!0,run:()=>this._commandService.executeCommand("workbench.action.terminal.runRecentCommand")});const n=a("workbench.action.terminal.goToRecentDirectory","Go To Recent Directory");t.push({class:void 0,tooltip:i,id:"workbench.action.terminal.goToRecentDirectory",label:n,enabled:!0,run:()=>this._commandService.executeCommand("workbench.action.terminal.goToRecentDirectory")}),t.push(new Ct);const s=a("terminal.configureCommandDecorations","Configure Command Decorations");t.push({class:void 0,tooltip:s,id:"terminal.configureCommandDecorations",label:s,enabled:!0,run:()=>this._showConfigureCommandDecorationsQuickPick()});const o=a("terminal.learnShellIntegration","Learn About Shell Integration");return t.push({class:void 0,tooltip:o,id:"terminal.learnShellIntegration",label:o,enabled:!0,run:()=>this._openerService.open("https://code.visualstudio.com/docs/terminal/shell-integration")}),t}async _showConfigureCommandDecorationsQuickPick(){const e=this._quickInputService.createQuickPick();e.items=[{id:"a",label:a("toggleVisibility","Toggle visibility")}],e.canSelectMany=!1,e.onDidAccept(async t=>{switch(e.hide(),e.activeItems[0].id){case"a":this._showToggleVisibilityQuickPick();break}}),e.show()}_showToggleVisibilityQuickPick(){const e=this._quickInputService.createQuickPick();e.hideInput=!0,e.hideCheckAll=!0,e.canSelectMany=!0,e.title=a("toggleVisibility","Toggle visibility");const t=this._configurationService.getValue("terminal.integrated.shellIntegration.decorationsEnabled"),i={label:a("gutter","Gutter command decorations"),picked:t!=="never"&&t!=="overviewRuler"},n={label:a("overviewRuler","Overview ruler command decorations"),picked:t!=="never"&&t!=="gutter"};e.items=[i,n];const s=[];t!=="never"&&(t!=="gutter"&&s.push(i),t!=="overviewRuler"&&s.push(n)),e.selectedItems=s,e.onDidChangeSelection(async o=>{let l="never";o.includes(i)?o.includes(n)?l="both":l="gutter":o.includes(n)&&(l="overviewRuler"),await this._configurationService.updateValue("terminal.integrated.shellIntegration.decorationsEnabled",l)}),e.ok=!1,e.show()}_getDecorationCssColor(e){var i;let t;return(e==null?void 0:e.exitCode)===void 0?t=ic:t=e.exitCode?ec:tc,(i=this._themeService.getColorTheme().getColor(t))==null?void 0:i.toString()}};ar=b([d(1,Ar),d(2,Wt),d(3,Z),d(4,he),d(5,Ri),d(6,me),d(7,jn),d(8,ue),d(9,O),d(10,ca),d(11,ee)],ar);class as{constructor(e){this.completion=e,this.score=ys.Default,this.distance=0,this.labelLow=this.completion.label.toLowerCase()}}class ls{constructor(e,t){this.leadingLineContent=e,this.characterCountDelta=t}}class Eo{constructor(e,t,i,n){this._items=e,this._lineContext=t,this.replacementIndex=i,this.replacementLength=n,this._refilterKind=1,this._fuzzyScoreOptions=nc.default,this._options={}}get items(){return this._ensureCachedState(),this._filteredItems}get stats(){return this._ensureCachedState(),this._stats}get lineContext(){return this._lineContext}set lineContext(e){(this._lineContext.leadingLineContent!==e.leadingLineContent||this._lineContext.characterCountDelta!==e.characterCountDelta)&&(this._refilterKind=this._lineContext.characterCountDelta<e.characterCountDelta&&this._filteredItems?2:1,this._lineContext=e)}_ensureCachedState(){this._refilterKind!==0&&this._createCachedState()}_createCachedState(){const e=[],{leadingLineContent:t,characterCountDelta:i}=this._lineContext;let n="",s="";const o=this._refilterKind===1?this._items:this._filteredItems,l=[],c=!this._options.filterGraceful||o.length>2e3?sc:rc;for(let h=0;h<o.length;h++){const m=o[h],p=this.replacementLength,w=p+i;if(n.length!==w&&(n=w===0?"":t.slice(-w),s=n.toLowerCase()),m.word=n,w===0)m.score=ys.Default;else{let f=0;for(;f<p;){const _=n.charCodeAt(f);if(_===32||_===9)f+=1;else break}if(f>=w)m.score=ys.Default;else{const _=c(n,s,f,m.completion.label,m.labelLow,0,this._fuzzyScoreOptions);if(!_)continue;m.score=_}}m.idx=h,m.distance=1,l.push(m),e.push(m.completion.label.length)}this._filteredItems=l,this._refilterKind=0,this._stats={pLabelLen:e.length?oc(e.length-.85,e,(h,m)=>h-m):0}}}var Od='.workbench-suggest-widget{display:flex;flex-direction:column;left:0;position:absolute;top:0;width:430px;z-index:40}.workbench-suggest-widget.message{align-items:center;flex-direction:row}.monaco-workbench .workbench-suggest-details,.workbench-suggest-widget{background-color:var(--vscode-editorSuggestWidget-background);border-color:var(--vscode-editorSuggestWidget-border);border-style:solid;border-width:1px;flex:0 1 auto;width:100%}.monaco-workbench.hc-black .workbench-suggest-details,.monaco-workbench.hc-black .workbench-suggest-widget,.monaco-workbench.hc-light .workbench-suggest-details,.monaco-workbench.hc-light .workbench-suggest-widget{border-width:2px}.monaco-workbench .workbench-suggest-widget.with-status-bar .suggest-status-bar{display:flex}.monaco-workbench .workbench-suggest-widget .suggest-status-bar .left{padding-right:8px}.monaco-workbench .workbench-suggest-widget.with-status-bar .suggest-status-bar .action-label{color:var(--vscode-editorSuggestWidgetStatus-foreground)}.monaco-workbench .workbench-suggest-widget.with-status-bar .suggest-status-bar .action-item:not(:last-of-type) .action-label{margin-right:0}.monaco-workbench .workbench-suggest-widget.with-status-bar .suggest-status-bar .action-item:not(:last-of-type) .action-label:after{content:", ";margin-right:.3em}.monaco-workbench .workbench-suggest-widget.with-status-bar .monaco-list .monaco-list-row.focused.string-label>.contents>.main>.right>.readMore,.monaco-workbench .workbench-suggest-widget.with-status-bar .monaco-list .monaco-list-row>.contents>.main>.right>.readMore{display:none}.workbench-suggest-widget .monaco-list .monaco-list-row{background-position:2px 2px;background-repeat:no-repeat;-mox-box-sizing:border-box;box-sizing:border-box;cursor:pointer;display:flex;padding-right:10px;touch-action:none;white-space:nowrap}.workbench-suggest-widget .monaco-list .monaco-list-row.focused{color:var(--vscode-editorSuggestWidget-selectedForeground)}.workbench-suggest-widget .monaco-list .monaco-list-row.focused .codicon{color:var(--vscode-editorSuggestWidget-selectedIconForeground)}.workbench-suggest-widget .monaco-list .monaco-list-row>.contents{flex:1;height:100%;overflow:hidden;padding-left:2px}.workbench-suggest-widget .monaco-list .monaco-list-row>.contents>.main{display:flex;justify-content:space-between;overflow:hidden;text-overflow:ellipsis;white-space:pre}.workbench-suggest-widget .monaco-list .monaco-list-row>.contents>.main>.left,.workbench-suggest-widget .monaco-list .monaco-list-row>.contents>.main>.right{display:flex}.workbench-suggest-widget .monaco-list .monaco-list-row:not(.focused)>.contents>.main .monaco-icon-label{color:var(--vscode-editorSuggestWidget-foreground)}.workbench-suggest-widget:not(.frozen) .monaco-highlighted-label .highlight{font-weight:700}.workbench-suggest-widget .monaco-list .monaco-list-row>.contents>.main .monaco-highlighted-label .highlight{color:var(--vscode-editorSuggestWidget-highlightForeground)}.workbench-suggest-widget .monaco-list .monaco-list-row.focused>.contents>.main .monaco-highlighted-label .highlight{color:var(--vscode-editorSuggestWidget-focusHighlightForeground)}.workbench-suggest-widget .monaco-list .monaco-list-row .monaco-icon-label.deprecated{opacity:.66;text-decoration:unset}.workbench-suggest-widget .monaco-list .monaco-list-row .monaco-icon-label.deprecated>.monaco-icon-label-container>.monaco-icon-name-container{text-decoration:line-through}.workbench-suggest-widget .monaco-list .monaco-list-row .monaco-icon-label:before{height:100%}.workbench-suggest-widget .monaco-list .monaco-list-row .icon{background-position:50%;background-repeat:no-repeat;background-size:80%;display:block;height:16px;margin-left:2px;width:16px}.workbench-suggest-widget .monaco-list .monaco-list-row .icon.hide{display:none}.workbench-suggest-widget .monaco-list .monaco-list-row .suggest-icon{align-items:center;display:flex;margin-right:4px}.workbench-suggest-widget.no-icons .monaco-list .monaco-list-row .icon,.workbench-suggest-widget.no-icons .monaco-list .monaco-list-row .suggest-icon:before{display:none}.workbench-suggest-widget .monaco-list .monaco-list-row .icon.customcolor .colorspan{border:.1em solid #000;display:inline-block;height:.7em;margin:0 0 0 .3em;width:.7em}.workbench-suggest-widget .monaco-list .monaco-list-row>.contents>.main>.right>.details-label{opacity:.7}.workbench-suggest-widget .monaco-list .monaco-list-row>.contents>.main>.left>.signature-label{opacity:.6;overflow:hidden;text-overflow:ellipsis}.workbench-suggest-widget .monaco-list .monaco-list-row>.contents>.main>.left>.qualifier-label{align-self:center;font-size:85%;line-height:normal;margin-left:12px;opacity:.4;overflow:hidden;text-overflow:ellipsis}.workbench-suggest-widget .monaco-list .monaco-list-row>.contents>.main>.right>.details-label{font-size:85%;margin-left:1.1em;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.workbench-suggest-widget .monaco-list .monaco-list-row>.contents>.main>.right>.details-label>.monaco-tokenized-source{display:inline}.workbench-suggest-widget .monaco-list .monaco-list-row>.contents>.main>.right>.details-label{display:none}.workbench-suggest-widget .monaco-list .monaco-list-row:not(.string-label)>.contents>.main>.right>.details-label,.workbench-suggest-widget.docs-side .monaco-list .monaco-list-row.focused:not(.string-label)>.contents>.main>.right>.details-label,.workbench-suggest-widget:not(.shows-details) .monaco-list .monaco-list-row.focused>.contents>.main>.right>.details-label{display:inline}.workbench-suggest-widget:not(.docs-side) .monaco-list .monaco-list-row.focused:hover>.contents>.main>.right.can-expand-details>.details-label{width:calc(100% - 26px)}.workbench-suggest-widget .monaco-list .monaco-list-row>.contents>.main>.left{flex-grow:1;flex-shrink:1;overflow:hidden}.workbench-suggest-widget .monaco-list .monaco-list-row>.contents>.main>.left>.monaco-icon-label{flex-shrink:0}.workbench-suggest-widget .monaco-list .monaco-list-row:not(.string-label)>.contents>.main>.left>.monaco-icon-label{max-width:100%}.workbench-suggest-widget .monaco-list .monaco-list-row.string-label>.contents>.main>.left>.monaco-icon-label{flex-shrink:1}.workbench-suggest-widget .monaco-list .monaco-list-row>.contents>.main>.right{flex-shrink:4;max-width:70%;overflow:hidden}.workbench-suggest-widget .monaco-list .monaco-list-row>.contents>.main>.right>.readMore{display:inline-block;height:18px;position:absolute;right:10px;visibility:hidden;width:18px}';oi(Od,{});function Nd(r){return`simple-suggest-aria-id:${r}`}class Bd{constructor(){this._onDidToggleDetails=new v,this.onDidToggleDetails=this._onDidToggleDetails.event,this.templateId="suggestion"}dispose(){this._onDidToggleDetails.dispose()}renderTemplate(e){const t=new Bi,i=e;i.classList.add("show-file-icons");const n=Se(e,_e(".icon")),s=Se(n,_e("span.colorspan")),o=Se(e,_e(".contents")),l=Se(o,_e(".main")),c=Se(l,_e(".icon-label.codicon")),h=Se(l,_e("span.left")),m=Se(l,_e("span.right")),p=new ac(h,{supportHighlights:!0,supportIcons:!0});t.add(p);const w=Se(h,_e("span.signature-label")),f=Se(h,_e("span.qualifier-label")),_=Se(m,_e("span.details-label"));return(()=>{const y="Hack",R="",C="12",D="20",B="normal",A="0",j=`${C}px`,$=`${D}px`,H=`${A}px`;i.style.fontSize=j,i.style.fontWeight=B,i.style.letterSpacing=H,l.style.fontFamily=y,l.style.fontFeatureSettings=R,l.style.lineHeight=$,n.style.height=$,n.style.width=$})(),{root:i,left:h,right:m,icon:n,colorspan:s,iconLabel:p,iconContainer:c,parametersLabel:w,qualifierLabel:f,detailsLabel:_,disposables:t}}renderElement(e,t,i){const{completion:n}=e;i.root.id=Nd(t),i.colorspan.style.backgroundColor="";const s={labelEscapeNewLines:!0,matches:lc(e.score)};i.icon.className="icon hide",i.iconContainer.className="",i.iconContainer.classList.add("suggest-icon",...L.asClassNameArray(n.icon||k.symbolText)),i.iconLabel.setLabel(n.label,void 0,s),i.parametersLabel.textContent="",i.detailsLabel.textContent=Vd(n.detail||""),i.root.classList.add("string-label"),it(i.detailsLabel),i.right.classList.remove("can-expand-details")}disposeTemplate(e){e.disposables.dispose()}}function Vd(r){return r.replace(/\r\n|\r|\n/g,"")}const Hd=_e;let lr=class{get list(){return this._list}constructor(e,t,i,n){this._container=e,this._persistedSize=t,this._state=0,this._forceRenderingAbove=!1,this._pendingLayout=new cc,this._showTimeout=new hc,this._disposables=new Bi,this._onDidSelect=new v,this.onDidSelect=this._onDidSelect.event,this._onDidHide=new v,this.onDidHide=this._onDidHide.event,this._onDidShow=new v,this.onDidShow=this._onDidShow.event,this.element=new dc,this.element.domNode.classList.add("workbench-suggest-widget"),this._container.appendChild(this.element.domNode);class s{constructor(h,m,p=!1,w=!1){this.persistedSize=h,this.currentSize=m,this.persistHeight=p,this.persistWidth=w}}let o;this._disposables.add(this.element.onDidWillResize(()=>{o=new s(this._persistedSize.restore(),this.element.size)})),this._disposables.add(this.element.onDidResize(c=>{var h,m;if(this._resize(c.dimension.width,c.dimension.height),o&&(o.persistHeight=o.persistHeight||!!c.north||!!c.south,o.persistWidth=o.persistWidth||!!c.east||!!c.west),!!c.done){if(o){const{itemHeight:p,defaultSize:w}=this._getLayoutInfo(),f=Math.round(p/2);let{width:_,height:S}=this.element.size;(!o.persistHeight||Math.abs(o.currentSize.height-S)<=f)&&(S=((h=o.persistedSize)==null?void 0:h.height)??w.height),(!o.persistWidth||Math.abs(o.currentSize.width-_)<=f)&&(_=((m=o.persistedSize)==null?void 0:m.width)??w.width),this._persistedSize.store(new at(_,S))}o=void 0}}));const l=new Bd;this._disposables.add(l),this._listElement=Se(this.element.domNode,Hd(".tree")),this._list=new uc("SuggestWidget",this._listElement,{getHeight:c=>this._getLayoutInfo().itemHeight,getTemplateId:c=>"suggestion"},[l],{alwaysConsumeMouseWheel:!0,useShadows:!1,mouseSupport:!1,multipleSelectionSupport:!1,accessibilityProvider:{getRole:()=>"option",getWidgetAriaLabel:()=>a("suggest","Suggest"),getWidgetRole:()=>"listbox",getAriaLabel:c=>{let h=c.completion.label;if(typeof c.completion.label!="string"){const{detail:p,description:w}=c.completion.label;p&&w?h=a("label.full","{0}{1}, {2}",h,p,w):p?h=a("label.detail","{0}{1}",h,p):w&&(h=a("label.desc","{0}, {1}",h,w))}const{detail:m}=c.completion;return a("ariaCurrenttSuggestionReadDetails","{0}, docs: {1}",h,m)}}}),i.statusBarMenuId&&(this._status=n.createInstance(mc,this.element.domNode,i.statusBarMenuId),this.element.domNode.classList.toggle("with-status-bar",!0)),this._disposables.add(this._list.onMouseDown(c=>this._onListMouseDownOrTap(c))),this._disposables.add(this._list.onTap(c=>this._onListMouseDownOrTap(c))),this._disposables.add(this._list.onDidChangeSelection(c=>this._onListSelection(c)))}dispose(){var e;this._disposables.dispose(),(e=this._status)==null||e.dispose(),this.element.dispose()}showSuggestions(e,t,i,n,s){if(this._cursorPosition=s,this._completionModel!==e&&(this._completionModel=e),i&&this._state!==2&&this._state!==0){this._setState(4);return}if(this._completionModel.items.length===0){this._setState(n?0:2),this._completionModel=void 0;return}try{this._list.splice(0,this._list.length,this._completionModel.items),this._setState(i?4:3),this._list.reveal(t,0),this._list.setFocus([t])}finally{}this._pendingLayout.value=gc(()=>{this._pendingLayout.clear(),this._layout(this.element.size)})}setLineContext(e){this._completionModel&&(this._completionModel.lineContext=e)}_setState(e){var t,i,n,s,o,l,c;if(this._state!==e)switch(this._state=e,this.element.domNode.classList.toggle("frozen",e===4),this.element.domNode.classList.remove("message"),e){case 0:_t(this._listElement),this._status&&_t((t=this._status)==null?void 0:t.element),(i=this._status)==null||i.hide(),this._showTimeout.cancel(),this.element.domNode.classList.remove("visible"),this._list.splice(0,this._list.length),this._cappedHeight=void 0;break;case 1:this.element.domNode.classList.add("message"),_t(this._listElement),this._status&&_t((n=this._status)==null?void 0:n.element),this._show();break;case 2:this.element.domNode.classList.add("message"),_t(this._listElement),this._status&&_t((s=this._status)==null?void 0:s.element),this._show();break;case 3:it(this._listElement),this._status&&it((o=this._status)==null?void 0:o.element),this._show();break;case 4:it(this._listElement),this._status&&it((l=this._status)==null?void 0:l.element),this._show();break;case 5:it(this._listElement),this._status&&it((c=this._status)==null?void 0:c.element),this._show();break}}_show(){var e;(e=this._status)==null||e.show(),it(this.element.domNode),this._layout(this._persistedSize.restore()),this._showTimeout.cancelAndSet(()=>{this.element.domNode.classList.add("visible"),this._onDidShow.fire(this)},100)}hide(){this._pendingLayout.clear(),this._setState(0),this._onDidHide.fire(this),_t(this.element.domNode),this.element.clearSashHoverState();const e=this._persistedSize.restore(),t=Math.ceil(this._getLayoutInfo().itemHeight*4.3);e&&e.height<t&&this._persistedSize.store(e.with(void 0,t))}_layout(e){var C,D;if(!this._cursorPosition)return;const t=pc(document.body),i=this._getLayoutInfo();e||(e=i.defaultSize);let n=e.height,s=e.width;this._status&&(this._status.element.style.lineHeight=`${i.itemHeight}px`);const o=t.width-i.borderHeight-2*i.horizontalPadding;s>o&&(s=o);const l=this._completionModel?this._completionModel.stats.pLabelLen*i.typicalHalfwidthCharacterWidth:s,c=i.statusBarHeight+this._list.contentHeight+i.borderHeight,h=i.itemHeight+i.statusBarHeight,m=jo(this._container),p=this._cursorPosition,w=m.top+p.top+p.height,f=Math.min(t.height-w-i.verticalPadding,c),_=m.top+p.top-i.verticalPadding,S=Math.min(_,c);let y=Math.min(Math.max(S,f)+i.borderHeight,c);n===((C=this._cappedHeight)==null?void 0:C.capped)&&(n=this._cappedHeight.wanted),n<h&&(n=h),n>y&&(n=y);const R=150;n>f||this._forceRenderingAbove&&_>R?(this._preference=0,this.element.enableSashes(!0,!0,!1,!1),y=S):(this._preference=1,this.element.enableSashes(!1,!0,!0,!1),y=f),this.element.preferredSize=new at(l,i.defaultSize.height),this.element.maxSize=new at(o,y),this.element.minSize=new at(220,h),this._cappedHeight=n===c?{wanted:((D=this._cappedHeight)==null?void 0:D.wanted)??e.height,capped:n}:void 0,this.element.domNode.style.left=`${this._cursorPosition.left}px`,this._preference===0?this.element.domNode.style.top=`${this._cursorPosition.top-n-i.borderHeight}px`:this.element.domNode.style.top=`${this._cursorPosition.top+this._cursorPosition.height}px`,this._resize(s,n)}_resize(e,t){const{width:i,height:n}=this.element.maxSize;e=Math.min(i,e),n&&(t=Math.min(n,t));const{statusBarHeight:s}=this._getLayoutInfo();this._list.layout(t-s,e),this._listElement.style.height=`${t-s}px`,this._listElement.style.width=`${e}px`,this._listElement.style.height=`${t}px`,this.element.layout(t,e)}_getLayoutInfo(){const e={lineHeight:20,typicalHalfwidthCharacterWidth:10},t=fc(e.lineHeight,8,1e3),i=0,n=1,s=2*n;return{itemHeight:t,statusBarHeight:i,borderWidth:n,borderHeight:s,typicalHalfwidthCharacterWidth:e.typicalHalfwidthCharacterWidth,verticalPadding:22,horizontalPadding:14,defaultSize:new at(430,i+12*t+s)}}_onListMouseDownOrTap(e){typeof e.element>"u"||typeof e.index>"u"||(e.browserEvent.preventDefault(),e.browserEvent.stopPropagation(),this._select(e.element,e.index))}_onListSelection(e){e.elements.length&&this._select(e.elements[0],e.indexes[0])}_select(e,t){const i=this._completionModel;i&&this._onDidSelect.fire({item:e,index:t,model:i})}selectNext(){this._list.focusNext(1,!0);const e=this._list.getFocus();return e.length>0&&this._list.reveal(e[0]),!0}selectNextPage(){this._list.focusNextPage();const e=this._list.getFocus();return e.length>0&&this._list.reveal(e[0]),!0}selectPrevious(){this._list.focusPrevious(1,!0);const e=this._list.getFocus();return e.length>0&&this._list.reveal(e[0]),!0}selectPreviousPage(){this._list.focusPreviousPage();const e=this._list.getFocus();return e.length>0&&this._list.reveal(e[0]),!0}getFocusedItem(){if(this._completionModel)return{item:this._list.getFocusedElements()[0],index:this._list.getFocus()[0],model:this._completionModel}}forceRenderingAbove(){this._forceRenderingAbove||(this._forceRenderingAbove=!0,this._layout(this._persistedSize.restore()))}stopForceRenderingAbove(){this._forceRenderingAbove=!1}};lr=b([d(3,O)],lr);const Gd={0:k.symbolText,1:k.history,2:k.symbolMethod,3:k.symbolFile,4:k.folder,5:k.symbolProperty,6:k.symbolMethod,7:k.symbolVariable,8:k.symbolValue,9:k.symbolVariable,10:k.symbolNamespace,11:k.symbolInterface,12:k.symbolKeyword,13:k.symbolKeyword};let cr=class extends q{constructor(e,t){super(),this._terminalSuggestWidgetVisibleContextKey=e,this._instantiationService=t,this._enableWidget=!0,this._cursorIndexStart=0,this._cursorIndexDelta=0,this._onBell=new v,this.onBell=this._onBell.event,this._onAcceptedCompletion=new v,this.onAcceptedCompletion=this._onAcceptedCompletion.event,this._cachedBashAliases=new Set,this._cachedBashBuiltins=new Set,this._cachedBashCommands=new Set,this._cachedBashKeywords=new Set}activate(e){this._terminal=e,this._register(e.parser.registerOscHandler(633,t=>this._handleVSCodeSequence(t))),this._register(e.onData(t=>{this._handleTerminalInput(t)}))}setContainer(e){this._container=e}_handleVSCodeSequence(e){if(!this._terminal)return!1;const[t,...i]=e.split(";");switch(t){case"Completions":return this._handleCompletionsSequence(this._terminal,e,t,i),!0;case"CompletionsBash":return this._handleCompletionsBashSequence(this._terminal,e,t,i),!0;case"CompletionsBashFirstWord":return this._handleCompletionsBashFirstWordSequence(this._terminal,e,t,i)}return!1}_handleCompletionsSequence(e,t,i,n){if(!e.element||!this._enableWidget)return;const s=parseInt(n[0]),o=parseInt(n[1]);if(this._cursorIndexStart=parseInt(n[2]),!n[3]){this._onBell.fire();return}let l=JSON.parse(t.slice(i.length+n[0].length+n[1].length+n[2].length+4));Array.isArray(l)||(l=[l]);const c=l.map(m=>new as({label:m.CompletionText,icon:Gd[m.ResultType],detail:m.ToolTip}));this._leadingLineContent=c[0].completion.label.slice(0,o),this._cursorIndexDelta=0;const h=new Eo(c,new ls(this._leadingLineContent,s),s,o);if(c.length===1&&c[0].completion.label.substring(o).length===0){this._onBell.fire();return}this._handleCompletionModel(h)}_handleCompletionsBashFirstWordSequence(e,t,i,n){const s=n[0],o=t.slice(i.length+s.length+2).split(";");let l;switch(s){case"alias":l=this._cachedBashAliases;break;case"builtin":l=this._cachedBashBuiltins;break;case"command":l=this._cachedBashCommands;break;case"keyword":l=this._cachedBashKeywords;break;default:return!1}l.clear();const c=new Set;for(const h of o)c.add(h);for(const h of c)l.add(new as({label:h,icon:k.symbolString,detail:s}));return this._cachedFirstWord=void 0,!0}_handleCompletionsBashSequence(e,t,i,n){if(!e.element)return;let s=parseInt(n[0]);const o=parseInt(n[1]);if(!n[2]){this._onBell.fire();return}const l=t.slice(i.length+n[0].length+n[1].length+n[2].length+4).split(";");let c;if(s!==100&&l.length>0?c=l.map(m=>new as({label:m,icon:k.symbolProperty})):(s=0,this._cachedFirstWord||(this._cachedFirstWord=[...this._cachedBashAliases,...this._cachedBashBuiltins,...this._cachedBashCommands,...this._cachedBashKeywords],this._cachedFirstWord.sort((m,p)=>{const w=m.completion.label.charCodeAt(0),f=p.completion.label.charCodeAt(0),_=w<65||w>90&&w<97||w>122?1:0,S=f<65||f>90&&f<97||f>122?1:0;return _!==S?_-S:m.completion.label.localeCompare(p.completion.label)})),c=this._cachedFirstWord),c.length===0)return;this._leadingLineContent=c[0].completion.label.slice(0,o);const h=new Eo(c,new ls(this._leadingLineContent,s),s,o);if(c.length===1&&c[0].completion.label.substring(o).length===0){this._onBell.fire();return}this._handleCompletionModel(h)}_handleCompletionModel(e){var l;if(e.items.length===0||!((l=this._terminal)!=null&&l.element))return;if(e.items.length===1){this.acceptSelectedSuggestion({item:e.items[0],model:e});return}const t=this._ensureSuggestWidget(this._terminal);this._additionalInput=void 0;const i={width:this._terminal._core._renderService.dimensions.device.cell.width,height:this._terminal._core._renderService.dimensions.device.cell.height};if(!i.width||!i.height)return;const n=this._terminal.element.getBoundingClientRect(),o=ts(this._container,"panel").offsetParent.getBoundingClientRect();if(t.showSuggestions(e,0,!1,!1,{left:n.left-o.left+this._terminal.buffer.active.cursorX*i.width,top:n.top-o.top+this._terminal.buffer.active.cursorY*i.height,height:i.height}),this._inputQueue){const c=this._inputQueue;this._inputQueue=void 0;for(const h of c)this._handleTerminalInput(h)}}_ensureSuggestWidget(e){return this._terminalSuggestWidgetVisibleContextKey.set(!0),this._suggestWidget||(this._suggestWidget=this._register(this._instantiationService.createInstance(lr,ts(this._container,"panel"),this._instantiationService.createInstance(hr),{})),this._suggestWidget.list.style(_c({listInactiveFocusBackground:wc,listInactiveFocusOutline:vc})),this._suggestWidget.onDidSelect(async t=>this.acceptSelectedSuggestion(t)),this._suggestWidget.onDidHide(()=>this._terminalSuggestWidgetVisibleContextKey.set(!1)),this._suggestWidget.onDidShow(()=>this._terminalSuggestWidgetVisibleContextKey.set(!0))),this._suggestWidget}selectPreviousSuggestion(){var e;(e=this._suggestWidget)==null||e.selectPrevious()}selectPreviousPageSuggestion(){var e;(e=this._suggestWidget)==null||e.selectPreviousPage()}selectNextSuggestion(){var e;(e=this._suggestWidget)==null||e.selectNext()}selectNextPageSuggestion(){var e;(e=this._suggestWidget)==null||e.selectNextPage()}acceptSelectedSuggestion(e){var t,i,n;e||(e=(t=this._suggestWidget)==null?void 0:t.getFocusedItem()),e&&this._leadingLineContent&&((i=this._suggestWidget)==null||i.hide(),this._onAcceptedCompletion.fire(["\x1B[D".repeat(Math.max(e.model.replacementLength-this._cursorIndexStart+this._cursorIndexDelta,0)),"\x1B[3~".repeat(((n=this._additionalInput)==null?void 0:n.length)??0),"".repeat(e.model.replacementLength),e.item.completion.label].join("")),this._enableWidget=!1,kt(100).then(s=>this._enableWidget=!0))}hideSuggestWidget(){var e;(e=this._suggestWidget)==null||e.hide()}handleNonXtermData(e){this._handleTerminalInput(e)}_handleTerminalInput(e){var i,n,s,o,l;if(!this._terminal||!this._enableWidget||!this._terminalSuggestWidgetVisibleContextKey.get()){e==="-"?this._inputQueue=[]:(i=this._inputQueue)==null||i.push(e);return}let t=!1;if(e===""&&this._additionalInput&&this._additionalInput.length>0&&this._cursorIndexDelta>0&&(t=!0,this._additionalInput=this._additionalInput.substring(0,this._cursorIndexDelta---1)+this._additionalInput.substring(this._cursorIndexDelta)),e==="\x1B[3~"&&this._additionalInput&&this._additionalInput.length>0&&this._cursorIndexDelta<this._additionalInput.length-1&&(t=!0,this._additionalInput=this._additionalInput.substring(0,this._cursorIndexDelta)+this._additionalInput.substring(this._cursorIndexDelta+1)),e==="\x1B[D"&&this._cursorIndexDelta>0&&(t=!0,this._cursorIndexDelta--),e==="\x1B[C"&&(t=!0,this._cursorIndexDelta+=1),e.match(/^[a-z0-9]$/i)&&(t=!0,this._additionalInput===void 0&&(this._additionalInput=""),this._additionalInput+=e,this._cursorIndexDelta++),t){if(this._terminalSuggestWidgetVisibleContextKey.get()&&((s=this._suggestWidget)==null||s.setLineContext(new ls(this._leadingLineContent+(this._additionalInput??""),((n=this._additionalInput)==null?void 0:n.length)??0))),((o=this._suggestWidget._completionModel)==null?void 0:o.items.length)===0){this._additionalInput=void 0,this.hideSuggestWidget();return}const c={width:this._terminal._core._renderService.dimensions.device.cell.width,height:this._terminal._core._renderService.dimensions.device.cell.height};if(!c.width||!c.height)return;const h=this._terminal.element.getBoundingClientRect(),p=ts(this._container,"panel").offsetParent.getBoundingClientRect();(l=this._suggestWidget)==null||l.showSuggestions(this._suggestWidget._completionModel,0,!1,!1,{left:h.left-p.left+this._terminal.buffer.active.cursorX*c.width,top:h.top-p.top+this._terminal.buffer.active.cursorY*c.height,height:c.height})}else this._additionalInput=void 0,this.hideSuggestWidget()}};cr=b([d(1,O)],cr);let hr=class{constructor(e){this._storageService=e,this._key="terminal.integrated.suggestSize"}restore(){const e=this._storageService.get(this._key,0)??"";try{const t=JSON.parse(e);if(at.is(t))return at.lift(t)}catch{}}store(e){this._storageService.store(this._key,JSON.stringify(e),0,1)}reset(){this._storageService.remove(this._key,0)}};hr=b([d(0,Xe)],hr);let cs,hs,ds,us,ms,gs;function $d(r,e){let t=e.getLine(r);if(!t)return{lineData:void 0,lineIndex:r};let i=t.translateToString(!0);for(;r>0&&t.isWrapped&&(t=e.getLine(--r),!!t);)i=t.translateToString(!1)+i;return{lineData:i,lineIndex:r}}let Rn=class st extends Bi{*getBufferReverseIterator(){for(let e=this.raw.buffer.active.length;e>=0;e--){const{lineData:t,lineIndex:i}=$d(e,this.raw.buffer.active);t&&(e=i,yield t)}}get findResult(){return this._lastFindResult}get isStdinDisabled(){return!!this.raw.options.disableStdin}get markTracker(){return this._markNavigationAddon}get shellIntegration(){return this._shellIntegrationAddon}get suggestController(){return this._suggestAddon}get textureAtlas(){var t,i;const e=((t=this._webglAddon)==null?void 0:t.textureAtlas)||((i=this._canvasAddon)==null?void 0:i.textureAtlas);if(e)return createImageBitmap(e)}constructor(e,t,i,n,s,o,l,c,h,m,p,w,f,_,S,y){super(),this._configHelper=t,this._backgroundColorProvider=s,this._capabilities=o,this._terminalSuggestWidgetVisibleContextKey=c,this._configurationService=m,this._instantiationService=p,this._logService=w,this._notificationService=f,this._storageService=_,this._themeService=S,this._telemetryService=y,this._onDidRequestRunCommand=new v,this.onDidRequestRunCommand=this._onDidRequestRunCommand.event,this._onDidRequestFocus=new v,this.onDidRequestFocus=this._onDidRequestFocus.event,this._onDidRequestSendText=new v,this.onDidRequestSendText=this._onDidRequestSendText.event,this._onDidRequestFreePort=new v,this.onDidRequestFreePort=this._onDidRequestFreePort.event,this._onDidChangeFindResults=new v,this.onDidChangeFindResults=this._onDidChangeFindResults.event,this._onDidChangeSelection=new v,this.onDidChangeSelection=this._onDidChangeSelection.event;const R=this._configHelper.getFont(void 0,!0),C=this._configHelper.config,D=this._configurationService.getValue("editor");this.raw=this.add(new e({allowProposedApi:!0,cols:i,rows:n,altClickMovesCursor:C.altClickMovesCursor&&D.multiCursorModifier==="alt",scrollback:C.scrollback,theme:this._getXtermTheme(),drawBoldTextInBrightColors:C.drawBoldTextInBrightColors,fontFamily:R.fontFamily,fontWeight:C.fontWeight,fontWeightBold:C.fontWeightBold,fontSize:R.fontSize,letterSpacing:R.letterSpacing,lineHeight:R.lineHeight,minimumContrastRatio:C.minimumContrastRatio,tabStopWidth:C.tabStopWidth,cursorBlink:C.cursorBlinking,cursorStyle:C.cursorStyle==="line"?"bar":C.cursorStyle,cursorWidth:C.cursorWidth,macOptionIsMeta:C.macOptionIsMeta,macOptionClickForcesSelection:C.macOptionClickForcesSelection,rightClickSelectsWord:C.rightClickBehavior==="selectWord",fastScrollModifier:"alt",fastScrollSensitivity:C.fastScrollSensitivity,scrollSensitivity:C.mouseWheelScrollSensitivity,wordSeparator:C.wordSeparators,overviewRulerWidth:10,smoothScrollDuration:C.smoothScrolling?125:0})),this._core=this.raw._core,this.add(this._configurationService.onDidChangeConfiguration(async B=>{B.affectsConfiguration("terminal.integrated.gpuAcceleration")&&(st._suggestedRendererType=void 0),(B.affectsConfiguration("terminal.integrated")||B.affectsConfiguration("editor.fastScrollSensitivity")||B.affectsConfiguration("editor.mouseWheelScrollSensitivity")||B.affectsConfiguration("editor.multiCursorModifier"))&&this.updateConfig(),B.affectsConfiguration("terminal.integrated.unicodeVersion")&&this._updateUnicodeVersion()})),this.add(this._themeService.onDidColorThemeChange(B=>this._updateTheme(B))),this.add(this.raw.onSelectionChange(()=>this._onDidChangeSelection.fire())),this._updateUnicodeVersion(),this._refreshImageAddon(),this._markNavigationAddon=this._instantiationService.createInstance(sr,o),this.raw.loadAddon(this._markNavigationAddon),this._decorationAddon=this._instantiationService.createInstance(ar,this._capabilities),this._decorationAddon.onDidRequestRunCommand(B=>this._onDidRequestRunCommand.fire(B)),this.raw.loadAddon(this._decorationAddon),this._shellIntegrationAddon=this._instantiationService.createInstance(rr,l,h,this._telemetryService),this.raw.loadAddon(this._shellIntegrationAddon),this._suggestAddon=this._instantiationService.createInstance(cr,this._terminalSuggestWidgetVisibleContextKey),this.raw.loadAddon(this._suggestAddon),this._suggestAddon.onAcceptedCompletion(async B=>{this._onDidRequestFocus.fire(),this._onDidRequestSendText.fire(B)})}async getSelectionAsHtml(e){var i,n;if(!this._serializeAddon){const s=await this._getSerializeAddonConstructor();this._serializeAddon=new s,this.raw.loadAddon(this._serializeAddon)}if(e){const s=(i=e.getOutput())==null?void 0:i.length,o=(n=e.marker)==null?void 0:n.line;if(!s||!o)throw new Error(`No row ${o} or output length ${s} for command ${e}`);this.raw.select(0,o+1,s-Math.floor(s/this.raw.cols))}const t=this._serializeAddon.serializeAsHTML({onlySelection:!0});return e&&this.raw.clearSelection(),t}attachToElement(e){return this._container||this.raw.open(e),this._shouldLoadWebgl()?this._enableWebglRenderer():this._shouldLoadCanvas()&&this._enableCanvasRenderer(),this._suggestAddon.setContainer(e),this._container=e,this._container.querySelector(".xterm-screen")}updateConfig(){const e=this._configHelper.config;this.raw.options.altClickMovesCursor=e.altClickMovesCursor,this._setCursorBlink(e.cursorBlinking),this._setCursorStyle(e.cursorStyle),this._setCursorWidth(e.cursorWidth),this.raw.options.scrollback=e.scrollback,this.raw.options.drawBoldTextInBrightColors=e.drawBoldTextInBrightColors,this.raw.options.minimumContrastRatio=e.minimumContrastRatio,this.raw.options.tabStopWidth=e.tabStopWidth,this.raw.options.fastScrollSensitivity=e.fastScrollSensitivity,this.raw.options.scrollSensitivity=e.mouseWheelScrollSensitivity,this.raw.options.macOptionIsMeta=e.macOptionIsMeta;const t=this._configurationService.getValue("editor");this.raw.options.altClickMovesCursor=e.altClickMovesCursor&&t.multiCursorModifier==="alt",this.raw.options.macOptionClickForcesSelection=e.macOptionClickForcesSelection,this.raw.options.rightClickSelectsWord=e.rightClickBehavior==="selectWord",this.raw.options.wordSeparator=e.wordSeparators,this.raw.options.customGlyphs=e.customGlyphs,this.raw.options.smoothScrollDuration=e.smoothScrolling?125:0,this._shouldLoadWebgl()?this._enableWebglRenderer():(this._disposeOfWebglRenderer(),this._shouldLoadCanvas()?this._enableCanvasRenderer():this._disposeOfCanvasRenderer()),this._refreshImageAddon()}_shouldLoadWebgl(){return!bc&&this._configHelper.config.gpuAcceleration==="auto"&&st._suggestedRendererType===void 0||this._configHelper.config.gpuAcceleration==="on"}_shouldLoadCanvas(){return this._configHelper.config.gpuAcceleration==="auto"&&(st._suggestedRendererType===void 0||st._suggestedRendererType==="canvas")||this._configHelper.config.gpuAcceleration==="canvas"}forceRedraw(){this.raw.clearTextureAtlas()}clearDecorations(){var e;(e=this._decorationAddon)==null||e.clearDecorations()}forceRefresh(){var e;(e=this._core.viewport)==null||e._innerRefresh()}forceUnpause(){var e;this._canvasAddon&&((e=this._core._renderService)==null||e._handleIntersectionChange({intersectionRatio:1}),this.raw.refresh(0,this.raw.rows-1))}async findNext(e,t){return this._updateFindColors(t),(await this._getSearchAddon()).findNext(e,t)}async findPrevious(e,t){return this._updateFindColors(t),(await this._getSearchAddon()).findPrevious(e,t)}_updateFindColors(e){const t=this._themeService.getColorTheme(),i=t.getColor(da)||t.getColor(ua),n=t.getColor(Sc),s=t.getColor(Cc),o=t.getColor(la),l=t.getColor(yc),c=t.getColor(xc),h=t.getColor(Ic);e.decorations={activeMatchBackground:n==null?void 0:n.toString(),activeMatchBorder:(s==null?void 0:s.toString())||"transparent",activeMatchColorOverviewRuler:(o==null?void 0:o.toString())||"transparent",matchBackground:i?l==null?void 0:l.blend(i).toString():void 0,matchBorder:(c==null?void 0:c.toString())||"transparent",matchOverviewRuler:(h==null?void 0:h.toString())||"transparent"}}async _getSearchAddon(){if(this._searchAddon)return this._searchAddon;const e=await this._getSearchAddonConstructor();return this._searchAddon=new e({highlightLimit:1e3}),this.raw.loadAddon(this._searchAddon),this._searchAddon.onDidChangeResults(t=>{this._lastFindResult=t,this._onDidChangeFindResults.fire(t)}),this._searchAddon}clearSearchDecorations(){var e;(e=this._searchAddon)==null||e.clearDecorations()}clearActiveSearchDecoration(){var e;(e=this._searchAddon)==null||e.clearActiveDecoration()}getFont(){return this._configHelper.getFont(this._core)}getLongestViewportWrappedLineLength(){let e=0;for(let t=this.raw.buffer.active.length-1;t>=this.raw.buffer.active.viewportY;t--){const i=this._getWrappedLineCount(t,this.raw.buffer.active);e=Math.max(e,i.lineCount*this.raw.cols-i.endSpaces||0),t=i.currentIndex}return e}_getWrappedLineCount(e,t){var o;let i=t.getLine(e);if(!i)throw new Error("Could not get line");let n=e,s=0;for(let l=Math.min(i.length,this.raw.cols)-1;l>=0&&!((o=i==null?void 0:i.getCell(l))!=null&&o.getChars());l--)s++;for(;i!=null&&i.isWrapped&&n>0;)n--,i=t.getLine(n);return{lineCount:e-n+1,currentIndex:n,endSpaces:s}}scrollDownLine(){this.raw.scrollLines(1)}scrollDownPage(){this.raw.scrollPages(1)}scrollToBottom(){this.raw.scrollToBottom()}scrollUpLine(){this.raw.scrollLines(-1)}scrollUpPage(){this.raw.scrollPages(-1)}scrollToTop(){this.raw.scrollToTop()}clearBuffer(){var e,t;this.raw.clear(),(e=this._capabilities.get(2))==null||e.handlePromptStart(),(t=this._capabilities.get(2))==null||t.handleCommandStart()}_setCursorBlink(e){this.raw.options.cursorBlink!==e&&(this.raw.options.cursorBlink=e,this.raw.refresh(0,this.raw.rows-1))}_setCursorStyle(e){this.raw.options.cursorStyle!==e&&(this.raw.options.cursorStyle=e==="line"?"bar":e)}_setCursorWidth(e){this.raw.options.cursorWidth!==e&&(this.raw.options.cursorWidth=e)}async _enableWebglRenderer(){if(!this.raw.element||this._webglAddon)return;const e=await this._getWebglAddonConstructor();this._webglAddon=new e,this._disposeOfCanvasRenderer();try{this.raw.loadAddon(this._webglAddon),this._logService.trace("Webgl was loaded"),this._webglAddon.onContextLoss(()=>{this._logService.info("Webgl lost context, disposing of webgl renderer"),this._disposeOfWebglRenderer()})}catch(t){this._logService.warn("Webgl could not be loaded. Falling back to the canvas renderer type.",t),!this._storageService.getBoolean("terminal.integrated.neverMeasureRenderTime",-1,!1)&&this._configHelper.config.gpuAcceleration!=="off"&&this._measureRenderTime(),st._suggestedRendererType="canvas",this._disposeOfWebglRenderer(),this._enableCanvasRenderer()}}async _enableCanvasRenderer(){if(!this.raw.element||this._canvasAddon)return;const e=await this._getCanvasAddonConstructor();this._canvasAddon=new e,this._disposeOfWebglRenderer();try{this.raw.loadAddon(this._canvasAddon),this._logService.trace("Canvas renderer was loaded")}catch(t){this._logService.warn("Canvas renderer could not be loaded, falling back to dom renderer",t),!this._storageService.getBoolean("terminal.integrated.neverMeasureRenderTime",-1,!1)&&this._configHelper.config.gpuAcceleration!=="off"&&this._measureRenderTime(),st._suggestedRendererType="dom",this._disposeOfCanvasRenderer()}}async _getCanvasAddonConstructor(){return cs||(cs=(await vt(()=>import("./xterm-addon-canvas-400c2cd0.js").then(e=>e.x),["assets/xterm-addon-canvas-400c2cd0.js","assets/index-e8d740ba.js","assets/index-4826039e.css"]).then(e=>e.default??e)).CanvasAddon),cs}async _refreshImageAddon(){var e;if(this._configHelper.config.experimentalImageSupport){if(!this._imageAddon){const t=await this._getImageAddonConstructor();this._imageAddon=new t,this.raw.loadAddon(this._imageAddon)}}else{try{(e=this._imageAddon)==null||e.dispose()}catch{}this._imageAddon=void 0}}async _getImageAddonConstructor(){return hs||(hs=(await vt(()=>import("./xterm-addon-image-bf2e7496.js").then(e=>e.x),["assets/xterm-addon-image-bf2e7496.js","assets/index-e8d740ba.js","assets/index-4826039e.css"]).then(e=>e.default??e)).ImageAddon),hs}async _getSearchAddonConstructor(){return ds||(ds=(await vt(()=>import("./xterm-addon-search-bc0ba4f1.js").then(e=>e.x),["assets/xterm-addon-search-bc0ba4f1.js","assets/index-e8d740ba.js","assets/index-4826039e.css"]).then(e=>e.default??e)).SearchAddon),ds}async _getUnicode11Constructor(){return ms||(ms=(await vt(()=>import("./xterm-addon-unicode11-8ca21c0f.js").then(e=>e.x),["assets/xterm-addon-unicode11-8ca21c0f.js","assets/index-e8d740ba.js","assets/index-4826039e.css"]).then(e=>e.default??e)).Unicode11Addon),ms}async _getWebglAddonConstructor(){return gs||(gs=(await vt(()=>import("./xterm-addon-webgl-7fe24a16.js").then(e=>e.x),["assets/xterm-addon-webgl-7fe24a16.js","assets/index-e8d740ba.js","assets/index-4826039e.css"]).then(e=>e.default??e)).WebglAddon),gs}async _getSerializeAddonConstructor(){return us||(us=(await vt(()=>import("./xterm-addon-serialize-2ab9cace.js").then(e=>e.x),["assets/xterm-addon-serialize-2ab9cace.js","assets/index-e8d740ba.js","assets/index-4826039e.css"]).then(e=>e.default??e)).SerializeAddon),us}_disposeOfCanvasRenderer(){var e;try{(e=this._canvasAddon)==null||e.dispose()}catch{}this._canvasAddon=void 0}_disposeOfWebglRenderer(){var e;try{(e=this._webglAddon)==null||e.dispose()}catch{}this._webglAddon=void 0}async _measureRenderTime(){var s;const e=[];if(!((s=this._core._renderService)!=null&&s._renderer._renderLayers))return;const t=this._core._renderService._renderer._renderLayers[0],i=t==null?void 0:t.onGridChanged,n=()=>{if(e.shift(),e.sort((l,c)=>l-c)[Math.floor(e.length/2)]>50)if(this._configHelper.config.gpuAcceleration==="auto")st._suggestedRendererType="dom",this.updateConfig();else{const l=[{label:a("yes","Yes"),run:()=>this._configurationService.updateValue("terminal.integrated.gpuAcceleration","off",2)},{label:a("no","No"),run:()=>{}},{label:a("dontShowAgain","Don't Show Again"),isSecondary:!0,run:()=>this._storageService.store("terminal.integrated.neverMeasureRenderTime",!0,-1,1)}];this._notificationService.prompt(ie.Warning,a("terminal.slowRendering","Terminal GPU acceleration appears to be slow on your computer. Would you like to switch to disable it which may improve performance? [Read more about terminal settings](https://code.visualstudio.com/docs/editor/integrated-terminal#_changing-how-the-terminal-is-rendered)."),l)}};t.onGridChanged=(o,l,c)=>{const h=performance.now();i.call(t,o,l,c),e.push(performance.now()-h),e.length===20&&(n(),t.onGridChanged=i)}}_getXtermTheme(e){var h,m,p,w,f,_,S,y,R,C,D,B,A,j,$,H;e||(e=this._themeService.getColorTheme());const t=e.getColor(kc),i=this._backgroundColorProvider.getBackgroundColor(e),n=e.getColor(Tc)||t,s=e.getColor(Dc)||i,o=e.getColor(Pc),l=e.getColor(Ec),c=e.getColor(Ac)||void 0;return{background:i==null?void 0:i.toString(),foreground:t==null?void 0:t.toString(),cursor:n==null?void 0:n.toString(),cursorAccent:s==null?void 0:s.toString(),selectionBackground:o==null?void 0:o.toString(),selectionInactiveBackground:l==null?void 0:l.toString(),selectionForeground:c==null?void 0:c.toString(),black:(h=e.getColor(le[0]))==null?void 0:h.toString(),red:(m=e.getColor(le[1]))==null?void 0:m.toString(),green:(p=e.getColor(le[2]))==null?void 0:p.toString(),yellow:(w=e.getColor(le[3]))==null?void 0:w.toString(),blue:(f=e.getColor(le[4]))==null?void 0:f.toString(),magenta:(_=e.getColor(le[5]))==null?void 0:_.toString(),cyan:(S=e.getColor(le[6]))==null?void 0:S.toString(),white:(y=e.getColor(le[7]))==null?void 0:y.toString(),brightBlack:(R=e.getColor(le[8]))==null?void 0:R.toString(),brightRed:(C=e.getColor(le[9]))==null?void 0:C.toString(),brightGreen:(D=e.getColor(le[10]))==null?void 0:D.toString(),brightYellow:(B=e.getColor(le[11]))==null?void 0:B.toString(),brightBlue:(A=e.getColor(le[12]))==null?void 0:A.toString(),brightMagenta:(j=e.getColor(le[13]))==null?void 0:j.toString(),brightCyan:($=e.getColor(le[14]))==null?void 0:$.toString(),brightWhite:(H=e.getColor(le[15]))==null?void 0:H.toString()}}_updateTheme(e){this.raw.options.theme=this._getXtermTheme(e)}refresh(){this._updateTheme(),this._decorationAddon.refreshLayouts()}async _updateUnicodeVersion(){if(!this._unicode11Addon&&this._configHelper.config.unicodeVersion==="11"){const e=await this._getUnicode11Constructor();this._unicode11Addon=new e,this.raw.loadAddon(this._unicode11Addon)}this.raw.unicode.activeVersion!==this._configHelper.config.unicodeVersion&&(this.raw.unicode.activeVersion=this._configHelper.config.unicodeVersion)}_writeText(e){this.raw.write(e)}};Rn._suggestedRendererType=void 0;Rn=b([d(9,Z),d(10,O),d(11,Je),d(12,ee),d(13,Xe),d(14,he),d(15,ft)],Rn);var dr;(function(r){function e(){return Wn.INSTANCE.getTerminalContributions()}r.getTerminalContributions=e})(dr||(dr={}));class Wn{constructor(){this._terminalContributions=[]}registerTerminalContribution(e,t){this._terminalContributions.push({id:e,ctor:t})}getTerminalContributions(){return this._terminalContributions.slice(0)}}Wn.INSTANCE=new Wn;xe.add("terminal.contributions",Wn.INSTANCE);let Ui;function zd(r){return Ui||(Ui=qc.withAsyncBody(async e=>{const t=(await vt(()=>import("./xterm-3d8dc88c.js").then(i=>i.x),["assets/xterm-3d8dc88c.js","assets/index-e8d740ba.js","assets/index-4826039e.css"]).then(i=>i.default??i)).Terminal;t.strings.promptLabel=a("terminal.integrated.a11yPromptLabel","Terminal input"),t.strings.tooMuchOutput=r?a("terminal.integrated.useAccessibleBuffer","Use the accessible buffer {0} to manually review output",r.getLabel()):a("terminal.integrated.useAccessibleBufferNoKb","Use the Terminal: Focus Accessible Buffer command to manually review output"),e(t)}),Ui)}const Kd=["bash","zsh","pwsh","pwsh"];let Pe=class rt extends q{get domElement(){return this._wrapperElement}get usedShellIntegrationInjection(){return this._usedShellIntegrationInjection}get extEnvironmentVariableCollection(){return this._processManager.extEnvironmentVariableCollection}get waitOnExit(){var e;return((e=this._shellLaunchConfig.attachPersistentProcess)==null?void 0:e.waitOnExit)||this._shellLaunchConfig.waitOnExit}set waitOnExit(e){this._shellLaunchConfig.waitOnExit=e}get target(){return this._target}set target(e){this._target=e}get instanceId(){return this._instanceId}get resource(){return this._resource}get cols(){return this._fixedCols!==void 0?this._fixedCols:this._dimensionsOverride&&this._dimensionsOverride.cols?this._dimensionsOverride.forceExactSize?this._dimensionsOverride.cols:Math.min(Math.max(this._dimensionsOverride.cols,2),this._cols):this._cols}get rows(){return this._fixedRows!==void 0?this._fixedRows:this._dimensionsOverride&&this._dimensionsOverride.rows?this._dimensionsOverride.forceExactSize?this._dimensionsOverride.rows:Math.min(Math.max(this._dimensionsOverride.rows,2),this._rows):this._rows}get isDisposed(){return this._isDisposed}get fixedCols(){return this._fixedCols}get fixedRows(){return this._fixedRows}get maxCols(){return this._cols}get maxRows(){return this._rows}get processId(){return this._processManager.shellProcessId}get processReady(){return this._processManager.ptyProcessReady}get hasChildProcesses(){var e;return((e=this.shellLaunchConfig.attachPersistentProcess)==null?void 0:e.hasChildProcesses)||this._processManager.hasChildProcesses}get reconnectionProperties(){var e;return((e=this.shellLaunchConfig.attachPersistentProcess)==null?void 0:e.reconnectionProperties)||this.shellLaunchConfig.reconnectionProperties}get areLinksReady(){return this._areLinksReady}get initialDataEvents(){return this._initialDataEvents}get exitCode(){return this._exitCode}get exitReason(){return this._exitReason}get hadFocusOnExit(){return this._hadFocusOnExit}get isTitleSetByProcess(){return!!this._messageTitleDisposable}get shellLaunchConfig(){return this._shellLaunchConfig}get shellType(){return this._shellType}get os(){return this._processManager.os}get isRemote(){return this._processManager.remoteAuthority!==void 0}get remoteAuthority(){return this._processManager.remoteAuthority}get hasFocus(){return this._wrapperElement.contains(document.activeElement)??!1}get title(){return this._title}get titleSource(){return this._titleSource}get icon(){return this._getIcon()}get color(){return this._getColor()}get processName(){return this._processName}get sequence(){return this._sequence}get staticTitle(){return this._staticTitle}get workspaceFolder(){return this._workspaceFolder}get cwd(){return this._cwd}get initialCwd(){return this._initialCwd}get description(){var t;if(this._description)return this._description;const e=((t=this.shellLaunchConfig.attachPersistentProcess)==null?void 0:t.type)||this.shellLaunchConfig.type;if(e)return e==="Task"?a("terminalTypeTask","Task"):a("terminalTypeLocal","Local")}get userHome(){return this._userHome}get shellIntegrationNonce(){return this._processManager.shellIntegrationNonce}get injectedArgs(){return this._injectedArgs}constructor(e,t,i,n,s,o,l,c,h,m,p,w,f,_,S,y,R,C,D,B,A,j,$,H,He,Ze,Qn,ci,X,We,et,Jn){var Ur,jr,Xr,Yr,Qr,Jr,Zr,eo;if(super(),this._terminalShellTypeContextKey=e,this._terminalInRunCommandPicker=t,this._terminalSuggestWidgetVisibleContextKey=i,this._configHelper=n,this._shellLaunchConfig=s,this._contextKeyService=o,this._terminalProfileResolverService=c,this._pathService=h,this._keybindingService=m,this._notificationService=p,this._preferencesService=w,this._viewsService=f,this._clipboardService=_,this._themeService=S,this._configurationService=y,this._logService=R,this._dialogService=C,this._storageService=D,this._accessibilityService=B,this._productService=A,this._quickInputService=j,this._workspaceContextService=H,this._editorService=He,this._workspaceTrustRequestService=Ze,this._historyService=Qn,this._telemetryService=ci,this._openerService=X,this._commandService=We,this._audioCueService=et,this._viewDescriptorService=Jn,this._contributions=new Map,this._latestXtermWriteData=0,this._latestXtermParseData=0,this._title="",this._titleSource=be.Process,this._cols=0,this._rows=0,this._cwd=void 0,this._initialCwd=void 0,this._injectedArgs=void 0,this._layoutSettingsChanged=!0,this._areLinksReady=!1,this._initialDataEvents=[],this._widgetManager=new Ed,this._processName="",this._usedShellIntegrationInjection=!1,this.capabilities=new pd,this.disableLayout=!1,this._onExit=new v,this.onExit=this._onExit.event,this._onDisposed=this._register(new v),this.onDisposed=this._onDisposed.event,this._onProcessIdReady=this._register(new v),this.onProcessIdReady=this._onProcessIdReady.event,this._onTitleChanged=this._register(new v),this.onTitleChanged=this._onTitleChanged.event,this._onIconChanged=this._register(new v),this.onIconChanged=this._onIconChanged.event,this._onData=this._register(new v),this.onData=this._onData.event,this._onBinary=this._register(new v),this.onBinary=this._onBinary.event,this._onLineData=this._register(new v({onDidAddFirstListener:()=>this._onLineDataSetup()})),this.onLineData=this._onLineData.event,this._onRequestExtHostProcess=this._register(new v),this.onRequestExtHostProcess=this._onRequestExtHostProcess.event,this._onDimensionsChanged=this._register(new v),this.onDimensionsChanged=this._onDimensionsChanged.event,this._onMaximumDimensionsChanged=this._register(new v),this.onMaximumDimensionsChanged=this._onMaximumDimensionsChanged.event,this._onDidFocus=this._register(new v),this.onDidFocus=this._onDidFocus.event,this._onDidRequestFocus=this._register(new v),this.onDidRequestFocus=this._onDidRequestFocus.event,this._onDidBlur=this._register(new v),this.onDidBlur=this._onDidBlur.event,this._onDidInputData=this._register(new v),this.onDidInputData=this._onDidInputData.event,this._onRequestAddInstanceToGroup=this._register(new v),this.onRequestAddInstanceToGroup=this._onRequestAddInstanceToGroup.event,this._onDidChangeHasChildProcesses=this._register(new v),this.onDidChangeHasChildProcesses=this._onDidChangeHasChildProcesses.event,this._wrapperElement=document.createElement("div"),this._wrapperElement.classList.add("terminal-wrapper"),this._skipTerminalCommands=[],this._isExiting=!1,this._hadFocusOnExit=!1,this._isVisible=!1,this._isDisposed=!1,this._instanceId=rt._instanceIdCounter++,this._hasHadInput=!1,this._fixedRows=(jr=(Ur=s.attachPersistentProcess)==null?void 0:Ur.fixedDimensions)==null?void 0:jr.rows,this._fixedCols=(Yr=(Xr=s.attachPersistentProcess)==null?void 0:Xr.fixedDimensions)==null?void 0:Yr.cols,this._resource=Ba(this._workspaceContextService.getWorkspace().id,this.instanceId,this.title),(Qr=this._shellLaunchConfig.attachPersistentProcess)!=null&&Qr.hideFromUser&&(this._shellLaunchConfig.hideFromUser=this._shellLaunchConfig.attachPersistentProcess.hideFromUser),(Jr=this._shellLaunchConfig.attachPersistentProcess)!=null&&Jr.isFeatureTerminal&&(this._shellLaunchConfig.isFeatureTerminal=this._shellLaunchConfig.attachPersistentProcess.isFeatureTerminal),(Zr=this._shellLaunchConfig.attachPersistentProcess)!=null&&Zr.type&&(this._shellLaunchConfig.type=this._shellLaunchConfig.attachPersistentProcess.type),this.shellLaunchConfig.cwd){const W=typeof this._shellLaunchConfig.cwd=="string"?M.from({scheme:G.file,path:this._shellLaunchConfig.cwd}):this._shellLaunchConfig.cwd;W&&(this._workspaceFolder=xt(this._workspaceContextService.getWorkspaceFolder(W)))}if(!this._workspaceFolder){const W=this._historyService.getLastActiveWorkspaceRoot();this._workspaceFolder=W?xt(this._workspaceContextService.getWorkspaceFolder(W)):void 0}const de=this._register(o.createScoped(this._wrapperElement));this._scopedInstantiationService=l.createChild(new Rc([Ie,de])),this._terminalFocusContextKey=u.focus.bindTo(de),this._terminalHasFixedWidth=u.terminalHasFixedWidth.bindTo(de),this._terminalHasTextContextKey=u.textSelected.bindTo(de),this._terminalAltBufferActiveContextKey=u.altBufferActive.bindTo(de),this._terminalShellIntegrationEnabledContextKey=u.terminalShellIntegrationEnabled.bindTo(de),this._logService.trace(`terminalInstance#ctor (instanceId: ${this.instanceId})`,this._shellLaunchConfig),this._register(this.capabilities.onDidAddCapability(W=>{var oe;if(this._logService.debug("terminalInstance added capability",W),W===0)(oe=this.capabilities.get(0))==null||oe.onDidChangeCwd(ae=>{var ve;this._cwd=ae,this._setTitle(this.title,be.Config),(ve=this._scopedInstantiationService.invokeFunction(Ps))==null||ve.add(ae,{remoteAuthority:this.remoteAuthority})});else if(W===2){const ae=this.capabilities.get(2);ae==null||ae.onCommandFinished(ve=>{var Ae;ve.command.trim().length>0&&((Ae=this._scopedInstantiationService.invokeFunction(pn))==null||Ae.add(ve.command,{shellType:this._shellType}))})}})),this._register(this.capabilities.onDidRemoveCapability(W=>this._logService.debug("terminalInstance removed capability",W))),!this.shellLaunchConfig.executable&&!$.remoteAuthority&&this._terminalProfileResolverService.resolveIcon(this._shellLaunchConfig,Ue),this._icon=((eo=s.attachPersistentProcess)==null?void 0:eo.icon)||s.icon,this.shellLaunchConfig.customPtyImplementation&&this._setTitle(this._shellLaunchConfig.name,be.Api),this.statusList=this._scopedInstantiationService.createInstance(nr),this._initDimensions(),this._processManager=this._createProcessManager(),this._register(we(()=>{var W;return(W=this._dndObserver)==null?void 0:W.dispose()})),this._containerReadyBarrier=new xs(100),this._attachBarrier=new xs(1e3),this._xtermReadyPromise=this._createXterm(),this._xtermReadyPromise.then(async()=>{var W,oe,ae;if(await this._containerReadyBarrier.wait(),!this.shellLaunchConfig.customPtyImplementation&&((W=this._configHelper.config.shellIntegration)!=null&&W.enabled)&&!this.shellLaunchConfig.executable){const ve=await this._processManager.getBackendOS(),Ae=await this._terminalProfileResolverService.getDefaultProfile({remoteAuthority:this.remoteAuthority,os:ve});this.shellLaunchConfig.executable=Ae.path,this.shellLaunchConfig.args=Ae.args,this.shellLaunchConfig.isExtensionOwnedTerminal?((oe=this.shellLaunchConfig).icon??(oe.icon=Ae.icon),(ae=this.shellLaunchConfig).color??(ae.color=Ae.color)):(this.shellLaunchConfig.icon=Ae.icon,this.shellLaunchConfig.color=Ae.color)}await this._createProcess(),this.shellLaunchConfig.attachPersistentProcess&&(this._cwd=this.shellLaunchConfig.attachPersistentProcess.cwd,this._setTitle(this.shellLaunchConfig.attachPersistentProcess.title,this.shellLaunchConfig.attachPersistentProcess.titleSource),this.setShellType(this.shellType)),this._fixedCols&&await this._addScrollbar()}).catch(W=>{if(!this._isDisposed)throw W}),this._register(this._configurationService.onDidChangeConfiguration(async W=>{var ae,ve;W.affectsConfiguration("accessibility.verbosity.terminal")&&this._setAriaLabel((ae=this.xterm)==null?void 0:ae.raw,this._instanceId,this.title),W.affectsConfiguration("terminal.integrated")&&(this.updateConfig(),this.setVisible(this._isVisible)),["terminal.integrated.fontSize","terminal.integrated.fontFamily","terminal.integrated.fontWeight","terminal.integrated.fontWeightBold","terminal.integrated.letterSpacing","terminal.integrated.lineHeight","editor.fontFamily"].some(Ae=>W.affectsConfiguration(Ae))&&(this._layoutSettingsChanged=!0,await this._resize()),W.affectsConfiguration("terminal.integrated.unicodeVersion")&&this._updateUnicodeVersion(),W.affectsConfiguration("editor.accessibilitySupport")&&this.updateAccessibilitySupport(),(W.affectsConfiguration("terminal.integrated.tabs.title")||W.affectsConfiguration("terminal.integrated.tabs.separator")||W.affectsConfiguration("terminal.integrated.tabs.description"))&&((ve=this._labelComputer)==null||ve.refreshLabel())})),this._register(this._workspaceContextService.onDidChangeWorkspaceFolders(()=>{var W;return(W=this._labelComputer)==null?void 0:W.refreshLabel()})),this._register(this.onDidBlur(()=>{var W,oe;return(oe=(W=this.xterm)==null?void 0:W.suggestController)==null?void 0:oe.hideSuggestWidget()}));let Zn=window.setTimeout(()=>{Zn=void 0,this._initialDataEvents=void 0},1e4);this._register(we(()=>{Zn&&window.clearTimeout(Zn)}));const tl=dr.getTerminalContributions();for(const W of tl){if(this._contributions.has(W.id)){oo(new Error(`Cannot have two terminal contributions with the same id ${W.id}`));continue}let oe;try{oe=this._scopedInstantiationService.createInstance(W.ctor,this,this._processManager,this._widgetManager),this._contributions.set(W.id,oe)}catch(ae){oo(ae)}this._xtermReadyPromise.then(ae=>{var ve;(ve=oe.xtermReady)==null||ve.call(oe,ae)}),this.onDisposed(()=>{oe.dispose()})}}getContribution(e){return this._contributions.get(e)}_getIcon(){return this._icon||(this._icon=this._processManager.processState>=2?Un().getIcon(this._configurationService.getValue("terminal.integrated.tabs.defaultIcon")):void 0),this._icon}_getColor(){var e,t;if(this.shellLaunchConfig.color)return this.shellLaunchConfig.color;if((t=(e=this.shellLaunchConfig)==null?void 0:e.attachPersistentProcess)!=null&&t.color)return this.shellLaunchConfig.attachPersistentProcess.color;this._processManager.processState>=2}_initDimensions(){if(!this._container){this._cols=80,this._rows=30;return}const e=window.getComputedStyle(this._container),t=parseInt(e.width),i=parseInt(e.height);this._evaluateColsAndRows(t,i)}_evaluateColsAndRows(e,t){if(!e||!t)return this._setLastKnownColsAndRows(),null;const i=this._getDimension(e,t);if(!i)return this._setLastKnownColsAndRows(),null;const n=this.xterm?this.xterm.getFont():this._configHelper.getFont();if(!n.charWidth||!n.charHeight)return this._setLastKnownColsAndRows(),null;const s=i.width*window.devicePixelRatio,o=n.charWidth*window.devicePixelRatio+n.letterSpacing,l=Math.max(Math.floor(s/o),1),c=i.height*window.devicePixelRatio,h=Math.ceil(n.charHeight*window.devicePixelRatio),m=Math.floor(h*n.lineHeight),p=Math.max(Math.floor(c/m),1);return(this._cols!==l||this._rows!==p)&&(this._cols=l,this._rows=p,this._fireMaximumDimensionsChanged()),i.width}_setLastKnownColsAndRows(){rt._lastKnownGridDimensions&&(this._cols=rt._lastKnownGridDimensions.cols,this._rows=rt._lastKnownGridDimensions.rows)}_fireMaximumDimensionsChanged(){this._onMaximumDimensionsChanged.fire()}_getDimension(e,t){var l;const i=this.xterm?this.xterm.getFont():this._configHelper.getFont();if(!i||!i.charWidth||!i.charHeight||!((l=this.xterm)!=null&&l.raw.element))return;const n=window.getComputedStyle(this.xterm.raw.element),s=parseInt(n.paddingLeft)+parseInt(n.paddingRight),o=parseInt(n.paddingTop)+parseInt(n.paddingBottom);return rt._lastKnownCanvasDimensions=new at(Math.min(8e3,e-s),t+(this._hasScrollBar&&!this._horizontalScrollbar?-5:0)-2-o),rt._lastKnownCanvasDimensions}get persistentProcessId(){return this._processManager.persistentProcessId}get shouldPersist(){return this._processManager.shouldPersist&&!this.shellLaunchConfig.isTransient&&(!this.reconnectionProperties||this._configurationService.getValue("task.reconnection")===!0)}async _createXterm(){const e=await zd(this._keybindingService.lookupKeybinding("workbench.action.terminal.focusAccessibleBuffer",this._contextKeyService));if(this._isDisposed)throw new Is("Terminal disposed of during xterm.js creation");const t=this.shellLaunchConfig.hideFromUser||this.shellLaunchConfig.executable===void 0||this.shellType===void 0||!Kd.includes(this.shellType),i=this._scopedInstantiationService.createInstance(Rn,e,this._configHelper,this._cols,this._rows,{getBackgroundColor:o=>{const l=o.getColor(da);return l||(this.target===E.Editor?o.getColor(Wc):this._viewDescriptorService.getViewLocationById(z)===1?o.getColor(ua):o.getColor(Fc))}},this.capabilities,this._processManager.shellIntegrationNonce,this._terminalSuggestWidgetVisibleContextKey,t);this.xterm=i,this.updateAccessibilitySupport(),this.xterm.onDidRequestRunCommand(o=>{o.copyAsHtml?this.copySelection(!0,o.command):this.sendText(o.command.command,!o.noNewLine)}),this.xterm.onDidRequestFocus(()=>this.focus()),this.xterm.onDidRequestSendText(o=>this.sendText(o,!1));const n=this._shellLaunchConfig.initialText?new Promise(o=>this._writeInitialText(i,o)):void 0,s=new Ad(n);if(s.onLineData(o=>this._onLineData.fire(o)),this._lineDataEventAddon=s,setTimeout(()=>{i.raw.onBell(()=>{this._configHelper.config.enableBell&&(this.statusList.add({id:"bell",severity:ie.Warning,icon:k.bell,tooltip:a("bellStatus","Bell")},this._configHelper.config.bellDuration),this._audioCueService.playSound(ha.terminalBell.sound))})},1e3),i.raw.onSelectionChange(async()=>this._onSelectionChange()),i.raw.buffer.onBufferChange(()=>this._refreshAltBufferContextKey()),this._processManager.onProcessData(o=>this._onProcessData(o)),i.raw.onData(async o=>{await this._processManager.write(o),this._onDidInputData.fire(this)}),i.raw.onBinary(o=>this._processManager.processBinary(o)),this._processManager.onProcessReady(async o=>{this._processManager.os&&s.setOperatingSystem(this._processManager.os),this._processManager.os===1&&(i.raw.options.windowsMode=o.requiresWindowsMode||!1)}),this._processManager.onRestoreCommands(o=>{var l;return(l=this.xterm)==null?void 0:l.shellIntegration.deserialize(o)}),this._register(this._viewDescriptorService.onDidChangeLocation(({views:o})=>{o.some(l=>l.id===z)&&i.refresh()})),!this.capabilities.has(0)){let o=i.raw.onKey(l=>{new ao(l.domEvent).equals(3)&&this._updateProcessCwd()});this._register(this.capabilities.onDidAddCapability(l=>{l===0&&(o==null||o.dispose(),o=void 0)}))}return this._pathService.userHome().then(o=>{this._userHome=o.fsPath}),this._isVisible&&this._open(),i}async _onLineDataSetup(){(this.xterm||await this._xtermReadyPromise).raw.loadAddon(this._lineDataEventAddon)}async runCommand(e,t){var i;((i=this.capabilities.get(2))==null?void 0:i.hasInput)!==!1&&(await this.sendText("",!1),await kt(100)),await this.sendText(e,t,!t)}async runRecent(e,t,i){return this._scopedInstantiationService.invokeFunction(on,this,this._terminalInRunCommandPicker,e,t,i)}detachFromElement(){this._wrapperElement.remove(),this._container=void 0}attachToElement(e){var t;this._container!==e&&(this._attachBarrier.open(),this._container=e,this._container.appendChild(this._wrapperElement),(t=this.xterm)==null||t.refresh(),setTimeout(()=>this._initDragAndDrop(e)))}_open(){if(!this.xterm||this.xterm.raw.element)return;if(!this._container||!this._container.isConnected)throw new Error("A container element needs to be set with `attachToElement` and be part of the DOM before calling `_open`");const e=document.createElement("div");this._wrapperElement.appendChild(e),this._container.appendChild(this._wrapperElement);const t=this.xterm;this._wrapperElement.xterm=t.raw;const i=t.attachToElement(e);if(this._register(t.shellIntegration.onDidChangeStatus(()=>{this.hasFocus?this._setShellIntegrationContextKey():this._terminalShellIntegrationEnabledContextKey.reset()})),!t.raw.element||!t.raw.textarea)throw new Error("xterm elements not set after open");this._setAriaLabel(t.raw,this._instanceId,this._title),t.raw.attachCustomKeyEventHandler(n=>{if(this._isExiting)return!1;const s=new ao(n),o=this._keybindingService.softDispatch(s,s.target),l=o.kind===1&&this._configHelper.config.allowChords&&n.key!=="Escape";if(this._keybindingService.inChordMode||l)return n.preventDefault(),!1;const c="terminal.integrated.showTerminalConfigPrompt",h=["RightArrow","LeftArrow","UpArrow","DownArrow","Space","Meta","Control","Shift","Alt","","Delete","Backspace","Tab"];return this._storageService.getBoolean(c,-1,!0)&&!h.includes(n.key)&&!n.ctrlKey&&!n.shiftKey&&!n.altKey&&(this._hasHadInput=!0),o.kind===2&&o.commandId&&this._skipTerminalCommands.some(m=>m===o.commandId)&&!this._configHelper.config.sendKeybindingsToShell?(this._storageService.getBoolean(c,-1,!0)&&this._hasHadInput&&!Oc.includes(o.commandId)&&(this._notificationService.prompt(ie.Info,a("keybindingHandling","Some keybindings don't go to the terminal by default and are handled by {0} instead.",this._productService.nameLong),[{label:a("configureTerminalSettings","Configure Terminal Settings"),run:()=>{this._preferencesService.openSettings({jsonEditor:!1,query:"@id:terminal.integrated.commandsToSkipShell,terminal.integrated.sendKeybindingsToShell,terminal.integrated.allowChords"})}}]),this._storageService.store(c,!1,-1,0)),n.preventDefault(),!1):!(this._configHelper.config.allowMnemonics&&!De&&n.altKey||Nc.getTabFocusMode("terminalFocus")&&n.key==="Tab"||re&&n.altKey&&n.key==="F4"&&!n.ctrlKey||!Kt.clipboard.readText&&n.key==="v"&&n.ctrlKey)}),this._register(V(t.raw.element,"mousedown",()=>{const n=V(document,"mouseup",()=>{setTimeout(()=>this._refreshSelectionContextKey(),0),n.dispose()})})),this._register(V(t.raw.element,"touchstart",()=>{t.raw.focus()})),this._register(V(t.raw.element,"keyup",()=>{setTimeout(()=>this._refreshSelectionContextKey(),0)})),this._register(V(t.raw.textarea,"focus",()=>this._setFocus(!0))),this._register(V(t.raw.textarea,"blur",()=>this._setFocus(!1))),this._register(V(t.raw.textarea,"focusout",()=>this._setFocus(!1))),this._initDragAndDrop(this._container),this._widgetManager.attachToElement(i),this._lastLayoutDimensions&&this.layout(this._lastLayoutDimensions),this.updateConfig(),t.raw.options.disableStdin&&this._attachPressAnyKeyToCloseListener(t.raw)}_setFocus(e){e?(this._terminalFocusContextKey.set(!0),this._setShellIntegrationContextKey(),this._onDidFocus.fire(this)):(this.resetFocusContextKey(),this._onDidBlur.fire(this),this._refreshSelectionContextKey())}_setShellIntegrationContextKey(){this.xterm&&this._terminalShellIntegrationEnabledContextKey.set(this.xterm.shellIntegration.status===2)}resetFocusContextKey(){this._terminalFocusContextKey.reset(),this._terminalShellIntegrationEnabledContextKey.reset()}_initDragAndDrop(e){var i;(i=this._dndObserver)==null||i.dispose();const t=this._scopedInstantiationService.createInstance(ur,e);t.onDropTerminal(n=>this._onRequestAddInstanceToGroup.fire(n)),t.onDropFile(async n=>{this.focus(),await this.sendPath(n,!1)}),this._dndObserver=new Bc(e,t)}hasSelection(){return this.xterm?this.xterm.raw.hasSelection():!1}async copySelection(e,t){const i=await this._xtermReadyPromise;if(this.hasSelection()||e&&t)if(e){let s=function(o){o.clipboardData.types.includes("text/plain")||o.clipboardData.setData("text/plain",(t==null?void 0:t.getOutput())??""),o.clipboardData.setData("text/html",n),o.preventDefault()};const n=await i.getSelectionAsHtml(t);document.addEventListener("copy",s),document.execCommand("copy"),document.removeEventListener("copy",s)}else await this._clipboardService.writeText(i.raw.getSelection());else this._notificationService.warn(a("terminal.integrated.copySelection.noSelection","The terminal has no selection to copy"))}get selection(){return this.xterm&&this.hasSelection()?this.xterm.raw.getSelection():void 0}clearSelection(){var e;(e=this.xterm)==null||e.raw.clearSelection()}selectAll(){var e,t;(e=this.xterm)==null||e.raw.focus(),(t=this.xterm)==null||t.raw.selectAll()}_refreshAltBufferContextKey(){this._terminalAltBufferActiveContextKey.set(!!(this.xterm&&this.xterm.raw.buffer.active===this.xterm.raw.buffer.alternate))}async _shouldPasteText(e){var c;if((c=this.xterm)!=null&&c.raw.modes.bracketedPasteMode)return!0;const t=e.split(/\r?\n/);if(t.length===2&&t[1].trim().length===0||t.length===1||!this._configurationService.getValue("terminal.integrated.enableMultiLinePasteWarning"))return!0;const i=3,n=30;let s=a("preview","Preview:");for(let h=0;h<Math.min(t.length,i);h++){const m=t[h],p=m.length>n?`${m.slice(0,n)}…`:m;s+=`
${p}`}t.length>i&&(s+=`
…`);const{confirmed:o,checkboxChecked:l}=await this._dialogService.confirm({message:a("confirmMoveTrashMessageFilesAndDirectories","Are you sure you want to paste {0} lines of text into the terminal?",t.length),detail:s,primaryButton:a({key:"multiLinePasteButton",comment:["&& denotes a mnemonic"]},"&&Paste"),checkbox:{label:a("doNotAskAgain","Do not ask me again")}});return o&&l&&await this._configurationService.updateValue("terminal.integrated.enableMultiLinePasteWarning",!1),o}dispose(e){var t,i;if(!this._isDisposed){this._isDisposed=!0,this._logService.trace(`terminalInstance#dispose (instanceId: ${this.instanceId})`),J(this._widgetManager),(t=this.xterm)!=null&&t.raw.element&&(this._hadFocusOnExit=this.hasFocus),this._wrapperElement.xterm&&(this._wrapperElement.xterm=void 0),this._horizontalScrollbar&&(this._horizontalScrollbar.dispose(),this._horizontalScrollbar=void 0);try{(i=this.xterm)==null||i.dispose()}catch(n){this._logService.error("Exception occurred during xterm disposal",n)}Vc&&(this.resetFocusContextKey(),this._terminalHasTextContextKey.reset(),this._onDidBlur.fire(this)),this._pressAnyKeyToCloseListener&&(this._pressAnyKeyToCloseListener.dispose(),this._pressAnyKeyToCloseListener=void 0),this._exitReason===void 0&&(this._exitReason=e??Ke.Unknown),this._processManager.dispose(),this._onProcessExit(void 0),this._onDisposed.fire(this),super.dispose()}}async detachProcessAndDispose(e){await this._processManager.detachFromProcess(e===Ke.User),this.dispose(e)}focus(e){var t;this._refreshAltBufferContextKey(),this.xterm&&(e||!((t=window.getSelection())!=null&&t.toString()))&&(this.xterm.raw.focus(),this._onDidRequestFocus.fire())}async focusWhenReady(e){await this._xtermReadyPromise,await this._attachBarrier.wait(),this.focus(e)}async paste(){if(!this.xterm)return;const e=await this._clipboardService.readText();await this._shouldPasteText(e)&&(this.focus(),this.xterm.raw.paste(e))}async pasteSelection(){if(!this.xterm)return;const e=await this._clipboardService.readText("selection");await this._shouldPasteText(e)&&(this.focus(),this.xterm.raw.paste(e))}async sendText(e,t,i){var n,s,o,l;i&&((n=this.xterm)!=null&&n.raw.modes.bracketedPasteMode)&&(e=`\x1B[200~${e}\x1B[201~`),e=e.replace(/\r?\n/g,"\r"),t&&!e.endsWith("\r")&&(e+="\r"),await this._processManager.write(e),this._onDidInputData.fire(this),(o=(s=this.xterm)==null?void 0:s.suggestController)==null||o.handleNonXtermData(e),(l=this.xterm)==null||l.scrollToBottom()}async sendPath(e,t){return this.sendText(await this.preparePathForShell(e),t)}async preparePathForShell(e){return await this.processReady,Dd(e,this.shellLaunchConfig.executable,this.title,this.shellType,this._processManager.backend,this._processManager.os)}setVisible(e){this._isVisible=e,this._wrapperElement.classList.toggle("active",e),e&&this.xterm&&(this._open(),this._resize(),setTimeout(()=>this.xterm.forceRefresh(),0))}scrollDownLine(){var e;(e=this.xterm)==null||e.scrollDownLine()}scrollDownPage(){var e;(e=this.xterm)==null||e.scrollDownPage()}scrollToBottom(){var e;(e=this.xterm)==null||e.scrollToBottom()}scrollUpLine(){var e;(e=this.xterm)==null||e.scrollUpLine()}scrollUpPage(){var e;(e=this.xterm)==null||e.scrollUpPage()}scrollToTop(){var e;(e=this.xterm)==null||e.scrollToTop()}clearBuffer(){var e;(e=this.xterm)==null||e.clearBuffer()}_refreshSelectionContextKey(){const e=!!this._viewsService.getActiveViewWithId(z);let t=!1;const i=this._editorService.activeEditor;i&&(t=i instanceof ke),this._terminalHasTextContextKey.set((e||t)&&this.hasSelection())}_createProcessManager(){var i,n,s;let e;(i=this.shellLaunchConfig.attachPersistentProcess)!=null&&i.environmentVariableCollections&&(e=Hc(this.shellLaunchConfig.attachPersistentProcess.environmentVariableCollections));const t=this._scopedInstantiationService.createInstance(tr,this._instanceId,this._configHelper,(n=this.shellLaunchConfig)==null?void 0:n.cwd,e,(s=this.shellLaunchConfig.attachPersistentProcess)==null?void 0:s.shellIntegrationNonce);return this.capabilities.add(t.capabilities),t.onProcessReady(async o=>{this._onProcessIdReady.fire(this),this._initialCwd=await this.getInitialCwd(),this._labelComputer||(this._labelComputer=this._register(this._scopedInstantiationService.createInstance(mr,this._configHelper,this)),this._labelComputer.onDidChangeLabel(l=>{this._title=l.title,this._description=l.description,this._onTitleChanged.fire(this)})),this._shellLaunchConfig.name?this._setTitle(this._shellLaunchConfig.name,be.Api):(setTimeout(()=>{this._xtermReadyPromise.then(l=>{this._messageTitleDisposable=l.raw.onTitleChange(c=>this._onTitleChange(c))})}),this._setTitle(this._shellLaunchConfig.executable,be.Process))}),t.onProcessExit(o=>this._onProcessExit(o)),t.onDidChangeProperty(({type:o,value:l})=>{var c,h;switch(o){case"cwd":this._cwd=l,(c=this._labelComputer)==null||c.refreshLabel();break;case"initialCwd":this._initialCwd=l,this._cwd=this._initialCwd,this._setTitle(this.title,be.Config),this._icon=((h=this._shellLaunchConfig.attachPersistentProcess)==null?void 0:h.icon)||this._shellLaunchConfig.icon,this._onIconChanged.fire({instance:this,userInitiated:!1});break;case"title":this._setTitle(l??"",be.Process);break;case"overrideDimensions":this.setOverrideDimensions(l,!0);break;case"resolvedShellLaunchConfig":this._setResolvedShellLaunchConfig(l);break;case"shellType":this.setShellType(l);break;case"hasChildProcesses":this._onDidChangeHasChildProcesses.fire(l);break;case"usedShellIntegrationInjection":this._usedShellIntegrationInjection=!0;break}}),t.onProcessData(o=>{var l;(l=this._initialDataEvents)==null||l.push(o.data),this._onData.fire(o.data)}),t.onEnvironmentVariableInfoChanged(o=>this._onEnvironmentVariableInfoChanged(o)),t.onPtyDisconnect(()=>{this.xterm&&(this.xterm.raw.options.disableStdin=!0),this.statusList.add({id:"disconnected",severity:ie.Error,icon:k.debugDisconnect,tooltip:a("disconnectStatus","Lost connection to process")})}),t.onPtyReconnect(()=>{this.xterm&&(this.xterm.raw.options.disableStdin=!1),this.statusList.remove("disconnected")}),t}async _createProcess(){var i,n,s;if(this._isDisposed)return;this._historyService.getLastActiveWorkspaceRoot(G.file)?await this._trust()||this._onProcessExit({message:a("workspaceNotTrustedCreateTerminal","Cannot launch a terminal process in an untrusted workspace")}):this._cwd&&this._userHome&&this._cwd!==this._userHome&&this._onProcessExit({message:a("workspaceNotTrustedCreateTerminalCwd","Cannot launch a terminal process in an untrusted workspace with cwd {0} and userHome {1}",this._cwd,this._userHome)}),this._container&&this._cols===0&&this._rows===0&&(this._initDimensions(),(i=this.xterm)==null||i.raw.resize(this._cols||80,this._rows||30));const t=this.shellLaunchConfig.icon;await this._processManager.createProcess(this._shellLaunchConfig,this._cols||80,this._rows||30).then(o=>{o&&("message"in o?this._onProcessExit(o):"injectedArgs"in o&&(this._injectedArgs=o.injectedArgs))}),(n=this.xterm)!=null&&n.shellIntegration&&this.capabilities.add(this.xterm.shellIntegration.capabilities),(t!==this.shellLaunchConfig.icon||this.shellLaunchConfig.color)&&(this._icon=((s=this._shellLaunchConfig.attachPersistentProcess)==null?void 0:s.icon)||this._shellLaunchConfig.icon,this._onIconChanged.fire({instance:this,userInitiated:!1}))}registerMarker(){var e;return(e=this.xterm)==null?void 0:e.raw.registerMarker()}addBufferMarker(e){var t;(t=this.capabilities.get(4))==null||t.addMark(e)}scrollToMark(e,t,i){var n;(n=this.xterm)==null||n.markTracker.scrollToClosestMarker(e,t,i)}async freePortKillProcess(e,t){var i;await((i=this._processManager)==null?void 0:i.freePortKillProcess(e)),this.runCommand(t,!1)}_onProcessData(e){var i;const t=++this._latestXtermWriteData;e.trackCommit?e.writePromise=new Promise(n=>{var s;(s=this.xterm)==null||s.raw.write(e.data,()=>{this._latestXtermParseData=t,this._processManager.acknowledgeDataEvent(e.data.length),n()})}):(i=this.xterm)==null||i.raw.write(e.data,()=>{this._latestXtermParseData=t,this._processManager.acknowledgeDataEvent(e.data.length)})}async _onProcessExit(e){if(this._isExiting)return;const t=qd(e,this.shellLaunchConfig,this._processManager.processState,this._initialCwd);if(this._usedShellIntegrationInjection&&this._processManager.processState===4&&(t==null?void 0:t.code)!==0){this._relaunchWithShellIntegrationDisabled(t==null?void 0:t.message),this._onExit.fire(e);return}this._isExiting=!0,await this._flushXtermData(),this._logService.debug(`Terminal process exit (instanceId: ${this.instanceId}) with code ${this._exitCode}`),this._exitCode=t==null?void 0:t.code;const i=t==null?void 0:t.message;this._logService.debug(`Terminal process exit (instanceId: ${this.instanceId}) state ${this._processManager.processState}`);const n=this.waitOnExit;n&&this._processManager.processState!==5?this._xtermReadyPromise.then(s=>{switch(i&&s.raw.write(jt(i)),typeof n){case"string":s.raw.write(jt(n,{excludeLeadingNewLine:!0}));break;case"function":this.exitCode!==void 0&&s.raw.write(jt(n(this.exitCode),{excludeLeadingNewLine:!0}));break}s.raw.options.disableStdin=!0,s.raw.textarea&&this._attachPressAnyKeyToCloseListener(s.raw)}):(this.dispose(Ke.Process),i&&(this._processManager.processState===4||this._configHelper.config.showExitAlert?this._notificationService.notify({message:i,severity:ie.Error,actions:{primary:[this._scopedInstantiationService.createInstance(Es)]}}):this._logService.warn(i))),this._onExit.fire(e),this._isDisposed&&this._onExit.dispose()}_relaunchWithShellIntegrationDisabled(e){this._shellLaunchConfig.ignoreShellIntegration=!0,this.relaunch(),this.statusList.add({id:"shell-integration-attention-needed",severity:ie.Warning,icon:k.warning,tooltip:(`${e} `??"")+a("launchFailed.exitCodeOnlyShellIntegration","Disabling shell integration in user settings might help."),hoverActions:[{commandId:"workbench.action.terminal.learnMore",label:a("shellIntegration.learnMore","Learn more about shell integration"),run:()=>{this._openerService.open("https://code.visualstudio.com/docs/editor/integrated-terminal#_shell-integration")}},{commandId:"workbench.action.openSettings",label:a("shellIntegration.openSettings","Open user settings"),run:()=>{this._commandService.executeCommand("workbench.action.openSettings","terminal.integrated.shellIntegration.enabled")}}]}),this._telemetryService.publicLog2("terminal/shellIntegrationFailureProcessExit")}_flushXtermData(){if(this._latestXtermWriteData===this._latestXtermParseData)return Promise.resolve();let e=0;return new Promise(t=>{const i=setInterval(()=>{(this._latestXtermWriteData===this._latestXtermParseData||++e===5)&&(clearInterval(i),t())},20)})}_attachPressAnyKeyToCloseListener(e){e.textarea&&!this._pressAnyKeyToCloseListener&&(this._pressAnyKeyToCloseListener=V(e.textarea,"keypress",t=>{this._pressAnyKeyToCloseListener&&(this._pressAnyKeyToCloseListener.dispose(),this._pressAnyKeyToCloseListener=void 0,this.dispose(Ke.Process),t.preventDefault())}))}_writeInitialText(e,t){var n;if(!this._shellLaunchConfig.initialText){t==null||t();return}const i=typeof this._shellLaunchConfig.initialText=="string"?this._shellLaunchConfig.initialText:(n=this._shellLaunchConfig.initialText)==null?void 0:n.text;typeof this._shellLaunchConfig.initialText=="string"||this._shellLaunchConfig.initialText.trailingNewLine?e.raw.writeln(i,t):e.raw.write(i,t)}async reuseTerminal(e,t=!1){var n;(n=this._pressAnyKeyToCloseListener)==null||n.dispose(),this._pressAnyKeyToCloseListener=void 0;const i=this.xterm;i&&(t||await new Promise(s=>i.raw.write(`
\x1B[G`,s)),e.initialText&&(this._shellLaunchConfig.initialText=e.initialText,await new Promise(s=>this._writeInitialText(i,s))),this._isExiting&&this._shellLaunchConfig.waitOnExit&&(i.raw.options.disableStdin=!1,this._isExiting=!1),t&&i.clearDecorations()),this.statusList.remove("relaunch-needed"),t||(e.initialText=" "),this._shellLaunchConfig=e,await this._processManager.relaunch(this._shellLaunchConfig,this._cols||80,this._rows||30,t).then(s=>{s&&("message"in s?this._onProcessExit(s):"injectedArgs"in s&&(this._injectedArgs=s.injectedArgs))})}async setEscapeSequenceLogging(e){const t=await this._xtermReadyPromise;t.raw.options.logLevel=e?"debug":"info"}relaunch(){this.reuseTerminal(this._shellLaunchConfig,!0)}_onTitleChange(e){this.isTitleSetByProcess&&this._setTitle(e,be.Sequence)}async _trust(){return await this._workspaceTrustRequestService.requestWorkspaceTrust({message:a("terminal.requestTrust","Creating a terminal process requires executing code")})===!0}async _onSelectionChange(){this._configurationService.getValue("terminal.integrated.copyOnSelection")&&this.hasSelection()&&await this.copySelection()}async _updateProcessCwd(){if(!(this._isDisposed||this.shellLaunchConfig.customPtyImplementation))try{const e=await this._refreshProperty("cwd");if(typeof e!="string")throw new Error(`cwd is not a string ${e}`)}catch(e){if(e instanceof Error&&e.message==="Cannot refresh property when process is not set")return;throw e}}updateConfig(){this._setCommandsToSkipShell(this._configHelper.config.commandsToSkipShell),this._refreshEnvironmentVariableInfoWidgetState(this._processManager.environmentVariableInfo)}async _updateUnicodeVersion(){this._processManager.setUnicodeVersion(this._configHelper.config.unicodeVersion)}updateAccessibilitySupport(){this.xterm.raw.options.screenReaderMode=this._accessibilityService.isScreenReaderOptimized()}_setCommandsToSkipShell(e){const t=e.filter(i=>i[0]==="-").map(i=>i.slice(1));this._skipTerminalCommands=ma.filter(i=>!t.includes(i)).concat(e)}layout(e){var i;if(this._lastLayoutDimensions=e,!(this.disableLayout||e.width<=0||e.height<=0||!this._evaluateColsAndRows(e.width,e.height))){this._resize(),this._containerReadyBarrier.open();for(const n of this._contributions.values())this.xterm?(i=n.layout)==null||i.call(n,this.xterm,e):this._xtermReadyPromise.then(s=>{var o;return(o=n.layout)==null?void 0:o.call(n,s,e)})}}async _resize(){this._resizeNow(!1)}async _resizeNow(e){let t=this.cols,i=this.rows;if(this.xterm){if(this._isVisible&&this._layoutSettingsChanged){const n=this.xterm.getFont(),s=this._configHelper.config;this.xterm.raw.options.letterSpacing=n.letterSpacing,this.xterm.raw.options.lineHeight=n.lineHeight,this.xterm.raw.options.fontSize=n.fontSize,this.xterm.raw.options.fontFamily=n.fontFamily,this.xterm.raw.options.fontWeight=s.fontWeight,this.xterm.raw.options.fontWeightBold=s.fontWeightBold,this._initDimensions(),t=this.cols,i=this.rows,this._layoutSettingsChanged=!1}if(isNaN(t)||isNaN(i))return;(t!==this.xterm.raw.cols||i!==this.xterm.raw.rows)&&((this._fixedRows||this._fixedCols)&&await this._updateProperty("fixedDimensions",{cols:this._fixedCols,rows:this._fixedRows}),this._onDimensionsChanged.fire()),this.xterm.raw.resize(t,i),rt._lastKnownGridDimensions={cols:t,rows:i},this._isVisible&&this.xterm.forceUnpause()}e?this._processManager.setDimensions(t,i,!0):await this._processManager.setDimensions(t,i)}setShellType(e){this._shellType=e,e&&this._terminalShellTypeContextKey.set(e==null?void 0:e.toString())}_setAriaLabel(e,t,i){var s;const n=[];if(e&&e.textarea){i&&i.length>0?n.push(a("terminalTextBoxAriaLabelNumberAndTitle","Terminal {0}, {1}",t,i)):n.push(a("terminalTextBoxAriaLabel","Terminal {0}",t)),this._accessibilityService.isScreenReaderOptimized()||n.push(a("terminalScreenReaderMode","Run the command: Toggle Screen Reader Accessibility Mode for an optimized screen reader experience"));const l=(s=this._keybindingService.lookupKeybinding("workbench.action.terminal.showAccessibilityHelp"))==null?void 0:s.getLabel();this._configurationService.getValue("accessibility.verbosity.terminal")&&l&&n.push(a("terminalHelpAriaLabel","Use {0} for terminal accessibility help",l)),e.textarea.setAttribute("aria-label",n.join(`
`))}}_updateTitleProperties(e,t){if(!e)return this._processName;switch(t){case be.Process:if(this._processManager.os===1)e=vs.parse(e).name;else{const i=e.indexOf(" ");e.startsWith("/")?e=Jt(e):i>-1&&(e=e.substring(0,i))}this._processName=e;break;case be.Api:this._staticTitle=e,J(this._messageTitleDisposable),this._messageTitleDisposable=void 0;break;case be.Sequence:this._sequence=e,this._processManager.os===1&&(e.match(/^[a-zA-Z]:\\.+\.[a-zA-Z]{1,3}/)?(e=vs.parse(e).name,this._sequence=e):this._sequence=void 0);break}return this._titleSource=t,e}setOverrideDimensions(e,t=!1){this._dimensionsOverride&&this._dimensionsOverride.forceExactSize&&!e&&this._rows===0&&this._cols===0&&(this._cols=this._dimensionsOverride.cols,this._rows=this._dimensionsOverride.rows),this._dimensionsOverride=e,t?this._resizeNow(!0):this._resize()}async setFixedDimensions(){var i,n;const e=await this._quickInputService.input({title:a("setTerminalDimensionsColumn","Set Fixed Dimensions: Column"),placeHolder:"Enter a number of columns or leave empty for automatic width",validateInput:async s=>s.length>0&&!s.match(/^\d+$/)?{content:"Enter a number or leave empty size automatically",severity:ie.Error}:void 0});if(e===void 0)return;this._fixedCols=this._parseFixedDimension(e),(i=this._labelComputer)==null||i.refreshLabel(),this._terminalHasFixedWidth.set(!!this._fixedCols);const t=await this._quickInputService.input({title:a("setTerminalDimensionsRow","Set Fixed Dimensions: Row"),placeHolder:"Enter a number of rows or leave empty for automatic height",validateInput:async s=>s.length>0&&!s.match(/^\d+$/)?{content:"Enter a number or leave empty size automatically",severity:ie.Error}:void 0});t!==void 0&&(this._fixedRows=this._parseFixedDimension(t),(n=this._labelComputer)==null||n.refreshLabel(),await this._refreshScrollbar(),this._resize(),this.focus())}_parseFixedDimension(e){if(e==="")return;const t=parseInt(e);if(t<=0)throw new Error(`Could not parse dimension "${e}"`);return t}async toggleSizeToContentWidth(){var e,t;if((e=this.xterm)!=null&&e.raw.buffer.active){if(this._hasScrollBar)this._terminalHasFixedWidth.set(!1),this._fixedCols=void 0,this._fixedRows=void 0,this._hasScrollBar=!1,this._initDimensions(),await this._resize();else{const i=Math.max(this.maxCols,Math.min(this.xterm.getLongestViewportWrappedLineLength(),5e3));i>this.xterm.raw.cols&&(this._fixedCols=i)}await this._refreshScrollbar(),(t=this._labelComputer)==null||t.refreshLabel(),this.focus()}}_refreshScrollbar(){return this._fixedCols||this._fixedRows?this._addScrollbar():this._removeScrollbar()}async _addScrollbar(){var t;const e=(this.xterm?this.xterm.getFont():this._configHelper.getFont()).charWidth;if(!(!((t=this.xterm)!=null&&t.raw.element)||!this._container||!e||!this._fixedCols)&&(this._wrapperElement.classList.add("fixed-dims"),this._hasScrollBar=!0,this._initDimensions(),this._fixedRows=this._rows-1,await this._resize(),this._terminalHasFixedWidth.set(!0),this._horizontalScrollbar||(this._horizontalScrollbar=this._register(new Gc(this._wrapperElement,{vertical:2,horizontal:1,useShadows:!1,scrollYToX:!1,consumeMouseWheelIfScrollbarIsNeeded:!1})),this._container.appendChild(this._horizontalScrollbar.getDomNode())),this._horizontalScrollbar.setScrollDimensions({width:this.xterm.raw.element.clientWidth,scrollWidth:this._fixedCols*e+40}),this._horizontalScrollbar.getDomNode().style.paddingBottom="16px",re))for(let i=this.xterm.raw.buffer.active.viewportY;i<this.xterm.raw.buffer.active.length;i++){const n=this.xterm.raw.buffer.active.getLine(i);n._line.isWrapped=!1}}async _removeScrollbar(){!this._container||!this._horizontalScrollbar||(this._horizontalScrollbar.getDomNode().remove(),this._horizontalScrollbar.dispose(),this._horizontalScrollbar=void 0,this._wrapperElement.remove(),this._wrapperElement.classList.remove("fixed-dims"),this._container.appendChild(this._wrapperElement))}_setResolvedShellLaunchConfig(e){this._shellLaunchConfig.args=e.args,this._shellLaunchConfig.cwd=e.cwd,this._shellLaunchConfig.executable=e.executable,this._shellLaunchConfig.env=e.env}_onEnvironmentVariableInfoChanged(e){var t,i;e.requiresAction&&((i=(t=this.xterm)==null?void 0:t.raw.textarea)==null||i.setAttribute("aria-label",a("terminalStaleTextBoxAriaLabel","Terminal {0} environment is stale, run the 'Show Environment Information' command for more information",this._instanceId))),this._refreshEnvironmentVariableInfoWidgetState(e)}_refreshEnvironmentVariableInfoWidgetState(e){if(!e){this.statusList.remove("relaunch-needed"),this.statusList.remove("env-var-info-changes-active");return}if(e.requiresAction&&this._configHelper.config.environmentChangesRelaunch&&!this._processManager.hasWrittenData&&(!this._shellLaunchConfig.isFeatureTerminal||this.reconnectionProperties&&this._configurationService.getValue("task.reconnection")===!0)&&!this._shellLaunchConfig.customPtyImplementation&&!this._shellLaunchConfig.isExtensionOwnedTerminal&&!this._shellLaunchConfig.attachPersistentProcess){this.relaunch();return}const t=er(this.shellLaunchConfig.cwd,this._workspaceContextService,this._historyService);this.statusList.add(e.getStatus({workspaceFolder:t}))}async toggleEscapeSequenceLogging(){const e=await this._xtermReadyPromise;return e.raw.options.logLevel=e.raw.options.logLevel==="debug"?"info":"debug",e.raw.options.logLevel==="debug"}async getInitialCwd(){return this._initialCwd||(this._initialCwd=this._processManager.initialCwd),this._initialCwd}async getCwd(){return this.capabilities.has(0)?this.capabilities.get(0).getCwd():this.capabilities.has(1)?this.capabilities.get(1).getCwd():this._processManager.initialCwd}async _refreshProperty(e){return await this.processReady,this._processManager.refreshProperty(e)}async _updateProperty(e,t){return this._processManager.updateProperty(e,t)}async rename(e){this._setTitle(e,be.Api)}_setTitle(e,t){var s,o;const i=!e;e=this._updateTitleProperties(e,t);const n=e!==this._title;this._title=e,(s=this._labelComputer)==null||s.refreshLabel(i),this._setAriaLabel((o=this.xterm)==null?void 0:o.raw,this._instanceId,this._title),n&&this._onTitleChanged.fire(this)}async changeIcon(){const e=[];for(const i of ks())e.push({label:`$(${i.id})`,description:`${i.id}`,icon:i});const t=await this._quickInputService.pick(e,{matchOnDescription:!0});t&&(this._icon=t.icon,this._onIconChanged.fire({instance:this,userInitiated:!0}))}async changeColor(){if(!this._getIcon())return;const t=this._themeService.getColorTheme(),i=$c(t),n=ea(t),s=[];for(const m of i){const p=ct(m);s.push({label:`$(${k.circleFilled.id}) ${m.replace("terminal.ansi","")}`,id:m,description:m,iconClasses:[p]})}s.push({type:"separator"});const o={label:"Reset to default"};s.push(o),document.body.appendChild(n);const l=this._quickInputService.createQuickPick();l.items=s,l.matchOnDescription=!0,l.show();const c=[],h=await new Promise(m=>{c.push(l.onDidHide(()=>m(void 0))),c.push(l.onDidAccept(()=>m(l.selectedItems[0])))});J(c),h&&(this.shellLaunchConfig.color=h.id,this._onIconChanged.fire({instance:this,userInitiated:!0})),l.hide(),document.body.removeChild(n)}selectPreviousSuggestion(){var e,t;(t=(e=this.xterm)==null?void 0:e.suggestController)==null||t.selectPreviousSuggestion()}selectPreviousPageSuggestion(){var e,t;(t=(e=this.xterm)==null?void 0:e.suggestController)==null||t.selectPreviousPageSuggestion()}selectNextSuggestion(){var e,t;(t=(e=this.xterm)==null?void 0:e.suggestController)==null||t.selectNextSuggestion()}selectNextPageSuggestion(){var e,t;(t=(e=this.xterm)==null?void 0:e.suggestController)==null||t.selectNextPageSuggestion()}async acceptSelectedSuggestion(e){var t,i;(i=(t=this.xterm)==null?void 0:t.suggestController)==null||i.acceptSelectedSuggestion(e)}hideSuggestWidget(){var e,t;(t=(e=this.xterm)==null?void 0:e.suggestController)==null||t.hideSuggestWidget()}forceScrollbarVisibility(){this._wrapperElement.classList.add("force-scrollbar")}resetScrollbarVisibility(){this._wrapperElement.classList.remove("force-scrollbar")}};Pe._instanceIdCounter=1;Pe.__decorator=b([Ve(50)],Pe.prototype,"_fireMaximumDimensionsChanged",null);Pe.__decorator=b([Ve(1e3)],Pe.prototype,"relaunch",null);Pe.__decorator=b([Ve(2e3)],Pe.prototype,"_updateProcessCwd",null);Pe.__decorator=b([Ve(50)],Pe.prototype,"_resize",null);Pe=b([d(5,Ie),d(6,O),d(7,pt),d(8,oa),d(9,bi),d(10,ee),d(11,Wi),d(12,Nr),d(13,Ar),d(14,he),d(15,Z),d(16,Je),d(17,Rt),d(18,Xe),d(19,Lc),d(20,ai),d(21,me),d(22,si),d(23,ge),d(24,mt),d(25,Mc),d(26,Vn),d(27,ft),d(28,Ri),d(29,ue),d(30,ca),d(31,Ni)],Pe);let ur=class extends q{get onDropFile(){return this._onDropFile.event}get onDropTerminal(){return this._onDropTerminal.event}constructor(e,t,i){super(),this._container=e,this._layoutService=t,this._viewDescriptorService=i,this._onDropFile=new v,this._onDropTerminal=new v,this._register(we(()=>this._clearDropOverlay()))}_clearDropOverlay(){this._dropOverlay&&this._dropOverlay.parentElement&&this._dropOverlay.parentElement.removeChild(this._dropOverlay),this._dropOverlay=void 0}onDragEnter(e){if(fi(e,qt.FILES,qt.RESOURCES,"Terminals",un.FILES)){if(this._dropOverlay||(this._dropOverlay=document.createElement("div"),this._dropOverlay.classList.add("terminal-drop-overlay")),fi(e,"Terminals")){const t=this._getDropSide(e);this._dropOverlay.classList.toggle("drop-before",t==="before"),this._dropOverlay.classList.toggle("drop-after",t==="after")}this._dropOverlay.parentElement||this._container.appendChild(this._dropOverlay)}}onDragLeave(e){this._clearDropOverlay()}onDragEnd(e){this._clearDropOverlay()}onDragOver(e){if(!(!e.dataTransfer||!this._dropOverlay)){if(fi(e,"Terminals")){const t=this._getDropSide(e);this._dropOverlay.classList.toggle("drop-before",t==="before"),this._dropOverlay.classList.toggle("drop-after",t==="after")}this._dropOverlay.style.opacity="1"}}async onDrop(e){if(this._clearDropOverlay(),!e.dataTransfer)return;const t=Va(e);if(t){for(const o of t){const l=this._getDropSide(e);this._onDropTerminal.fire({uri:o,side:l})}return}let i;const n=e.dataTransfer.getData(qt.RESOURCES);n&&(i=M.parse(JSON.parse(n)[0]));const s=e.dataTransfer.getData(un.FILES);!i&&s&&(i=M.file(JSON.parse(s)[0])),!i&&e.dataTransfer.files.length>0&&e.dataTransfer.files[0].path&&(i=M.file(e.dataTransfer.files[0].path)),i&&this._onDropFile.fire(i)}_getDropSide(e){const t=this._container;if(!t)return"after";const i=t.getBoundingClientRect();return this._getViewOrientation()===1?e.clientX-i.left<i.width/2?"before":"after":e.clientY-i.top<i.height/2?"before":"after"}_getViewOrientation(){const e=this._layoutService.getPanelPosition();return this._viewDescriptorService.getViewLocationById(z)===1&&e===2?1:0}};ur=b([d(1,Xn),d(2,Ni)],ur);let mr=class extends q{get title(){return this._title}get description(){return this._description}constructor(e,t,i,n){super(),this._configHelper=e,this._instance=t,this._fileService=i,this._workspaceContextService=n,this._title="",this._description="",this._onDidChangeLabel=this._register(new v),this.onDidChangeLabel=this._onDidChangeLabel.event}refreshLabel(e){this._title=this.computeLabel(this._configHelper.config.tabs.title,"title",e),this._description=this.computeLabel(this._configHelper.config.tabs.description,"description"),(this._title!==this._instance.title||this._description!==this._instance.description||e)&&this._onDidChangeLabel.fire({title:this._title,description:this._description})}computeLabel(e,t,i){var m,p,w,f;const n=((m=this._instance.shellLaunchConfig.attachPersistentProcess)==null?void 0:m.type)||this._instance.shellLaunchConfig.type,s={cwd:this._instance.cwd||this._instance.initialCwd||"",cwdFolder:"",workspaceFolder:this._instance.workspaceFolder?Jt(this._instance.workspaceFolder.uri.fsPath):void 0,local:n==="Local"?n:void 0,process:this._instance.processName,sequence:this._instance.sequence,task:n==="Task"?n:void 0,fixedDimensions:this._instance.fixedCols?this._instance.fixedRows?`↔${this._instance.fixedCols} ↕${this._instance.fixedRows}`:`↔${this._instance.fixedCols}`:this._instance.fixedRows?`↕${this._instance.fixedRows}`:"",separator:{label:this._configHelper.config.tabs.separator}};if(e=e.trim(),!e)return t==="title"&&this._instance.processName||"";if(!i&&this._instance.staticTitle&&t==="title")return this._instance.staticTitle.replace(/[\n\r\t]/g,"")||((p=s.process)==null?void 0:p.replace(/[\n\r\t]/g,""))||"";const o=this._instance.capabilities.has(0)||this._instance.capabilities.has(1),c=this._workspaceContextService.getWorkspace().folders.length>1;if(s.cwd&&o&&(!this._instance.shellLaunchConfig.isFeatureTerminal||t==="title")){const _=M.from({scheme:((w=this._instance.workspaceFolder)==null?void 0:w.uri.scheme)||G.file,path:this._instance.cwd?zc(this._instance.cwd):void 0});let S=!1;if(c)S=!0;else if((f=this._instance.workspaceFolder)!=null&&f.uri){const y=this._fileService.hasCapability(this._instance.workspaceFolder.uri,1024);S=_.fsPath.localeCompare(this._instance.workspaceFolder.uri.fsPath,void 0,{sensitivity:y?"case":"base"})!==0}S&&(s.cwdFolder=Jt(s.cwd))}const h=Kc(e,s).replace(/[\n\r\t]/g,"").trim();return h===""&&t==="title"?this._instance.processName||"":h}};mr=b([d(2,gt),d(3,ge)],mr);function qd(r,e,t,i){if(r===void 0||r===0)return{code:r,message:void 0};const n=typeof r=="number"?r:r.code;let s;switch(typeof r){case"number":{let o;e.executable&&(o=e.executable,typeof e.args=="string"?o+=` ${e.args}`:e.args&&e.args.length&&(o+=e.args.map(l=>` '${l}'`).join())),t===4?o?s=a("launchFailed.exitCodeAndCommandLine",'The terminal process "{0}" failed to launch (exit code: {1}).',o,n):s=a("launchFailed.exitCodeOnly","The terminal process failed to launch (exit code: {0}).",n):o?s=a("terminated.exitCodeAndCommandLine",'The terminal process "{0}" terminated with exit code: {1}.',o,n):s=a("terminated.exitCodeOnly","The terminal process terminated with exit code: {0}.",n);break}case"object":{if(r.message.toString().includes("Could not find pty with id"))break;let o=r.message;const l=r.message.match(/.*error code:\s*(\d+).*$/);if(l)switch(l.length>1?parseInt(l[1]):void 0){case 5:o=`Access was denied to the path containing your executable "${e.executable}". Manage and change your permissions to get this to work`;break;case 267:o=`Invalid starting directory "${i}", review your terminal.integrated.cwd setting`;break;case 1260:o="Windows cannot open this program because it has been prevented by a software restriction policy. For more information, open Event Viewer or contact your system Administrator";break}s=a("launchFailed.errorMessage","The terminal process failed to launch: {0}.",o);break}}return{code:n,message:s}}let gr=class extends q{get onDidCreateInstance(){return this._onDidCreateInstance.event}constructor(e,t,i){super(),this._instantiationService=e,this._contextKeyService=t,this._environmentService=i,this._backendRegistration=new Map,this._onDidCreateInstance=new v,this._terminalShellTypeContextKey=u.shellType.bindTo(this._contextKeyService),this._terminalInRunCommandPicker=u.inTerminalRunCommandPicker.bindTo(this._contextKeyService),this._terminalSuggestWidgetVisibleContextKey=u.suggestWidgetVisible.bindTo(this._contextKeyService),this._configHelper=e.createInstance(Ln);for(const n of[void 0,i.remoteAuthority]){let s;const o=new Promise(l=>s=l);this._backendRegistration.set(n,{promise:o,resolve:s})}}createInstance(e,t){const i=this.convertProfileToShellLaunchConfig(e),n=this._instantiationService.createInstance(Pe,this._terminalShellTypeContextKey,this._terminalInRunCommandPicker,this._terminalSuggestWidgetVisibleContextKey,this._configHelper,i);return n.target=t,this._onDidCreateInstance.fire(n),n}convertProfileToShellLaunchConfig(e,t){if(e&&"profileName"in e){const i=e;return i.path?{executable:i.path,args:i.args,env:i.env,icon:i.icon,color:i.color,name:i.overrideName?i.profileName:void 0,cwd:t}:e}return e?(t&&(e.cwd=t),e):{}}async getBackend(e){var i;let t=xe.as(Ts.Backend).getTerminalBackend(e);return t||(await((i=this._backendRegistration.get(e))==null?void 0:i.promise),t=xe.as(Ts.Backend).getTerminalBackend(e)),t}didRegisterBackend(e){var t;(t=this._backendRegistration.get(e))==null||t.resolve()}};gr=b([d(0,O),d(1,Ie),d(2,si)],gr);const qa={type:["string","null"],enum:["terminal.ansiBlack","terminal.ansiRed","terminal.ansiGreen","terminal.ansiYellow","terminal.ansiBlue","terminal.ansiMagenta","terminal.ansiCyan","terminal.ansiWhite"],default:null},Ua={type:"string",enum:Array.from(ks(),r=>r.id),markdownEnumDescriptions:Array.from(ks(),r=>`$(${r.id})`)},zt={args:{description:a("terminalProfile.args","An optional set of arguments to run the shell executable with."),type:"array",items:{type:"string"}},overrideName:{description:a("terminalProfile.overrideName","Controls whether or not the profile name overrides the auto detected one."),type:"boolean"},icon:{description:a("terminalProfile.icon","A codicon ID to associate with the terminal icon."),...Ua},color:{description:a("terminalProfile.color","A theme color ID to associate with the terminal icon."),...qa},env:{markdownDescription:a("terminalProfile.env","An object with environment variables that will be added to the terminal profile process. Set to `null` to delete environment variables from the base environment."),type:"object",additionalProperties:{type:["string","null"]},default:{}}},ps={type:"object",required:["path"],properties:{path:{description:a("terminalProfile.path","A single path to a shell executable or an array of paths that will be used as fallbacks when one fails."),type:["string","array"],items:{type:"string"}},...zt}},fs={type:"object",required:["path"],properties:{path:{description:a("terminalAutomationProfile.path","A single path to a shell executable."),type:["string"],items:{type:"string"}},...zt}};function _s(r){const e=r===2?"linux":r===1?"osx":"windows";return a({key:"terminal.integrated.profile",comment:["{0} is the platform, {1} is a code block, {2} and {3} are a link start and end"]},`A set of terminal profile customizations for {0} which allows adding, removing or changing how terminals are launched. Profiles are made up of a mandatory path, optional arguments and other presentation options.

To override an existing profile use its profile name as the key, for example:

{1}

{2}Read more about configuring profiles{3}.`,Uc(r),'```json\n"terminal.integrated.profile.'+e+'": {\n  "bash": null\n}\n```',"[","](https://code.visualstudio.com/docs/terminal/profiles)")}const Ao=a("terminal.integrated.shell.linux.deprecation","This is deprecated, the new recommended way to configure your default shell is by creating a terminal profile in {0} and setting its profile name as the default in {1}. This will currently take priority over the new profiles settings but that will change in the future.","`#terminal.integrated.profiles.linux#`","`#terminal.integrated.defaultProfile.linux#`"),Lo=a("terminal.integrated.shell.osx.deprecation","This is deprecated, the new recommended way to configure your default shell is by creating a terminal profile in {0} and setting its profile name as the default in {1}. This will currently take priority over the new profiles settings but that will change in the future.","`#terminal.integrated.profiles.osx#`","`#terminal.integrated.defaultProfile.osx#`"),Mo=a("terminal.integrated.shell.windows.deprecation","This is deprecated, the new recommended way to configure your default shell is by creating a terminal profile in {0} and setting its profile name as the default in {1}. This will currently take priority over the new profiles settings but that will change in the future.","`#terminal.integrated.profiles.windows#`","`#terminal.integrated.defaultProfile.windows#`"),Ud=a("terminal.integrated.automationShell.linux.deprecation","This is deprecated, the new recommended way to configure your automation shell is by creating a terminal automation profile with {0}. This will currently take priority over the new automation profile settings but that will change in the future.","`#terminal.integrated.automationProfile.linux#`"),jd=a("terminal.integrated.automationShell.osx.deprecation","This is deprecated, the new recommended way to configure your automation shell is by creating a terminal automation profile with {0}. This will currently take priority over the new automation profile settings but that will change in the future.","`#terminal.integrated.automationProfile.osx#`"),Xd=a("terminal.integrated.automationShell.windows.deprecation","This is deprecated, the new recommended way to configure your automation shell is by creating a terminal automation profile with {0}. This will currently take priority over the new automation profile settings but that will change in the future.","`#terminal.integrated.automationProfile.windows#`"),Yd={id:"terminal",order:100,title:a("terminalIntegratedConfigurationTitle","Integrated Terminal"),type:"object",properties:{["terminal.integrated.automationShell.linux"]:{restricted:!0,markdownDescription:a({key:"terminal.integrated.automationShell.linux",comment:["{0} and {1} are the `shell` and `shellArgs` settings keys"]},"A path that when set will override {0} and ignore {1} values for automation-related terminal usage like tasks and debug.","`terminal.integrated.shell.linux`","`shellArgs`"),type:["string","null"],default:null,markdownDeprecationMessage:Ud},["terminal.integrated.automationShell.osx"]:{restricted:!0,markdownDescription:a({key:"terminal.integrated.automationShell.osx",comment:["{0} and {1} are the `shell` and `shellArgs` settings keys"]},"A path that when set will override {0} and ignore {1} values for automation-related terminal usage like tasks and debug.","`terminal.integrated.shell.osx`","`shellArgs`"),type:["string","null"],default:null,markdownDeprecationMessage:jd},["terminal.integrated.automationShell.windows"]:{restricted:!0,markdownDescription:a({key:"terminal.integrated.automationShell.windows",comment:["{0} and {1} are the `shell` and `shellArgs` settings keys"]},"A path that when set will override {0} and ignore {1} values for automation-related terminal usage like tasks and debug.","`terminal.integrated.shell.windows`","`shellArgs`"),type:["string","null"],default:null,markdownDeprecationMessage:Xd},["terminal.integrated.automationProfile.linux"]:{restricted:!0,markdownDescription:a("terminal.integrated.automationProfile.linux","The terminal profile to use on Linux for automation-related terminal usage like tasks and debug. This setting will currently be ignored if {0} (now deprecated) is set.","`terminal.integrated.automationShell.linux`"),type:["object","null"],default:null,anyOf:[{type:"null"},fs],defaultSnippets:[{body:{path:"${1}",icon:"${2}"}}]},["terminal.integrated.automationProfile.osx"]:{restricted:!0,markdownDescription:a("terminal.integrated.automationProfile.osx","The terminal profile to use on macOS for automation-related terminal usage like tasks and debug. This setting will currently be ignored if {0} (now deprecated) is set.","`terminal.integrated.automationShell.osx`"),type:["object","null"],default:null,anyOf:[{type:"null"},fs],defaultSnippets:[{body:{path:"${1}",icon:"${2}"}}]},["terminal.integrated.automationProfile.windows"]:{restricted:!0,markdownDescription:a("terminal.integrated.automationProfile.windows","The terminal profile to use for automation-related terminal usage like tasks and debug. This setting will currently be ignored if {0} (now deprecated) is set.","`terminal.integrated.automationShell.windows`"),type:["object","null"],default:null,anyOf:[{type:"null"},fs],defaultSnippets:[{body:{path:"${1}",icon:"${2}"}}]},["terminal.integrated.shell.linux"]:{restricted:!0,markdownDescription:a("terminal.integrated.shell.linux","The path of the shell that the terminal uses on Linux. [Read more about configuring the shell](https://code.visualstudio.com/docs/editor/integrated-terminal#_terminal-profiles)."),type:["string","null"],default:null,markdownDeprecationMessage:Ao},["terminal.integrated.shell.osx"]:{restricted:!0,markdownDescription:a("terminal.integrated.shell.osx","The path of the shell that the terminal uses on macOS. [Read more about configuring the shell](https://code.visualstudio.com/docs/editor/integrated-terminal#_terminal-profiles)."),type:["string","null"],default:null,markdownDeprecationMessage:Lo},["terminal.integrated.shell.windows"]:{restricted:!0,markdownDescription:a("terminal.integrated.shell.windows","The path of the shell that the terminal uses on Windows. [Read more about configuring the shell](https://code.visualstudio.com/docs/editor/integrated-terminal#_terminal-profiles)."),type:["string","null"],default:null,markdownDeprecationMessage:Mo},["terminal.integrated.shellArgs.linux"]:{restricted:!0,markdownDescription:a("terminal.integrated.shellArgs.linux","The command line arguments to use when on the Linux terminal. [Read more about configuring the shell](https://code.visualstudio.com/docs/editor/integrated-terminal#_terminal-profiles)."),type:"array",items:{type:"string"},default:[],markdownDeprecationMessage:Ao},["terminal.integrated.shellArgs.osx"]:{restricted:!0,markdownDescription:a("terminal.integrated.shellArgs.osx","The command line arguments to use when on the macOS terminal. [Read more about configuring the shell](https://code.visualstudio.com/docs/editor/integrated-terminal#_terminal-profiles)."),type:"array",items:{type:"string"},default:["-l"],markdownDeprecationMessage:Lo},["terminal.integrated.shellArgs.windows"]:{restricted:!0,markdownDescription:a("terminal.integrated.shellArgs.windows","The command line arguments to use when on the Windows terminal. [Read more about configuring the shell](https://code.visualstudio.com/docs/editor/integrated-terminal#_terminal-profiles)."),anyOf:[{type:"array",items:{type:"string",markdownDescription:a("terminal.integrated.shellArgs.windows","The command line arguments to use when on the Windows terminal. [Read more about configuring the shell](https://code.visualstudio.com/docs/editor/integrated-terminal#_terminal-profiles).")}},{type:"string",markdownDescription:a("terminal.integrated.shellArgs.windows.string","The command line arguments in [command-line format](https://msdn.microsoft.com/en-au/08dfcab2-eb6e-49a4-80eb-87d4076c98c6) to use when on the Windows terminal. [Read more about configuring the shell](https://code.visualstudio.com/docs/editor/integrated-terminal#_terminal-profiles).")}],default:[],markdownDeprecationMessage:Mo},["terminal.integrated.profiles.windows"]:{restricted:!0,markdownDescription:_s(3),type:"object",default:{PowerShell:{source:"PowerShell",icon:"terminal-powershell"},"Command Prompt":{path:["${env:windir}\\Sysnative\\cmd.exe","${env:windir}\\System32\\cmd.exe"],args:[],icon:"terminal-cmd"},"Git Bash":{source:"Git Bash"}},additionalProperties:{anyOf:[{type:"object",required:["source"],properties:{source:{description:a("terminalProfile.windowsSource","A profile source that will auto detect the paths to the shell. Note that non-standard executable locations are not supported and must be created manually in a new profile."),enum:["PowerShell","Git Bash"]},...zt}},{type:"object",required:["extensionIdentifier","id","title"],properties:{extensionIdentifier:{description:a("terminalProfile.windowsExtensionIdentifier","The extension that contributed this profile."),type:"string"},id:{description:a("terminalProfile.windowsExtensionId","The id of the extension terminal"),type:"string"},title:{description:a("terminalProfile.windowsExtensionTitle","The name of the extension terminal"),type:"string"},...zt}},{type:"null"},ps]}},["terminal.integrated.profiles.osx"]:{restricted:!0,markdownDescription:_s(1),type:"object",default:{bash:{path:"bash",args:["-l"],icon:"terminal-bash"},zsh:{path:"zsh",args:["-l"]},fish:{path:"fish",args:["-l"]},tmux:{path:"tmux",icon:"terminal-tmux"},pwsh:{path:"pwsh",icon:"terminal-powershell"}},additionalProperties:{anyOf:[{type:"object",required:["extensionIdentifier","id","title"],properties:{extensionIdentifier:{description:a("terminalProfile.osxExtensionIdentifier","The extension that contributed this profile."),type:"string"},id:{description:a("terminalProfile.osxExtensionId","The id of the extension terminal"),type:"string"},title:{description:a("terminalProfile.osxExtensionTitle","The name of the extension terminal"),type:"string"},...zt}},{type:"null"},ps]}},["terminal.integrated.profiles.linux"]:{restricted:!0,markdownDescription:_s(2),type:"object",default:{bash:{path:"bash",icon:"terminal-bash"},zsh:{path:"zsh"},fish:{path:"fish"},tmux:{path:"tmux",icon:"terminal-tmux"},pwsh:{path:"pwsh",icon:"terminal-powershell"}},additionalProperties:{anyOf:[{type:"object",required:["extensionIdentifier","id","title"],properties:{extensionIdentifier:{description:a("terminalProfile.linuxExtensionIdentifier","The extension that contributed this profile."),type:"string"},id:{description:a("terminalProfile.linuxExtensionId","The id of the extension terminal"),type:"string"},title:{description:a("terminalProfile.linuxExtensionTitle","The name of the extension terminal"),type:"string"},...zt}},{type:"null"},ps]}},["terminal.integrated.useWslProfiles"]:{description:a("terminal.integrated.useWslProfiles","Controls whether or not WSL distros are shown in the terminal dropdown"),type:"boolean",default:!0},["terminal.integrated.inheritEnv"]:{scope:1,description:a("terminal.integrated.inheritEnv","Whether new shells should inherit their environment from VS Code, which may source a login shell to ensure $PATH and other development variables are initialized. This has no effect on Windows."),type:"boolean",default:!0},["terminal.integrated.persistentSessionScrollback"]:{scope:1,markdownDescription:a("terminal.integrated.persistentSessionScrollback","Controls the maximum amount of lines that will be restored when reconnecting to a persistent terminal session. Increasing this will restore more lines of scrollback at the cost of more memory and increase the time it takes to connect to terminals on start up. This setting requires a restart to take effect and should be set to a value less than or equal to `#terminal.integrated.scrollback#`."),type:"number",default:100},["terminal.integrated.showLinkHover"]:{scope:1,description:a("terminal.integrated.showLinkHover","Whether to show hovers for links in the terminal output."),type:"boolean",default:!0},["terminal.integrated.ignoreProcessNames"]:{description:a("terminal.integrated.confirmIgnoreProcesses","A set of process names to ignore when using the {0} setting.","`terminal.integrated.confirmOnKill`"),type:"array",items:{type:"string",uniqueItems:!0},default:["starship","oh-my-posh","bash","zsh"]}}};function Qd(){xe.as(Vr.Configuration).registerConfiguration(Yd),ja()}let ws;function ja(r,e){const t=xe.as(Vr.Configuration);let i;r&&(i=Ta(r==null?void 0:r.profiles,e));const n=ws;ws={id:"terminal",order:100,title:a("terminalIntegratedConfigurationTitle","Integrated Terminal"),type:"object",properties:{["terminal.integrated.defaultProfile.linux"]:{restricted:!0,markdownDescription:a("terminal.integrated.defaultProfile.linux","The default profile used on Linux. This setting will currently be ignored if either {0} or {1} are set.","`terminal.integrated.shell.linux`","`terminal.integrated.shellArgs.linux`"),type:["string","null"],default:null,enum:(r==null?void 0:r.os)===3?i==null?void 0:i.values:void 0,markdownEnumDescriptions:(r==null?void 0:r.os)===3?i==null?void 0:i.markdownDescriptions:void 0},["terminal.integrated.defaultProfile.osx"]:{restricted:!0,markdownDescription:a("terminal.integrated.defaultProfile.osx","The default profile used on macOS. This setting will currently be ignored if either {0} or {1} are set.","`terminal.integrated.shell.osx`","`terminal.integrated.shellArgs.osx`"),type:["string","null"],default:null,enum:(r==null?void 0:r.os)===2?i==null?void 0:i.values:void 0,markdownEnumDescriptions:(r==null?void 0:r.os)===2?i==null?void 0:i.markdownDescriptions:void 0},["terminal.integrated.defaultProfile.windows"]:{restricted:!0,markdownDescription:a("terminal.integrated.defaultProfile.windows","The default profile used on Windows. This setting will currently be ignored if either {0} or {1} are set.","`terminal.integrated.shell.windows`","`terminal.integrated.shellArgs.windows`"),type:["string","null"],default:null,enum:(r==null?void 0:r.os)===1?i==null?void 0:i.values:void 0,markdownEnumDescriptions:(r==null?void 0:r.os)===1?i==null?void 0:i.markdownDescriptions:void 0}}},t.updateConfigurations({add:[ws],remove:n?[n]:[]})}let Mi=class{get onDidChangeAvailableProfiles(){return this._onDidChangeAvailableProfiles.event}get profilesReady(){return this._profilesReadyBarrier.wait().then(()=>{})}get availableProfiles(){return this._platformConfigJustRefreshed||this.refreshAvailableProfiles(),this._availableProfiles||[]}get contributedProfiles(){return this._contributedProfiles||[]}constructor(e,t,i,n,s,o,l){this._contextKeyService=e,this._configurationService=t,this._terminalContributionService=i,this._extensionService=n,this._remoteAgentService=s,this._environmentService=o,this._terminalInstanceService=l,this._contributedProfiles=[],this._platformConfigJustRefreshed=!1,this._profileProviders=new Map,this._onDidChangeAvailableProfiles=new v,this._extensionService.onDidChangeExtensions(()=>this.refreshAvailableProfiles()),this._webExtensionContributedProfileContextKey=u.webExtensionContributedProfile.bindTo(this._contextKeyService),this._updateWebContextKey(),this._profilesReadyBarrier=new xs(2e4),this.refreshAvailableProfiles(),this._setupConfigListener()}async _setupConfigListener(){const e=await this.getPlatformKey();this._configurationService.onDidChangeConfiguration(async t=>{(t.affectsConfiguration("terminal.integrated.defaultProfile."+e)||t.affectsConfiguration("terminal.integrated.profiles."+e)||t.affectsConfiguration("terminal.integrated.useWslProfiles"))&&(t.source!==7?(this.refreshAvailableProfiles(),this._platformConfigJustRefreshed=!1):this._platformConfigJustRefreshed=!0)})}getDefaultProfileName(){return this._defaultProfileName}getDefaultProfile(e){let t;if(e){if(t=this._configurationService.getValue(`terminal.integrated.defaultProfile.${this._getOsKey(e)}`),!t||typeof t!="string")return}else t=this._defaultProfileName;if(t)return this.availableProfiles.find(i=>i.profileName===t&&!i.isAutoDetected)}_getOsKey(e){switch(e){case 3:return"linux";case 2:return"osx";case 1:return"windows"}}refreshAvailableProfiles(){this._refreshAvailableProfilesNow()}async _refreshAvailableProfilesNow(){const e=await this._detectProfiles(!0),t=!Ds(e,this._availableProfiles,Jd),i=await this._updateContributedProfiles();(t||i)&&(this._availableProfiles=e,this._onDidChangeAvailableProfiles.fire(this._availableProfiles),this._profilesReadyBarrier.open(),this._updateWebContextKey(),await this._refreshPlatformConfig(this._availableProfiles))}async _updateContributedProfiles(){const e=await this.getPlatformKey(),t=[],i=this._configurationService.getValue("terminal.integrated.profiles."+e);for(const[o,l]of Object.entries(i))l===null&&t.push(o);const n=Array.from(this._terminalContributionService.terminalProfiles.filter(o=>!t.includes(o.title))),s=!Ds(n,this._contributedProfiles,Zd);return this._contributedProfiles=n,s}getContributedProfileProvider(e,t){const i=this._profileProviders.get(e);return i==null?void 0:i.get(t)}async _detectProfiles(e){const t=await this._terminalInstanceService.getBackend(this._environmentService.remoteAuthority);if(!t)return this._availableProfiles||[];const i=await this.getPlatformKey();return this._defaultProfileName=this._configurationService.getValue(`terminal.integrated.defaultProfile.${i}`)??void 0,t.getProfiles(this._configurationService.getValue(`terminal.integrated.profiles.${i}`),this._defaultProfileName,e)}_updateWebContextKey(){this._webExtensionContributedProfileContextKey.set(Qt&&this._contributedProfiles.length>0)}async _refreshPlatformConfig(e){const t=await this._remoteAgentService.getEnvironment();ja({os:(t==null?void 0:t.os)||Ue,profiles:e},this._contributedProfiles),Wa(e)}async getPlatformKey(){const e=await this._remoteAgentService.getEnvironment();return e?e.os===1?"windows":e.os===2?"osx":"linux":re?"windows":De?"osx":"linux"}registerTerminalProfileProvider(e,t,i){let n=this._profileProviders.get(e);return n||(n=new Map,this._profileProviders.set(e,n)),n.set(t,i),we(()=>this._profileProviders.delete(t))}async registerContributedProfile(e){const t=await this.getPlatformKey(),i=await this._configurationService.getValue(`terminal.integrated.profiles.${t}`);if(typeof i=="object"){const n={extensionIdentifier:e.extensionIdentifier,icon:e.options.icon,id:e.id,title:e.title,color:e.options.color};i[e.title]=n}await this._configurationService.updateValue(`terminal.integrated.profiles.${t}`,i,2)}async getContributedDefaultProfile(e){if(e&&!e.extHostTerminalId&&!("executable"in e)){const t=await this.getPlatformKey(),i=this._configurationService.getValue(`terminal.integrated.defaultProfile.${t}`);return this.contributedProfiles.find(s=>s.title===i)}}};Mi.__decorator=b([ga(2e3)],Mi.prototype,"refreshAvailableProfiles",null);Mi=b([d(0,Ie),d(1,Z),d(2,pa),d(3,se),d(4,Ye),d(5,si),d(6,Ne)],Mi);function Jd(r,e){return r.profileName===e.profileName&&Da(r.args,e.args)&&r.color===e.color&&Xh(r.icon,e.icon)&&r.isAutoDetected===e.isAutoDetected&&r.isDefault===e.isDefault&&r.overrideName===e.overrideName&&r.path===e.path}function Zd(r,e){return r.extensionIdentifier===e.extensionIdentifier&&r.color===e.color&&r.icon===e.icon&&r.id===e.id&&r.title===e.title}class eu{constructor(){this._linkProviders=new Set,this._onDidAddLinkProvider=new v,this._onDidRemoveLinkProvider=new v}get linkProviders(){return this._linkProviders}get onDidAddLinkProvider(){return this._onDidAddLinkProvider.event}get onDidRemoveLinkProvider(){return this._onDidRemoveLinkProvider.event}registerLinkProvider(e){const t=[];return this._linkProviders.add(e),this._onDidAddLinkProvider.fire(e),{dispose:()=>{for(const i of t)i.dispose();this._linkProviders.delete(e),this._onDidRemoveLinkProvider.fire(e)}}}}const ji="Generated";let Ro=!1;class pr{get defaultProfileName(){return this._defaultProfileName}constructor(e,t,i,n,s,o,l,c,h,m){this._context=e,this._configurationService=t,this._configurationResolverService=i,this._historyService=n,this._logService=s,this._terminalProfileService=o,this._workspaceContextService=l,this._remoteAgentService=c,this._storageService=h,this._notificationService=m,this._iconRegistry=Un(),this._remoteAgentService.getConnection()?this._remoteAgentService.getEnvironment().then(p=>this._primaryBackendOs=(p==null?void 0:p.os)||Ue):this._primaryBackendOs=Ue,this._configurationService.onDidChangeConfiguration(p=>{(p.affectsConfiguration("terminal.integrated.defaultProfile.windows")||p.affectsConfiguration("terminal.integrated.defaultProfile.osx")||p.affectsConfiguration("terminal.integrated.defaultProfile.linux"))&&this._refreshDefaultProfileName()}),this._terminalProfileService.onDidChangeAvailableProfiles(()=>this._refreshDefaultProfileName()),this.showProfileMigrationNotification()}async _refreshDefaultProfileName(){var e,t;this._primaryBackendOs&&(this._defaultProfileName=(t=await this.getDefaultProfile({remoteAuthority:(e=this._remoteAgentService.getConnection())==null?void 0:e.remoteAuthority,os:this._primaryBackendOs}))==null?void 0:t.profileName)}resolveIcon(e,t){if(e.icon){e.icon=this._getCustomIcon(e.icon)||this.getDefaultIcon();return}if(e.customPtyImplementation){e.icon=this.getDefaultIcon();return}if(e.executable)return;const i=this._getUnresolvedRealDefaultProfile(t);i&&(e.icon=i.icon),e.icon||(e.icon=this.getDefaultIcon())}getDefaultIcon(e){return this._iconRegistry.getIcon(this._configurationService.getValue("terminal.integrated.tabs.defaultIcon",{resource:e}))||k.terminal}async resolveShellLaunchConfig(e,t){let i;e.executable?i=await this._resolveProfile({path:e.executable,args:e.args,profileName:ji,isDefault:!1},t):i=await this.getDefaultProfile(t),e.executable=i.path,e.args=i.args,i.env&&(e.env?e.env={...e.env,...i.env}:e.env=i.env);const n=e===void 0||typeof e.cwd=="string"?void 0:e.cwd;e.icon=this._getCustomIcon(e.icon)||this._getCustomIcon(i.icon)||this.getDefaultIcon(n),i.overrideName&&(e.name=i.profileName),e.color=e.color||i.color||this._configurationService.getValue("terminal.integrated.tabs.defaultColor",{resource:n}),e.useShellEnvironment===void 0&&(e.useShellEnvironment=this._configurationService.getValue("terminal.integrated.inheritEnv"))}async getDefaultShell(e){return(await this.getDefaultProfile(e)).path}async getDefaultShellArgs(e){return(await this.getDefaultProfile(e)).args||[]}async getDefaultProfile(e){return this._resolveProfile(await this._getUnresolvedDefaultProfile(e),e)}getEnvironment(e){return this._context.getEnvironment(e)}_getCustomIcon(e){if(e){if(typeof e=="string")return L.fromId(e);if(L.isThemeIcon(e))return e;if(M.isUri(e)||ze(e))return M.revive(e);if(typeof e=="object"&&"light"in e&&"dark"in e){const t=e;if((M.isUri(t.light)||ze(t.light))&&(M.isUri(t.dark)||ze(t.dark)))return{light:M.revive(t.light),dark:M.revive(t.dark)}}}}async _getUnresolvedDefaultProfile(e){if(e.allowAutomationShell){const n=this._getUnresolvedAutomationShellProfile(e);if(n)return n}const t=await this._getUnresolvedShellSettingDefaultProfile(e);if(t)return this._setIconForAutomation(e,t);await this._terminalProfileService.profilesReady;const i=this._getUnresolvedRealDefaultProfile(e.os);return i?this._setIconForAutomation(e,i):this._setIconForAutomation(e,await this._getUnresolvedFallbackDefaultProfile(e))}_setIconForAutomation(e,t){if(e.allowAutomationShell){const i=lo(t);return i.icon=k.tools,i}return t}_getUnresolvedRealDefaultProfile(e){return this._terminalProfileService.getDefaultProfile(e)}async _getUnresolvedShellSettingDefaultProfile(e){let t=this._configurationService.getValue(`terminal.integrated.shell.${this._getOsKey(e.os)}`);if(!this._isValidShell(t)){const o=this._configurationService.inspect(`terminal.integrated.shellArgs.${this._getOsKey(e.os)}`);if(!o.userValue&&!o.workspaceValue)return}(!t||!this._isValidShell(t))&&(t=await this._context.getDefaultSystemShell(e.remoteAuthority,e.os));let i;const n=this._configurationService.getValue(`terminal.integrated.shellArgs.${this._getOsKey(e.os)}`);this._isValidShellArgs(n,e.os)&&(i=n),i===void 0&&(e.os===2&&i===void 0&&hi(t).name.match(/(zsh|bash|fish)/)?i=["--login"]:i=[]);const s=this._guessProfileIcon(t);return{profileName:ji,path:t,args:i,icon:s,isDefault:!1}}async _getUnresolvedFallbackDefaultProfile(e){const t=await this._context.getDefaultSystemShell(e.remoteAuthority,e.os);if(e.os===Ue){let s=this._terminalProfileService.availableProfiles.find(o=>hi(o.path).name===hi(t).name);if(s)return e.allowAutomationShell&&(s=lo(s),s.icon=k.tools),s}let i;e.os===2&&hi(t).name.match(/(zsh|bash)/)?i=["--login"]:i=[];const n=this._guessProfileIcon(t);return{profileName:ji,path:t,args:i,icon:n,isDefault:!1}}_getUnresolvedAutomationShellProfile(e){const t=this._configurationService.getValue(`terminal.integrated.automationShell.${this._getOsKey(e.os)}`);if(t&&typeof t=="string")return{path:t,profileName:ji,isDefault:!1,icon:k.tools};const i=this._configurationService.getValue(`terminal.integrated.automationProfile.${this._getOsKey(e.os)}`);if(this._isValidAutomationProfile(i,e.os))return i.icon=this._getCustomIcon(i.icon)||k.tools,i}async _resolveProfile(e,t){if(t.os===1){const o=await this._context.getEnvironment(t.remoteAuthority),l=!!o.hasOwnProperty("PROCESSOR_ARCHITEW6432"),c=o.windir;if(!l&&c){const h=Cs(c,"Sysnative").replace(/\//g,"\\").toLowerCase();e.path&&e.path.toLowerCase().indexOf(h)===0&&(e.path=Cs(c,"System32",e.path.substr(h.length+1)))}e.path&&(e.path=e.path.replace(/\//g,"\\"))}const i=await this._context.getEnvironment(t.remoteAuthority),n=this._historyService.getLastActiveWorkspaceRoot(t.remoteAuthority?G.vscodeRemote:G.file),s=n?xt(this._workspaceContextService.getWorkspaceFolder(n)):void 0;return e.path=await this._resolveVariables(e.path,i,s),e.args&&(typeof e.args=="string"?e.args=await this._resolveVariables(e.args,i,s):e.args=await Promise.all(e.args.map(o=>this._resolveVariables(o,i,s)))),e}async _resolveVariables(e,t,i){try{e=await this._configurationResolverService.resolveWithEnvironment(t,i,e)}catch(n){this._logService.error("Could not resolve shell",n)}return e}_getOsKey(e){switch(e){case 3:return"linux";case 2:return"osx";case 1:return"windows"}}_guessProfileIcon(e){switch(hi(e).name){case"bash":return k.terminalBash;case"pwsh":case"powershell":return k.terminalPowershell;case"tmux":return k.terminalTmux;case"cmd":return k.terminalCmd;default:return}}_isValidShell(e){return e?typeof e=="string":!1}_isValidShellArgs(e,t){return!!(e===void 0||t===1&&typeof e=="string"||Array.isArray(e)&&e.every(i=>typeof i=="string"))}async createProfileFromShellAndShellArgs(e,t){var c,h;const i=(c=this._terminalProfileService.availableProfiles)==null?void 0:c.find(m=>m.path!==e?!1:m.args===void 0||typeof m.args=="string"?m.args===t:m.path===e&&Ds(m.args,t||[])),n=await this.getDefaultProfile({remoteAuthority:(h=this._remoteAgentService.getConnection())==null?void 0:h.remoteAuthority,os:this._primaryBackendOs});n.profileName=`${n.path} (migrated)`;const s=i||n,o=this._isValidShellArgs(t,this._primaryBackendOs)?t:s.args,l={profileName:s.profileName,path:s.path,args:o,isDefault:!0};return i&&i.profileName===l.profileName&&i.path===l.path&&Da(i.args,l.args)?i.profileName:l}_isValidAutomationProfile(e,t){return e==null||typeof e!="object"?!1:"path"in e&&typeof e.path=="string"}async showProfileMigrationNotification(){(!!this._configurationService.getValue("terminal.integrated.shell."+this._primaryBackendOs)||!!this._configurationService.inspect("terminal.integrated.shellArgs."+this._primaryBackendOs).userValue)&&!!this._configurationService.getValue("terminal.integrated.defaultProfile."+this._primaryBackendOs)&&this._storageService.getBoolean("terminals.integrated.profile-migration",1,!0)&&!Ro&&(this._notificationService.prompt(Re.Info,a("terminalProfileMigration","The terminal is using deprecated shell/shellArgs settings, do you want to migrate it to a profile?"),[{label:a("migrateToProfile","Migrate"),run:async()=>{const t=this._configurationService.getValue("terminal.integrated.shell."+this._primaryBackendOs),i=this._configurationService.getValue("terminal.integrated.shellArgs."+this._primaryBackendOs),n=await this.createProfileFromShellAndShellArgs(t,i);if(typeof n=="string")await this._configurationService.updateValue("terminal.integrated.defaultProfile."+this._primaryBackendOs,n),this._logService.trace(`migrated from shell/shellArgs, using existing profile ${n}`);else{const s={...this._configurationService.inspect("terminal.integrated.profiles."+this._primaryBackendOs).userValue},o={path:n.path};n.args&&(o.args=n.args),s[n.profileName]=o,await this._configurationService.updateValue("terminal.integrated.profiles."+this._primaryBackendOs,s),await this._configurationService.updateValue("terminal.integrated.defaultProfile."+this._primaryBackendOs,n.profileName),this._logService.trace(`migrated from shell/shellArgs, ${t} ${i} to profile ${JSON.stringify(n)}`)}await this._configurationService.updateValue("terminal.integrated.shell."+this._primaryBackendOs,void 0),await this._configurationService.updateValue("terminal.integrated.shellArgs."+this._primaryBackendOs,void 0)}}],{neverShowAgain:{id:"terminals.integrated.profile-migration",scope:Zo.WORKSPACE}}),Ro=!0)}}pr.__decorator=b([Ve(200)],pr.prototype,"_refreshDefaultProfileName",null);let fr=class extends pr{constructor(e,t,i,n,s,o,l,c,h,m){super({getDefaultSystemShell:async(p,w)=>{const f=await m.getBackend(p);if(!f)throw new Is(`Cannot get default system shell when there is no backend for remote authority '${p}'`);return f.getDefaultSystemShell(w)},getEnvironment:async p=>{const w=await m.getBackend(p);if(!w)throw new Is(`Cannot get environment when there is no backend for remote authority '${p}'`);return w.getEnvironment()}},t,e,i,n,o,s,l,c,h)}};fr=b([d(0,Bn),d(1,Z),d(2,Vn),d(3,Je),d(4,ge),d(5,Qe),d(6,Ye),d(7,Xe),d(8,ee),d(9,Ne)],fr);let At=class{get onDidChangeCollections(){return this._onDidChangeCollections.event}constructor(e,t){this._extensionService=e,this._storageService=t,this.collections=new Map,this._onDidChangeCollections=new v,this._storageService.remove("terminal.integrated.environmentVariableCollections",1);const i=this._storageService.get("terminal.integrated.environmentVariableCollectionsV2",1);i&&(JSON.parse(i).forEach(s=>this.collections.set(s.extensionIdentifier,{persistent:!0,map:jc(s.collection),descriptionMap:Xc(s.description)})),this._invalidateExtensionCollections()),this.mergedCollection=this._resolveMergedCollection(),this._extensionService.onDidChangeExtensions(()=>this._invalidateExtensionCollections())}set(e,t){this.collections.set(e,t),this._updateCollections()}delete(e){this.collections.delete(e),this._updateCollections()}_updateCollections(){this._persistCollectionsEventually(),this.mergedCollection=this._resolveMergedCollection(),this._notifyCollectionUpdatesEventually()}_persistCollectionsEventually(){this._persistCollections()}_persistCollections(){const e=[];this.collections.forEach((i,n)=>{i.persistent&&e.push({extensionIdentifier:n,collection:Yc(this.collections.get(n).map),description:Qc(i.descriptionMap)})});const t=JSON.stringify(e);this._storageService.store("terminal.integrated.environmentVariableCollectionsV2",t,1,1)}_notifyCollectionUpdatesEventually(){this._notifyCollectionUpdates()}_notifyCollectionUpdates(){this._onDidChangeCollections.fire(this.mergedCollection)}_resolveMergedCollection(){return new $a(this.collections)}async _invalidateExtensionCollections(){await this._extensionService.whenInstalledExtensionsRegistered();const e=this._extensionService.extensions;let t=!1;this.collections.forEach((i,n)=>{e.some(o=>o.identifier.value===n)||(this.collections.delete(n),t=!0)}),t&&this._updateCollections()}};At.__decorator=b([ga(1e3)],At.prototype,"_persistCollectionsEventually",null);At.__decorator=b([Ve(1e3)],At.prototype,"_notifyCollectionUpdatesEventually",null);At=b([d(0,se),d(1,Xe)],At);class tu{get providers(){return this._providers}constructor(){this._selectors=new Map,this._providers=new Map,this._onDidRegisterProvider=new v,this.onDidRegisterProvider=this._onDidRegisterProvider.event,this._onDidRegisterCommandSelector=new v,this.onDidRegisterCommandSelector=this._onDidRegisterCommandSelector.event,this._onDidUnregisterProvider=new v,this.onDidUnregisterProvider=this._onDidUnregisterProvider.event,this.extensionQuickFixes=new Promise(e=>iu.setHandler(t=>{e(t.filter(i=>Zc(i.description,"terminalQuickFixProvider")).map(i=>i.value?i.value.map(n=>({...n,extensionIdentifier:i.description.identifier.value})):[]).flat())})),this.extensionQuickFixes.then(e=>{for(const t of e)this.registerCommandSelector(t)})}registerCommandSelector(e){this._selectors.set(e.id,e),this._onDidRegisterCommandSelector.fire(e)}registerQuickFixProvider(e,t){let i=!1;return this.extensionQuickFixes.then(()=>{if(i)return;this._providers.set(e,t);const n=this._selectors.get(e);if(!n)throw new Error(`No registered selector for ID: ${e}`);this._onDidRegisterProvider.fire({selector:n,provider:t})}),we(()=>{i=!0,this._providers.delete(e);const n=this._selectors.get(e);n&&(this._selectors.delete(e),this._onDidUnregisterProvider.fire(n.id))})}}const iu=Jc.registerExtensionPoint({extensionPoint:"terminalQuickFixes",defaultExtensionKind:["workspace"],activationEventsGenerator:(r,e)=>{for(const t of r??[])e.push(`onTerminalQuickFixRequest:${t.id}`)},jsonSchema:{description:a("vscode.extension.contributes.terminalQuickFixes","Contributes terminal quick fixes."),type:"array",items:{type:"object",additionalProperties:!1,required:["id","commandLineMatcher","outputMatcher","commandExitResult"],defaultSnippets:[{body:{id:"$1",commandLineMatcher:"$2",outputMatcher:"$3",exitStatus:"$4"}}],properties:{id:{description:a("vscode.extension.contributes.terminalQuickFixes.id","The ID of the quick fix provider"),type:"string"},commandLineMatcher:{description:a("vscode.extension.contributes.terminalQuickFixes.commandLineMatcher","A regular expression or string to test the command line against"),type:"string"},outputMatcher:{markdownDescription:a("vscode.extension.contributes.terminalQuickFixes.outputMatcher",`A regular expression or string to match a single line of the output against, which provides groups to be referenced in terminalCommand and uri.

For example:

 \`lineMatcher: /git push --set-upstream origin (?<branchName>[^s]+)/;\`

\`terminalCommand: 'git push --set-upstream origin \${group:branchName}';\`
`),type:"object",required:["lineMatcher","anchor","offset","length"],properties:{lineMatcher:{description:"A regular expression or string to test the command line against",type:"string"},anchor:{description:"Where the search should begin in the buffer",enum:["top","bottom"]},offset:{description:"The number of lines vertically from the anchor in the buffer to start matching against",type:"number"},length:{description:"The number of rows to match against, this should be as small as possible for performance reasons",type:"number"}}},commandExitResult:{description:a("vscode.extension.contributes.terminalQuickFixes.commandExitResult","The command exit result to match on"),enum:["success","error"],enumDescriptions:["The command exited with an exit code of zero.","The command exited with a non-zero exit code."]}}}}});var nu=".monaco-workbench .editor-instance .xterm-viewport,.monaco-workbench .pane-body.integrated-terminal .xterm-viewport{-webkit-text-fill-color:transparent;-webkit-background-clip:text;background-clip:text;scrollbar-width:thin;transition:background-color .8s linear}.monaco-workbench .editor-instance .xterm-viewport::-webkit-scrollbar,.monaco-workbench .pane-body.integrated-terminal .xterm-viewport::-webkit-scrollbar{width:10px}.monaco-workbench .editor-instance .xterm-viewport::-webkit-scrollbar-track,.monaco-workbench .pane-body.integrated-terminal .xterm-viewport::-webkit-scrollbar-track{opacity:0}.monaco-workbench .editor-instance .xterm-viewport::-webkit-scrollbar-thumb,.monaco-workbench .pane-body.integrated-terminal .xterm-viewport::-webkit-scrollbar-thumb{background-color:inherit;min-height:20px}.monaco-workbench .editor-instance .force-scrollbar .xterm .xterm-viewport,.monaco-workbench .editor-instance .xterm.focus .xterm-viewport,.monaco-workbench .editor-instance .xterm:focus .xterm-viewport,.monaco-workbench .editor-instance .xterm:hover .xterm-viewport,.monaco-workbench .pane-body.integrated-terminal .force-scrollbar .xterm .xterm-viewport,.monaco-workbench .pane-body.integrated-terminal .xterm.focus .xterm-viewport,.monaco-workbench .pane-body.integrated-terminal .xterm:focus .xterm-viewport,.monaco-workbench .pane-body.integrated-terminal .xterm:hover .xterm-viewport{cursor:default;transition:opacity .1s linear}.monaco-workbench .editor-instance .xterm .xterm-viewport::-webkit-scrollbar-thumb:hover,.monaco-workbench .pane-body.integrated-terminal .xterm .xterm-viewport::-webkit-scrollbar-thumb:hover{transition:opacity 0ms linear}.monaco-workbench .editor-instance .xterm .xterm-viewport::-webkit-scrollbar-thumb:window-inactive,.monaco-workbench .pane-body.integrated-terminal .xterm .xterm-viewport::-webkit-scrollbar-thumb:window-inactive{background-color:inherit}";oi(nu,{});var su='.monaco-workbench .pane-body.integrated-terminal{align-content:flex-start;align-items:baseline;background-color:transparent!important;display:flex;flex-direction:column;position:relative;user-select:auto;-webkit-user-select:initial;z-index:0}.terminal-command-decoration.hide{visibility:hidden}.monaco-workbench .part.panel .pane-body.integrated-terminal .terminal-outer-container{background-color:var(--vscode-terminal-background,--vscode-panel-background)}.monaco-workbench .editor-instance .terminal-outer-container,.monaco-workbench .editor-instance .terminal-split-pane,.monaco-workbench .pane-body.integrated-terminal .terminal-group,.monaco-workbench .pane-body.integrated-terminal .terminal-groups-container,.monaco-workbench .pane-body.integrated-terminal .terminal-outer-container,.monaco-workbench .pane-body.integrated-terminal .terminal-split-pane{height:100%}.monaco-workbench .part.auxiliarybar .pane-body.integrated-terminal .terminal-outer-container,.monaco-workbench .part.sidebar .pane-body.integrated-terminal .terminal-outer-container{background-color:var(--vscode-terminal-background,--vscode-sideBar-background)}.monaco-workbench .pane-body.integrated-terminal .split-view-view:not(:first-child),.monaco-workbench .pane-body.integrated-terminal .tabs-container{border-color:var(--vscode-terminal-border)}.monaco-workbench .pane-body.integrated-terminal .terminal-drop-overlay{background-color:var(--vscode-terminal-dropBackground,--vscode-editorGroup-dropBackground)}.monaco-workbench .pane-body.integrated-terminal .terminal-tabs-entry.is-active:before{background-color:var(--vscode-terminal-tab-activeBorder)}.monaco-workbench .editor-instance .xterm textarea:focus{opacity:0!important;outline:0!important}.monaco-workbench .terminal-tab:before{font-family:codicon!important;font-size:16px!important}.monaco-workbench .terminal-tab:not(.terminal-uri-icon):before{background-image:none!important}.monaco-workbench .editor-instance .terminal-wrapper{background-color:var(--vscode-terminal-background,--vscode-editorPane-background)}.monaco-workbench .editor-instance .terminal-wrapper,.monaco-workbench .pane-body.integrated-terminal .terminal-wrapper{box-sizing:border-box;display:block;height:100%}.monaco-workbench .editor-instance .xterm,.monaco-workbench .pane-body.integrated-terminal .xterm{bottom:0;left:0;padding:0 10px 2px;position:absolute;right:0}.terminal-side-view .terminal.xterm{top:0}.monaco-workbench .editor-instance .terminal-wrapper.fixed-dims .xterm,.monaco-workbench .pane-body.integrated-terminal .terminal-wrapper.fixed-dims .xterm{position:static}.monaco-workbench .editor-instance .xterm-viewport,.monaco-workbench .pane-body.integrated-terminal .xterm-viewport{z-index:30}.monaco-workbench .editor-instance .xterm-decoration-overview-ruler,.monaco-workbench .pane-body.integrated-terminal .xterm-decoration-overview-ruler{pointer-events:none;z-index:31}.monaco-workbench .editor-instance .xterm-screen,.monaco-workbench .pane-body.integrated-terminal .xterm-screen{z-index:31}.xterm .xterm-screen{cursor:text}.monaco-workbench .simple-find-part-wrapper.result-count{z-index:33!important}.xterm .xterm-accessibility{pointer-events:none;z-index:32!important}.xterm.enable-mouse-events .xterm-screen{cursor:default}.xterm.xterm-cursor-pointer .xterm-screen{cursor:pointer}.xterm.column-select.focus .xterm-screen{cursor:crosshair}.integrated-terminal.shell-integration .xterm,.monaco-workbench .editor-instance .xterm,.monaco-workbench .pane-body.integrated-terminal .terminal-group .monaco-split-view2.horizontal .split-view-view:first-child .xterm{padding-left:20px!important}.monaco-workbench .editor-instance .terminal-group .monaco-split-view2.horizontal .split-view-view:last-child .xterm,.monaco-workbench .pane-body.integrated-terminal .terminal-group .monaco-split-view2.horizontal .split-view-view:last-child .xterm{padding-right:20px}.monaco-workbench .editor-instance .xterm a:not(.xterm-invalid-link),.monaco-workbench .pane-body.integrated-terminal .xterm a:not(.xterm-invalid-link){position:relative}.monaco-workbench .editor-instance .terminal-wrapper>div,.monaco-workbench .pane-body.integrated-terminal .terminal-wrapper>div{height:100%}.monaco-workbench .editor-instance .xterm-viewport,.monaco-workbench .pane-body.integrated-terminal .xterm-viewport{box-sizing:border-box}.monaco-workbench .editor-instance .terminal-wrapper.fixed-dims,.monaco-workbench .pane-body.integrated-terminal .terminal-wrapper.fixed-dims{position:relative}.monaco-workbench .editor-instance .terminal-wrapper:not(.fixed-dims) .xterm-viewport,.monaco-workbench .pane-body.integrated-terminal .terminal-wrapper:not(.fixed-dims) .xterm-viewport{width:auto!important}.monaco-workbench .pane-body.integrated-terminal{font-variant-ligatures:none}.monaco-workbench .pane-body.integrated-terminal .split-view-view{box-sizing:border-box;overflow:hidden}.monaco-workbench .pane-body.integrated-terminal .split-view-view:first-child .tabs-container{border-right-style:solid;border-right-width:1px}.monaco-workbench .pane-body.integrated-terminal .split-view-view:last-child .tabs-container,.monaco-workbench .pane-body.integrated-terminal .terminal-group .monaco-split-view2.horizontal .split-view-view:not(:first-child){border-left-style:solid;border-left-width:1px}.monaco-workbench .pane-body.integrated-terminal .terminal-group .monaco-split-view2.vertical .split-view-view:not(:first-child){border-top-style:solid;border-top-width:1px}.monaco-workbench .pane-body.integrated-terminal .terminal-groups-container.alt-active .xterm{cursor:default}.monaco-workbench .pane-body.integrated-terminal .xterm{user-select:none;-webkit-user-select:none}.monaco-workbench .pane-body.integrated-terminal .monaco-split-view2.vertical .split-view-view:not(:last-child) .xterm{bottom:auto;top:0}.monaco-workbench .pane-body.integrated-terminal .xterm:focus{outline:none}.monaco-workbench.hc-black .pane-body.integrated-terminal .xterm.focus:before,.monaco-workbench.hc-black .pane-body.integrated-terminal .xterm:focus:before,.monaco-workbench.hc-light .pane-body.integrated-terminal .xterm.focus:before,.monaco-workbench.hc-light .pane-body.integrated-terminal .xterm:focus:before{border:1px solid;bottom:0;content:"";display:block;left:0;pointer-events:none;position:absolute;right:0;top:0;z-index:32}.monaco-workbench.hc-black .pane-body.integrated-terminal .monaco-split-view2.horizontal .split-view-view:not(:only-child) .xterm.focus:before,.monaco-workbench.hc-black .pane-body.integrated-terminal .monaco-split-view2.horizontal .split-view-view:not(:only-child) .xterm:focus:before,.monaco-workbench.hc-light .pane-body.integrated-terminal .monaco-split-view2.horizontal .split-view-view:not(:only-child) .xterm.focus:before,.monaco-workbench.hc-light .pane-body.integrated-terminal .monaco-split-view2.horizontal .split-view-view:not(:only-child) .xterm:focus:before{right:0}.monaco-workbench .pane-body.integrated-terminal .xterm .xterm-helpers{position:absolute;top:0}.monaco-workbench .pane-body.integrated-terminal .xterm .xterm-helper-textarea:focus{opacity:0!important}.monaco-workbench.hc-black.mac .pane-body.integrated-terminal .terminal-groups-container:not(.alt-active) .terminal:not(.enable-mouse-events),.monaco-workbench.vs-dark.mac .pane-body.integrated-terminal .terminal-groups-container:not(.alt-active) .terminal:not(.enable-mouse-events){cursor:-webkit-image-set(url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAL0lEQVQoz2NgCD3x//9/BhBYBWdhgFVAiVW4JBFKGIa4AqD0//9D3pt4I4tAdAMAHTQ/j5Zom30AAAAASUVORK5CYII=") 1x,url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAAz0lEQVRIx2NgYGBY/R8I/vx5eelX3n82IJ9FxGf6tksvf/8FiTMQAcAGQMDvSwu09abffY8QYSAScNk45G198eX//yev73/4///701eh//kZSARckrNBRvz//+8+6ZohwCzjGNjdgQxkAg7B9WADeBjIBqtJCbhRA0YNoIkBSNmaPEMoNmA0FkYNoFKhapJ6FGyAH3nauaSmPfwI0v/3OukVi0CIZ+F25KrtYcx/CTIy0e+rC7R1Z4KMICVTQQ14feVXIbR695u14+Ir4gwAAD49E54wc1kWAAAAAElFTkSuQmCC") 2x) 5 8,text}.xterm .xterm-cursor-pointer,.xterm.xterm-cursor-pointer{cursor:pointer!important}.monaco-pane-view .pane>.pane-header .monaco-action-bar .switch-terminal,.monaco-workbench .part.sidebar>.title>.title-actions .switch-terminal,.part.panel>.title>.title-actions .switch-terminal>.monaco-select-box{border-style:solid;border-width:1px}.xterm-screen .xterm-decoration-container .xterm-decoration.quick-fix{z-index:7}.monaco-workbench .part.sidebar>.title>.title-actions .switch-terminal{align-items:center;display:flex;flex-shrink:1;font-size:11px;height:20px;margin-right:.3em;margin-top:7px}.monaco-workbench.mac .part.sidebar>.title>.title-actions .switch-terminal{border-radius:4px}.monaco-workbench .part.sidebar>.title>.title-actions .switch-terminal>.monaco-select-box{background-color:unset!important;border:none!important;display:block!important}.monaco-pane-view .pane>.pane-header .monaco-action-bar .switch-terminal.action-item.select-container{border:none!important}.monaco-workbench .part.sidebar>.title>.title-actions .switch-terminal>.monaco-select-box{padding:0 22px 0 6px}.monaco-workbench .pane-body.integrated-terminal .tabs-container{display:flex;flex-direction:column;height:100%}.monaco-workbench .terminal-overflow-guard{height:100%;overflow:hidden;position:relative}.monaco-workbench .pane-body.integrated-terminal .tabs-list-container{height:100%;overflow:hidden}.monaco-workbench .pane-body.integrated-terminal .tabs-container>.monaco-toolbar{margin:auto;padding:4px 0 2px}.monaco-workbench .pane-body.integrated-terminal .terminal-tabs-entry.is-active:before{bottom:0;content:"";display:block;left:0;position:absolute;top:0;width:1px}.monaco-workbench .pane-body.integrated-terminal .tabs-container.has-text>.monaco-toolbar{margin:0;padding:4px 7px 2px;text-align:left}.monaco-workbench .pane-body.integrated-terminal .tabs-list{height:100%}.monaco-workbench .pane-body.integrated-terminal .tabs-list .terminal-tabs-entry{text-align:center}.monaco-workbench .pane-body.integrated-terminal .tabs-container.has-text .tabs-list .terminal-tabs-entry{padding-left:10px;padding-right:10px;text-align:left}.monaco-workbench .pane-body.integrated-terminal .tabs-container.has-text .tabs-list .terminal-tabs-entry .monaco-icon-label:after{margin-right:0}.monaco-workbench .pane-body.integrated-terminal .tabs-container:not(.has-text) .terminal-tabs-entry .codicon{color:inherit}.monaco-workbench .pane-body.integrated-terminal .tabs-container:not(.has-text) .monaco-icon-description-container{display:none}.monaco-workbench .pane-body.integrated-terminal .tabs-list .codicon{vertical-align:text-bottom}.monaco-workbench .pane-body.integrated-terminal .tabs-list .actions,.monaco-workbench .pane-body.integrated-terminal .tabs-list .editable-tab .monaco-icon-name-container{display:none}.monaco-workbench .pane-body.integrated-terminal .tabs-list .actions .action-label{padding:2px}.monaco-workbench .pane-body.integrated-terminal .tabs-list .monaco-list-row:hover .actions,.monaco-workbench .pane-body.integrated-terminal .tabs-list:focus-within .monaco-list-row.focused .actions,.monaco-workbench .pane-body.integrated-terminal .tabs-list:focus-within .monaco-list-row.selected .actions{display:block}.monaco-action-bar .action-item .single-terminal-tab{align-items:center;display:flex!important}.monaco-action-bar .action-item .single-terminal-tab .codicon:first-child{margin-right:4px}.monaco-action-bar .action-item .single-terminal-tab .codicon:nth-child(2){color:inherit;margin-left:4px}.monaco-workbench .pane-body.integrated-terminal .tabs-container.has-text .tabs-list .terminal-tabs-entry .uri-icon{background-repeat:no-repeat;background-size:contain;height:100%;margin-right:4px}.monaco-action-bar .terminal-uri-icon.single-terminal-tab.action-label .codicon,.monaco-workbench .terminal-uri-icon .monaco-highlighted-label .codicon{background-size:16px}.monaco-action-bar .terminal-uri-icon.single-terminal-tab.action-label:not(.alt-command) .codicon:before,.monaco-workbench .terminal-uri-icon .monaco-highlighted-label .codicon:before{content:"";display:inline-block;height:16px;width:16px}.monaco-workbench .pane-body.integrated-terminal .terminal-drop-overlay{bottom:0;display:block;left:0;opacity:0;pointer-events:none;position:absolute;right:0;top:0;z-index:34}.monaco-workbench:not(.reduce-motion) .pane-body.integrated-terminal .terminal-drop-overlay{transition:left 70ms ease-out,right 70ms ease-out,top 70ms ease-out,bottom 70ms ease-out,opacity .15s ease-out}.monaco-workbench .pane-body.integrated-terminal .terminal-group>.monaco-split-view2.horizontal .terminal-drop-overlay.drop-before{right:50%}.monaco-workbench .pane-body.integrated-terminal .terminal-group>.monaco-split-view2.horizontal .terminal-drop-overlay.drop-after{left:50%}.monaco-workbench .pane-body.integrated-terminal .terminal-group>.monaco-split-view2.vertical .terminal-drop-overlay.drop-before{bottom:50%}.monaco-workbench .pane-body.integrated-terminal .terminal-group>.monaco-split-view2.vertical .terminal-drop-overlay.drop-after{top:50%}.monaco-workbench .terminal .terminal-command-decoration:not(.default):hover{background-color:var(--vscode-toolbar-hoverBackground);border-radius:5px;cursor:pointer}.monaco-workbench .terminal .terminal-command-decoration{color:var(--vscode-terminalCommandDecoration-successBackground)}.monaco-workbench .terminal .terminal-command-decoration.error{color:var(--vscode-terminalCommandDecoration-errorBackground)}.monaco-workbench .terminal .terminal-command-decoration.default{color:var(--vscode-terminalCommandDecoration-defaultBackground);pointer-events:none}.monaco-workbench .terminal .terminal-command-decoration.quick-fix{background-color:var(--vscode-terminal-background,--vscode-panel-background);color:var(--vscode-editorLightBulb-foreground)!important}.terminal-scroll-highlight{border-left:5px solid #fff;border-left-width:5px!important;left:0;pointer-events:none;right:0}.terminal-scroll-highlight-outline{border:1px solid #fff;pointer-events:none}.terminal-scroll-highlight{border-color:var(--vscode-focusBorder)}.hc-black .xterm-find-result-decoration,.hc-light .xterm-find-result-decoration{outline-style:dotted!important;outline-style:solid!important}.xterm-find-active-result-decoration{outline-style:solid!important;outline-width:2px!important;z-index:7!important}.monaco-workbench.hc-black .editor-instance .xterm.focus:before,.monaco-workbench.hc-black .editor-instance .xterm:focus:before,.monaco-workbench.hc-black .pane-body.integrated-terminal .xterm.focus:before,.monaco-workbench.hc-black .pane-body.integrated-terminal .xterm:focus:before,.monaco-workbench.hc-light .editor-instance .xterm.focus:before,.monaco-workbench.hc-light .editor-instance .xterm:focus:before,.monaco-workbench.hc-light .pane-body.integrated-terminal .xterm.focus:before,.monaco-workbench.hc-light .pane-body.integrated-terminal .xterm:focus:before{border-color:var(--vscode-contrastActiveBorder)}.monaco-workbench .integrated-terminal .hoverHighlight{background-color:var(--vscode-terminal-hoverHighlightBackground)}.monaco-workbench .editor-instance .force-scrollbar .xterm .xterm-viewport,.monaco-workbench .editor-instance .xterm.focus .xterm-viewport,.monaco-workbench .editor-instance .xterm:focus .xterm-viewport,.monaco-workbench .editor-instance .xterm:hover .xterm-viewport,.monaco-workbench .pane-body.integrated-terminal .force-scrollbar .xterm .xterm-viewport,.monaco-workbench .pane-body.integrated-terminal .xterm.focus .xterm-viewport,.monaco-workbench .pane-body.integrated-terminal .xterm:focus .xterm-viewport,.monaco-workbench .pane-body.integrated-terminal .xterm:hover .xterm-viewport{background-color:var(--vscode-scrollbarSlider-background)!important}.monaco-workbench .editor-instance .xterm-viewport,.monaco-workbench .pane-body.integrated-terminal .xterm-viewport{scrollbar-color:var(--vscode-scrollbarSlider-background) transparent}.monaco-workbench .editor-instance .xterm .xterm-viewport::-webkit-scrollbar-thumb:hover,.monaco-workbench .pane-body.integrated-terminal .xterm .xterm-viewport::-webkit-scrollbar-thumb:hover{background-color:var(--vscode-scrollbarSlider-hoverBackground)}.monaco-workbench .editor-instance .xterm-viewport:hover,.monaco-workbench .pane-body.integrated-terminal .xterm-viewport:hover{scrollbar-color:var(--vscode-scrollbarSlider-hoverBackground) transparent}.monaco-workbench .editor-instance .xterm .xterm-viewport::-webkit-scrollbar-thumb:active,.monaco-workbench .pane-body.integrated-terminal .xterm .xterm-viewport::-webkit-scrollbar-thumb:active{background-color:var(--vscode-scrollbarSlider-activeBackground)}.monaco-workbench .terminal-accessible-widget{bottom:0;cursor:default;left:10px;opacity:0;overflow:initial;overflow-x:initial;padding:0;pointer-events:none;position:absolute;right:0;top:0;z-index:0}.monaco-workbench .terminal-accessible-widget div{white-space:pre-wrap}.monaco-workbench .terminal-accessible-widget.active,.monaco-workbench .terminal-accessible-widget.focus-within{background-color:var(--vscode-terminal-background,--vscode-panel-background);opacity:1;pointer-events:all;z-index:33}.monaco-workbench .xterm.terminal.hide{visibility:hidden}';oi(su,{});var ru=".monaco-workbench .terminal-widget-container{bottom:0;left:0;overflow:visible;position:absolute;right:0;top:0}.monaco-workbench .terminal-overlay-widget{bottom:0;color:#3794ff;left:0;position:absolute}.monaco-workbench .terminal-hover-target{position:absolute;z-index:33}.monaco-workbench .terminal-env-var-info{height:28px;opacity:.5;position:absolute;right:10px;text-align:center;top:0;width:28px;z-index:32}.monaco-workbench .terminal-env-var-info.requires-action,.monaco-workbench .terminal-env-var-info:hover{opacity:1}.monaco-workbench .terminal-env-var-info.codicon{line-height:28px}";oi(ru,{});var ou=".xterm{cursor:text;position:relative;user-select:none;-ms-user-select:none;-webkit-user-select:none}.xterm.focus,.xterm:focus{outline:none}.xterm .xterm-helpers{position:absolute;top:0;z-index:5}.xterm .xterm-helper-textarea{border:0;height:0;left:-9999em;margin:0;opacity:0;overflow:hidden;padding:0;position:absolute;resize:none;top:0;white-space:nowrap;width:0;z-index:-5}.xterm .composition-view{background:#000;color:#fff;display:none;position:absolute;white-space:nowrap;z-index:1}.xterm .composition-view.active{display:block}.xterm .xterm-viewport{background-color:#000;bottom:0;cursor:default;left:0;overflow-y:scroll;position:absolute;right:0;top:0}.xterm .xterm-screen{position:relative}.xterm .xterm-screen canvas{left:0;position:absolute;top:0}.xterm .xterm-scroll-area{visibility:hidden}.xterm-char-measure-element{display:inline-block;left:-9999em;line-height:normal;position:absolute;top:0;visibility:hidden}.xterm.enable-mouse-events{cursor:default}.xterm .xterm-cursor-pointer,.xterm.xterm-cursor-pointer{cursor:pointer}.xterm.column-select.focus{cursor:crosshair}.xterm .xterm-accessibility,.xterm .xterm-message{bottom:0;color:transparent;left:0;pointer-events:none;position:absolute;right:0;top:0;z-index:10}.xterm .live-region{height:1px;left:-9999px;overflow:hidden;position:absolute;width:1px}.xterm-dim{opacity:1!important}.xterm-underline-1{text-decoration:underline}.xterm-underline-2{text-decoration:double underline}.xterm-underline-3{text-decoration:wavy underline}.xterm-underline-4{text-decoration:dotted underline}.xterm-underline-5{text-decoration:dashed underline}.xterm-overline{text-decoration:overline}.xterm-overline.xterm-underline-1{text-decoration:overline underline}.xterm-overline.xterm-underline-2{text-decoration:overline double underline}.xterm-overline.xterm-underline-3{text-decoration:overline wavy underline}.xterm-overline.xterm-underline-4{text-decoration:overline dotted underline}.xterm-overline.xterm-underline-5{text-decoration:overline dashed underline}.xterm-strikethrough{text-decoration:line-through}.xterm-screen .xterm-decoration-container .xterm-decoration{position:absolute;z-index:6}.xterm-screen .xterm-decoration-container .xterm-decoration.xterm-decoration-top-layer{z-index:7}.xterm-decoration-overview-ruler{pointer-events:none;position:absolute;right:0;top:0;z-index:8}.xterm-decoration-top{position:relative;z-index:2}";oi(ou,{});function qr(r){var l;let e="";const t=r.statusList.statuses,i=[];for(const c of t)e+=`

---

${c.icon?`$(${(l=c.icon)==null?void 0:l.id}) `:""}${c.tooltip||c.id}`,c.hoverActions&&i.push(...c.hoverActions);const n=Ya(r,!0),s=Xa(r,!0);return{content:new N(r.title+n+s+e,{supportThemeIcons:!0}),actions:i}}function Xa(r,e){const t=[];r.capabilities.has(2)&&t.push(2),r.capabilities.has(0)&&t.push(0);let i="";return t.length>0?i+=`${e?`

---

`:`

`}${a("shellIntegration.enabled","Shell integration activated")}`:r.shellLaunchConfig.ignoreShellIntegration?i+=`${e?`

---

`:`

`}${a("launchFailed.exitCodeOnlyShellIntegration","The terminal process failed to launch. Disabling shell integration with terminal.integrated.shellIntegration.enabled might help.")}`:r.usedShellIntegrationInjection&&(i+=`${e?`

---

`:`

`}${a("shellIntegration.activationFailed","Shell integration failed to activate")}`),i}function Ya(r,e){const t=[];if(r.processId&&t.push(a({key:"shellProcessTooltip.processId",comment:[`The first arg is "PID" which shouldn't be translated`]},"Process ID ({0}): {1}","PID",r.processId)+`
`),r.shellLaunchConfig.executable){let i=r.shellLaunchConfig.executable;const n=eh(r.injectedArgs||r.shellLaunchConfig.args||[]).map(s=>`'${s}'`).join(" ");n&&(i+=` ${n}`),t.push(a("shellProcessTooltip.commandLine","Command line: {0}",i))}return t.length?`${e?`

---

`:`

`}${t.join(`
`)}`:""}const Wo=_e;let _r=class extends ih{constructor(e,t,i,n,s,o,l,c,h,m,p,w){super("TerminalTabsList",e,{getHeight:()=>22,getTemplateId:()=>"terminal.tabs"},[c.createInstance(wr,e,c.createInstance(nh,sh),()=>this.getSelectedElements())],{horizontalScrolling:!1,supportDynamicHeights:!1,selectionNavigation:!0,identityProvider:{getId:_=>_==null?void 0:_.instanceId},accessibilityProvider:c.createInstance(vr),smoothScrolling:s.getValue("workbench.list.smoothScrolling"),multipleSelectionSupport:!0,additionalScrollHeight:22,dnd:c.createInstance(br),openOnSingleClick:!0},t,i,s,c),this._configurationService=s,this._terminalService=o,this._terminalGroupService=l,this._themeService=m,this._hoverService=w;const f=[this._terminalGroupService.onDidChangeInstances(()=>this.refresh()),this._terminalGroupService.onDidChangeGroups(()=>this.refresh()),this._terminalGroupService.onDidShow(()=>this.refresh()),this._terminalGroupService.onDidChangeInstanceCapability(()=>this.refresh()),this._terminalService.onDidChangeInstanceTitle(()=>this.refresh()),this._terminalService.onDidChangeInstanceIcon(()=>this.refresh()),this._terminalService.onDidChangeInstancePrimaryStatus(()=>this.refresh()),this._terminalService.onDidChangeConnectionState(()=>this.refresh()),this._themeService.onDidColorThemeChange(()=>this.refresh()),this._terminalGroupService.onDidChangeActiveInstance(_=>{if(_){const S=this._terminalGroupService.instances.indexOf(_);this.setSelection([S]),this.reveal(S)}this.refresh()})];p.onWillShutdown(_=>{J(f)}),this.onMouseDblClick(async _=>{var y,R,C;if(this.getFocus().length===0){const D=await this._terminalService.createTerminal({location:E.Panel});this._terminalGroupService.setActiveInstance(D),await D.focusWhenReady()}((y=this._terminalService.getEditingTerminal())==null?void 0:y.instanceId)!==((R=_.element)==null?void 0:R.instanceId)&&this._getFocusMode()==="doubleClick"&&this.getFocus().length===1&&((C=_.element)==null||C.focus(!0))}),this.onMouseClick(async _=>{var S,y,R;((S=this._terminalService.getEditingTerminal())==null?void 0:S.instanceId)!==((y=_.element)==null?void 0:y.instanceId)&&(_.browserEvent.altKey&&_.element?await this._terminalService.createTerminal({location:{parentTerminal:_.element}}):this._getFocusMode()==="singleClick"&&this.getSelection().length<=1&&((R=_.element)==null||R.focus(!0)))}),this.onContextMenu(_=>{if(!_.element){this.setSelection([]);return}const S=this.getSelectedElements();(!S||!S.find(y=>_.element===y))&&this.setFocus(_.index!==void 0?[_.index]:[])}),this._terminalTabsSingleSelectedContextKey=u.tabsSingularSelection.bindTo(t),this._isSplitContextKey=u.splitTerminal.bindTo(t),this.onDidChangeSelection(_=>this._updateContextKey()),this.onDidChangeFocus(()=>this._updateContextKey()),this.onDidOpen(async _=>{const S=_.element;S&&(this._terminalGroupService.setActiveInstance(S),_.editorOptions.preserveFocus||await S.focusWhenReady())}),this._decorationsProvider||(this._decorationsProvider=c.createInstance(Sr),h.registerDecorationsProvider(this._decorationsProvider)),this.refresh()}_getFocusMode(){return this._configurationService.getValue("terminal.integrated.tabs.focusMode")}refresh(e=!0){e&&this._terminalService.isEditable(void 0)&&this.domFocus(),this.splice(0,this.length,this._terminalGroupService.instances.slice())}focusHover(){const e=this.getSelectedElements()[0];e&&this._hoverService.showHover({...qr(e),target:this.getHTMLElement(),trapFocus:!0},!0)}_updateContextKey(){this._terminalTabsSingleSelectedContextKey.set(this.getSelectedElements().length===1);const e=this.getFocusedElements();this._isSplitContextKey.set(e.length>0&&this._terminalGroupService.instanceIsSplit(e[0]))}};_r=b([d(1,Ie),d(2,On),d(3,he),d(4,Z),d(5,ne),d(6,ce),d(7,O),d(8,th),d(9,he),d(10,jn),d(11,Yn)],_r);let wr=class{constructor(e,t,i,n,s,o,l,c,h,m,p,w){this._container=e,this._labels=t,this._getSelection=i,this._instantiationService=n,this._terminalService=s,this._terminalGroupService=o,this._hoverService=l,this._configurationService=c,this._keybindingService=h,this._listService=m,this._themeService=p,this._contextViewService=w,this.templateId="terminal.tabs"}renderTemplate(e){const t=Se(e,Wo(".terminal-tabs-entry")),i={},n=this._labels.create(t,{supportHighlights:!0,supportDescriptionHighlights:!0,supportIcons:!0,hoverDelegate:{delay:this._configurationService.getValue("workbench.hover.delay"),showHover:l=>this._hoverService.showHover({...l,actions:i.hoverActions,hideOnHover:!0})}}),s=Se(n.element,Wo(".actions")),o=new rh(s,{actionViewItemProvider:l=>l instanceof mn?this._instantiationService.createInstance(_a,l,void 0):void 0});return{element:t,label:n,actionBar:o,context:i,elementDisposables:new Bi}}shouldHideText(){return this._container?this._container.clientWidth<63:!1}shouldHideActionBar(){return this._container?this._container.clientWidth<=105:!1}renderElement(e,t,i){var S;const n=!this.shouldHideText(),s=this._terminalGroupService.getGroupForInstance(e);if(!s)throw new Error(`Could not find group for instance "${e.instanceId}"`);i.element.classList.toggle("has-text",n),i.element.classList.toggle("is-active",this._terminalGroupService.activeInstance===e);let o="";if(s.terminalInstances.length>1){const y=s.terminalInstances.indexOf(e);y===0?o="┌ ":y===s.terminalInstances.length-1?o="└ ":o="├ "}const l=qr(e);i.context.hoverActions=l.actions;const c=this._instantiationService.invokeFunction(Er,e),h=!this.shouldHideActionBar();let m="";if(n)this.fillActionBar(e,i),m=o,e.icon&&(m+=`$(${c}) ${e.title}`);else{const y=e.statusList.primary;y&&y.severity>Re.Ignore?m=`${o}$(${((S=y.icon)==null?void 0:S.id)||c})`:m=`${o}$(${c})`}h||i.actionBar.clear(),i.elementDisposables.add(V(i.element,ye.AUXCLICK,y=>{y.stopImmediatePropagation(),y.button===1&&this._terminalService.safeDisposeTerminal(e)}));const p=[],w=ct(e);w&&p.push(w);const f=Lt(e,this._themeService.getColorTheme().type);f&&p.push(...f),i.label.setResource({resource:e.resource,name:m,description:n?e.description:void 0},{fileDecorations:{colors:!0,badges:n},title:{markdown:l.content,markdownNotSupportedFallback:void 0},extraClasses:p});const _=this._terminalService.getEditableData(e);i.label.element.classList.toggle("editable-tab",!!_),_&&(i.elementDisposables.add(this._renderInputBox(i.label.element.querySelector(".monaco-icon-label-container"),e,_)),i.actionBar.clear())}_renderInputBox(e,t,i){const n=t.title||"",s=new oh(e,this._contextViewService,{validationOptions:{validation:h=>{const m=i.validationMessage(h);return!m||m.severity!==Re.Error?null:{content:m.content,formatContent:!0,type:3}}},ariaLabel:a("terminalInputAriaLabel","Type terminal name. Press Enter to confirm or Escape to cancel."),inputBoxStyles:ah});s.element.style.height="22px",s.value=n,s.focus(),s.select({start:0,end:n.length});const o=hh((h,m)=>{s.element.style.display="none";const p=s.value;J(c),s.element.remove(),m&&i.onFinish(p,h)}),l=()=>{if(s.isInputValid()){const h=i.validationMessage(s.value);h?s.showMessage({content:h.content,formatContent:!0,type:h.severity===Re.Info?1:h.severity===Re.Warning?2:3}):s.hideMessage()}};l();const c=[s,co(s.inputElement,ye.KEY_DOWN,h=>{h.stopPropagation(),h.equals(3)?o(s.isInputValid(),!0):h.equals(9)&&o(!1,!0)}),co(s.inputElement,ye.KEY_UP,h=>{l()}),V(s.inputElement,ye.BLUR,()=>{o(s.isInputValid(),!0)})];return we(()=>{o(!1,!1)})}disposeElement(e,t,i){i.elementDisposables.clear(),i.actionBar.clear()}disposeTemplate(e){e.elementDisposables.dispose(),e.label.dispose(),e.actionBar.dispose()}fillActionBar(e,t){var n;const i=[new U("workbench.action.terminal.splitInstance",x.split.short,L.asClassName(k.splitHorizontal),!0,async()=>{this._runForSelectionOrInstance(e,async s=>{this._terminalService.createTerminal({location:{parentTerminal:s}})})}),new U("workbench.action.terminal.killInstance",x.kill.short,L.asClassName(k.trashcan),!0,async()=>{this._runForSelectionOrInstance(e,s=>this._terminalService.safeDisposeTerminal(s))})];t.actionBar.clear();for(const s of i)t.actionBar.push(s,{icon:!0,label:!1,keybinding:(n=this._keybindingService.lookupKeybinding(s.id))==null?void 0:n.getLabel()})}_runForSelectionOrInstance(e,t){var n;const i=this._getSelection();if(i.includes(e))for(const s of i)s&&t(s);else t(e);this._terminalGroupService.focusTabs(),(n=this._listService.lastFocusedList)==null||n.focusNext()}};wr=b([d(3,O),d(4,ne),d(5,ce),d(6,Yn),d(7,Z),d(8,bi),d(9,On),d(10,he),d(11,fa)],wr);let vr=class{constructor(e){this._terminalGroupService=e}getWidgetAriaLabel(){return a("terminal.tabs","Terminal tabs")}getAriaLabel(e){var n;let t="";const i=this._terminalGroupService.getGroupForInstance(e);if(i&&((n=i.terminalInstances)==null?void 0:n.length)>1){const s=i.terminalInstances.indexOf(e);t=a({key:"splitTerminalAriaLabel",comment:["The terminal's ID","The terminal's title","The terminal's split number","The terminal group's total split number"]},"Terminal {0} {1}, split {2} of {3}",e.instanceId,e.title,s+1,i.terminalInstances.length)}else t=a({key:"terminalAriaLabel",comment:["The terminal's ID","The terminal's title"]},"Terminal {0} {1}",e.instanceId,e.title);return t}};vr=b([d(0,ce)],vr);let br=class{constructor(e,t){this._terminalService=e,this._terminalGroupService=t,this._autoFocusDisposable=q.None,this._primaryBackend=this._terminalService.getPrimaryBackend()}getDragURI(e){var t;return((t=this._terminalService.getEditingTerminal())==null?void 0:t.instanceId)===e.instanceId?null:e.resource.toString()}getDragLabel(e,t){return e.length===1?e[0].title:void 0}onDragLeave(){this._autoFocusInstance=void 0,this._autoFocusDisposable.dispose(),this._autoFocusDisposable=q.None}onDragStart(e,t){if(!t.dataTransfer)return;const i=e.getData();if(!Array.isArray(i))return;const n=i.filter(s=>"instanceId"in s);n.length>0&&t.dataTransfer.setData("Terminals",JSON.stringify(n.map(s=>s.resource.toString())))}onDragOver(e,t,i,n){if(e instanceof lh&&!fi(n,qt.FILES,qt.RESOURCES,"Terminals",un.FILES))return!1;const s=this._autoFocusInstance!==t;return s&&(this._autoFocusDisposable.dispose(),this._autoFocusInstance=t),!t&&!fi(n,"Terminals")?e instanceof ho:(s&&t&&(this._autoFocusDisposable=ch(()=>{this._terminalService.setActiveInstance(t),this._autoFocusInstance=void 0},500)),{feedback:i?[i]:void 0,accept:!0,effect:1})}async drop(e,t,i,n){this._autoFocusDisposable.dispose(),this._autoFocusInstance=void 0;let s;const o=[],l=Va(n);if(l)for(const h of l){const m=this._terminalService.getInstanceFromResource(h);if(m)s=[m],this._terminalService.moveToTerminalView(m);else if(this._primaryBackend){const p=zr(h);p.instanceId&&o.push(this._primaryBackend.requestDetachInstance(p.workspaceId,p.instanceId))}}if(o.length){let h=await Promise.all(o);h=h.filter(p=>p!==void 0);let m;for(const p of h)m=await this._terminalService.createTerminal({config:{attachPersistentProcess:p}});m&&this._terminalService.setActiveInstance(m);return}if(s===void 0){if(!(e instanceof ho)){this._handleExternalDrop(t,n);return}const h=e.getData();if(!h||!Array.isArray(h))return;s=[];for(const m of h)"instanceId"in m&&s.push(m)}if(!t){this._terminalGroupService.moveGroupToEnd(s[0]),this._terminalService.setActiveInstance(s[0]);return}let c=!1;for(const h of s)this._terminalGroupService.moveGroup(h,t),c||(this._terminalService.setActiveInstance(h),c=!0)}async _handleExternalDrop(e,t){if(!e||!t.dataTransfer)return;let i;const n=t.dataTransfer.getData(qt.RESOURCES);n&&(i=M.parse(JSON.parse(n)[0]));const s=t.dataTransfer.getData(un.FILES);!i&&s&&(i=M.file(JSON.parse(s)[0])),!i&&t.dataTransfer.files.length>0&&t.dataTransfer.files[0].path&&(i=M.file(t.dataTransfer.files[0].path)),i&&(this._terminalService.setActiveInstance(e),e.focus(),await e.sendPath(i,!1))}};br=b([d(0,ne),d(1,ce)],br);let Sr=class{constructor(e){this._terminalService=e,this.label=a("label","Terminal"),this._onDidChange=new v,this._terminalService.onDidChangeInstancePrimaryStatus(t=>this._onDidChange.fire([t.resource]))}get onDidChange(){return this._onDidChange.event}provideDecorations(e){var n;if(e.scheme!==G.vscodeTerminal)return;const t=this._terminalService.getInstanceFromResource(e);if(!t)return;const i=(n=t==null?void 0:t.statusList)==null?void 0:n.primary;if(i!=null&&i.icon)return{color:Ka(i.severity),letter:i.icon,tooltip:i.tooltip}}dispose(){this.dispose()}};Sr=b([d(0,ne)],Sr);function vi(r,e,t,i,n){const s=new dh(r),o={x:s.posx,y:s.posy},l=[];wa(t,void 0,l),n&&l.push(...n),i.showContextMenu({getAnchor:()=>o,getActions:()=>l,getActionsContext:()=>e})}const ui=_e;let Cr=class extends q{constructor(e,t,i,n,s,o,l,c,h,m,p){super(),this._terminalService=t,this._terminalGroupService=i,this._instantiationService=n,this._notificationService=s,this._contextMenuService=o,this._configurationService=l,this._storageService=h,this._hoverService=p,this._cancelContextMenu=!1,this._parentElement=e,this._tabContainer=ui(".tabs-container");const w=ui(".tabs-list-container");this._tabListElement=ui(".tabs-list"),w.appendChild(this._tabListElement),this._tabContainer.appendChild(w),this._instanceMenu=this._register(c.createMenu(I.TerminalInstanceContext,m)),this._tabsListMenu=this._register(c.createMenu(I.TerminalTabContext,m)),this._tabsListEmptyMenu=this._register(c.createMenu(I.TerminalTabEmptyAreaContext,m)),this._tabList=this._register(this._instantiationService.createInstance(_r,this._tabListElement));const f=ui(".terminal-outer-container");this._terminalContainer=ui(".terminal-groups-container"),f.appendChild(this._terminalContainer),this._terminalService.setContainers(e,this._terminalContainer),this._terminalIsTabsNarrowContextKey=u.tabsNarrow.bindTo(m),this._terminalTabsFocusContextKey=u.tabsFocus.bindTo(m),this._terminalTabsMouseContextKey=u.tabsMouse.bindTo(m),this._tabTreeIndex=this._terminalService.configHelper.config.tabs.location==="left"?0:1,this._terminalContainerIndex=this._terminalService.configHelper.config.tabs.location==="left"?1:0,l.onDidChangeConfiguration(_=>{_.affectsConfiguration("terminal.integrated.tabs.enabled")||_.affectsConfiguration("terminal.integrated.tabs.hideCondition")?this._refreshShowTabs():_.affectsConfiguration("terminal.integrated.tabs.location")&&(this._tabTreeIndex=this._terminalService.configHelper.config.tabs.location==="left"?0:1,this._terminalContainerIndex=this._terminalService.configHelper.config.tabs.location==="left"?1:0,this._shouldShowTabs()&&(this._splitView.swapViews(0,1),this._removeSashListener(),this._addSashListener(),this._splitView.resizeView(this._tabTreeIndex,this._getLastListWidth())))}),this._register(this._terminalGroupService.onDidChangeInstances(()=>this._refreshShowTabs())),this._register(this._terminalGroupService.onDidChangeGroups(()=>this._refreshShowTabs())),this._attachEventListeners(e,this._terminalContainer),this._terminalGroupService.onDidChangePanelOrientation(_=>{this._panelOrientation=_,this._panelOrientation===0?this._terminalContainer.classList.add("terminal-side-view"):this._terminalContainer.classList.remove("terminal-side-view")}),this._splitView=new ra(e,{orientation:1,proportionalLayout:!1}),this._setupSplitView(f)}_shouldShowTabs(){const e=this._terminalService.configHelper.config.tabs.enabled,t=this._terminalService.configHelper.config.tabs.hideCondition;return e?t==="never"||t==="singleTerminal"&&this._terminalGroupService.instances.length>1||t==="singleGroup"&&this._terminalGroupService.groups.length>1:!1}_refreshShowTabs(){this._shouldShowTabs()?this._splitView.length===1&&(this._addTabTree(),this._addSashListener(),this._splitView.resizeView(this._tabTreeIndex,this._getLastListWidth()),this.rerenderTabs()):this._splitView.length===2&&!this._terminalTabsMouseContextKey.get()&&(this._splitView.removeView(this._tabTreeIndex),this._plusButton&&this._tabContainer.removeChild(this._plusButton),this._removeSashListener())}_getLastListWidth(){const e=this._panelOrientation===0?"tabs-list-width-vertical":"tabs-list-width-horizontal",t=this._storageService.get(e,0);return!t||!parseInt(t)?this._panelOrientation===0?46:120:parseInt(t)}_handleOnDidSashReset(){let e=80;const t=document.createElement("canvas");t.width=1,t.height=1;const i=t.getContext("2d");if(i){const s=window.getComputedStyle(this._tabListElement);i.font=`${s.fontStyle} ${s.fontSize} ${s.fontFamily}`;const o=this._terminalGroupService.instances.reduce((l,c)=>Math.max(l,i.measureText(c.title+(c.description||"")).width+this._getAdditionalWidth(c)),0);e=Math.ceil(Math.max(o,80))}Math.ceil(this._splitView.getViewSize(this._tabTreeIndex))===e&&(e=46),this._splitView.resizeView(this._tabTreeIndex,e),this._updateListWidth(e)}_getAdditionalWidth(e){var s;const i=e.statusList.statuses.length>0?30:0;return 40+((((s=this._terminalGroupService.getGroupForInstance(e))==null?void 0:s.terminalInstances.length)||0)>1?30:0)+i}_handleOnDidSashChange(){const e=this._splitView.getViewSize(this._tabTreeIndex);!this._width||e<=0||this._updateListWidth(e)}_updateListWidth(e){e<63&&e>=46?(e=46,this._splitView.resizeView(this._tabTreeIndex,e)):e>=63&&e<80&&(e=80,this._splitView.resizeView(this._tabTreeIndex,e)),this.rerenderTabs();const t=this._panelOrientation===0?"tabs-list-width-vertical":"tabs-list-width-horizontal";this._storageService.store(t,e,0,0)}_setupSplitView(e){this._register(this._splitView.onDidSashReset(()=>this._handleOnDidSashReset())),this._register(this._splitView.onDidSashChange(()=>this._handleOnDidSashChange())),this._shouldShowTabs()&&this._addTabTree(),this._splitView.addView({element:e,layout:t=>this._terminalGroupService.groups.forEach(i=>i.layout(t,this._height||0)),minimumSize:120,maximumSize:Number.POSITIVE_INFINITY,onDidChange:()=>q.None,priority:2},dn.Distribute,this._terminalContainerIndex),this._shouldShowTabs()&&this._addSashListener()}_addTabTree(){this._splitView.addView({element:this._tabContainer,layout:e=>this._tabList.layout(this._height||0,e),minimumSize:46,maximumSize:500,onDidChange:()=>q.None,priority:1},dn.Distribute,this._tabTreeIndex),this.rerenderTabs()}rerenderTabs(){this._updateHasText(),this._tabList.refresh()}_addSashListener(){let e;this._sashDisposables=[this._splitView.sashes[0].onDidStart(t=>{e=window.setInterval(()=>{this.rerenderTabs()},100)}),this._splitView.sashes[0].onDidEnd(t=>{window.clearInterval(e),e=0})]}_removeSashListener(){this._sashDisposables&&(J(this._sashDisposables),this._sashDisposables=void 0)}_updateHasText(){const e=this._tabListElement.clientWidth>63;this._tabContainer.classList.toggle("has-text",e),this._terminalIsTabsNarrowContextKey.set(!e)}layout(e,t){this._height=t,this._width=e,this._splitView.layout(e),this._shouldShowTabs()&&this._splitView.resizeView(this._tabTreeIndex,this._getLastListWidth()),this._updateHasText()}_attachEventListeners(e,t){this._register(V(this._tabContainer,"mouseleave",async i=>{this._terminalTabsMouseContextKey.set(!1),this._refreshShowTabs(),i.stopPropagation()})),this._register(V(this._tabContainer,"mouseenter",async i=>{this._terminalTabsMouseContextKey.set(!0),i.stopPropagation()})),this._register(V(t,"mousedown",async i=>{const n=this._terminalGroupService.activeInstance;if(this._terminalGroupService.instances.length===0||!n){this._cancelContextMenu=!0;return}if(i.which===2&&Nn)n.focus();else if(i.which===3){const s=this._terminalService.configHelper.config.rightClickBehavior;if(s==="nothing"){i.shiftKey||(this._cancelContextMenu=!0);return}else if(s==="copyPaste"||s==="paste"){if(s==="copyPaste"&&i.shiftKey){vi(i,this._parentElement,this._instanceMenu,this._contextMenuService);return}s==="copyPaste"&&n.hasSelection()?(await n.copySelection(),n.clearSelection()):Kt.clipboard.readText?n.paste():this._notificationService.info(`This browser doesn't support the clipboard.readText API needed to trigger a paste, try ${De?"⌘":"Ctrl"}+V instead.`),De&&setTimeout(()=>{n.clearSelection()},0),this._cancelContextMenu=!0}}})),this._register(V(t,"contextmenu",i=>{this._terminalService.configHelper.config.rightClickBehavior==="nothing"&&!i.shiftKey&&(this._cancelContextMenu=!0),this._cancelContextMenu||vi(i,this._parentElement,this._instanceMenu,this._contextMenuService),i.preventDefault(),i.stopImmediatePropagation(),this._cancelContextMenu=!1})),this._register(V(this._tabContainer,"contextmenu",i=>{if(this._terminalService.configHelper.config.rightClickBehavior==="nothing"&&!i.shiftKey&&(this._cancelContextMenu=!0),!this._cancelContextMenu){const s=this._tabList.getFocus().length===0;vi(i,this._parentElement,s?this._tabsListEmptyMenu:this._tabsListMenu,this._contextMenuService,s?this._getTabActions():void 0)}i.preventDefault(),i.stopImmediatePropagation(),this._cancelContextMenu=!1})),this._register(V(document,"keydown",i=>{t.classList.toggle("alt-active",!!i.altKey)})),this._register(V(document,"keyup",i=>{t.classList.toggle("alt-active",!!i.altKey)})),this._register(V(e,"keyup",i=>{i.keyCode===27&&i.stopPropagation()})),this._register(V(this._tabContainer,ye.FOCUS_IN,()=>{this._terminalTabsFocusContextKey.set(!0)})),this._register(V(this._tabContainer,ye.FOCUS_OUT,()=>{this._terminalTabsFocusContextKey.set(!1)}))}_getTabActions(){return[new Ct,this._configurationService.inspect("terminal.integrated.tabs.location").userValue==="left"?new U("moveRight",a("moveTabsRight","Move Tabs Right"),void 0,void 0,async()=>{this._configurationService.updateValue("terminal.integrated.tabs.location","right")}):new U("moveLeft",a("moveTabsLeft","Move Tabs Left"),void 0,void 0,async()=>{this._configurationService.updateValue("terminal.integrated.tabs.location","left")}),new U("hideTabs",a("hideTabs","Hide Tabs"),void 0,void 0,async()=>{this._configurationService.updateValue("terminal.integrated.tabs.enabled",!1)})]}setEditable(e){e||this._tabList.domFocus(),this._tabList.refresh(!1)}focusTabs(){if(!this._shouldShowTabs())return;this._terminalTabsFocusContextKey.set(!0);const e=this._tabList.getSelection();this._tabList.domFocus(),e&&this._tabList.setFocus(e)}focus(){if(this._terminalService.connectionState===0){const e=document.activeElement;this._register(this._terminalService.onDidChangeConnectionState(()=>{document.activeElement===e&&this._focus()}));return}this._focus()}focusHover(){if(this._shouldShowTabs()){this._tabList.focusHover();return}const e=this._terminalGroupService.activeInstance;e&&this._hoverService.showHover({...qr(e),target:this._terminalContainer,trapFocus:!0},!0)}_focus(){var e;(e=this._terminalGroupService.activeInstance)==null||e.focusWhenReady()}};Cr=b([d(1,ne),d(2,ce),d(3,O),d(4,ee),d(5,Wt),d(6,Z),d(7,Kn),d(8,Xe),d(9,Ie),d(10,Yn)],Cr);function au(){pe.appendMenuItems([{id:I.MenubarTerminalMenu,item:{group:"1_create",command:{id:"workbench.action.terminal.new",title:a({key:"miNewTerminal",comment:["&& denotes a mnemonic"]},"&&New Terminal")},order:1}},{id:I.MenubarTerminalMenu,item:{group:"1_create",command:{id:"workbench.action.terminal.split",title:a({key:"miSplitTerminal",comment:["&& denotes a mnemonic"]},"&&Split Terminal"),precondition:g.has("terminalIsOpen")},order:2,when:u.processSupported}},{id:I.MenubarTerminalMenu,item:{group:"2_run",command:{id:"workbench.action.terminal.runActiveFile",title:a({key:"miRunActiveFile",comment:["&& denotes a mnemonic"]},"Run &&Active File")},order:3,when:u.processSupported}},{id:I.MenubarTerminalMenu,item:{group:"2_run",command:{id:"workbench.action.terminal.runSelectedText",title:a({key:"miRunSelectedText",comment:["&& denotes a mnemonic"]},"Run &&Selected Text")},order:4,when:u.processSupported}}]),pe.appendMenuItems([{id:I.TerminalInstanceContext,item:{group:"1_create",command:{id:"workbench.action.terminal.split",title:x.split.value}}},{id:I.TerminalInstanceContext,item:{command:{id:"workbench.action.terminal.new",title:x.new},group:"1_create"}},{id:I.TerminalInstanceContext,item:{command:{id:"workbench.action.terminal.kill",title:x.kill.value},group:"4_kill"}},{id:I.TerminalInstanceContext,item:{command:{id:"workbench.action.terminal.copySelection",title:a("workbench.action.terminal.copySelection.short","Copy")},group:"2_edit",order:1}},{id:I.TerminalInstanceContext,item:{command:{id:"workbench.action.terminal.copySelectionAsHtml",title:a("workbench.action.terminal.copySelectionAsHtml","Copy as HTML")},group:"2_edit",order:2}},{id:I.TerminalInstanceContext,item:{command:{id:"workbench.action.terminal.paste",title:a("workbench.action.terminal.paste.short","Paste")},group:"2_edit",order:3}},{id:I.TerminalInstanceContext,item:{command:{id:"workbench.action.terminal.clear",title:a("workbench.action.terminal.clear","Clear")},group:"3_clear"}},{id:I.TerminalInstanceContext,item:{command:{id:"workbench.action.terminal.showTabs",title:a("workbench.action.terminal.showsTabs","Show Tabs")},when:g.not("config.terminal.integrated.tabs.enabled"),group:"5_config"}},{id:I.TerminalInstanceContext,item:{command:{id:"workbench.action.terminal.sizeToContentWidth",title:x.toggleSizeToContentWidth},group:"5_config"}},{id:I.TerminalInstanceContext,item:{command:{id:"workbench.action.terminal.selectAll",title:a("workbench.action.terminal.selectAll","Select All")},group:"2_edit",order:3}}]),pe.appendMenuItems([{id:I.TerminalEditorInstanceContext,item:{group:"1_create",command:{id:"workbench.action.terminal.split",title:x.split.value}}},{id:I.TerminalEditorInstanceContext,item:{command:{id:"workbench.action.terminal.new",title:x.new},group:"1_create"}},{id:I.TerminalEditorInstanceContext,item:{command:{id:"workbench.action.terminal.killEditor",title:x.kill.value},group:"4_kill"}},{id:I.TerminalEditorInstanceContext,item:{command:{id:"workbench.action.terminal.copySelection",title:a("workbench.action.terminal.copySelection.short","Copy")},group:"2_edit",order:1}},{id:I.TerminalEditorInstanceContext,item:{command:{id:"workbench.action.terminal.copySelectionAsHtml",title:a("workbench.action.terminal.copySelectionAsHtml","Copy as HTML")},group:"2_edit",order:2}},{id:I.TerminalEditorInstanceContext,item:{command:{id:"workbench.action.terminal.paste",title:a("workbench.action.terminal.paste.short","Paste")},group:"2_edit",order:3}},{id:I.TerminalEditorInstanceContext,item:{command:{id:"workbench.action.terminal.clear",title:a("workbench.action.terminal.clear","Clear")},group:"3_clear"}},{id:I.TerminalEditorInstanceContext,item:{command:{id:"workbench.action.terminal.selectAll",title:a("workbench.action.terminal.selectAll","Select All")},group:"2_edit",order:3}},{id:I.TerminalEditorInstanceContext,item:{command:{id:"workbench.action.terminal.sizeToContentWidth",title:x.toggleSizeToContentWidth},group:"5_config"}}]),pe.appendMenuItems([{id:I.TerminalTabEmptyAreaContext,item:{command:{id:"workbench.action.terminal.newWithProfile",title:a("workbench.action.terminal.newWithProfile.short","New Terminal With Profile")},group:"1_create"}},{id:I.TerminalTabEmptyAreaContext,item:{command:{id:"workbench.action.terminal.new",title:x.new},group:"1_create"}}]),pe.appendMenuItems([{id:I.TerminalNewDropdownContext,item:{command:{id:"workbench.action.terminal.selectDefaultShell",title:{value:a("workbench.action.terminal.selectDefaultProfile","Select Default Profile"),original:"Select Default Profile"}},group:"3_configure"}},{id:I.TerminalNewDropdownContext,item:{command:{id:"workbench.action.terminal.openSettings",title:a("workbench.action.terminal.openSettings","Configure Terminal Settings")},group:"3_configure"}},{id:I.TerminalNewDropdownContext,item:{command:{id:"workbench.action.tasks.runTask",title:a("workbench.action.tasks.runTask","Run Task...")},when:uo,group:"4_tasks",order:1}},{id:I.TerminalNewDropdownContext,item:{command:{id:"workbench.action.tasks.configureTaskRunner",title:a("workbench.action.tasks.configureTaskRunner","Configure Tasks...")},when:uo,group:"4_tasks",order:2}}]),pe.appendMenuItems([{id:I.ViewTitle,item:{command:{id:"workbench.action.terminal.switchTerminal",title:{value:a("workbench.action.terminal.switchTerminal","Switch Terminal"),original:"Switch Terminal"}},group:"navigation",order:0,when:g.and(g.equals("view",z),g.not("config.terminal.integrated.tabs.enabled"))}},{id:I.ViewTitle,item:{command:{id:"workbench.action.terminal.focus",title:x.focus},alt:{id:"workbench.action.terminal.split",title:x.split.value,icon:k.splitHorizontal},group:"navigation",order:0,when:g.and(g.equals("view",z),g.has("config.terminal.integrated.tabs.enabled"),g.or(g.and(g.equals("config.terminal.integrated.tabs.showActiveTerminal","singleTerminal"),g.equals("terminalCount",1)),g.and(g.equals("config.terminal.integrated.tabs.showActiveTerminal","singleTerminalOrNarrow"),g.or(g.equals("terminalCount",1),g.has("isTerminalTabsNarrow"))),g.and(g.equals("config.terminal.integrated.tabs.showActiveTerminal","singleGroup"),g.equals("terminalGroupCount",1)),g.equals("config.terminal.integrated.tabs.showActiveTerminal","always")))}},{id:I.ViewTitle,item:{command:{id:"workbench.action.terminal.split",title:x.split,icon:k.splitHorizontal},group:"navigation",order:2,when:g.and(g.equals("view",z),g.notEquals("config.terminal.integrated.tabs.hideCondition","never"),g.or(g.not("config.terminal.integrated.tabs.enabled"),g.and(g.equals("config.terminal.integrated.tabs.showActions","singleTerminal"),g.equals("terminalCount",1)),g.and(g.equals("config.terminal.integrated.tabs.showActions","singleTerminalOrNarrow"),g.or(g.equals("terminalCount",1),g.has("isTerminalTabsNarrow"))),g.and(g.equals("config.terminal.integrated.tabs.showActions","singleGroup"),g.equals("terminalGroupCount",1)),g.equals("config.terminal.integrated.tabs.showActions","always")))}},{id:I.ViewTitle,item:{command:{id:"workbench.action.terminal.kill",title:x.kill,icon:k.trash},group:"navigation",order:3,when:g.and(g.equals("view",z),g.notEquals("config.terminal.integrated.tabs.hideCondition","never"),g.or(g.not("config.terminal.integrated.tabs.enabled"),g.and(g.equals("config.terminal.integrated.tabs.showActions","singleTerminal"),g.equals("terminalCount",1)),g.and(g.equals("config.terminal.integrated.tabs.showActions","singleTerminalOrNarrow"),g.or(g.equals("terminalCount",1),g.has("isTerminalTabsNarrow"))),g.and(g.equals("config.terminal.integrated.tabs.showActions","singleGroup"),g.equals("terminalGroupCount",1)),g.equals("config.terminal.integrated.tabs.showActions","always")))}},{id:I.ViewTitle,item:{command:{id:"workbench.action.terminal.new",title:x.new,icon:k.plus},alt:{id:"workbench.action.terminal.split",title:x.split.value,icon:k.splitHorizontal},group:"navigation",order:0,when:g.and(g.equals("view",z),g.or(u.webExtensionContributedProfile,u.processSupported))}},{id:I.ViewTitle,item:{command:{id:"workbench.action.terminal.clear",title:a("workbench.action.terminal.clearLong","Clear Terminal"),icon:k.clearAll},group:"navigation",order:4,when:g.equals("view",z),isHiddenByDefault:!0}},{id:I.ViewTitle,item:{command:{id:"workbench.action.terminal.runActiveFile",title:a("workbench.action.terminal.runActiveFile","Run Active File"),icon:k.run},group:"navigation",order:5,when:g.equals("view",z),isHiddenByDefault:!0}},{id:I.ViewTitle,item:{command:{id:"workbench.action.terminal.runSelectedText",title:a("workbench.action.terminal.runSelectedText","Run Selected Text"),icon:k.selection},group:"navigation",order:6,when:g.equals("view",z),isHiddenByDefault:!0}}]),pe.appendMenuItems([{id:I.TerminalInlineTabContext,item:{command:{id:"workbench.action.terminal.split",title:x.split.value},group:"1_create",order:1}},{id:I.TerminalInlineTabContext,item:{command:{id:"workbench.action.terminal.moveToEditor",title:x.moveToEditor.value},group:"1_create",order:2}},{id:I.TerminalInlineTabContext,item:{command:{id:"workbench.action.terminal.changeIconPanel",title:x.changeIcon.value},group:"2_edit"}},{id:I.TerminalInlineTabContext,item:{command:{id:"workbench.action.terminal.changeColorPanel",title:x.changeColor.value},group:"2_edit"}},{id:I.TerminalInlineTabContext,item:{command:{id:"workbench.action.terminal.renamePanel",title:x.rename.value},group:"2_edit"}},{id:I.TerminalInlineTabContext,item:{command:{id:"workbench.action.terminal.sizeToContentWidthInstance",title:a("workbench.action.terminal.sizeToContentWidthInstance","Toggle Size to Content Width")},group:"2_edit"}},{id:I.TerminalInlineTabContext,item:{command:{id:"workbench.action.terminal.kill",title:x.kill.value},group:"4_kill"}}]),pe.appendMenuItems([{id:I.TerminalTabContext,item:{command:{id:"workbench.action.terminal.splitInstance",title:x.split.value},group:"1_create",order:1}},{id:I.TerminalTabContext,item:{command:{id:"workbench.action.terminal.moveToEditorInstance",title:x.moveToEditor.value},group:"1_create",order:2}},{id:I.TerminalTabContext,item:{command:{id:"workbench.action.terminal.renameInstance",title:a("workbench.action.terminal.renameInstance","Rename...")},group:"2_edit"}},{id:I.TerminalTabContext,item:{command:{id:"workbench.action.terminal.changeIconInstance",title:a("workbench.action.terminal.changeIcon","Change Icon...")},group:"2_edit"}},{id:I.TerminalTabContext,item:{command:{id:"workbench.action.terminal.changeColorInstance",title:a("workbench.action.terminal.changeColor","Change Color...")},group:"2_edit"}},{id:I.TerminalTabContext,item:{command:{id:"workbench.action.terminal.sizeToContentWidthInstance",title:a("workbench.action.terminal.sizeToContentWidthInstance","Toggle Size to Content Width")},group:"2_edit"}},{id:I.TerminalTabContext,item:{group:"5_config",command:{id:"workbench.action.terminal.joinInstance",title:a("workbench.action.terminal.joinInstance","Join Terminals")},when:u.tabsSingularSelection.toNegated()}},{id:I.TerminalTabContext,item:{group:"5_config",command:{id:"workbench.action.terminal.unsplitInstance",title:x.unsplit.value},when:g.and(u.tabsSingularSelection,u.splitTerminal)}},{id:I.TerminalTabContext,item:{command:{id:"workbench.action.terminal.killInstance",title:x.kill.value},group:"4_kill"}}]),pe.appendMenuItem(I.EditorTitleContext,{command:{id:"workbench.action.terminal.moveToTerminalPanel",title:x.moveToTerminalPanel},when:wt.Scheme.isEqualTo(G.vscodeTerminal),group:"2_files"}),pe.appendMenuItem(I.EditorTitleContext,{command:{id:"workbench.action.terminal.rename",title:x.rename},when:wt.Scheme.isEqualTo(G.vscodeTerminal),group:"3_files"}),pe.appendMenuItem(I.EditorTitleContext,{command:{id:"workbench.action.terminal.changeColor",title:x.changeColor},when:wt.Scheme.isEqualTo(G.vscodeTerminal),group:"3_files"}),pe.appendMenuItem(I.EditorTitleContext,{command:{id:"workbench.action.terminal.changeIcon",title:x.changeIcon},when:wt.Scheme.isEqualTo(G.vscodeTerminal),group:"3_files"}),pe.appendMenuItem(I.EditorTitleContext,{command:{id:"workbench.action.terminal.sizeToContentWidth",title:x.toggleSizeToContentWidth},when:wt.Scheme.isEqualTo(G.vscodeTerminal),group:"3_files"}),pe.appendMenuItem(I.EditorTitle,{command:{id:"workbench.action.createTerminalEditor",title:x.new,icon:k.plus},alt:{id:"workbench.action.terminal.split",title:x.split.value,icon:k.splitHorizontal},group:"navigation",order:0,when:wt.Scheme.isEqualTo(G.vscodeTerminal)})}function yr(r,e,t,i,n,s){let o=[],l=[];e=e.filter(f=>!f.isAutoDetected);const c=r===E.Editor||typeof r=="object"&&"viewColumn"in r&&r.viewColumn===Br?{viewColumn:Fn}:{splitActiveTerminal:!0};for(const f of e){const _=f.profileName===t,S={config:f,location:r},y={config:f,location:c},R=f.profileName.replace(/[\n\r\t]/g,"");o.push(new U("workbench.action.terminal.newWithProfile",_?a("defaultTerminalProfile","{0} (Default)",R):R,void 0,!0,async()=>{const C=await n.createTerminal(S);n.setActiveInstance(C),await n.focusActiveInstance()})),l.push(new U("workbench.action.terminal.split",_?a("defaultTerminalProfile","{0} (Default)",R):R,void 0,!0,async()=>{const C=await n.createTerminal(y);n.setActiveInstance(C),await n.focusActiveInstance()}))}for(const f of i){const S=f.title===t?a("defaultTerminalProfile","{0} (Default)",f.title.replace(/[\n\r\t]/g,"")):f.title.replace(/[\n\r\t]/g,"");o.push(new U("contributed",S,void 0,!0,()=>n.createTerminal({config:{extensionIdentifier:f.extensionIdentifier,id:f.id,title:S},location:r}))),l.push(new U("contributed-split",S,void 0,!0,()=>n.createTerminal({config:{extensionIdentifier:f.extensionIdentifier,id:f.id,title:S},location:c})))}const h=o.find(f=>f.label.endsWith("(Default)"));h&&(o=o.filter(f=>f!==h).sort((f,_)=>f.label.localeCompare(_.label)),o.unshift(h)),o.length>0&&(o.push(new Yo("split.profile",a("splitTerminal","Split Terminal"),l)),o.push(new Ct));const m=s.getActions();o.push(...Ct.join(...m.map(f=>f[1])));const p=l.find(f=>f.label.endsWith("(Default)"));return p&&(l=l.filter(f=>f!==p).sort((f,_)=>f.label.localeCompare(_.label)),l.unshift(p)),{dropdownAction:new U("refresh profiles","Launch Profile...","codicon-chevron-down",!0),dropdownMenuActions:o,className:`terminal-tab-actions-${n.resolveLocation(r)}`}}let xr=class extends uh{get terminalTabbedView(){return this._terminalTabbedView}constructor(e,t,i,n,s,o,l,c,h,m,p,w,f,_,S,y,R,C){super(e,t,o,s,i,n,l,_,m,p),this._contextKeyService=i,this._configurationService=s,this._contextMenuService=o,this._instantiationService=l,this._terminalService=c,this._terminalGroupService=h,this._notificationService=w,this._keybindingService=f,this._menuService=S,this._terminalProfileService=y,this._terminalProfileResolverService=R,this._themeService=C,this._isWelcomeShowing=!1,this._register(this._terminalService.onDidRegisterProcessSupport(()=>{this._onDidChangeViewWelcomeState.fire()})),this._register(this._terminalService.onDidChangeInstances(()=>{this._isWelcomeShowing&&(this._isWelcomeShowing=!0,this._onDidChangeViewWelcomeState.fire(),!this._terminalTabbedView&&this._parentDomElement&&(this._createTabsView(),this.layoutBody(this._parentDomElement.offsetHeight,this._parentDomElement.offsetWidth)))})),this._dropdownMenu=this._register(this._menuService.createMenu(I.TerminalNewDropdownContext,this._contextKeyService)),this._singleTabMenu=this._register(this._menuService.createMenu(I.TerminalInlineTabContext,this._contextKeyService)),this._register(this._terminalProfileService.onDidChangeAvailableProfiles(D=>this._updateTabActionBar(D))),this._viewShowing=u.viewShowing.bindTo(this._contextKeyService),this._register(this.onDidChangeBodyVisibility(D=>{var B;D&&((B=this._terminalTabbedView)==null||B.rerenderTabs())})),this._register(this._configurationService.onDidChangeConfiguration(D=>{this._parentDomElement&&(D.affectsConfiguration("terminal.integrated.shellIntegration.decorationsEnabled")||D.affectsConfiguration("terminal.integrated.shellIntegration.enabled"))&&this._updateForShellIntegration(this._parentDomElement)})),this._register(this._terminalService.onDidCreateInstance(D=>{D.capabilities.onDidAddCapability(B=>{var A;B===2&&this._gutterDecorationsEnabled()&&((A=this._parentDomElement)==null||A.classList.add("shell-integration"))})}))}_updateForShellIntegration(e){e.classList.toggle("shell-integration",this._gutterDecorationsEnabled())}_gutterDecorationsEnabled(){const e=this._configurationService.getValue("terminal.integrated.shellIntegration.decorationsEnabled");return(e==="both"||e==="gutter")&&this._configurationService.getValue("terminal.integrated.shellIntegration.enabled")}_initializeTerminal(){this.isBodyVisible()&&this._terminalService.isProcessSupportRegistered&&this._terminalService.connectionState===1&&!this._terminalGroupService.groups.length&&this._terminalService.createTerminal({location:E.Panel})}renderBody(e){super.renderBody(e),this._parentDomElement||this._updateForShellIntegration(e),this._parentDomElement=e,this._parentDomElement.classList.add("integrated-terminal"),this._fontStyleElement=document.createElement("style"),this._instantiationService.createInstance(Tr,this._parentDomElement),this.shouldShowWelcome()||this._createTabsView(),this._parentDomElement.appendChild(this._fontStyleElement),this._register(this.configurationService.onDidChangeConfiguration(t=>{if((t.affectsConfiguration("terminal.integrated.fontFamily")||t.affectsConfiguration("editor.fontFamily"))&&!this._terminalService.configHelper.configFontIsMonospace()){const n=[{label:a("terminal.useMonospace","Use 'monospace'"),run:()=>this.configurationService.updateValue("terminal.integrated.fontFamily","monospace")}];this._notificationService.prompt(ie.Warning,a("terminal.monospaceOnly","The terminal only supports monospace fonts. Be sure to restart VS Code if this is a newly installed font."),n)}})),this._register(this.onDidChangeBodyVisibility(async t=>{if(this._viewShowing.set(t),t)this._terminalService.isProcessSupportRegistered||this._onDidChangeViewWelcomeState.fire(),this._initializeTerminal(),this._terminalGroupService.showPanel(!1);else for(const i of this._terminalGroupService.instances)i.resetFocusContextKey();this._terminalGroupService.updateVisibility()})),this._register(this._terminalService.onDidChangeConnectionState(()=>this._initializeTerminal())),this.layoutBody(this._parentDomElement.offsetHeight,this._parentDomElement.offsetWidth)}_createTabsView(){this._parentDomElement&&(this._terminalTabbedView=this.instantiationService.createInstance(Cr,this._parentDomElement))}layoutBody(e,t){var i;super.layoutBody(e,t),(i=this._terminalTabbedView)==null||i.layout(t,e)}getActionViewItem(e){var t;switch(e.id){case"workbench.action.terminal.split":{const i=this,n=new class extends U{constructor(){super(e.id,e.label,e.class,e.enabled),this.checked=e.checked,this.tooltip=e.tooltip}dispose(){e.dispose()}async run(){const s=i._terminalGroupService.activeInstance;if(s){const o=await i._terminalService.createTerminal({location:{parentTerminal:s}});return o==null?void 0:o.focusWhenReady()}}};return new Uo(e,n,{icon:!0,label:!1,keybinding:this._getKeybindingLabel(e)})}case"workbench.action.terminal.switchTerminal":return this._instantiationService.createInstance(Ir,e);case"workbench.action.terminal.focus":if(e instanceof mn){const i=[];return wa(this._singleTabMenu,void 0,i),this._instantiationService.createInstance(kr,e,i)}case"workbench.action.terminal.new":if(e instanceof mn){const i=yr(E.Panel,this._terminalProfileService.availableProfiles,this._getDefaultProfileName(),this._terminalProfileService.contributedProfiles,this._terminalService,this._dropdownMenu);return(t=this._newDropdown)==null||t.dispose(),this._newDropdown=new ya(e,i.dropdownAction,i.dropdownMenuActions,i.className,this._contextMenuService,{},this._keybindingService,this._notificationService,this._contextKeyService,this._themeService),this._updateTabActionBar(this._terminalProfileService.availableProfiles),this._newDropdown}}return super.getActionViewItem(e)}_getDefaultProfileName(){let e;try{e=this._terminalProfileService.getDefaultProfileName()}catch{e=this._terminalProfileResolverService.defaultProfileName}return e}_getKeybindingLabel(e){var t;return xt((t=this._keybindingService.lookupKeybinding(e.id))==null?void 0:t.getLabel())}_updateTabActionBar(e){var i;const t=yr(E.Panel,e,this._getDefaultProfileName(),this._terminalProfileService.contributedProfiles,this._terminalService,this._dropdownMenu);(i=this._newDropdown)==null||i.update(t.dropdownAction,t.dropdownMenuActions)}focus(){if(this._terminalService.connectionState===0){const e=document.activeElement;this._register(this._terminalService.onDidChangeConnectionState(()=>{document.activeElement===e&&this._terminalGroupService.showPanel(!0)}));return}this._terminalGroupService.showPanel(!0)}shouldShowWelcome(){return this._isWelcomeShowing=!this._terminalService.isProcessSupportRegistered&&this._terminalService.instances.length===0,this._isWelcomeShowing}};xr=b([d(1,bi),d(2,Ie),d(3,Ni),d(4,Z),d(5,Wt),d(6,O),d(7,ne),d(8,ce),d(9,he),d(10,ft),d(11,ee),d(12,bi),d(13,Ri),d(14,Kn),d(15,Qe),d(16,pt),d(17,he)],xr);let Ir=class extends mh{constructor(e,t,i,n,s){super(null,e,Fo(t,i),i.activeGroupIndex,n,gh,{ariaLabel:a("terminals","Open Terminals."),optionsAsChildren:!0}),this._terminalService=t,this._terminalGroupService=i,this._register(t.onDidChangeInstances(()=>this._updateItems(),this)),this._register(t.onDidChangeActiveGroup(()=>this._updateItems(),this)),this._register(t.onDidChangeActiveInstance(()=>this._updateItems(),this)),this._register(t.onDidChangeInstanceTitle(()=>this._updateItems(),this)),this._register(i.onDidChangeGroups(()=>this._updateItems(),this)),this._register(t.onDidChangeConnectionState(()=>this._updateItems(),this)),this._register(s.onDidChangeAvailableProfiles(()=>this._updateItems(),this)),this._register(t.onDidChangeInstancePrimaryStatus(()=>this._updateItems(),this))}render(e){super.render(e),e.classList.add("switch-terminal"),e.style.borderColor=Xi(ph)}_updateItems(){const e=Fo(this._terminalService,this._terminalGroupService);this.setOptions(e,this._terminalGroupService.activeGroupIndex)}};Ir=b([d(1,ne),d(2,ce),d(3,fa),d(4,Qe)],Ir);function Fo(r,e){let t;return r.connectionState===1?t=e.getGroupLabels().map(i=>({text:i})):t=[{text:a("terminalConnectingLabel","Starting...")}],t.push({text:Pa,isDisabled:!0}),t.push({text:Ea}),t}let kr=class extends _a{constructor(e,t,i,n,s,o,l,c,h,m,p){super(e,{draggable:!0},i,n,s,o,h),this._actions=t,this._terminalService=l,this._terminalGroupService=c,this._commandService=m,this._instantiationService=p,this._elementDisposables=[],this._register(Y.debounce(Y.any(this._terminalService.onDidChangeInstancePrimaryStatus,this._terminalGroupService.onDidChangeActiveInstance,Y.map(this._terminalService.onDidChangeInstanceIcon,w=>w.instance),Y.map(this._terminalService.onDidChangeInstanceColor,w=>w.instance),this._terminalService.onDidChangeInstanceTitle,this._terminalService.onDidChangeInstanceCapability),(w,f)=>(w||(w=new Set),f&&w.add(f),w))(w=>{for(const f of w)this.updateLabel(f)})),this._register(we(()=>J(this._elementDisposables)))}async onClick(e){e.altKey&&this._menuItemAction.alt?this._commandService.executeCommand(this._menuItemAction.alt.id,{target:E.Panel}):this._openContextMenu()}updateLabel(e){if(!(e&&e!==this._terminalGroupService.activeInstance)&&(this._elementDisposables.length===0&&this.element&&this.label&&(this._elementDisposables.push(V(this.element,ye.CONTEXT_MENU,t=>{t.button===2&&(this._openContextMenu(),t.preventDefault())})),this._elementDisposables.push(V(this.element,ye.AUXCLICK,t=>{if(t.button===1){const i=this._terminalGroupService.activeInstance;i&&this._terminalService.safeDisposeTerminal(i),t.preventDefault()}})),this._elementDisposables.push(V(this.element,ye.DRAG_START,t=>{const i=this._terminalGroupService.activeInstance;t.dataTransfer&&i&&t.dataTransfer.setData("Terminals",JSON.stringify([i.resource.toString()]))}))),this.label)){const t=this.label,i=this._terminalGroupService.activeInstance;if(!i){mo(t,"");return}t.classList.add("single-terminal-tab");let n="";const s=i.statusList.primary;if(s){const c=Ka(s.severity);this._themeService.getColorTheme();const h=this._themeService.getColorTheme().getColor(c);h&&(n=h.toString())}t.style.color=n,mo(t,...fh(this._instantiationService.invokeFunction(lu,i,this._terminalService.configHelper.config.tabs.separator,L.isThemeIcon(this._commandAction.item.icon)?this._commandAction.item.icon:void 0))),this._altCommand&&(t.classList.remove(this._altCommand),this._altCommand=void 0),this._color&&(t.classList.remove(this._color),this._color=void 0),this._class&&(t.classList.remove(this._class),t.classList.remove("terminal-uri-icon"),this._class=void 0);const o=ct(i);o&&(this._color=o,t.classList.add(o));const l=Lt(i,this._themeService.getColorTheme().type);l&&(this._class=l==null?void 0:l[0],t.classList.add(...l)),this._commandAction.item.icon&&(this._altCommand="alt-command",t.classList.add(this._altCommand)),this._action.tooltip=cu(i,this._terminalService.configHelper.config.tabs.separator),this.updateTooltip()}}_openContextMenu(){this._contextMenuService.showContextMenu({getAnchor:()=>this.element,getActions:()=>this._actions,getActionsContext:()=>this.label})}};kr=b([d(2,bi),d(3,ee),d(4,Ie),d(5,he),d(6,ne),d(7,ce),d(8,Wt),d(9,ue),d(10,O)],kr);function lu(r,e,t,i){if(!e||!e.title)return"";const n=L.isThemeIcon(e.icon)?e.icon.id:r.get(pt).getDefaultIcon(),s=`$(${(i==null?void 0:i.id)||n}) ${Qa(e,t)}`,o=e.statusList.primary;return o!=null&&o.icon?`${s} $(${o.icon.id})`:s}function cu(r,e){var i;if(!r)return"";const t=[];return t.push(Qa(r,e)+Ya(r,!1)+Xa(r,!1)),t.push(((i=r.statusList.primary)==null?void 0:i.tooltip)||""),t.filter(n=>n).join(`

`)}function Qa(r,e){return r?r.description?`${r.title} ${e} ${r.description}`:r.title:""}let Tr=class extends ia{constructor(e,t,i,n){super(t),this._themeService=t,this._terminalService=i,this._terminalGroupService=n,this._registerListeners(),this._styleElement=document.createElement("style"),e.appendChild(this._styleElement),this._register(we(()=>e.removeChild(this._styleElement))),this.updateStyles()}_registerListeners(){this._register(this._terminalService.onDidChangeInstanceIcon(()=>this.updateStyles())),this._register(this._terminalService.onDidChangeInstanceColor(()=>this.updateStyles())),this._register(this._terminalService.onDidChangeInstances(()=>this.updateStyles())),this._register(this._terminalGroupService.onDidChangeGroups(()=>this.updateStyles()))}updateStyles(){super.updateStyles();const e=this._themeService.getColorTheme();let t="";for(const i of this._terminalService.instances){const n=i.icon;if(!n)continue;let s;n instanceof M?s=n:n instanceof Object&&"light"in n&&"dark"in n&&(s=e.type===na.LIGHT?n.light:n.dark);const o=Lt(i,e.type);s instanceof M&&o&&o.length>1&&(t+=`.monaco-workbench .${o[0]} .monaco-highlighted-label .codicon, .monaco-action-bar .terminal-uri-icon.single-terminal-tab.action-label:not(.alt-command) .codicon{background-image: ${sa(s)};}`)}for(const i of this._terminalService.instances){const n=ct(i);if(!n||!i.color)continue;const s=e.getColor(i.color);s&&(t+=`.monaco-workbench .${n} .codicon:first-child:not(.codicon-split-horizontal):not(.codicon-trashcan):not(.file-icon){ color: ${s} !important; }`)}this._styleElement.textContent=t}};Tr=b([d(1,he),d(2,ne),d(3,ce)],Tr);function hu(){du()}function du(){for(let r=0;r<9;r++){const e=r,t=r+1;va.registerCommandAndKeybindingRule({id:`workbench.action.terminal.focusAtIndex${t}`,weight:200,when:void 0,primary:0,handler:i=>(i.get(ce).setActiveInstanceByIndex(e),i.get(ce).showPanel(!0))})}}const Ja=`
- `+["`${cwd}`: "+a("cwd","the terminal's current working directory"),"`${cwdFolder}`: "+a("cwdFolder","the terminal's current working directory, displayed for multi-root workspaces or in a single root workspace when the value differs from the initial working directory. On Windows, this will only be displayed when shell integration is enabled."),"`${workspaceFolder}`: "+a("workspaceFolder","the workspace in which the terminal was launched"),"`${local}`: "+a("local","indicates a local terminal in a remote workspace"),"`${process}`: "+a("process","the name of the terminal process"),"`${separator}`: "+a("separator","a conditional separator {0} that only shows when surrounded by variables with values or static text.","(` - `)"),"`${sequence}`: "+a("sequence","the name provided to the terminal by the process"),"`${task}`: "+a("task","indicates this terminal is associated with a task")].join(`
- `);let Za=a("terminalTitle","Controls the terminal title. Variables are substituted based on the context:");Za+=Ja;let el=a("terminalDescription","Controls the terminal description, which appears to the right of the title. Variables are substituted based on the context:");el+=Ja;const uu={id:"terminal",order:100,title:a("terminalIntegratedConfigurationTitle","Integrated Terminal"),type:"object",properties:{["terminal.integrated.sendKeybindingsToShell"]:{markdownDescription:a("terminal.integrated.sendKeybindingsToShell","Dispatches most keybindings to the terminal instead of the workbench, overriding {0}, which can be used alternatively for fine tuning.","`#terminal.integrated.commandsToSkipShell#`"),type:"boolean",default:!1},["terminal.integrated.tabs.defaultColor"]:{description:a("terminal.integrated.tabs.defaultColor","A theme color ID to associate with terminal icons by default."),...qa,scope:4},["terminal.integrated.tabs.defaultIcon"]:{description:a("terminal.integrated.tabs.defaultIcon","A codicon ID to associate with terminal icons by default."),...Ua,default:k.terminal.id,scope:4},["terminal.integrated.tabs.enabled"]:{description:a("terminal.integrated.tabs.enabled","Controls whether terminal tabs display as a list to the side of the terminal. When this is disabled a dropdown will display instead."),type:"boolean",default:!0},["terminal.integrated.tabs.enableAnimation"]:{description:a("terminal.integrated.tabs.enableAnimation","Controls whether terminal tab statuses support animation (eg. in progress tasks)."),type:"boolean",default:!0},["terminal.integrated.tabs.hideCondition"]:{description:a("terminal.integrated.tabs.hideCondition","Controls whether the terminal tabs view will hide under certain conditions."),type:"string",enum:["never","singleTerminal","singleGroup"],enumDescriptions:[a("terminal.integrated.tabs.hideCondition.never","Never hide the terminal tabs view"),a("terminal.integrated.tabs.hideCondition.singleTerminal","Hide the terminal tabs view when there is only a single terminal opened"),a("terminal.integrated.tabs.hideCondition.singleGroup","Hide the terminal tabs view when there is only a single terminal group opened")],default:"singleTerminal"},["terminal.integrated.tabs.showActiveTerminal"]:{description:a("terminal.integrated.tabs.showActiveTerminal","Shows the active terminal information in the view. This is particularly useful when the title within the tabs aren't visible."),type:"string",enum:["always","singleTerminal","singleTerminalOrNarrow","never"],enumDescriptions:[a("terminal.integrated.tabs.showActiveTerminal.always","Always show the active terminal"),a("terminal.integrated.tabs.showActiveTerminal.singleTerminal","Show the active terminal when it is the only terminal opened"),a("terminal.integrated.tabs.showActiveTerminal.singleTerminalOrNarrow","Show the active terminal when it is the only terminal opened or when the tabs view is in its narrow textless state"),a("terminal.integrated.tabs.showActiveTerminal.never","Never show the active terminal")],default:"singleTerminalOrNarrow"},["terminal.integrated.tabs.showActions"]:{description:a("terminal.integrated.tabs.showActions","Controls whether terminal split and kill buttons are displays next to the new terminal button."),type:"string",enum:["always","singleTerminal","singleTerminalOrNarrow","never"],enumDescriptions:[a("terminal.integrated.tabs.showActions.always","Always show the actions"),a("terminal.integrated.tabs.showActions.singleTerminal","Show the actions when it is the only terminal opened"),a("terminal.integrated.tabs.showActions.singleTerminalOrNarrow","Show the actions when it is the only terminal opened or when the tabs view is in its narrow textless state"),a("terminal.integrated.tabs.showActions.never","Never show the actions")],default:"singleTerminalOrNarrow"},["terminal.integrated.tabs.location"]:{type:"string",enum:["left","right"],enumDescriptions:[a("terminal.integrated.tabs.location.left","Show the terminal tabs view to the left of the terminal"),a("terminal.integrated.tabs.location.right","Show the terminal tabs view to the right of the terminal")],default:"right",description:a("terminal.integrated.tabs.location","Controls the location of the terminal tabs, either to the left or right of the actual terminal(s).")},["terminal.integrated.tabFocusMode"]:{markdownDescription:a("tabFocusMode","Controls whether the terminal receives tabs or defers them to the workbench for navigation. When set, this overrides {0} when the terminal is focused.","`#editor.tabFocusMode#`"),type:["boolean","null"],default:null},["terminal.integrated.defaultLocation"]:{type:"string",enum:["editor","view"],enumDescriptions:[a("terminal.integrated.defaultLocation.editor","Create terminals in the editor"),a("terminal.integrated.defaultLocation.view","Create terminals in the terminal view")],default:"view",description:a("terminal.integrated.defaultLocation","Controls where newly created terminals will appear.")},["terminal.integrated.tabs.focusMode"]:{type:"string",enum:["singleClick","doubleClick"],enumDescriptions:[a("terminal.integrated.tabs.focusMode.singleClick","Focus the terminal when clicking a terminal tab"),a("terminal.integrated.tabs.focusMode.doubleClick","Focus the terminal when double-clicking a terminal tab")],default:"doubleClick",description:a("terminal.integrated.tabs.focusMode","Controls whether focusing the terminal of a tab happens on double or single click.")},["terminal.integrated.macOptionIsMeta"]:{description:a("terminal.integrated.macOptionIsMeta","Controls whether to treat the option key as the meta key in the terminal on macOS."),type:"boolean",default:!1},["terminal.integrated.macOptionClickForcesSelection"]:{description:a("terminal.integrated.macOptionClickForcesSelection","Controls whether to force selection when using Option+click on macOS. This will force a regular (line) selection and disallow the use of column selection mode. This enables copying and pasting using the regular terminal selection, for example, when mouse mode is enabled in tmux."),type:"boolean",default:!1},["terminal.integrated.altClickMovesCursor"]:{markdownDescription:a("terminal.integrated.altClickMovesCursor","If enabled, alt/option + click will reposition the prompt cursor to underneath the mouse when {0} is set to {1} (the default value). This may not work reliably depending on your shell.","`#editor.multiCursorModifier#`","`'alt'`"),type:"boolean",default:!0},["terminal.integrated.copyOnSelection"]:{description:a("terminal.integrated.copyOnSelection","Controls whether text selected in the terminal will be copied to the clipboard."),type:"boolean",default:!1},["terminal.integrated.enableMultiLinePasteWarning"]:{markdownDescription:a("terminal.integrated.enableMultiLinePasteWarning",`Show a warning dialog when pasting multiple lines into the terminal. The dialog does not show when:

- Bracketed paste mode is enabled (the shell supports multi-line paste natively)
- The paste is handled by the shell's readline (in the case of pwsh)`),type:"boolean",default:!0},["terminal.integrated.drawBoldTextInBrightColors"]:{description:a("terminal.integrated.drawBoldTextInBrightColors",'Controls whether bold text in the terminal will always use the "bright" ANSI color variant.'),type:"boolean",default:!0},["terminal.integrated.fontFamily"]:{markdownDescription:a("terminal.integrated.fontFamily","Controls the font family of the terminal. Defaults to {0}'s value.","`#editor.fontFamily#`"),type:"string"},["terminal.integrated.fontSize"]:{description:a("terminal.integrated.fontSize","Controls the font size in pixels of the terminal."),type:"number",default:De?12:14,minimum:6,maximum:100},["terminal.integrated.letterSpacing"]:{description:a("terminal.integrated.letterSpacing","Controls the letter spacing of the terminal. This is an integer value which represents the number of additional pixels to add between characters."),type:"number",default:Qo},["terminal.integrated.lineHeight"]:{description:a("terminal.integrated.lineHeight","Controls the line height of the terminal. This number is multiplied by the terminal font size to get the actual line-height in pixels."),type:"number",default:Jo},["terminal.integrated.minimumContrastRatio"]:{markdownDescription:a("terminal.integrated.minimumContrastRatio",`When set, the foreground color of each cell will change to try meet the contrast ratio specified. Note that this will not apply to \`powerline\` characters per #146406. Example values:

- 1: Do nothing and use the standard theme colors.
- 4.5: [WCAG AA compliance (minimum)](https://www.w3.org/TR/UNDERSTANDING-WCAG20/visual-audio-contrast-contrast.html) (default).
- 7: [WCAG AAA compliance (enhanced)](https://www.w3.org/TR/UNDERSTANDING-WCAG20/visual-audio-contrast7.html).
- 21: White on black or black on white.`),type:"number",default:4.5,tags:["accessibility"]},["terminal.integrated.tabStopWidth"]:{markdownDescription:a("terminal.integrated.tabStopWidth","The number of cells in a tab stop."),type:"number",minimum:1,default:8},["terminal.integrated.fastScrollSensitivity"]:{markdownDescription:a("terminal.integrated.fastScrollSensitivity","Scrolling speed multiplier when pressing `Alt`."),type:"number",default:5},["terminal.integrated.mouseWheelScrollSensitivity"]:{markdownDescription:a("terminal.integrated.mouseWheelScrollSensitivity","A multiplier to be used on the `deltaY` of mouse wheel scroll events."),type:"number",default:1},["terminal.integrated.bellDuration"]:{markdownDescription:a("terminal.integrated.bellDuration","The number of milliseconds to show the bell within a terminal tab when triggered."),type:"number",default:1e3},["terminal.integrated.fontWeight"]:{anyOf:[{type:"number",minimum:bs,maximum:Ss,errorMessage:a("terminal.integrated.fontWeightError",'Only "normal" and "bold" keywords or numbers between 1 and 1000 are allowed.')},{type:"string",pattern:"^(normal|bold|1000|[1-9][0-9]{0,2})$"},{enum:go}],description:a("terminal.integrated.fontWeight",'The font weight to use within the terminal for non-bold text. Accepts "normal" and "bold" keywords or numbers between 1 and 1000.'),default:"normal"},["terminal.integrated.fontWeightBold"]:{anyOf:[{type:"number",minimum:bs,maximum:Ss,errorMessage:a("terminal.integrated.fontWeightError",'Only "normal" and "bold" keywords or numbers between 1 and 1000 are allowed.')},{type:"string",pattern:"^(normal|bold|1000|[1-9][0-9]{0,2})$"},{enum:go}],description:a("terminal.integrated.fontWeightBold",'The font weight to use within the terminal for bold text. Accepts "normal" and "bold" keywords or numbers between 1 and 1000.'),default:"bold"},["terminal.integrated.cursorBlinking"]:{description:a("terminal.integrated.cursorBlinking","Controls whether the terminal cursor blinks."),type:"boolean",default:!1},["terminal.integrated.cursorStyle"]:{description:a("terminal.integrated.cursorStyle","Controls the style of terminal cursor."),enum:[zi.BLOCK,zi.LINE,zi.UNDERLINE],default:zi.BLOCK},["terminal.integrated.cursorWidth"]:{markdownDescription:a("terminal.integrated.cursorWidth","Controls the width of the cursor when {0} is set to {1}.","`#terminal.integrated.cursorStyle#`","`line`"),type:"number",default:1},["terminal.integrated.scrollback"]:{description:a("terminal.integrated.scrollback","Controls the maximum number of lines the terminal keeps in its buffer. We pre-allocate memory based on this value in order to ensure a smooth experience. As such, as the value increases, so will the amount of memory."),type:"number",default:1e3},["terminal.integrated.detectLocale"]:{markdownDescription:a("terminal.integrated.detectLocale","Controls whether to detect and set the `$LANG` environment variable to a UTF-8 compliant option since VS Code's terminal only supports UTF-8 encoded data coming from the shell."),type:"string",enum:["auto","off","on"],markdownEnumDescriptions:[a("terminal.integrated.detectLocale.auto","Set the `$LANG` environment variable if the existing variable does not exist or it does not end in `'.UTF-8'`."),a("terminal.integrated.detectLocale.off","Do not set the `$LANG` environment variable."),a("terminal.integrated.detectLocale.on","Always set the `$LANG` environment variable.")],default:"auto"},["terminal.integrated.gpuAcceleration"]:{type:"string",enum:["auto","on","off","canvas"],markdownEnumDescriptions:[a("terminal.integrated.gpuAcceleration.auto","Let VS Code detect which renderer will give the best experience."),a("terminal.integrated.gpuAcceleration.on","Enable GPU acceleration within the terminal."),a("terminal.integrated.gpuAcceleration.off","Disable GPU acceleration within the terminal. The terminal will render much slower when GPU acceleration is off but it should reliably work on all systems."),a("terminal.integrated.gpuAcceleration.canvas","Use the terminal's fallback canvas renderer which uses a 2d context instead of webgl which may perform better on some systems. Note that some features are limited in the canvas renderer like opaque selection.")],default:"auto",description:a("terminal.integrated.gpuAcceleration","Controls whether the terminal will leverage the GPU to do its rendering.")},["terminal.integrated.tabs.separator"]:{type:"string",default:" - ",markdownDescription:a("terminal.integrated.tabs.separator","Separator used by {0} and {0}.","`terminal.integrated.tabs.title`","`terminal.integrated.tabs.description`")},["terminal.integrated.tabs.title"]:{type:"string",default:"${process}",markdownDescription:Za},["terminal.integrated.tabs.description"]:{type:"string",default:"${task}${separator}${local}${separator}${cwdFolder}",markdownDescription:el},["terminal.integrated.rightClickBehavior"]:{type:"string",enum:["default","copyPaste","paste","selectWord","nothing"],enumDescriptions:[a("terminal.integrated.rightClickBehavior.default","Show the context menu."),a("terminal.integrated.rightClickBehavior.copyPaste","Copy when there is a selection, otherwise paste."),a("terminal.integrated.rightClickBehavior.paste","Paste on right click."),a("terminal.integrated.rightClickBehavior.selectWord","Select the word under the cursor and show the context menu."),a("terminal.integrated.rightClickBehavior.nothing","Do nothing and pass event to terminal.")],default:De?"selectWord":re?"copyPaste":"default",description:a("terminal.integrated.rightClickBehavior","Controls how terminal reacts to right click.")},["terminal.integrated.cwd"]:{restricted:!0,description:a("terminal.integrated.cwd","An explicit start path where the terminal will be launched, this is used as the current working directory (cwd) for the shell process. This may be particularly useful in workspace settings if the root directory is not a convenient cwd."),type:"string",default:void 0,scope:4},["terminal.integrated.confirmOnExit"]:{description:a("terminal.integrated.confirmOnExit","Controls whether to confirm when the window closes if there are active terminal sessions."),type:"string",enum:["never","always","hasChildProcesses"],enumDescriptions:[a("terminal.integrated.confirmOnExit.never","Never confirm."),a("terminal.integrated.confirmOnExit.always","Always confirm if there are terminals."),a("terminal.integrated.confirmOnExit.hasChildProcesses","Confirm if there are any terminals that have child processes.")],default:"never"},["terminal.integrated.confirmOnKill"]:{description:a("terminal.integrated.confirmOnKill","Controls whether to confirm killing terminals when they have child processes. When set to editor, terminals in the editor area will be marked as changed when they have child processes. Note that child process detection may not work well for shells like Git Bash which don't run their processes as child processes of the shell."),type:"string",enum:["never","editor","panel","always"],enumDescriptions:[a("terminal.integrated.confirmOnKill.never","Never confirm."),a("terminal.integrated.confirmOnKill.editor","Confirm if the terminal is in the editor."),a("terminal.integrated.confirmOnKill.panel","Confirm if the terminal is in the panel."),a("terminal.integrated.confirmOnKill.always","Confirm if the terminal is either in the editor or panel.")],default:"editor"},["terminal.integrated.enableBell"]:{description:a("terminal.integrated.enableBell","Controls whether the terminal bell is enabled. This shows up as a visual bell next to the terminal's name."),type:"boolean",default:!1},["terminal.integrated.commandsToSkipShell"]:{markdownDescription:a("terminal.integrated.commandsToSkipShell",`A set of command IDs whose keybindings will not be sent to the shell but instead always be handled by VS Code. This allows keybindings that would normally be consumed by the shell to act instead the same as when the terminal is not focused, for example \`Ctrl+P\` to launch Quick Open.

&nbsp;

Many commands are skipped by default. To override a default and pass that command's keybinding to the shell instead, add the command prefixed with the \`-\` character. For example add \`-workbench.action.quickOpen\` to allow \`Ctrl+P\` to reach the shell.

&nbsp;

The following list of default skipped commands is truncated when viewed in Settings Editor. To see the full list, {1} and search for the first command from the list below.

&nbsp;

Default Skipped Commands:

{0}`,ma.sort().map(r=>`- ${r}`).join(`
`),`[${a("openDefaultSettingsJson","open the default settings JSON")}](command:workbench.action.openRawDefaultSettings '${a("openDefaultSettingsJson.capitalized","Open Default Settings (JSON)")}')`),type:"array",items:{type:"string"},default:[]},["terminal.integrated.allowChords"]:{markdownDescription:a("terminal.integrated.allowChords","Whether or not to allow chord keybindings in the terminal. Note that when this is true and the keystroke results in a chord it will bypass {0}, setting this to false is particularly useful when you want ctrl+k to go to your shell (not VS Code).","`#terminal.integrated.commandsToSkipShell#`"),type:"boolean",default:!0},["terminal.integrated.allowMnemonics"]:{markdownDescription:a("terminal.integrated.allowMnemonics","Whether to allow menubar mnemonics (for example Alt+F) to trigger the open of the menubar. Note that this will cause all alt keystrokes to skip the shell when true. This does nothing on macOS."),type:"boolean",default:!1},["terminal.integrated.env.osx"]:{restricted:!0,markdownDescription:a("terminal.integrated.env.osx","Object with environment variables that will be added to the VS Code process to be used by the terminal on macOS. Set to `null` to delete the environment variable."),type:"object",additionalProperties:{type:["string","null"]},default:{}},["terminal.integrated.env.linux"]:{restricted:!0,markdownDescription:a("terminal.integrated.env.linux","Object with environment variables that will be added to the VS Code process to be used by the terminal on Linux. Set to `null` to delete the environment variable."),type:"object",additionalProperties:{type:["string","null"]},default:{}},["terminal.integrated.env.windows"]:{restricted:!0,markdownDescription:a("terminal.integrated.env.windows","Object with environment variables that will be added to the VS Code process to be used by the terminal on Windows. Set to `null` to delete the environment variable."),type:"object",additionalProperties:{type:["string","null"]},default:{}},["terminal.integrated.environmentChangesIndicator"]:{markdownDescription:a("terminal.integrated.environmentChangesIndicator","Whether to display the environment changes indicator on each terminal which explains whether extensions have made, or want to make changes to the terminal's environment."),type:"string",enum:["off","on","warnonly"],enumDescriptions:[a("terminal.integrated.environmentChangesIndicator.off","Disable the indicator."),a("terminal.integrated.environmentChangesIndicator.on","Enable the indicator."),a("terminal.integrated.environmentChangesIndicator.warnonly","Only show the warning indicator when a terminal's environment is 'stale', not the information indicator that shows a terminal has had its environment modified by an extension.")],default:"warnonly"},["terminal.integrated.environmentChangesRelaunch"]:{markdownDescription:a("terminal.integrated.environmentChangesRelaunch","Whether to relaunch terminals automatically if extension want to contribute to their environment and have not been interacted with yet."),type:"boolean",default:!0},["terminal.integrated.showExitAlert"]:{description:a("terminal.integrated.showExitAlert",'Controls whether to show the alert "The terminal process terminated with exit code" when exit code is non-zero.'),type:"boolean",default:!0},["terminal.integrated.splitCwd"]:{description:a("terminal.integrated.splitCwd","Controls the working directory a split terminal starts with."),type:"string",enum:["workspaceRoot","initial","inherited"],enumDescriptions:[a("terminal.integrated.splitCwd.workspaceRoot","A new split terminal will use the workspace root as the working directory. In a multi-root workspace a choice for which root folder to use is offered."),a("terminal.integrated.splitCwd.initial","A new split terminal will use the working directory that the parent terminal started with."),a("terminal.integrated.splitCwd.inherited","On macOS and Linux, a new split terminal will use the working directory of the parent terminal. On Windows, this behaves the same as initial.")],default:"inherited"},["terminal.integrated.windowsEnableConpty"]:{description:a("terminal.integrated.windowsEnableConpty","Whether to use ConPTY for Windows terminal process communication (requires Windows 10 build number 18309+). Winpty will be used if this is false."),type:"boolean",default:!0},["terminal.integrated.wordSeparators"]:{description:a("terminal.integrated.wordSeparators","A string containing all characters to be considered word separators by the double-click to select word feature."),type:"string",default:" ()[]{}',\"`─‘’|"},["terminal.integrated.enableFileLinks"]:{description:a("terminal.integrated.enableFileLinks","Whether to enable file links in terminals. Links can be slow when working on a network drive in particular because each file link is verified against the file system. Changing this will take effect only in new terminals."),type:"string",enum:["off","on","notRemote"],enumDescriptions:[a("enableFileLinks.off","Always off."),a("enableFileLinks.on","Always on."),a("enableFileLinks.notRemote","Enable only when not in a remote workspace.")],default:"on"},["terminal.integrated.unicodeVersion"]:{type:"string",enum:["6","11"],enumDescriptions:[a("terminal.integrated.unicodeVersion.six","Version 6 of Unicode. This is an older version which should work better on older systems."),a("terminal.integrated.unicodeVersion.eleven","Version 11 of Unicode. This version provides better support on modern systems that use modern versions of Unicode.")],default:"11",description:a("terminal.integrated.unicodeVersion","Controls what version of Unicode to use when evaluating the width of characters in the terminal. If you experience emoji or other wide characters not taking up the right amount of space or backspace either deleting too much or too little then you may want to try tweaking this setting.")},["terminal.integrated.localEchoLatencyThreshold"]:{description:a("terminal.integrated.localEchoLatencyThreshold","Length of network delay, in milliseconds, where local edits will be echoed on the terminal without waiting for server acknowledgement. If '0', local echo will always be on, and if '-1' it will be disabled."),type:"integer",minimum:-1,default:30},["terminal.integrated.localEchoEnabled"]:{markdownDescription:a("terminal.integrated.localEchoEnabled","When local echo should be enabled. This will override {0}","`#terminal.integrated.localEchoLatencyThreshold#`"),type:"string",enum:["on","off","auto"],enumDescriptions:[a("terminal.integrated.localEchoEnabled.on","Always enabled"),a("terminal.integrated.localEchoEnabled.off","Always disabled"),a("terminal.integrated.localEchoEnabled.auto","Enabled only for remote workspaces")],default:"auto"},["terminal.integrated.localEchoExcludePrograms"]:{description:a("terminal.integrated.localEchoExcludePrograms","Local echo will be disabled when any of these program names are found in the terminal title."),type:"array",items:{type:"string",uniqueItems:!0},default:_h},["terminal.integrated.localEchoStyle"]:{description:a("terminal.integrated.localEchoStyle","Terminal style of locally echoed text; either a font style or an RGB color."),default:"dim",oneOf:[{type:"string",default:"dim",enum:["bold","dim","italic","underlined","inverted"]},{type:"string",format:"color-hex",default:"#ff0000"}]},["terminal.integrated.enablePersistentSessions"]:{description:a("terminal.integrated.enablePersistentSessions","Persist terminal sessions/history for the workspace across window reloads."),type:"boolean",default:!0},["terminal.integrated.persistentSessionReviveProcess"]:{markdownDescription:a("terminal.integrated.persistentSessionReviveProcess",`When the terminal process must be shut down (for example on window or application close), this determines when the previous terminal session contents/history should be restored and processes be recreated when the workspace is next opened.

Caveats:

- Restoring of the process current working directory depends on whether it is supported by the shell.
- Time to persist the session during shutdown is limited, so it may be aborted when using high-latency remote connections.`),type:"string",enum:["onExit","onExitAndWindowClose","never"],markdownEnumDescriptions:[a("terminal.integrated.persistentSessionReviveProcess.onExit","Revive the processes after the last window is closed on Windows/Linux or when the `workbench.action.quit` command is triggered (command palette, keybinding, menu)."),a("terminal.integrated.persistentSessionReviveProcess.onExitAndWindowClose","Revive the processes after the last window is closed on Windows/Linux or when the `workbench.action.quit` command is triggered (command palette, keybinding, menu), or when the window is closed."),a("terminal.integrated.persistentSessionReviveProcess.never","Never restore the terminal buffers or recreate the process.")],default:"onExit"},["terminal.integrated.customGlyphs"]:{description:a("terminal.integrated.customGlyphs","Whether to draw custom glyphs for block element and box drawing characters instead of using the font, which typically yields better rendering with continuous lines. Note that this doesn't work when {0} is disabled.","`#terminal.integrated.gpuAcceleration#`"),type:"boolean",default:!0},["terminal.integrated.autoReplies"]:{markdownDescription:a("terminal.integrated.autoReplies",`A set of messages that, when encountered in the terminal, will be automatically responded to. Provided the message is specific enough, this can help automate away common responses.

Remarks:

- Use {0} to automatically respond to the terminate batch job prompt on Windows.
- The message includes escape sequences so the reply might not happen with styled text.
- Each reply can only happen once every second.
- Use {1} in the reply to mean the enter key.
- To unset a default key, set the value to null.
- Restart VS Code if new don't apply.`,'`"Terminate batch job (Y/N)": "Y\\r"`','`"\\r"`'),type:"object",additionalProperties:{oneOf:[{type:"string",description:a("terminal.integrated.autoReplies.reply","The reply to send to the process.")},{type:"null"}]},default:{}},["terminal.integrated.shellIntegration.enabled"]:{restricted:!0,markdownDescription:a("terminal.integrated.shellIntegration.enabled",`Determines whether or not shell integration is auto-injected to support features like enhanced command tracking and current working directory detection. 

Shell integration works by injecting the shell with a startup script. The script gives VS Code insight into what is happening within the terminal.

Supported shells:

- Linux/macOS: bash, fish, pwsh, zsh
 - Windows: pwsh

This setting applies only when terminals are created, so you will need to restart your terminals for it to take effect.

 Note that the script injection may not work if you have custom arguments defined in the terminal profile, have enabled {1}, have a [complex bash \`PROMPT_COMMAND\`](https://code.visualstudio.com/docs/editor/integrated-terminal#_complex-bash-promptcommand), or other unsupported setup. To disable decorations, see {0}`,"`#terminal.integrated.shellIntegrations.decorationsEnabled#`","`#editor.accessibilitySupport#`"),type:"boolean",default:!0},["terminal.integrated.shellIntegration.decorationsEnabled"]:{restricted:!0,markdownDescription:a("terminal.integrated.shellIntegration.decorationsEnabled","When shell integration is enabled, adds a decoration for each command."),type:"string",enum:["both","gutter","overviewRuler","never"],enumDescriptions:[a("terminal.integrated.shellIntegration.decorationsEnabled.both","Show decorations in the gutter (left) and overview ruler (right)"),a("terminal.integrated.shellIntegration.decorationsEnabled.gutter","Show gutter decorations to the left of the terminal"),a("terminal.integrated.shellIntegration.decorationsEnabled.overviewRuler","Show overview ruler decorations to the right of the terminal"),a("terminal.integrated.shellIntegration.decorationsEnabled.never","Do not show decorations")],default:"both"},["terminal.integrated.shellIntegration.history"]:{restricted:!0,markdownDescription:a("terminal.integrated.shellIntegration.history","Controls the number of recently used commands to keep in the terminal command history. Set to 0 to disable terminal command history."),type:"number",default:100},["terminal.integrated.shellIntegration.suggestEnabled"]:{restricted:!0,markdownDescription:a("terminal.integrated.shellIntegration.suggestEnabled","Enables experimental terminal Intellisense suggestions for supported shells when {0} is set to {1}. If shell integration is installed manually, {2} needs to be set to {3} before calling the script.","`#terminal.integrated.shellIntegration.enabled#`","`true`","`VSCODE_SUGGEST`","`1`"),type:"boolean",default:!1,tags:["experimental"]},["terminal.integrated.smoothScrolling"]:{markdownDescription:a("terminal.integrated.smoothScrolling","Controls whether the terminal will scroll using an animation."),type:"boolean",default:!1},["terminal.integrated.experimentalImageSupport"]:{restricted:!0,markdownDescription:a("terminal.integrated.experimentalImageSupport","Enables experimental image support in the terminal. Both sixel and iTerm's inline image protocol are supported on Linux and macOS, Windows support will light up automatically when ConPTY passes through the sequences. Images will not be retained currently between window reloads/reconnects."),type:"boolean",default:!1,tags:["experimental"]}}};function mu(){xe.as(Vr.Configuration).registerConfiguration(uu)}let Dr=class extends wh{constructor(e,t,i,n,s,o,l,c,h,m,p,w,f){super(gn,e,t,i),this._terminalEditorService=n,this._terminalProfileResolverService=s,this._terminalService=o,this._instantiationService=h,this._contextMenuService=m,this._notificationService=p,this._terminalProfileService=w,this._workbenchLayoutService=f,this._editorInput=void 0,this._cancelContextMenu=!1,this._dropdownMenu=this._register(c.createMenu(I.TerminalNewDropdownContext,l)),this._instanceMenu=this._register(c.createMenu(I.TerminalEditorInstanceContext,l))}async setInput(e,t,i,n){var s,o,l,c;(o=(s=this._editorInput)==null?void 0:s.terminalInstance)==null||o.detachFromElement(),this._editorInput=e,await super.setInput(e,t,i,n),(l=this._editorInput.terminalInstance)==null||l.attachToElement(this._overflowGuardElement),this._lastDimension&&this.layout(this._lastDimension),(c=this._editorInput.terminalInstance)==null||c.setVisible(this.isVisible()&&this._workbenchLayoutService.isVisible("workbench.parts.editor")),this._editorInput.terminalInstance&&(this._register(this._editorInput.terminalInstance.onDidFocus(()=>this._setActiveInstance())),this._editorInput.setCopyLaunchConfig(this._editorInput.terminalInstance.shellLaunchConfig))}clearInput(){var e,t;super.clearInput(),(t=(e=this._editorInput)==null?void 0:e.terminalInstance)==null||t.detachFromElement(),this._editorInput=void 0}_setActiveInstance(){var e;(e=this._editorInput)!=null&&e.terminalInstance&&this._terminalEditorService.setActiveInstance(this._editorInput.terminalInstance)}focus(){var e,t;(t=(e=this._editorInput)==null?void 0:e.terminalInstance)==null||t.focus()}createEditor(e){this._editorInstanceElement=e,this._overflowGuardElement=_e(".terminal-overflow-guard"),this._editorInstanceElement.appendChild(this._overflowGuardElement),this._registerListeners()}_registerListeners(){this._editorInstanceElement&&(this._register(V(this._editorInstanceElement,"mousedown",async e=>{if(this._terminalEditorService.instances.length!==0){if(e.which===2&&Nn){const t=this._terminalEditorService.activeInstance;t==null||t.focus()}else if(e.which===3){const t=this._terminalService.configHelper.config.rightClickBehavior;if(t==="nothing"){e.shiftKey||(this._cancelContextMenu=!0);return}else if(t==="copyPaste"||t==="paste"){const i=this._terminalEditorService.activeInstance;if(!i)return;if(t==="copyPaste"&&e.shiftKey){vi(e,this._editorInstanceElement,this._instanceMenu,this._contextMenuService);return}t==="copyPaste"&&i.hasSelection()?(await i.copySelection(),i.clearSelection()):Kt.clipboard.readText?i.paste():this._notificationService.info(`This browser doesn't support the clipboard.readText API needed to trigger a paste, try ${De?"⌘":"Ctrl"}+V instead.`),De&&setTimeout(()=>{i.clearSelection()},0),this._cancelContextMenu=!0}}}})),this._register(V(this._editorInstanceElement,"contextmenu",e=>{const t=this._terminalService.configHelper.config.rightClickBehavior;if(t==="nothing"&&!e.shiftKey){e.preventDefault(),e.stopImmediatePropagation(),this._cancelContextMenu=!1;return}else!this._cancelContextMenu&&t!=="copyPaste"&&t!=="paste"&&(this._cancelContextMenu||vi(e,this._editorInstanceElement,this._instanceMenu,this._contextMenuService),e.preventDefault(),e.stopImmediatePropagation(),this._cancelContextMenu=!1)})))}layout(e){var t,i;(i=(t=this._editorInput)==null?void 0:t.terminalInstance)==null||i.layout(e),this._lastDimension=e}setVisible(e,t){var i,n;super.setVisible(e,t),(n=(i=this._editorInput)==null?void 0:i.terminalInstance)==null||n.setVisible(e&&this._workbenchLayoutService.isVisible("workbench.parts.editor"))}getActionViewItem(e){switch(e.id){case"workbench.action.createTerminalEditor":if(e instanceof mn){const i=yr({viewColumn:Br},this._terminalProfileService.availableProfiles,this._getDefaultProfileName(),this._terminalProfileService.contributedProfiles,this._terminalService,this._dropdownMenu);return this._instantiationService.createInstance(ya,e,i.dropdownAction,i.dropdownMenuActions,i.className,this._contextMenuService,{})}}return super.getActionViewItem(e)}_getDefaultProfileName(){let e;try{e=this._terminalProfileService.getDefaultProfileName()}catch{e=this._terminalProfileResolverService.defaultProfileName}return e}};Dr=b([d(0,ft),d(1,he),d(2,Xe),d(3,yt),d(4,pt),d(5,ne),d(6,Ie),d(7,Kn),d(8,O),d(9,Wt),d(10,ee),d(11,Qe),d(12,Xn)],Dr);let Pr=class extends q{constructor(e,t,i,n,s,o,l){super(),e.registerEditor(`${G.vscodeTerminal}:/**`,{id:gn,label:x.terminal,priority:Sh.exclusive},{canSupportResource:c=>c.scheme===G.vscodeTerminal,singlePerResource:!0},{createEditorInput:async({resource:c,options:h})=>{let m=n.getInstanceFromResource(c);if(m){const f=o.getGroupForInstance(m);f==null||f.removeInstance(m)}else{const f=zr(c);if(!f.instanceId)throw new Error("Terminal identifier without instanceId");const _=n.getPrimaryBackend();if(!_)throw new Error("No terminal primary backend");const S=await _.requestDetachInstance(f.workspaceId,f.instanceId);if(!S)throw new Error("No terminal persistent process to attach");m=l.createInstance({attachPersistentProcess:S},E.Editor)}const p=s.resolveResource(m);return{editor:s.getInputFromResource(p),options:{...h,pinned:!0,forceReload:!0,override:gn}}}}),i.registerFormatter({scheme:G.vscodeTerminal,formatting:{label:"${path}",separator:""}}),t.onDidCreateTerminal(async c=>{const h=await n.createTerminal({config:c,location:E.Panel});n.setActiveInstance(h),await n.revealActiveTerminal()})}};Pr=b([d(0,vh),d(1,bh),d(2,Mt),d(3,ne),d(4,yt),d(5,ce),d(6,Ne)],Pr);const gu=xe.as(Ch.Quickaccess),pu="inTerminalPicker";gu.registerQuickAccessProvider({ctor:Zt,prefix:Zt.PREFIX,contextKey:pu,placeholder:a("tasksQuickAccessPlaceholder","Type the name of a terminal to open."),helpEntries:[{description:a("tasksQuickAccessHelp","Show All Opened Terminals"),commandId:"workbench.action.quickOpenTerm"}]});const Oo="workbench.action.quickOpenNavigateNextInTerminalPicker";$n.registerCommand({id:Oo,handler:Ca(Oo,!0)});const No="workbench.action.quickOpenNavigatePreviousInTerminalPicker";$n.registerCommand({id:No,handler:Ca(No,!1)});const fu=xe.as(yh.Workbench);fu.registerWorkbenchContribution(Pr,3);Qd();mu();xe.as(xh.EditorPane).registerEditorPane(Ih.create(Dr,gn,x.terminal),[new Ce(ke)]);xe.as(kh.DragAndDropContribution).register({dataFormatKey:"Terminals",getEditorInputs(r){const e=[];try{const t=JSON.parse(r);for(const i of t)e.push({resource:M.parse(i)})}catch{}return e},setData(r,e){var i;const t=r.filter(({resource:n})=>n.scheme===G.vscodeTerminal);t.length&&((i=e.dataTransfer)==null||i.setData("Terminals",JSON.stringify(t.map(({resource:n})=>n.toString()))))}});const _u=xe.as(ba.ViewContainersRegistry).registerViewContainer({id:z,title:a("terminal","Terminal"),icon:xa,ctorDescriptor:new Ce(Th,[z,{mergeViewWithContainerWhenSingleView:!0}]),storageId:z,hideIfEmpty:!0,order:3},1,{doNotRegisterOpenCommand:!0,isDefault:!0});xe.as(ba.ViewsRegistry).registerViews([{id:z,name:a("terminal","Terminal"),containerIcon:xa,canToggleVisibility:!1,canMoveView:!0,ctorDescriptor:new Ce(xr),openCommandActionDescriptor:{id:"workbench.action.terminal.toggleTerminal",mnemonicTitle:a({key:"miToggleIntegratedTerminal",comment:["&& denotes a mnemonic"]},"&&Terminal"),keybindings:{primary:2139,mac:{primary:347}},order:3}}],_u);sd();function te(r,e){va.registerCommandAndKeybindingRule({id:"workbench.action.terminal.sendSequence",weight:200,when:e.when||u.focus,primary:e.primary,mac:e.mac,linux:e.linux,win:e.win,handler:La,args:{text:r}})}re&&te(String.fromCharCode("V".charCodeAt(0)-64),{when:g.and(u.focus,g.equals("terminalShellType","pwsh"),Te.negate()),primary:2100});te("\x1B[24~a",{when:g.and(u.focus,g.equals("terminalShellType","pwsh"),u.terminalShellIntegrationEnabled,Te.negate()),primary:2058,mac:{primary:266}});te("\x1B[24~b",{when:g.and(u.focus,g.equals("terminalShellType","pwsh"),u.terminalShellIntegrationEnabled,Te.negate()),primary:522});te("\x1B[24~c",{when:g.and(u.focus,g.equals("terminalShellType","pwsh"),u.terminalShellIntegrationEnabled,Te.negate()),primary:1027});te("\x1B[24~d",{when:g.and(u.focus,g.equals("terminalShellType","pwsh"),u.terminalShellIntegrationEnabled,Te.negate()),mac:{primary:3089}});te("\x1B[24~e",{when:g.and(u.focus,g.equals("terminalShellType","pwsh"),u.terminalShellIntegrationEnabled,Te.negate(),g.equals("config.terminal.integrated.shellIntegration.suggestEnabled",!0)),primary:2058,mac:{primary:266}});te("\x1B[1;2H",{when:g.and(u.focus,g.equals("terminalShellType","pwsh")),mac:{primary:3087}});te("",{when:g.and(u.focus,Te),primary:2608,mac:{primary:816}});te("\x07",{when:u.focus,primary:2597,mac:{primary:805}});Ko&&te(String.fromCharCode("C".charCodeAt(0)-64),{when:g.and(u.focus),primary:289});te(String.fromCharCode("W".charCodeAt(0)-64),{primary:2049,mac:{primary:513}});re&&te(String.fromCharCode("H".charCodeAt(0)-64),{when:g.and(u.focus,g.equals("terminalShellType","cmd")),primary:2049});te("\x1Bd",{primary:2068,mac:{primary:532}});te("",{mac:{primary:2049}});te(String.fromCharCode("A".charCodeAt(0)-64),{mac:{primary:2063}});te(String.fromCharCode("E".charCodeAt(0)-64),{mac:{primary:2065}});te("\0",{primary:3095,mac:{primary:1303}});te("",{primary:3099,mac:{primary:1307}});te("",{primary:2138,mac:{primary:346}});hu();au();Dh();class Cm{constructor(){this.remoteAuthority=void 0,this.onPtyHostUnresponsive=Y.None,this.onPtyHostResponsive=Y.None,this.onPtyHostRestart=Y.None,this.onDidRequestDetach=Y.None,this.attachToProcess=$e,this.attachToRevivedProcess=$e,this.listProcesses=$e,this.getProfiles=async()=>[],this.getWslPath=$e,this.getEnvironment=async()=>({}),this.getShellEnvironment=async()=>{},this.setTerminalLayoutInfo=async()=>{},this.updateTitle=async()=>{},this.updateIcon=async()=>{},this.getTerminalLayoutInfo=async()=>{},this.reduceConnectionGraceTime=$e,this.requestDetachInstance=$e,this.acceptDetachInstanceReply=$e,this.persistTerminalState=$e}}class ym{constructor(e,t,i,n){this.id=e,this.pid=t,this.cwd=i,this.onData=n,this.onReady=new v,this.shouldPersist=!1,this.onProcessData=this.onData,this.onProcessReady=this.onReady.event,this.onDidChangeProperty=Y.None,this.onProcessExit=Y.None,this.processBinary=$e,this.refreshProperty=async()=>{},setTimeout(()=>{this.onReady.fire({cwd:i,pid:t})})}acknowledgeDataEvent(){}async setUnicodeVersion(){}async getInitialCwd(){return this.cwd}async getCwd(){return this.cwd}async getLatency(){return 0}async updateProperty(){}}function xm(r){return xe.as(Ts.Backend).registerTerminalBackend(r),{[ne.toString()]:new Ce(je),[yt.toString()]:new Ce(Xs),[ce.toString()]:new Ce(Js),[Ne.toString()]:new Ce(gr),[Qe.toString()]:new Ce(Mi),[pa.toString()]:new Ce(Ph),[Eh.toString()]:new Ce(eu),[pt.toString()]:new Ce(fr),[aa.toString()]:new Ce(At),[Ah.toString()]:new Ce(tu)}}export{Cm as SimpleTerminalBackend,ym as SimpleTerminalProcess,xm as default};
