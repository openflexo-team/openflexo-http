import{br as S,pp as T,pq as _,pr as A,ps as Qe,aH as g,B as r,pt as Xe,w as ye,iA as X,av as Ue,ap as D,iD as Ze,aN as E,aF as M,h_ as N,_ as me,a as K,a0 as et,bO as fe,O as tt,L as Re,aV as nt,bx as it,a1 as $e,g as pe,aU as Ge,pu as Oe,pv as ot,bv as ne,aa as Se,b1 as ke,pw as st,px as rt,ac as ve,py as at,b_ as ie,bq as we,pz as dt,nr as w,pA as ct,pB as Y,pC as v,bg as Fe,D as j,E as U,bd as je,a2 as J,da as ut,er as qe,mN as We,a3 as ge,mW as lt,aL as V,ek as ae,fm as ht,pD as Q,cA as Be,pE as xe,pF as yt,pG as Ne,pH as mt,pI as Ie,pd as ft,N as pt,aQ as gt,oL as bt,pk as oe,pJ as Le,e as Ct,dw as Kt,jA as Te,mK as _t,nj as St,nM as kt,X as vt,k as se}from"./index-1e6bb64c.js";import{g as wt}from"./unboundCommands-fbf82d4c.js";import"./workbench.contribution-90d7208d.js";class de{static _readModifiers(e){e=e.toLowerCase().trim();let t=!1,n=!1,i=!1,o=!1,s;do s=!1,/^ctrl(\+|\-)/.test(e)&&(t=!0,e=e.substr(5),s=!0),/^shift(\+|\-)/.test(e)&&(n=!0,e=e.substr(6),s=!0),/^alt(\+|\-)/.test(e)&&(i=!0,e=e.substr(4),s=!0),/^meta(\+|\-)/.test(e)&&(o=!0,e=e.substr(5),s=!0),/^win(\+|\-)/.test(e)&&(o=!0,e=e.substr(4),s=!0),/^cmd(\+|\-)/.test(e)&&(o=!0,e=e.substr(4),s=!0);while(s);let d;const u=e.indexOf(" ");return u>0?(d=e.substring(0,u),e=e.substring(u)):(d=e,e=""),{remains:e,ctrl:t,shift:n,alt:i,meta:o,key:d}}static parseChord(e){const t=this._readModifiers(e),n=t.key.match(/^\[([^\]]+)\]$/);if(n){const o=n[1],s=S.lowerCaseToEnum(o);return[new T(t.ctrl,t.shift,t.alt,t.meta,s),t.remains]}const i=_.fromUserSettings(t.key);return[new A(t.ctrl,t.shift,t.alt,t.meta,i),t.remains]}static parseKeybinding(e){if(!e)return null;const t=[];let n;for(;e.length>0;)[n,e]=this.parseChord(e),t.push(n);return t.length>0?new Qe(t):null}}const Ye=[{key:"commandPalette",id:g.CommandPalette,description:r("menus.commandPalette","The Command Palette"),supportsSubmenus:!1},{key:"touchBar",id:g.TouchBarContext,description:r("menus.touchBar","The touch bar (macOS only)"),supportsSubmenus:!1},{key:"editor/title",id:g.EditorTitle,description:r("menus.editorTitle","The editor title menu")},{key:"editor/title/run",id:g.EditorTitleRun,description:r("menus.editorTitleRun","Run submenu inside the editor title menu")},{key:"editor/context",id:g.EditorContext,description:r("menus.editorContext","The editor context menu")},{key:"editor/context/copy",id:g.EditorContextCopy,description:r("menus.editorContextCopyAs","'Copy as' submenu in the editor context menu")},{key:"editor/context/share",id:g.EditorContextShare,description:r("menus.editorContextShare","'Share' submenu in the editor context menu"),proposed:"contribShareMenu"},{key:"explorer/context",id:g.ExplorerContext,description:r("menus.explorerContext","The file explorer context menu")},{key:"explorer/context/share",id:g.ExplorerContextShare,description:r("menus.explorerContextShare","'Share' submenu in the file explorer context menu"),proposed:"contribShareMenu"},{key:"editor/title/context",id:g.EditorTitleContext,description:r("menus.editorTabContext","The editor tabs context menu")},{key:"editor/title/context/share",id:g.EditorTitleContextShare,description:r("menus.editorTitleContextShare","'Share' submenu inside the editor title context menu"),proposed:"contribShareMenu"},{key:"debug/callstack/context",id:g.DebugCallStackContext,description:r("menus.debugCallstackContext","The debug callstack view context menu")},{key:"debug/variables/context",id:g.DebugVariablesContext,description:r("menus.debugVariablesContext","The debug variables view context menu")},{key:"debug/toolBar",id:g.DebugToolBar,description:r("menus.debugToolBar","The debug toolbar menu")},{key:"menuBar/home",id:g.MenubarHomeMenu,description:r("menus.home","The home indicator context menu (web only)"),proposed:"contribMenuBarHome",supportsSubmenus:!1},{key:"menuBar/edit/copy",id:g.MenubarCopy,description:r("menus.opy","'Copy as' submenu in the top level Edit menu")},{key:"scm/title",id:g.SCMTitle,description:r("menus.scmTitle","The Source Control title menu")},{key:"scm/sourceControl",id:g.SCMSourceControl,description:r("menus.scmSourceControl","The Source Control menu")},{key:"scm/resourceState/context",id:g.SCMResourceContext,description:r("menus.resourceStateContext","The Source Control resource state context menu")},{key:"scm/resourceFolder/context",id:g.SCMResourceFolderContext,description:r("menus.resourceFolderContext","The Source Control resource folder context menu")},{key:"scm/resourceGroup/context",id:g.SCMResourceGroupContext,description:r("menus.resourceGroupContext","The Source Control resource group context menu")},{key:"scm/change/title",id:g.SCMChangeContext,description:r("menus.changeTitle","The Source Control inline change menu")},{key:"statusBar/remoteIndicator",id:g.StatusBarRemoteIndicatorMenu,description:r("menus.statusBarRemoteIndicator","The remote indicator menu in the status bar"),supportsSubmenus:!1},{key:"view/title",id:g.ViewTitle,description:r("view.viewTitle","The contributed view title menu")},{key:"view/item/context",id:g.ViewItemContext,description:r("view.itemContext","The contributed view item context menu")},{key:"comments/comment/editorActions",id:g.CommentEditorActions,description:r("commentThread.editorActions","The contributed comment editor actions"),proposed:"contribCommentEditorActionsMenu"},{key:"comments/commentThread/title",id:g.CommentThreadTitle,description:r("commentThread.title","The contributed comment thread title menu")},{key:"comments/commentThread/context",id:g.CommentThreadActions,description:r("commentThread.actions","The contributed comment thread context menu, rendered as buttons below the comment editor"),supportsSubmenus:!1},{key:"comments/commentThread/additionalActions",id:g.CommentThreadAdditionalActions,description:r("commentThread.actions","The contributed comment thread context menu, rendered as buttons below the comment editor"),supportsSubmenus:!1,proposed:"contribCommentThreadAdditionalMenu"},{key:"comments/commentThread/title/context",id:g.CommentThreadTitleContext,description:r("commentThread.titleContext","The contributed comment thread title's peek context menu, rendered as a right click menu on the comment thread's peek title."),proposed:"contribCommentPeekContext"},{key:"comments/comment/title",id:g.CommentTitle,description:r("comment.title","The contributed comment title menu")},{key:"comments/comment/context",id:g.CommentActions,description:r("comment.actions","The contributed comment context menu, rendered as buttons below the comment editor"),supportsSubmenus:!1},{key:"comments/commentThread/comment/context",id:g.CommentThreadCommentContext,description:r("comment.commentContext","The contributed comment context menu, rendered as a right click menu on the an individual comment in the comment thread's peek view."),proposed:"contribCommentPeekContext"},{key:"notebook/toolbar",id:g.NotebookToolbar,description:r("notebook.toolbar","The contributed notebook toolbar menu")},{key:"notebook/kernelSource",id:g.NotebookKernelSource,description:r("notebook.kernelSource","The contributed notebook kernel sources menu"),proposed:"notebookKernelSource"},{key:"notebook/cell/title",id:g.NotebookCellTitle,description:r("notebook.cell.title","The contributed notebook cell title menu")},{key:"notebook/cell/execute",id:g.NotebookCellExecute,description:r("notebook.cell.execute","The contributed notebook cell execution menu")},{key:"interactive/toolbar",id:g.InteractiveToolbar,description:r("interactive.toolbar","The contributed interactive toolbar menu")},{key:"interactive/cell/title",id:g.InteractiveCellTitle,description:r("interactive.cell.title","The contributed interactive cell title menu")},{key:"testing/item/context",id:g.TestItem,description:r("testing.item.context","The contributed test item menu")},{key:"testing/item/gutter",id:g.TestItemGutter,description:r("testing.item.gutter.title","The menu for a gutter decoration for a test item")},{key:"extension/context",id:g.ExtensionContext,description:r("menus.extensionContext","The extension context menu")},{key:"timeline/title",id:g.TimelineTitle,description:r("view.timelineTitle","The Timeline view title menu")},{key:"timeline/item/context",id:g.TimelineItemContext,description:r("view.timelineContext","The Timeline view item context menu")},{key:"ports/item/context",id:g.TunnelContext,description:r("view.tunnelContext","The Ports view item context menu")},{key:"ports/item/origin/inline",id:g.TunnelOriginInline,description:r("view.tunnelOriginInline","The Ports view item origin inline menu")},{key:"ports/item/port/inline",id:g.TunnelPortInline,description:r("view.tunnelPortInline","The Ports view item port inline menu")},{key:"file/newFile",id:g.NewFile,description:r("file.newFile","The 'New File...' quick pick, shown on welcome page and File menu."),supportsSubmenus:!1},{key:"webview/context",id:g.WebviewContext,description:r("webview.context","The webview context menu")},{key:"file/share",id:g.MenubarShare,description:r("menus.share","Share submenu shown in the top level File menu."),proposed:"contribShareMenu"},{key:"editor/inlineCompletions/actions",id:g.InlineCompletionsActions,description:r("inlineCompletions.actions","The actions shown when hovering on an inline completion"),supportsSubmenus:!1,proposed:"inlineCompletionsAdditions"},{key:"editor/content",id:g.EditorContent,description:r("merge.toolbar","The prominent button in an editor, overlays its content"),proposed:"contribEditorContentMenu"},{key:"editor/lineNumber/context",id:g.EditorLineNumberContext,description:r("editorLineNumberContext","The contributed editor line number context menu")},{key:"mergeEditor/result/title",id:g.MergeInputResultToolbar,description:r("menus.mergeEditorResult","The result toolbar of the merge editor"),proposed:"contribMergeEditorMenus"}];var I;(function(l){function e(c){return typeof c.command=="string"}l.isMenuItem=e;function t(c,p){return typeof c.command!="string"?(p.error(r("requirestring","property `{0}` is mandatory and must be of type `string`","command")),!1):c.alt&&typeof c.alt!="string"?(p.error(r("optstring","property `{0}` can be omitted or must be of type `string`","alt")),!1):c.when&&typeof c.when!="string"?(p.error(r("optstring","property `{0}` can be omitted or must be of type `string`","when")),!1):c.group&&typeof c.group!="string"?(p.error(r("optstring","property `{0}` can be omitted or must be of type `string`","group")),!1):!0}l.isValidMenuItem=t;function n(c,p){return typeof c.submenu!="string"?(p.error(r("requirestring","property `{0}` is mandatory and must be of type `string`","submenu")),!1):c.when&&typeof c.when!="string"?(p.error(r("optstring","property `{0}` can be omitted or must be of type `string`","when")),!1):c.group&&typeof c.group!="string"?(p.error(r("optstring","property `{0}` can be omitted or must be of type `string`","group")),!1):!0}l.isValidSubmenuItem=n;function i(c,p){if(!Array.isArray(c))return p.error(r("requirearray","submenu items must be an array")),!1;for(const f of c)if(e(f)){if(!t(f,p))return!1}else if(!n(f,p))return!1;return!0}l.isValidItems=i;function o(c,p){return typeof c!="object"?(p.error(r("require","submenu items must be an object")),!1):typeof c.id!="string"?(p.error(r("requirestring","property `{0}` is mandatory and must be of type `string`","id")),!1):typeof c.label!="string"?(p.error(r("requirestring","property `{0}` is mandatory and must be of type `string`","label")),!1):!0}l.isValidSubmenu=o;const s={type:"object",required:["command"],properties:{command:{description:r("vscode.extension.contributes.menuItem.command","Identifier of the command to execute. The command must be declared in the 'commands'-section"),type:"string"},alt:{description:r("vscode.extension.contributes.menuItem.alt","Identifier of an alternative command to execute. The command must be declared in the 'commands'-section"),type:"string"},when:{description:r("vscode.extension.contributes.menuItem.when","Condition which must be true to show this item"),type:"string"},group:{description:r("vscode.extension.contributes.menuItem.group","Group into which this item belongs"),type:"string"}}},d={type:"object",required:["submenu"],properties:{submenu:{description:r("vscode.extension.contributes.menuItem.submenu","Identifier of the submenu to display in this item."),type:"string"},when:{description:r("vscode.extension.contributes.menuItem.when","Condition which must be true to show this item"),type:"string"},group:{description:r("vscode.extension.contributes.menuItem.group","Group into which this item belongs"),type:"string"}}},u={type:"object",required:["id","label"],properties:{id:{description:r("vscode.extension.contributes.submenu.id","Identifier of the menu to display as a submenu."),type:"string"},label:{description:r("vscode.extension.contributes.submenu.label","The label of the menu item which leads to this submenu."),type:"string"},icon:{description:r({key:"vscode.extension.contributes.submenu.icon",comment:["do not translate or change `\\$(zap)`, \\ in front of $ is important."]},"(Optional) Icon which is used to represent the submenu in the UI. Either a file path, an object with file paths for dark and light themes, or a theme icon references, like `\\$(zap)`"),anyOf:[{type:"string"},{type:"object",properties:{light:{description:r("vscode.extension.contributes.submenu.icon.light","Icon path when a light theme is used"),type:"string"},dark:{description:r("vscode.extension.contributes.submenu.icon.dark","Icon path when a dark theme is used"),type:"string"}}}]}}};l.menusContribution={description:r("vscode.extension.contributes.menus","Contributes menu items to the editor"),type:"object",properties:Xe(Ye,c=>c.key,c=>({markdownDescription:c.proposed?r("proposed",'Proposed API, requires `enabledApiProposal: ["{0}"]` - {1}',c.proposed,c.description):c.description,type:"array",items:c.supportsSubmenus===!1?s:{oneOf:[s,d]}})),additionalProperties:{description:"Submenu",type:"array",items:{oneOf:[s,d]}}},l.submenusContribution={description:r("vscode.extension.contributes.submenus","Contributes submenu items to the editor"),type:"array",items:u};function m(c,p){return c?N(c.command)?(p.error(r("requirestring","property `{0}` is mandatory and must be of type `string`","command")),!1):!a(c.title,p,"title")||c.shortTitle&&!a(c.shortTitle,p,"shortTitle")?!1:c.enablement&&typeof c.enablement!="string"?(p.error(r("optstring","property `{0}` can be omitted or must be of type `string`","precondition")),!1):!(c.category&&!a(c.category,p,"category")||!h(c.icon,p)):(p.error(r("nonempty","expected non-empty value.")),!1)}l.isValidCommand=m;function h(c,p){return typeof c>"u"||typeof c=="string"||typeof c.dark=="string"&&typeof c.light=="string"?!0:(p.error(r("opticon","property `icon` can be omitted or must be either a string or a literal like `{dark, light}`")),!1)}function a(c,p,f){return typeof c>"u"?(p.error(r("requireStringOrObject","property `{0}` is mandatory and must be of type `string` or `object`",f)),!1):typeof c=="string"&&N(c)?(p.error(r("requirestring","property `{0}` is mandatory and must be of type `string`",f)),!1):typeof c!="string"&&(N(c.original)||N(c.value))?(p.error(r("requirestrings","properties `{0}` and `{1}` are mandatory and must be of type `string`",`${f}.value`,`${f}.original`)),!1):!0}const y={type:"object",required:["command","title"],properties:{command:{description:r("vscode.extension.contributes.commandType.command","Identifier of the command to execute"),type:"string"},title:{description:r("vscode.extension.contributes.commandType.title","Title by which the command is represented in the UI"),type:"string"},shortTitle:{markdownDescription:r("vscode.extension.contributes.commandType.shortTitle","(Optional) Short title by which the command is represented in the UI. Menus pick either `title` or `shortTitle` depending on the context in which they show commands."),type:"string"},category:{description:r("vscode.extension.contributes.commandType.category","(Optional) Category string by which the command is grouped in the UI"),type:"string"},enablement:{description:r("vscode.extension.contributes.commandType.precondition","(Optional) Condition which must be true to enable the command in the UI (menu and keybindings). Does not prevent executing the command by other means, like the `executeCommand`-api."),type:"string"},icon:{description:r({key:"vscode.extension.contributes.commandType.icon",comment:["do not translate or change `\\$(zap)`, \\ in front of $ is important."]},"(Optional) Icon which is used to represent the command in the UI. Either a file path, an object with file paths for dark and light themes, or a theme icon references, like `\\$(zap)`"),anyOf:[{type:"string"},{type:"object",properties:{light:{description:r("vscode.extension.contributes.commandType.icon.light","Icon path when a light theme is used"),type:"string"},dark:{description:r("vscode.extension.contributes.commandType.icon.dark","Icon path when a dark theme is used"),type:"string"}}}]}}};l.commandsContribution={description:r("vscode.extension.contributes.commands","Contributes commands to the command palette."),oneOf:[y,{type:"array",items:y}]}})(I||(I={}));const Ae=new ye,ze=X.registerExtensionPoint({extensionPoint:"commands",jsonSchema:I.commandsContribution,activationEventsGenerator:(l,e)=>{for(const t of l)t.command&&e.push(`onCommand:${t.command}`)}});ze.setHandler(l=>{function e(t,n){if(!I.isValidCommand(t,n.collector))return;const{icon:i,enablement:o,category:s,title:d,shortTitle:u,command:m}=t;let h;i&&(typeof i=="string"?h=Ue.fromString(i)??{dark:D(n.description.extensionLocation,i),light:D(n.description.extensionLocation,i)}:h={dark:D(n.description.extensionLocation,i.dark),light:D(n.description.extensionLocation,i.light)});const a=E.getCommand(m);a&&(a.source?n.collector.info(r("dup1","Command `{0}` already registered by {1} ({2})",t.command,a.source.title,a.source.id)):n.collector.info(r("dup0","Command `{0}` already registered",t.command))),Ae.add(E.addCommand({id:m,title:d,source:{id:n.description.identifier.value,title:n.description.displayName??n.description.name},shortTitle:u,tooltip:d,category:s,precondition:M.deserialize(o),icon:h}))}Ae.clear();for(const t of l){const{value:n}=t;if(Array.isArray(n))for(const i of n)e(i,t);else e(n,t)}});const G=new Map,Ve=X.registerExtensionPoint({extensionPoint:"submenus",jsonSchema:I.submenusContribution});Ve.setHandler(l=>{G.clear();for(const e of l){const{value:t,collector:n}=e;for(const[,i]of Object.entries(t)){if(!I.isValidSubmenu(i,n))continue;if(!i.id){n.warn(r("submenuId.invalid.id","`{0}` is not a valid submenu identifier",i.id));continue}if(G.has(i.id)){n.info(r("submenuId.duplicate.id","The `{0}` submenu was already previously registered.",i.id));continue}if(!i.label){n.warn(r("submenuId.invalid.label","`{0}` is not a valid submenu label",i.label));continue}let o;i.icon&&(typeof i.icon=="string"?o=Ue.fromString(i.icon)||{dark:D(e.description.extensionLocation,i.icon)}:o={dark:D(e.description.extensionLocation,i.icon.dark),light:D(e.description.extensionLocation,i.icon.light)});const s={id:g.for(`api:${i.id}`),label:i.label,icon:o};G.set(i.id,s)}}});const xt=new Map(Ye.map(l=>[l.key,l])),De=new ye,re=new Map,It=X.registerExtensionPoint({extensionPoint:"menus",jsonSchema:I.menusContribution,deps:[Ve]});It.setHandler(l=>{De.clear(),re.clear();for(const e of l){const{value:t,collector:n}=e;for(const i of Object.entries(t)){if(!I.isValidItems(i[1],n))continue;let o=xt.get(i[0]);if(!o){const s=G.get(i[0]);s&&(o={key:i[0],id:s.id,description:""})}if(o){if(o.proposed&&!Ze(e.description,o.proposed)){n.error(r("proposedAPI.invalid",`{0} is a proposed menu identifier. It requires 'package.json#enabledApiProposals: ["{1}"]' and is only available when running out of dev or with the following command line switch: --enable-proposed-api {2}`,i[0],o.proposed,e.description.identifier.value));continue}for(const s of i[1]){let d;if(I.isMenuItem(s)){const u=E.getCommand(s.command),m=s.alt&&E.getCommand(s.alt)||void 0;if(!u){n.error(r("missing.command","Menu item references a command `{0}` which is not defined in the 'commands' section.",s.command));continue}s.alt&&!m&&n.warn(r("missing.altCommand","Menu item references an alt-command `{0}` which is not defined in the 'commands' section.",s.alt)),s.command===s.alt&&n.info(r("dupe.command","Menu item references the same command as default and alt-command")),d={command:u,alt:m,group:void 0,order:void 0,when:void 0}}else{if(o.supportsSubmenus===!1){n.error(r("unsupported.submenureference","Menu item references a submenu for a menu which doesn't have submenu support."));continue}const u=G.get(s.submenu);if(!u){n.error(r("missing.submenu","Menu item references a submenu `{0}` which is not defined in the 'submenus' section.",s.submenu));continue}let m=re.get(o.id.id);if(m||(m=new Set,re.set(o.id.id,m)),m.has(u.id.id)){n.warn(r("submenuItem.duplicate","The `{0}` submenu was already contributed to the `{1}` menu.",s.submenu,i[0]));continue}m.add(u.id.id),d={submenu:u.id,icon:u.icon,title:u.label,group:void 0,order:void 0,when:void 0}}if(s.group){const u=s.group.lastIndexOf("@");u>0?(d.group=s.group.substr(0,u),d.order=Number(s.group.substr(u+1))||void 0):d.group=s.group}d.when=M.deserialize(s.when),De.add(E.appendMenuItem(o.id,d))}}}}});class He{static writeKeybindingItem(e,t){if(!t.resolvedKeybinding)return;const n=JSON.stringify(t.resolvedKeybinding.getUserSettingsLabel());e.write(`{ "key": ${Lt(n+",",25)} "command": `);const i=t.when?JSON.stringify(t.when.serialize()):"",o=JSON.stringify(t.command);i.length>0?(e.write(`${o},`),e.writeLine(),e.write(`                                     "when": ${i}`)):e.write(`${o}`),t.commandArgs&&(e.write(","),e.writeLine(),e.write(`                                     "args": ${JSON.stringify(t.commandArgs)}`)),e.write(" }")}static readUserKeybindingItem(e){const t="key"in e&&typeof e.key=="string"?de.parseKeybinding(e.key):null,n="when"in e&&typeof e.when=="string"?M.deserialize(e.when):void 0,i="command"in e&&typeof e.command=="string"?e.command:null,o="args"in e&&typeof e.args<"u"?e.args:void 0;return{keybinding:t,command:i,commandArgs:o,when:n,_sourceKey:"key"in e&&typeof e.key=="string"?e.key:void 0}}}function Lt(l,e){return l.length<e?l+new Array(e-l.length).join(" "):l}class Tt{constructor(){this._lines=[],this._currentLine=""}write(e){this._currentLine+=e}writeLine(e=""){this._lines.push(this._currentLine+e),this._currentLine=""}toString(){return this.writeLine(),this._lines.join(`
`)}}function At(l,e){return l?typeof l.command!="string"?(e.push(r("requirestring","property `{0}` is mandatory and must be of type `string`","command")),!1):l.key&&typeof l.key!="string"?(e.push(r("optstring","property `{0}` can be omitted or must be of type `string`","key")),!1):l.when&&typeof l.when!="string"?(e.push(r("optstring","property `{0}` can be omitted or must be of type `string`","when")),!1):l.mac&&typeof l.mac!="string"?(e.push(r("optstring","property `{0}` can be omitted or must be of type `string`","mac")),!1):l.linux&&typeof l.linux!="string"?(e.push(r("optstring","property `{0}` can be omitted or must be of type `string`","linux")),!1):l.win&&typeof l.win!="string"?(e.push(r("optstring","property `{0}` can be omitted or must be of type `string`","win")),!1):!0:(e.push(r("nonempty","expected non-empty value.")),!1)}const Ee={type:"object",default:{command:"",key:""},properties:{command:{description:r("vscode.extension.contributes.keybindings.command","Identifier of the command to run when keybinding is triggered."),type:"string"},args:{description:r("vscode.extension.contributes.keybindings.args","Arguments to pass to the command to execute.")},key:{description:r("vscode.extension.contributes.keybindings.key","Key or key sequence (separate keys with plus-sign and sequences with space, e.g. Ctrl+O and Ctrl+L L for a chord)."),type:"string"},mac:{description:r("vscode.extension.contributes.keybindings.mac","Mac specific key or key sequence."),type:"string"},linux:{description:r("vscode.extension.contributes.keybindings.linux","Linux specific key or key sequence."),type:"string"},win:{description:r("vscode.extension.contributes.keybindings.win","Windows specific key or key sequence."),type:"string"},when:{description:r("vscode.extension.contributes.keybindings.when","Condition when the key is active."),type:"string"}}},Me=X.registerExtensionPoint({extensionPoint:"keybindings",deps:[ze],jsonSchema:{description:r("vscode.extension.contributes.keybindings","Contributes keybindings."),oneOf:[Ee,{type:"array",items:Ee}]}}),Dt=[90,91,92,93,95,96,97,98,99,100,101,102,103,104,105],x=new Map;x.set(95,22);x.set(96,23);x.set(97,24);x.set(98,25);x.set(99,26);x.set(100,27);x.set(101,28);x.set(102,29);x.set(103,30);x.set(104,21);let ce=class H extends ot{constructor(e,t,n,i,o,s,d,u,m,h){super(e,t,n,i,m),this.hostService=s,this.keyboardLayoutService=h,this._contributions=[],this.isComposingGlobalContextKey=e.createKey("isComposing",!1),this.kbsJsonSchema=new P,this.updateKeybindingsJsonSchema(),this._keyboardMapper=this.keyboardLayoutService.getKeyboardMapper(),this.keyboardLayoutService.onDidChangeKeyboardLayout(()=>{this._keyboardMapper=this.keyboardLayoutService.getKeyboardMapper(),this.updateResolver()}),this._cachedResolver=null,this.userKeybindings=this._register(new Et(o,u,m)),this.userKeybindings.initialize().then(()=>{this.userKeybindings.keybindings.length&&this.updateResolver()}),this._register(this.userKeybindings.onDidChange(()=>{m.debug("User keybindings changed"),this.updateResolver()})),Me.setHandler(a=>{const y=[];for(const c of a)this._handleKeybindingsExtensionPointUser(c.description.identifier,c.description.isBuiltin,c.value,c.collector,y);ne.setExtensionKeybindings(y),this.updateResolver()}),this.updateKeybindingsJsonSchema(),this._register(d.onDidRegisterExtensions(()=>this.updateKeybindingsJsonSchema())),this._register(Se(window,ve.KEY_DOWN,a=>{this.isComposingGlobalContextKey.set(a.isComposing);const y=new ke(a);this._log(`/ Received  keydown event - ${st(a)}`),this._log(`| Converted keydown event - ${rt(y)}`),this._dispatch(y,y.target)&&y.preventDefault(),this.isComposingGlobalContextKey.set(!1)})),this._register(Se(window,ve.KEY_UP,a=>{this.isComposingGlobalContextKey.set(a.isComposing);const y=new ke(a);this._singleModifierDispatch(y,y.target)&&y.preventDefault(),this.isComposingGlobalContextKey.set(!1)})),this._register(at(()=>{const a=navigator.keyboard;ie.keyboard!==2&&(we()?a==null||a.lock(["Escape"]):a==null||a.unlock(),this._cachedResolver=null,this._onDidUpdateKeybindings.fire())}))}registerSchemaContribution(e){this._contributions.push(e),e.onDidChange&&this._register(e.onDidChange(()=>this.updateKeybindingsJsonSchema())),this.updateKeybindingsJsonSchema()}updateKeybindingsJsonSchema(){this.kbsJsonSchema.updateSchema(this._contributions.flatMap(e=>e.getSchemaAdditions()))}_printKeybinding(e){return dt.toLabel(w,e.chords,t=>t instanceof A?_.toString(t.keyCode):S.toString(t.scanCode))||"[null]"}_printResolvedKeybinding(e){return e.getDispatchChords().map(t=>t||"[null]").join(" ")}_printResolvedKeybindings(e,t,n){const o=`${t.padStart(35," ")} => `;if(n.length===0){e.push(`${o}${"[NO BINDING]".padStart(35," ")}`);return}for(const s of n)e.push(`${o}${this._printResolvedKeybinding(s).padStart(35," ")}`)}_dumpResolveKeybindingDebugInfo(){const e=new Set,t=[];t.push("Default Resolved Keybindings (unique only):");for(const n of ne.getDefaultKeybindings()){if(!n.keybinding)continue;const i=this._printKeybinding(n.keybinding);if(e.has(i))continue;e.add(i);const o=this._keyboardMapper.resolveKeybinding(n.keybinding);this._printResolvedKeybindings(t,i,o)}t.push("User Resolved Keybindings (unique only):");for(const n of this.userKeybindings.keybindings){if(!n.keybinding)continue;const i=n._sourceKey??"Impossible: missing source key, but has keybinding";if(e.has(i))continue;e.add(i);const o=this._keyboardMapper.resolveKeybinding(n.keybinding);this._printResolvedKeybindings(t,i,o)}return t.join(`
`)}_dumpDebugInfo(){const e=JSON.stringify(this.keyboardLayoutService.getCurrentKeyboardLayout(),null,"	"),t=this._keyboardMapper.dumpDebugInfo(),n=this._dumpResolveKeybindingDebugInfo(),i=JSON.stringify(this.keyboardLayoutService.getRawKeyboardMapping(),null,"	");return`Layout info:
${e}

${n}

${t}

Raw mapping:
${i}`}_dumpDebugInfoJSON(){const e={layout:this.keyboardLayoutService.getCurrentKeyboardLayout(),rawMapping:this.keyboardLayoutService.getRawKeyboardMapping()};return JSON.stringify(e,null,"	")}customKeybindingsCount(){return this.userKeybindings.keybindings.length}updateResolver(){this._cachedResolver=null,this._onDidUpdateKeybindings.fire()}_getResolver(){if(!this._cachedResolver){const e=this._resolveKeybindingItems(ne.getDefaultKeybindings(),!0),t=this._resolveUserKeybindingItems(this.userKeybindings.keybindings,!1);this._cachedResolver=new ct(e,t,n=>this._log(n))}return this._cachedResolver}_documentHasFocus(){return this.hostService.hasFocus}_resolveKeybindingItems(e,t){const n=[];let i=0;for(const o of e){const s=o.when||void 0,d=o.keybinding;if(!d)n[i++]=new Y(void 0,o.command,o.commandArgs,s,t,o.extensionId,o.isBuiltinExtension);else{if(this._assertBrowserConflicts(d))continue;const u=this._keyboardMapper.resolveKeybinding(d);for(let m=u.length-1;m>=0;m--){const h=u[m];n[i++]=new Y(h,o.command,o.commandArgs,s,t,o.extensionId,o.isBuiltinExtension)}}}return n}_resolveUserKeybindingItems(e,t){const n=[];let i=0;for(const o of e){const s=o.when||void 0;if(!o.keybinding)n[i++]=new Y(void 0,o.command,o.commandArgs,s,t,null,!1);else{const d=this._keyboardMapper.resolveKeybinding(o.keybinding);for(const u of d)n[i++]=new Y(u,o.command,o.commandArgs,s,t,null,!1)}}return n}_assertBrowserConflicts(e){if(ie.keyboard===0||ie.keyboard===1&&we())return!1;for(const t of e.chords){if(!t.metaKey&&!t.altKey&&!t.ctrlKey&&!t.shiftKey)continue;const n=3584;let i=0;if(t.metaKey&&(i|=2048),t.shiftKey&&(i|=1024),t.altKey&&(i|=512),t.ctrlKey&&w===2&&(i|=256),(i&n)===2560&&(t instanceof T&&(t.scanCode===86||t.scanCode===85)||t instanceof A&&(t.keyCode===15||t.keyCode===17))||(i&n)===2048&&(t instanceof T&&t.scanCode>=36&&t.scanCode<=45||t instanceof A&&t.keyCode>=21&&t.keyCode<=30))return!0}return!1}resolveKeybinding(e){return this._keyboardMapper.resolveKeybinding(e)}resolveKeyboardEvent(e){return this.keyboardLayoutService.validateCurrentKeyboardMapping(e),this._keyboardMapper.resolveKeyboardEvent(e)}resolveUserBinding(e){const t=de.parseKeybinding(e);return t?this._keyboardMapper.resolveKeybinding(t):[]}_handleKeybindingsExtensionPointUser(e,t,n,i,o){if(Array.isArray(n))for(let s=0,d=n.length;s<d;s++)this._handleKeybinding(e,t,s+1,n[s],i,o);else this._handleKeybinding(e,t,1,n,i,o)}_handleKeybinding(e,t,n,i,o,s){const d=[];if(At(i,d)){const u=this._asCommandRule(e,t,n++,i);u&&s.push(u)}d.length>0&&o.error(r("invalid.keybindings","Invalid `contributes.{0}`: {1}",Me.name,d.join(`
`)))}static bindToCurrentPlatform(e,t,n,i){if(w===1&&i){if(i)return i}else if(w===2){if(t)return t}else if(n)return n;return e}_asCommandRule(e,t,n,i){const{command:o,args:s,when:d,key:u,mac:m,linux:h,win:a}=i,y=H.bindToCurrentPlatform(u,m,h,a);if(!y)return;let c;t?c=300+n:c=400+n;const p=E.getCommand(o),f=p&&p.precondition;let b;return d&&f?b=M.and(f,M.deserialize(d)):d?b=M.deserialize(d):f&&(b=f),{id:o,args:s,when:b,weight:c,keybinding:de.parseKeybinding(y),extensionId:e.value,isBuiltinExtension:t}}getDefaultKeybindingsContent(){const e=this._getResolver(),t=e.getDefaultKeybindings(),n=e.getDefaultBoundCommands();return H._getDefaultKeybindings(t)+`

`+H._getAllCommandsAsComment(n)}static _getDefaultKeybindings(e){const t=new Tt;t.writeLine("[");const n=e.length-1;return e.forEach((i,o)=>{He.writeKeybindingItem(t,i),o!==n?t.writeLine(","):t.writeLine()}),t.writeLine("]"),t.toString()}static _getAllCommandsAsComment(e){const n=wt(e).sort().join(`
// - `);return"// "+r("unboundCommands","Here are other available commands: ")+`
// - `+n}mightProducePrintableCharacter(e){if(e.ctrlKey||e.metaKey||e.altKey)return!1;const t=S.toEnum(e.code);if(Dt.indexOf(t)!==-1)return!!(e.keyCode===v[t]||Fe&&e.keyCode===x.get(t));if(v[t]!==-1)return!1;const i=this.keyboardLayoutService.getRawKeyboardMapping();if(!i)return!1;const o=i[e.code];return!(!o||!o.value||/\s/.test(o.value))}};ce=me([K(0,et),K(1,fe),K(2,tt),K(3,Re),K(4,nt),K(5,it),K(6,$e),K(7,pe),K(8,Ge),K(9,Oe)],ce);class Et extends j{get keybindings(){return this._keybindings}constructor(e,t,n){super(),this.userDataProfileService=e,this.fileService=t,this._rawKeybindings=[],this._keybindings=[],this.watchDisposables=this._register(new ye),this._onDidChange=this._register(new U),this.onDidChange=this._onDidChange.event,this.watch(),this.reloadConfigurationScheduler=this._register(new je(()=>this.reload().then(i=>{i&&this._onDidChange.fire()}),50)),this._register(J.filter(this.fileService.onDidFilesChange,i=>i.contains(this.userDataProfileService.currentProfile.keybindingsResource))(()=>{n.debug("Keybindings file changed"),this.reloadConfigurationScheduler.schedule()})),this._register(this.fileService.onDidRunOperation(i=>{i.operation===4&&i.resource.toString()===this.userDataProfileService.currentProfile.keybindingsResource.toString()&&(n.debug("Keybindings file written"),this.reloadConfigurationScheduler.schedule())})),this._register(e.onDidChangeCurrentProfile(i=>i.join(this.whenCurrentProfileChanged(i))))}async whenCurrentProfileChanged(e){e.preserveData&&await this.fileService.exists(e.previous.keybindingsResource)&&await this.fileService.copy(e.previous.keybindingsResource,e.profile.keybindingsResource),this.watch(),this.reloadConfigurationScheduler.schedule()}watch(){this.watchDisposables.clear(),this.watchDisposables.add(this.fileService.watch(ut(this.userDataProfileService.currentProfile.keybindingsResource))),this.watchDisposables.add(this.fileService.watch(this.userDataProfileService.currentProfile.keybindingsResource))}async initialize(){await this.reload()}async reload(){const e=await this.readUserKeybindings();return qe(this._rawKeybindings,e)?!1:(this._rawKeybindings=e,this._keybindings=this._rawKeybindings.map(t=>He.readUserKeybindingItem(t)),!0)}async readUserKeybindings(){try{const e=await this.fileService.readFile(this.userDataProfileService.currentProfile.keybindingsResource),t=We(e.value.toString());return Array.isArray(t)?t.filter(n=>n&&typeof n=="object"):[]}catch{return[]}}}class P{constructor(){this.commandsSchemas=[],this.commandsEnum=[],this.removalCommandsEnum=[],this.commandsEnumDescriptions=[],this.schema={id:P.schemaId,type:"array",title:r("keybindings.json.title","Keybindings configuration"),allowTrailingCommas:!0,allowComments:!0,definitions:{editorGroupsSchema:{type:"array",items:{type:"object",properties:{groups:{$ref:"#/definitions/editorGroupsSchema",default:[{},{}]},size:{type:"number",default:.5}}}},commandNames:{type:"string",enum:this.commandsEnum,enumDescriptions:this.commandsEnumDescriptions,description:r("keybindings.json.command","Name of the command to execute")},commandType:{anyOf:[{$ref:"#/definitions/commandNames"},{type:"string",enum:this.removalCommandsEnum,enumDescriptions:this.commandsEnumDescriptions,description:r("keybindings.json.removalCommand","Name of the command to remove keyboard shortcut for")},{type:"string"}]},commandsSchemas:{allOf:this.commandsSchemas}},items:{required:["key"],type:"object",defaultSnippets:[{body:{key:"$1",command:"$2",when:"$3"}}],properties:{key:{type:"string",description:r("keybindings.json.key","Key or key sequence (separated by space)")},command:{anyOf:[{if:{type:"array"},then:{not:{type:"array"},errorMessage:r("keybindings.commandsIsArray",`Incorrect type. Expected "{0}". The field 'command' does not support running multiple commands. Use command 'runCommands' to pass it multiple commands to run.`,"string")},else:{$ref:"#/definitions/commandType"}},{$ref:"#/definitions/commandType"}]},when:{type:"string",description:r("keybindings.json.when","Condition when the key is active.")},args:{description:r("keybindings.json.args","Arguments to pass to the command to execute.")}},$ref:"#/definitions/commandsSchemas"}},this.schemaRegistry=ge.as(lt.JSONContribution),this.schemaRegistry.registerSchema(P.schemaId,this.schema)}updateSchema(e){this.commandsSchemas.length=0,this.commandsEnum.length=0,this.removalCommandsEnum.length=0,this.commandsEnumDescriptions.length=0;const t=new Set,n=(s,d)=>{/^_/.test(s)||t.has(s)||(t.add(s),this.commandsEnum.push(s),this.commandsEnumDescriptions.push(d),this.removalCommandsEnum.push(`-${s}`))},i=V.getCommands();for(const[s,d]of i){const u=d.description;if(n(s,u?u.description:void 0),!u||!u.args||u.args.length!==1||!u.args[0].schema)continue;const m=u.args[0].schema,h=typeof u.args[0].isOptional<"u"?!u.args[0].isOptional:Array.isArray(m.required)&&m.required.length>0,a={if:{required:["command"],properties:{command:{const:s}}},then:{required:[].concat(h?["args"]:[]),properties:{args:m}}};this.commandsSchemas.push(a)}const o=E.getCommands();for(const s of o.keys())n(s);this.commandsSchemas.push(...e),this.schemaRegistry.notifySchemaChanged(P.schemaId)}}P.schemaId="vscode://schemas/keybindings";function Mt(l){const e=l,t={};for(const n in e){const i=e[n];if(i.length){const o=i[0],s=i[1],d=i[2],u=i[3],m=Number(i[4]),h=i.length===6?i[5]:void 0;t[n]={value:o,vkey:h,withShift:s,withAltGr:d,withShiftAltGr:u,valueIsDeadKey:(m&1)>0,withShiftIsDeadKey:(m&2)>0,withAltGrIsDeadKey:(m&4)>0,withShiftAltGrIsDeadKey:(m&8)>0}}else t[n]={value:"",valueIsDeadKey:!1,withShift:"",withShiftIsDeadKey:!1,withAltGr:"",withAltGrIsDeadKey:!1,withShiftAltGr:"",withShiftAltGrIsDeadKey:!1}}return t}class Z{constructor(e,t,n,i){this.layout=e,this.secondaryLayouts=t,this.mapping=Mt(n),this.isUserKeyboardLayout=!!i,this.layout.isUserKeyboardLayout=!!i}static createKeyboardLayoutFromDebugInfo(e,t,n){const i=new Z(e,[],{},!0);return i.mapping=t,i}update(e){this.layout=e.layout,this.secondaryLayouts=e.secondaryLayouts,this.mapping=e.mapping,this.isUserKeyboardLayout=e.isUserKeyboardLayout,this.layout.isUserKeyboardLayout=e.isUserKeyboardLayout}getScore(e){let t=0;for(const n in e){if(ae&&(n==="Backslash"||n==="KeyQ")||ht&&(n==="Backspace"||n==="Escape"))continue;const i=this.mapping[n];i===void 0&&(t-=1);const o=e[n];i&&o&&i.value!==o.value&&(t-=1)}return t}equal(e){return this.isUserKeyboardLayout!==e.isUserKeyboardLayout||Q(this.layout)!==Q(e.layout)?!1:this.fuzzyEqual(e.mapping)}fuzzyEqual(e){for(const t in e){if(ae&&(t==="Backslash"||t==="KeyQ"))continue;if(this.mapping[t]===void 0)return!1;const n=this.mapping[t],i=e[t];if(n.value!==i.value)return!1}return!0}}function Pt(l){const e=l.getValue("keyboard"),t=(e==null?void 0:e.dispatch)==="keyCode"?1:0,n=!!(e!=null&&e.mapAltGrToCtrlAlt);return{dispatch:t,mapAltGrToCtrlAlt:n}}const Ut=ge.as(Be.Configuration),Rt={id:"keyboard",order:15,type:"object",title:r("keyboardConfigurationTitle","Keyboard"),properties:{"keyboard.dispatch":{scope:1,type:"string",enum:["code","keyCode"],default:"code",markdownDescription:r("dispatch","Controls the dispatching logic for key presses to use either `code` (recommended) or `keyCode`."),included:w===2||w===3},"keyboard.mapAltGrToCtrlAlt":{scope:1,type:"boolean",default:!1,markdownDescription:r("mapAltGrToCtrlAlt","Controls if the AltGraph+ modifier should be treated as Ctrl+Alt+."),included:w===1}}};Ut.registerConfiguration(Rt);class $t{constructor(e){this._actual=e,this._cache=new Map}dumpDebugInfo(){return this._actual.dumpDebugInfo()}resolveKeyboardEvent(e){return this._actual.resolveKeyboardEvent(e)}resolveKeybinding(e){const t=e.getHashCode(),n=this._cache.get(t);if(!n){const i=this._actual.resolveKeybinding(e);return this._cache.set(t,i),i}return n}}class z extends Ne{constructor(e,t){super(1,t),this._mapper=e}_getLabel(e){return e.isDuplicateModifierCase()?"":this._mapper.getUILabelForKeyCode(e.keyCode)}_getUSLabelForKeybinding(e){return e.isDuplicateModifierCase()?"":_.toString(e.keyCode)}getUSLabel(){return mt.toLabel(this._os,this._chords,e=>this._getUSLabelForKeybinding(e))}_getAriaLabel(e){return e.isDuplicateModifierCase()?"":this._mapper.getAriaLabelForKeyCode(e.keyCode)}_getElectronAccelerator(e){return this._mapper.getElectronAcceleratorForKeyBinding(e)}_getUserSettingsLabel(e){if(e.isDuplicateModifierCase())return"";const t=this._mapper.getUserSettingsLabelForKeyCode(e.keyCode);return t&&t.toLowerCase()}_isWYSIWYG(e){return this.__isWYSIWYG(e.keyCode)}__isWYSIWYG(e){if(e===15||e===16||e===17||e===18)return!0;const t=this._mapper.getAriaLabelForKeyCode(e),n=this._mapper.getUserSettingsLabelForKeyCode(e);return t===n}_getChordDispatch(e){if(e.isModifierKey())return null;let t="";return e.ctrlKey&&(t+="ctrl+"),e.shiftKey&&(t+="shift+"),e.altKey&&(t+="alt+"),e.metaKey&&(t+="meta+"),t+=_.toString(e.keyCode),t}_getSingleModifierChordDispatch(e){return e.keyCode===5&&!e.shiftKey&&!e.altKey&&!e.metaKey?"ctrl":e.keyCode===4&&!e.ctrlKey&&!e.altKey&&!e.metaKey?"shift":e.keyCode===6&&!e.ctrlKey&&!e.shiftKey&&!e.metaKey?"alt":e.keyCode===57&&!e.ctrlKey&&!e.shiftKey&&!e.altKey?"meta":null}static getProducedCharCode(e,t){return t?e.ctrlKey&&e.shiftKey&&e.altKey?t.withShiftAltGr:e.ctrlKey&&e.altKey?t.withAltGr:e.shiftKey?t.withShift:t.value:null}static getProducedChar(e,t){const n=this.getProducedCharCode(e,t);return n===null||n.length===0?" --- ":"  "+n+"  "}}class Gt{constructor(e,t,n){this._isUSStandard=e,this._mapAltGrToCtrlAlt=n,this._keyCodeToLabel=[],this._scanCodeToKeyCode=[],this._keyCodeToLabel=[],this._keyCodeExists=[],this._keyCodeToLabel[0]=_.toString(0);for(let d=0;d<193;d++){const u=v[d];u!==-1&&(this._scanCodeToKeyCode[d]=u,this._keyCodeToLabel[u]=_.toString(u),this._keyCodeExists[u]=!0)}const i=[];let o=!1;this._codeInfo=[];for(const d in t)if(t.hasOwnProperty(d)){const u=S.toEnum(d);if(u===0)continue;const m=t[d],h=v[u];if(h!==-1){const C=xe[m.vkey]||0;if(C===0||h===C||u!==134)continue}const a=m.value,y=m.withShift,c=m.withAltGr,p=m.withShiftAltGr,f=xe[m.vkey]||0,b={scanCode:u,keyCode:f,value:a,withShift:y,withAltGr:c,withShiftAltGr:p};if(this._codeInfo[u]=b,this._scanCodeToKeyCode[u]=f,f===0)continue;if(this._keyCodeExists[f]=!0,a.length===0)this._keyCodeToLabel[f]=null;else if(a.length>1)this._keyCodeToLabel[f]=a;else{const C=a.charCodeAt(0);if(C>=97&&C<=122){const L=65+(C-97);i[L]=!0,o=!0,this._keyCodeToLabel[f]=String.fromCharCode(65+(C-97))}else C>=65&&C<=90?(i[C]=!0,o=!0,this._keyCodeToLabel[f]=a):this._keyCodeToLabel[f]=a}}const s=(d,u)=>{i[d]||(this._keyCodeToLabel[u]=String.fromCharCode(d))};if(s(65,31),s(66,32),s(67,33),s(68,34),s(69,35),s(70,36),s(71,37),s(72,38),s(73,39),s(74,40),s(75,41),s(76,42),s(77,43),s(78,44),s(79,45),s(80,46),s(81,47),s(82,48),s(83,49),s(84,50),s(85,51),s(86,52),s(87,53),s(88,54),s(89,55),s(90,56),!o){const d=(u,m)=>{this._keyCodeToLabel[u]=String.fromCharCode(m)};d(85,59),d(86,61),d(87,44),d(88,45),d(89,46),d(90,47),d(91,96),d(92,91),d(93,92),d(94,93),d(95,39)}}dumpDebugInfo(){const e=[],t=[88,104];let n=0;e.push("-----------------------------------------------------------------------------------------------------------------------------------------");for(let i=0;i<193;i++){if(v[i]!==-1&&t.indexOf(i)===-1)continue;n%6===0&&(e.push("|       HW Code combination      |  Key  |    KeyCode combination    |          UI label         |        User settings       | WYSIWYG |"),e.push("-----------------------------------------------------------------------------------------------------------------------------------------")),n++;const o=this._codeInfo[i],s=S.toString(i),d=[0,2,5,7];for(const u of d){const m=!!(u&1),h=!!(u&2),a=!!(u&4),y=new T(m,h,a,!1,i),c=this._resolveChord(y),p=c?_.toString(c.keyCode):null,f=c?new z(this,[c]):null,b=`${m?"Ctrl+":""}${h?"Shift+":""}${a?"Alt+":""}${s}`,C=f?f.getAriaLabel():null,L=C?C.replace(/Control\+/,"Ctrl+"):null,be=f?f.getUserSettingsLabel():null,q=z.getProducedChar(y,o),R=p?`${m?"Ctrl+":""}${h?"Shift+":""}${a?"Alt+":""}${p}`:null,ee=(f?f.isWYSIWYG():!1)?"       ":"   NO  ";e.push(`| ${this._leftPad(b,30)} | ${q} | ${this._leftPad(R,25)} | ${this._leftPad(L,25)} |  ${this._leftPad(be,25)} | ${ee} |`)}e.push("-----------------------------------------------------------------------------------------------------------------------------------------")}return e.join(`
`)}_leftPad(e,t){for(e===null&&(e="null");e.length<t;)e=" "+e;return e}getUILabelForKeyCode(e){return this._getLabelForKeyCode(e)}getAriaLabelForKeyCode(e){return this._getLabelForKeyCode(e)}getUserSettingsLabelForKeyCode(e){return this._isUSStandard?_.toUserSettingsUS(e):_.toUserSettingsGeneral(e)}getElectronAcceleratorForKeyBinding(e){return _.toElectronAccelerator(e.keyCode)}_getLabelForKeyCode(e){return this._keyCodeToLabel[e]||_.toString(0)}resolveKeyboardEvent(e){const t=e.ctrlKey||this._mapAltGrToCtrlAlt&&e.altGraphKey,n=e.altKey||this._mapAltGrToCtrlAlt&&e.altGraphKey,i=new A(t,e.shiftKey,n,e.metaKey,e.keyCode);return new z(this,[i])}_resolveChord(e){if(!e)return null;if(e instanceof A)return this._keyCodeExists[e.keyCode]?e:null;const t=this._scanCodeToKeyCode[e.scanCode]||0;return t===0||!this._keyCodeExists[t]?null:new A(e.ctrlKey,e.shiftKey,e.altKey,e.metaKey,t)}resolveKeybinding(e){const t=yt(e.chords.map(n=>this._resolveChord(n)));return t.length>0?[new z(this,t)]:[]}}const O=[];class Pe extends Ne{constructor(e,t,n){super(t,n),this._mapper=e}_getLabel(e){return this._mapper.getUILabelForScanCodeChord(e)}_getAriaLabel(e){return this._mapper.getAriaLabelForScanCodeChord(e)}_getElectronAccelerator(e){return this._mapper.getElectronAcceleratorLabelForScanCodeChord(e)}_getUserSettingsLabel(e){return this._mapper.getUserSettingsLabelForScanCodeChord(e)}_isWYSIWYG(e){if(!e||v[e.scanCode]!==-1)return!0;const t=this._mapper.getAriaLabelForScanCodeChord(e),n=this._mapper.getUserSettingsLabelForScanCodeChord(e);return!t&&!n?!0:!t||!n?!1:t.toLowerCase()===n.toLowerCase()}_getChordDispatch(e){return this._mapper.getDispatchStrForScanCodeChord(e)}_getSingleModifierChordDispatch(e){return(e.scanCode===157||e.scanCode===161)&&!e.shiftKey&&!e.altKey&&!e.metaKey?"ctrl":(e.scanCode===159||e.scanCode===163)&&!e.ctrlKey&&!e.shiftKey&&!e.metaKey?"alt":(e.scanCode===158||e.scanCode===162)&&!e.ctrlKey&&!e.altKey&&!e.metaKey?"shift":(e.scanCode===160||e.scanCode===164)&&!e.ctrlKey&&!e.shiftKey&&!e.altKey?"meta":null}}class F{constructor(e,t,n,i){this.ctrlKey=e,this.shiftKey=t,this.altKey=n,this.scanCode=i}toString(){return`${this.ctrlKey?"Ctrl+":""}${this.shiftKey?"Shift+":""}${this.altKey?"Alt+":""}${S.toString(this.scanCode)}`}equals(e){return this.ctrlKey===e.ctrlKey&&this.shiftKey===e.shiftKey&&this.altKey===e.altKey&&this.scanCode===e.scanCode}getProducedCharCode(e){return e?this.ctrlKey&&this.shiftKey&&this.altKey?e.withShiftAltGr:this.ctrlKey&&this.altKey?e.withAltGr:this.shiftKey?e.withShift:e.value:""}getProducedChar(e){const t=k.getCharCode(this.getProducedCharCode(e));return t===0?" --- ":t>=768&&t<=879?"U+"+t.toString(16):"  "+String.fromCharCode(t)+"  "}}class ue{constructor(e,t,n,i){this.ctrlKey=e,this.shiftKey=t,this.altKey=n,this.keyCode=i}toString(){return`${this.ctrlKey?"Ctrl+":""}${this.shiftKey?"Shift+":""}${this.altKey?"Alt+":""}${_.toString(this.keyCode)}`}}class Ot{constructor(){this._scanCodeToKeyCode=[],this._keyCodeToScanCode=[],this._scanCodeToKeyCode=[],this._keyCodeToScanCode=[]}registrationComplete(){this._moveToEnd(56),this._moveToEnd(106)}_moveToEnd(e){for(let t=0;t<8;t++){const n=this._scanCodeToKeyCode[(e<<3)+t];if(n)for(let i=0,o=n.length;i<o;i++){const s=this._keyCodeToScanCode[n[i]];if(s.length!==1)for(let d=0,u=s.length;d<u;d++){const m=s[d];if(m>>>3===e){for(let a=d+1;a<u;a++)s[a-1]=s[a];s[u-1]=m}}}}}registerIfUnknown(e,t){if(t.keyCode===0)return;const n=this._encodeScanCodeCombo(e),i=this._encodeKeyCodeCombo(t),o=t.keyCode>=21&&t.keyCode<=30,s=t.keyCode>=31&&t.keyCode<=56,d=this._scanCodeToKeyCode[n];if(o||s){if(d){for(let u=0,m=d.length;u<m;u++)if(d[u]===i)return}}else if(d&&d.length!==0)return;this._scanCodeToKeyCode[n]=this._scanCodeToKeyCode[n]||[],this._scanCodeToKeyCode[n].unshift(i),this._keyCodeToScanCode[i]=this._keyCodeToScanCode[i]||[],this._keyCodeToScanCode[i].unshift(n)}lookupKeyCodeCombo(e){const t=this._encodeKeyCodeCombo(e),n=this._keyCodeToScanCode[t];if(!n||n.length===0)return[];const i=[];for(let o=0,s=n.length;o<s;o++){const d=n[o],u=!!(d&1),m=!!(d&2),h=!!(d&4),a=d>>>3;i[o]=new F(u,m,h,a)}return i}lookupScanCodeCombo(e){const t=this._encodeScanCodeCombo(e),n=this._scanCodeToKeyCode[t];if(!n||n.length===0)return[];const i=[];for(let o=0,s=n.length;o<s;o++){const d=n[o],u=!!(d&1),m=!!(d&2),h=!!(d&4),a=d>>>3;i[o]=new ue(u,m,h,a)}return i}guessStableKeyCode(e){if(e>=36&&e<=45)switch(e){case 36:return 22;case 37:return 23;case 38:return 24;case 39:return 25;case 40:return 26;case 41:return 27;case 42:return 28;case 43:return 29;case 44:return 30;case 45:return 21}const t=this.lookupScanCodeCombo(new F(!1,!1,!1,e)),n=this.lookupScanCodeCombo(new F(!1,!0,!1,e));if(t.length===1&&n.length===1){const i=t[0].shiftKey,o=t[0].keyCode,s=n[0].shiftKey,d=n[0].keyCode;if(o===d&&i!==s)return o}return-1}_encodeScanCodeCombo(e){return this._encode(e.ctrlKey,e.shiftKey,e.altKey,e.scanCode)}_encodeKeyCodeCombo(e){return this._encode(e.ctrlKey,e.shiftKey,e.altKey,e.keyCode)}_encode(e,t,n,i){return((e?1:0)<<0|(t?1:0)<<1|(n?1:0)<<2|i<<3)>>>0}}class k{constructor(e,t,n,i){this._isUSStandard=e,this._mapAltGrToCtrlAlt=n,this._OS=i,this._scanCodeToLabel=[],this._scanCodeToDispatch=[],this._codeInfo=[],this._scanCodeKeyCodeMapper=new Ot,this._scanCodeToLabel=[],this._scanCodeToDispatch=[];const o=(h,a,y,c,p,f,b,C)=>{this._scanCodeKeyCodeMapper.registerIfUnknown(new F(!!h,!!a,!!y,c),new ue(!!p,!!f,!!b,C))},s=(h,a,y,c,p)=>{for(let f=h;f<=1;f++)for(let b=a;b<=1;b++)for(let C=y;C<=1;C++)o(f,b,C,c,f,b,C,p)};for(let h=0;h<193;h++)this._scanCodeToLabel[h]=null;for(let h=0;h<193;h++)this._scanCodeToDispatch[h]=null;for(let h=0;h<193;h++){const a=v[h];a!==-1&&(s(0,0,0,h,a),this._scanCodeToLabel[h]=_.toString(a),a===0||a===5||a===57||a===6||a===4?this._scanCodeToDispatch[h]=null:this._scanCodeToDispatch[h]=`[${S.toString(h)}]`)}const d={};{const h=[];for(const y in t)if(t.hasOwnProperty(y)){const c=S.toEnum(y);if(c===0||v[c]!==-1)continue;const p=t[y],f=k.getCharCode(p.value);if(f>=97&&f<=122){const b=65+(f-97);h[b]=!0}}const a=(y,c,p,f)=>{h[y]||(d[S.toString(c)]={value:p,withShift:f,withAltGr:"",withShiftAltGr:""})};a(65,10,"a","A"),a(66,11,"b","B"),a(67,12,"c","C"),a(68,13,"d","D"),a(69,14,"e","E"),a(70,15,"f","F"),a(71,16,"g","G"),a(72,17,"h","H"),a(73,18,"i","I"),a(74,19,"j","J"),a(75,20,"k","K"),a(76,21,"l","L"),a(77,22,"m","M"),a(78,23,"n","N"),a(79,24,"o","O"),a(80,25,"p","P"),a(81,26,"q","Q"),a(82,27,"r","R"),a(83,28,"s","S"),a(84,29,"t","T"),a(85,30,"u","U"),a(86,31,"v","V"),a(87,32,"w","W"),a(88,33,"x","X"),a(89,34,"y","Y"),a(90,35,"z","Z")}const u=[];let m=0;for(const h in t)if(t.hasOwnProperty(h)){const a=S.toEnum(h);if(a===0||v[a]!==-1)continue;this._codeInfo[a]=t[h];const y=d[h]||t[h],c=k.getCharCode(y.value),p=k.getCharCode(y.withShift),f=k.getCharCode(y.withAltGr),b=k.getCharCode(y.withShiftAltGr),C={scanCode:a,value:c,withShift:p,withAltGr:f,withShiftAltGr:b};if(u[m++]=C,this._scanCodeToDispatch[a]=`[${S.toString(a)}]`,c>=97&&c<=122){const L=65+(c-97);this._scanCodeToLabel[a]=String.fromCharCode(L)}else c>=65&&c<=90?this._scanCodeToLabel[a]=String.fromCharCode(c):c?this._scanCodeToLabel[a]=String.fromCharCode(c):this._scanCodeToLabel[a]=null}for(let h=u.length-1;h>=0;h--){const a=u[h],y=a.scanCode,c=a.withShiftAltGr;if(c===a.withAltGr||c===a.withShift||c===a.value)continue;const p=k._charCodeToKb(c);if(!p)continue;const f=p.shiftKey,b=p.keyCode;f?o(1,1,1,y,0,1,0,b):o(1,1,1,y,0,0,0,b)}for(let h=u.length-1;h>=0;h--){const a=u[h],y=a.scanCode,c=a.withAltGr;if(c===a.withShift||c===a.value)continue;const p=k._charCodeToKb(c);if(!p)continue;const f=p.shiftKey,b=p.keyCode;f?o(1,0,1,y,0,1,0,b):o(1,0,1,y,0,0,0,b)}for(let h=u.length-1;h>=0;h--){const a=u[h],y=a.scanCode,c=a.withShift;if(c===a.value)continue;const p=k._charCodeToKb(c);if(!p)continue;const f=p.shiftKey,b=p.keyCode;f?(o(0,1,0,y,0,1,0,b),o(0,1,1,y,0,1,1,b),o(1,1,0,y,1,1,0,b),o(1,1,1,y,1,1,1,b)):(o(0,1,0,y,0,0,0,b),o(0,1,0,y,0,1,0,b),o(0,1,1,y,0,0,1,b),o(0,1,1,y,0,1,1,b),o(1,1,0,y,1,0,0,b),o(1,1,0,y,1,1,0,b),o(1,1,1,y,1,0,1,b),o(1,1,1,y,1,1,1,b))}for(let h=u.length-1;h>=0;h--){const a=u[h],y=a.scanCode,c=k._charCodeToKb(a.value);if(!c)continue;const p=c.shiftKey,f=c.keyCode;p?(o(0,0,0,y,0,1,0,f),o(0,0,1,y,0,1,1,f),o(1,0,0,y,1,1,0,f),o(1,0,1,y,1,1,1,f)):(o(0,0,0,y,0,0,0,f),o(0,0,1,y,0,0,1,f),o(0,1,0,y,0,1,0,f),o(0,1,1,y,0,1,1,f),o(1,0,0,y,1,0,0,f),o(1,0,1,y,1,0,1,f),o(1,1,0,y,1,1,0,f),o(1,1,1,y,1,1,1,f))}s(0,0,0,36,22),s(0,0,0,37,23),s(0,0,0,38,24),s(0,0,0,39,25),s(0,0,0,40,26),s(0,0,0,41,27),s(0,0,0,42,28),s(0,0,0,43,29),s(0,0,0,44,30),s(0,0,0,45,21),this._scanCodeKeyCodeMapper.registrationComplete()}dumpDebugInfo(){const e=[],t=[88,104];let n=0;e.push(`isUSStandard: ${this._isUSStandard}`),e.push("----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------");for(let i=0;i<193;i++){if(v[i]!==-1&&t.indexOf(i)===-1)continue;n%4===0&&(e.push("|       HW Code combination      |  Key  |    KeyCode combination    | Pri |          UI label         |         User settings          |    Electron accelerator   |       Dispatching string       | WYSIWYG |"),e.push("----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------")),n++;const o=this._codeInfo[i];for(let s=0;s<8;s++){const d=!!(s&1),u=!!(s&2),m=!!(s&4),h=new F(d,u,m,i),a=this.resolveKeyboardEvent({_standardKeyboardEventBrand:!0,ctrlKey:h.ctrlKey,shiftKey:h.shiftKey,altKey:h.altKey,metaKey:!1,altGraphKey:!1,keyCode:-1,code:S.toString(i)}),y=h.toString(),c=h.getProducedChar(o),p=a.getAriaLabel(),f=p?p.replace(/Control\+/,"Ctrl+"):null,b=a.getUserSettingsLabel(),C=a.getElectronAccelerator(),L=a.getDispatchChords()[0],q=(a?a.isWYSIWYG():!1)?"       ":"   NO  ",R=this._scanCodeKeyCodeMapper.lookupScanCodeCombo(h);if(R.length===0)e.push(`| ${this._leftPad(y,30)} | ${c} | ${this._leftPad("",25)} | ${this._leftPad("",3)} | ${this._leftPad(f,25)} | ${this._leftPad(b,30)} | ${this._leftPad(C,25)} | ${this._leftPad(L,30)} | ${q} |`);else for(let $=0,ee=R.length;$<ee;$++){const Ce=R[$];let W;const te=this._scanCodeKeyCodeMapper.lookupKeyCodeCombo(Ce);if(te.length===1)W="";else{let _e=-1;for(let B=0;B<te.length;B++)if(te[B].equals(h)){_e=B+1;break}W=String(_e)}const Ke=Ce.toString();$===0?e.push(`| ${this._leftPad(y,30)} | ${c} | ${this._leftPad(Ke,25)} | ${this._leftPad(W,3)} | ${this._leftPad(f,25)} | ${this._leftPad(b,30)} | ${this._leftPad(C,25)} | ${this._leftPad(L,30)} | ${q} |`):e.push(`| ${this._leftPad("",30)} |       | ${this._leftPad(Ke,25)} | ${this._leftPad(W,3)} | ${this._leftPad("",25)} | ${this._leftPad("",30)} | ${this._leftPad("",25)} | ${this._leftPad("",30)} |         |`)}}e.push("----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------")}return e.join(`
`)}_leftPad(e,t){for(e===null&&(e="null");e.length<t;)e=" "+e;return e}keyCodeChordToScanCodeChord(e){if(e.keyCode===3)return[new T(e.ctrlKey,e.shiftKey,e.altKey,e.metaKey,46)];const t=this._scanCodeKeyCodeMapper.lookupKeyCodeCombo(new ue(e.ctrlKey,e.shiftKey,e.altKey,e.keyCode)),n=[];for(let i=0,o=t.length;i<o;i++){const s=t[i];n[i]=new T(s.ctrlKey,s.shiftKey,s.altKey,e.metaKey,s.scanCode)}return n}getUILabelForScanCodeChord(e){if(!e)return null;if(e.isDuplicateModifierCase())return"";if(this._OS===2)switch(e.scanCode){case 86:return"←";case 88:return"↑";case 85:return"→";case 87:return"↓"}return this._scanCodeToLabel[e.scanCode]}getAriaLabelForScanCodeChord(e){return e?e.isDuplicateModifierCase()?"":this._scanCodeToLabel[e.scanCode]:null}getDispatchStrForScanCodeChord(e){const t=this._scanCodeToDispatch[e.scanCode];if(!t)return null;let n="";return e.ctrlKey&&(n+="ctrl+"),e.shiftKey&&(n+="shift+"),e.altKey&&(n+="alt+"),e.metaKey&&(n+="meta+"),n+=t,n}getUserSettingsLabelForScanCodeChord(e){if(!e)return null;if(e.isDuplicateModifierCase())return"";const t=v[e.scanCode];if(t!==-1)return _.toUserSettingsUS(t).toLowerCase();const n=this._scanCodeKeyCodeMapper.guessStableKeyCode(e.scanCode);if(n!==-1){const i=this.keyCodeChordToScanCodeChord(new A(e.ctrlKey,e.shiftKey,e.altKey,e.metaKey,n));for(let o=0,s=i.length;o<s;o++)if(i[o].scanCode===e.scanCode)return _.toUserSettingsUS(n).toLowerCase()}return this._scanCodeToDispatch[e.scanCode]}getElectronAcceleratorLabelForScanCodeChord(e){if(!e)return null;const t=v[e.scanCode];if(t!==-1)return _.toElectronAccelerator(t);const n=this._scanCodeKeyCodeMapper.guessStableKeyCode(e.scanCode);return this._OS===3&&!this._isUSStandard&&(n===85||n===86||n===87||n===88||n===89||n===90||n===91||n===92||n===93||n===94)?null:n!==-1?_.toElectronAccelerator(n):null}_toResolvedKeybinding(e){if(e.length===0)return[];const t=[];return this._generateResolvedKeybindings(e,0,[],t),t}_generateResolvedKeybindings(e,t,n,i){const o=e[t],s=t===e.length-1;for(let d=0,u=o.length;d<u;d++){const m=[...n,o[d]];s?i.push(new Pe(this,this._OS,m)):this._generateResolvedKeybindings(e,t+1,m,i)}}resolveKeyboardEvent(e){let t=S.toEnum(e.code);t===94&&(t=46);const n=e.keyCode;if(n===15||n===16||n===17||n===18||n===20||n===19||n===14||n===13||n===12||n===11||n===1){const d=Ie[n];d!==-1&&(t=d)}else if((t===95||t===96||t===97||t===98||t===99||t===100||t===101||t===102||t===103||t===104||t===105)&&n>=0){const d=Ie[n];d!==-1&&(t=d)}const i=e.ctrlKey||this._mapAltGrToCtrlAlt&&e.altGraphKey,o=e.altKey||this._mapAltGrToCtrlAlt&&e.altGraphKey,s=new T(i,e.shiftKey,o,e.metaKey,t);return new Pe(this,this._OS,[s])}_resolveChord(e){return e?e instanceof T?[e]:this.keyCodeChordToScanCodeChord(e):[]}resolveKeybinding(e){const t=e.chords.map(n=>this._resolveChord(n));return this._toResolvedKeybinding(t)}static _redirectCharCode(e){switch(e){case 12290:return 46;case 12300:return 91;case 12301:return 93;case 12304:return 91;case 12305:return 93;case 65307:return 59;case 65292:return 44}return e}static _charCodeToKb(e){return e=this._redirectCharCode(e),e<O.length?O[e]:null}static getCharCode(e){if(e.length===0)return 0;const t=e.charCodeAt(0);switch(t){case 768:return 96;case 769:return 180;case 770:return 94;case 771:return 732;case 772:return 175;case 773:return 8254;case 774:return 728;case 775:return 729;case 776:return 168;case 778:return 730;case 779:return 733}return t}}(function(){function l(e,t,n){for(let i=O.length;i<e;i++)O[i]=null;O[e]={keyCode:t,shiftKey:n}}for(let e=65;e<=90;e++)l(e,31+(e-65),!0);for(let e=97;e<=122;e++)l(e,31+(e-97),!1);l(59,85,!1),l(58,85,!0),l(61,86,!1),l(43,86,!0),l(44,87,!1),l(60,87,!0),l(45,88,!1),l(95,88,!0),l(46,89,!1),l(62,89,!0),l(47,90,!1),l(63,90,!0),l(96,91,!1),l(126,91,!0),l(91,92,!1),l(123,92,!0),l(92,93,!1),l(124,93,!0),l(93,94,!1),l(125,94,!0),l(39,95,!1),l(34,95,!0)})();function Ft(l){switch(l){case"./keyboardLayouts/layout.contribution.darwin.js":return oe(()=>import("./layout.contribution.darwin-4d95a593.js"),["assets/layout.contribution.darwin-4d95a593.js","assets/_.contribution-49d36299.js"]).then(e=>e.default??e);case"./keyboardLayouts/layout.contribution.linux.js":return oe(()=>import("./layout.contribution.linux-60d75b79.js"),["assets/layout.contribution.linux-60d75b79.js","assets/_.contribution-49d36299.js"]).then(e=>e.default??e);case"./keyboardLayouts/layout.contribution.win.js":return oe(()=>import("./layout.contribution.win-6e4f05fb.js"),["assets/layout.contribution.win-6e4f05fb.js","assets/_.contribution-49d36299.js"]).then(e=>e.default??e);default:return new Promise(function(e,t){(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(t.bind(null,new Error("Unknown variable dynamic import: "+l)))})}}class jt extends j{get activeKeymap(){return this._activeKeymapInfo}get keymapInfos(){return this._keymapInfos}get activeKeyboardLayout(){var e;return this._initialized?((e=this._activeKeymapInfo)==null?void 0:e.layout)??null:null}get activeKeyMapping(){var e;return this._initialized?((e=this._activeKeymapInfo)==null?void 0:e.mapping)??null:null}get keyboardLayouts(){return this._keymapInfos.map(e=>e.layout)}constructor(e){super(),this._configurationService=e,this._onDidChangeKeyboardMapper=new U,this.onDidChangeKeyboardMapper=this._onDidChangeKeyboardMapper.event,this._keyboardMapper=null,this._initialized=!1,this._keymapInfos=[],this._mru=[],this._activeKeymapInfo=null,navigator.keyboard&&navigator.keyboard.addEventListener&&navigator.keyboard.addEventListener("layoutchange",()=>{this._getBrowserKeyMapping().then(t=>{this.isKeyMappingActive(t)||this.setLayoutFromBrowserAPI()})}),this._register(this._configurationService.onDidChangeConfiguration(t=>{t.affectsConfiguration("keyboard")&&(this._keyboardMapper=null,this._onDidChangeKeyboardMapper.fire())}))}registerKeyboardLayout(e){this._keymapInfos.push(e),this._mru=this._keymapInfos}removeKeyboardLayout(e){let t=this._mru.indexOf(e);this._mru.splice(t,1),t=this._keymapInfos.indexOf(e),this._keymapInfos.splice(t,1)}getMatchedKeymapInfo(e){if(!e)return null;const t=this.getUSStandardLayout();if(t){let n=t.getScore(e);if(n===0)return{result:t,score:0};let i=t;for(let o=0;o<this._mru.length;o++){const s=this._mru[o].getScore(e);if(s>n){if(s===0)return{result:this._mru[o],score:0};n=s,i=this._mru[o]}}return{result:i,score:n}}for(let n=0;n<this._mru.length;n++)if(this._mru[n].fuzzyEqual(e))return{result:this._mru[n],score:0};return null}getUSStandardLayout(){const e=this._mru.filter(t=>t.layout.isUSStandard);return e.length?e[0]:null}isKeyMappingActive(e){return this._activeKeymapInfo&&e&&this._activeKeymapInfo.fuzzyEqual(e)}setUSKeyboardLayout(){this._activeKeymapInfo=this.getUSStandardLayout()}setActiveKeyMapping(e){let t=!1;const n=this.getMatchedKeymapInfo(e);if(n&&(this._activeKeymapInfo?e&&n.result.getScore(e)>this._activeKeymapInfo.getScore(e)&&(this._activeKeymapInfo=n.result,t=!0):(this._activeKeymapInfo=n.result,t=!0)),this._activeKeymapInfo||(this._activeKeymapInfo=this.getUSStandardLayout(),t=!0),!this._activeKeymapInfo||!t)return;const i=this._mru.indexOf(this._activeKeymapInfo);this._mru.splice(i,1),this._mru.unshift(this._activeKeymapInfo),this._setKeyboardData(this._activeKeymapInfo)}setActiveKeymapInfo(e){this._activeKeymapInfo=e;const t=this._mru.indexOf(this._activeKeymapInfo);t!==0&&(this._mru.splice(t,1),this._mru.unshift(this._activeKeymapInfo),this._setKeyboardData(this._activeKeymapInfo))}setLayoutFromBrowserAPI(){this._updateKeyboardLayoutAsync(this._initialized)}_updateKeyboardLayoutAsync(e,t){e&&this._getBrowserKeyMapping(t).then(n=>{this.isKeyMappingActive(n)||this.setActiveKeyMapping(n)})}getKeyboardMapper(){const e=Pt(this._configurationService);return e.dispatch===1||!this._initialized||!this._activeKeymapInfo?new Le(e.mapAltGrToCtrlAlt,w):(this._keyboardMapper||(this._keyboardMapper=new $t(Je._createKeyboardMapper(this._activeKeymapInfo,e.mapAltGrToCtrlAlt))),this._keyboardMapper)}validateCurrentKeyboardMapping(e){!this._initialized||this._validateCurrentKeyboardMapping(e)||this._updateKeyboardLayoutAsync(!0,e)}setKeyboardLayout(e){const t=this.keymapInfos.filter(n=>Q(n.layout)===e);t.length>0&&this.setActiveKeymapInfo(t[0])}_setKeyboardData(e){this._initialized=!0,this._keyboardMapper=null,this._onDidChangeKeyboardMapper.fire()}static _createKeyboardMapper(e,t){const n=e.mapping,i=!!e.layout.isUSStandard;return w===1?new Gt(i,n,t):Object.keys(n).length===0?new Le(t,w):new k(i,n,t,w)}_validateCurrentKeyboardMapping(e){if(!this._initialized)return!0;const t=e,n=this._activeKeymapInfo;if(!n||t.browserEvent.key==="Dead"||t.browserEvent.isComposing)return!0;const i=n.mapping[t.code];if(!i)return!1;if(i.value==="")return(e.ctrlKey||e.metaKey)&&setTimeout(()=>{this._getBrowserKeyMapping().then(d=>{this.isKeyMappingActive(d)||this.setLayoutFromBrowserAPI()})},350),!0;const o=t.altKey&&t.shiftKey?i.withShiftAltGr:t.altKey?i.withAltGr:t.shiftKey?i.withShift:i.value,s=t.altKey&&t.shiftKey&&i.withShiftAltGrIsDeadKey||t.altKey&&i.withAltGrIsDeadKey||t.shiftKey&&i.withShiftIsDeadKey||i.valueIsDeadKey;return!(s&&t.browserEvent.key!=="Dead"||!s&&t.browserEvent.key!==o)}async _getBrowserKeyMapping(e){if(navigator.keyboard)try{return navigator.keyboard.getLayoutMap().then(t=>{const n={};for(const i of t)n[i[0]]={value:i[1],withShift:"",withAltGr:"",withShiftAltGr:""};return n})}catch{}else if(e&&!e.shiftKey&&!e.altKey&&!e.metaKey&&!e.metaKey){const t={},n=e;return t[n.browserEvent.code]={value:n.browserEvent.key,withShift:"",withAltGr:"",withShiftAltGr:""},this.getMatchedKeymapInfo(t)?t:null}return null}}class Je extends jt{constructor(e,t,n,i){super(e),Ft("./keyboardLayouts/layout.contribution."+(ae?"win":Fe?"darwin":"linux")+".js").then(s=>{const d=s.KeyboardLayoutContribution.INSTANCE.layoutInfos;this._keymapInfos.push(...d.map(u=>new Z(u.layout,u.secondaryLayouts,u.mapping,u.isUserKeyboardLayout))),this._mru=this._keymapInfos,this._initialized=!0,this.setLayoutFromBrowserAPI()})}}class qt extends j{get keyboardLayout(){return this._keyboardLayout}constructor(e,t){super(),this.keyboardLayoutResource=e,this.fileService=t,this._onDidChange=this._register(new U),this.onDidChange=this._onDidChange.event,this._keyboardLayout=null,this.reloadConfigurationScheduler=this._register(new je(()=>this.reload().then(n=>{n&&this._onDidChange.fire()}),50)),this._register(J.filter(this.fileService.onDidFilesChange,n=>n.contains(this.keyboardLayoutResource))(()=>this.reloadConfigurationScheduler.schedule()))}async initialize(){await this.reload()}async reload(){const e=this._keyboardLayout;try{const t=await this.fileService.readFile(this.keyboardLayoutResource),n=We(t.value.toString());if(bt(n)==="object"){const i=n.layout,o=n.rawMapping;this._keyboardLayout=Z.createKeyboardLayoutFromDebugInfo(i,o,!0)}else this._keyboardLayout=null}catch{this._keyboardLayout=null}return e?!qe(e,this._keyboardLayout):!0}}let le=class extends j{constructor(e,t,n,i,o,s){super(),this.configurationService=s,this._onDidChangeKeyboardLayout=new U,this.onDidChangeKeyboardLayout=this._onDidChangeKeyboardLayout.event;const u=s.getValue("keyboard").layout;this._keyboardLayoutMode=u??"autodetect",this._factory=new Je(s,n,i,o),this._register(this._factory.onDidChangeKeyboardMapper(()=>{this._onDidChangeKeyboardLayout.fire()})),u&&u!=="autodetect"&&this._factory.setKeyboardLayout(u),this._register(s.onDidChangeConfiguration(m=>{if(m.affectsConfiguration("keyboard.layout")){const a=s.getValue("keyboard").layout;this._keyboardLayoutMode=a,a==="autodetect"?this._factory.setLayoutFromBrowserAPI():this._factory.setKeyboardLayout(a)}})),this._userKeyboardLayout=new qt(e.keyboardLayoutResource,t),this._userKeyboardLayout.initialize().then(()=>{this._userKeyboardLayout.keyboardLayout&&(this._factory.registerKeyboardLayout(this._userKeyboardLayout.keyboardLayout),this.setUserKeyboardLayoutIfMatched())}),this._register(this._userKeyboardLayout.onDidChange(()=>{const m=this._factory.keymapInfos.filter(h=>h.isUserKeyboardLayout);m.length?this._userKeyboardLayout.keyboardLayout?m[0].update(this._userKeyboardLayout.keyboardLayout):this._factory.removeKeyboardLayout(m[0]):this._userKeyboardLayout.keyboardLayout&&this._factory.registerKeyboardLayout(this._userKeyboardLayout.keyboardLayout),this.setUserKeyboardLayoutIfMatched()}))}setUserKeyboardLayoutIfMatched(){const t=this.configurationService.getValue("keyboard").layout;t&&this._userKeyboardLayout.keyboardLayout&&Q(this._userKeyboardLayout.keyboardLayout.layout)===t&&this._factory.activeKeymap&&(this._userKeyboardLayout.keyboardLayout.equal(this._factory.activeKeymap)||this._factory.setActiveKeymapInfo(this._userKeyboardLayout.keyboardLayout))}getKeyboardMapper(){return this._factory.getKeyboardMapper()}getCurrentKeyboardLayout(){return this._factory.activeKeyboardLayout}getAllKeyboardLayouts(){return this._factory.keyboardLayouts}getRawKeyboardMapping(){return this._factory.activeKeyMapping}validateCurrentKeyboardMapping(e){this._keyboardLayoutMode==="autodetect"&&this._factory.validateCurrentKeyboardMapping(e)}};le=me([K(0,ft),K(1,pe),K(2,Re),K(3,pt),K(4,fe),K(5,gt)],le);const Wt=ge.as(Be.Configuration),Bt={id:"keyboard",order:15,type:"object",title:r("keyboardConfigurationTitle","Keyboard"),properties:{"keyboard.layout":{type:"string",default:"autodetect",description:r("keyboard.layout.config","Control the keyboard layout used in web.")}}};Wt.registerConfiguration(Bt);let he=class extends j{constructor(e,t,n){super(),this._instantiationService=e,this._extensionService=t,this._logService=n,this._extensionHostIsReady=!1,this._onWillExecuteCommand=this._register(new U),this.onWillExecuteCommand=this._onWillExecuteCommand.event,this._onDidExecuteCommand=new U,this.onDidExecuteCommand=this._onDidExecuteCommand.event,this._extensionService.whenInstalledExtensionsRegistered().then(i=>this._extensionHostIsReady=i),this._starActivation=null}_activateStar(){return this._starActivation||(this._starActivation=Promise.race([this._extensionService.activateByEvent("*"),Kt(3e4)])),this._starActivation}async executeCommand(e,...t){this._logService.trace("CommandService#executeCommand",e);const n=`onCommand:${e}`;return V.getCommand(e)?this._extensionService.activationEventIsDone(n)?this._tryExecuteCommand(e,t):this._extensionHostIsReady?(await this._extensionService.activateByEvent(n),this._tryExecuteCommand(e,t)):(this._extensionService.activateByEvent(n),this._tryExecuteCommand(e,t)):(await Promise.all([this._extensionService.activateByEvent(n),Promise.race([this._activateStar(),J.toPromise(J.filter(V.onDidRegisterCommand,o=>o===e))])]),this._tryExecuteCommand(e,t))}_tryExecuteCommand(e,t){const n=V.getCommand(e);if(!n)return Promise.reject(new Error(`command '${e}' not found`));try{this._onWillExecuteCommand.fire({commandId:e,args:t});const i=this._instantiationService.invokeFunction(n.handler,...t);return this._onDidExecuteCommand.fire({commandId:e,args:t}),Promise.resolve(i)}catch(i){return Promise.reject(i)}}};he=me([K(0,Ct),K(1,$e),K(2,Ge)],he);async function Jt(l){const e=Te.get(_t);await Te.get(pe).writeFile(e.defaultProfile.keybindingsResource,St.fromString(l))}function Qt(){return{...kt(),[vt.toString()]:new se(ce),[Oe.toString()]:new se(le,void 0,!0),[fe.toString()]:new se(he)}}export{Qt as default,Jt as updateUserKeybindings};
